<!DOCTYPE html>
<html id="docs" lang="zh" class="">
	<head>
	

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-36037335-10"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-36037335-10');
</script>
<meta charset="utf-8">
<title>使用自定义资源 - Kubernetes</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#326ce5">
<link rel="shortcut icon" type="image/png" href="/images/favicon.png">









<link rel="stylesheet" href="/css/style.b7b8403eb5b1fddd0a2da2a8383d5b53e6ef81c23e4b0e292e6103bd91f9502d.css" integrity="sha256-t7hAPrWx/d0KLaKoOD1bU&#43;bvgcI&#43;Sw4pLmEDvZH5UC0=">


<link rel="stylesheet" href="/css/base_fonts.css">
<link rel="stylesheet" href="/css/jquery-ui.min.css">
<link rel="stylesheet" href="/css/callouts.css">
<link rel="stylesheet" href="/css/custom-jekyll/tags.css">



<meta name="description" content="">
<meta property="og:description" content="">
<meta name="twitter:description" content="">
<meta property="og:url" content="https://kubernetes.io/zh/docs/tasks/access-kubernetes-api/custom-resources/">
<meta property="og:title" content="使用自定义资源">
<meta name="twitter:title" content="使用自定义资源">
<meta name="twitter:image" content="https://kubernetes.io/images/favicon.png" />

<meta name="twitter:image:alt" content="Kubernetes">

<meta property="og:image" content="/images/kubernetes-horizontal-color.png">

<meta property="og:type" content="article">
<script src="/js/anchor-4.1.1.min.js"></script>
<script src="/js/jquery-3.2.1.min.js"></script>
<script src="/js/jquery-ui-1.12.1.min.js"></script>
<script src="/js/bootstrap-4.3.1.min.js"></script>
<script src="/js/sweetalert-2.1.2.min.js"></script>

<script src="/js/script.js"></script>
<script src="/js/custom-jekyll/tags.js"></script>


	</head>
	<body>
		<div id="cellophane" onclick="kub.toggleMenu()"></div>

<header>
    <a href="/zh/" class="logo" title="生产级别的容器编排系统 - Kubernetes" aria-label="Kubernetes website"></a>

    <div class="nav-buttons" data-auto-burger="primary">
        <ul class="global-nav">
            
            
            <li><a href="/zh/docs/" class="active">文档</a></li>
            
            <li><a href="/zh/blog/">博客</a></li>
            
            
            
            <li><a href="/zh/partners/">合作伙伴</a></li>
            
            <li><a href="/zh/community/">社区</a></li>
            
            <li><a href="/zh/case-studies/">案例分析</a></li>
            
            
            
             <li>
                <a href="#">
                    中文 Chinese <span class="ui-icon ui-icon-carat-1-s"></span>
                </a>
                <ul>
                
                    <li><a href="/docs/tasks/access-kubernetes-api/custom-resources/">English</a></li>
                
                    <li><a href="/fr/docs/tasks/access-kubernetes-api/custom-resources/">Français</a></li>
                
                    <li><a href="/es/docs/tasks/access-kubernetes-api/custom-resources/">Español</a></li>
                
                </ul>
            </li>

            <li>
                <a href="#">
                    v1.17 <span class="ui-icon ui-icon-carat-1-s"></span>
                </a>
                <ul>
                
                    <li><a href="https://kubernetes.io/zh/docs/tasks/access-kubernetes-api/custom-resources/">v1.21</a></li>
                
                    <li><a href="https://v1-20.docs.kubernetes.io/zh/docs/tasks/access-kubernetes-api/custom-resources/">v1.20</a></li>
                
                    <li><a href="https://v1-19.docs.kubernetes.io/zh/docs/tasks/access-kubernetes-api/custom-resources/">v1.19</a></li>
                
                    <li><a href="https://v1-18.docs.kubernetes.io/zh/docs/tasks/access-kubernetes-api/custom-resources/">v1.18</a></li>
                
                    <li><a href="https://v1-17.docs.kubernetes.io/zh/docs/tasks/access-kubernetes-api/custom-resources/">v1.17</a></li>
                
                </ul>
            </li>
        </ul>
        
        <a href="/zh/docs/tutorials/kubernetes-basics/" class="button" id="tryKubernetes" data-auto-burger-exclude>学习 Kubernetes 基础知识</a>
        

        <button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
    </div>

    <nav id="mainNav">
        <div class="main-section" data-auto-burger="primary">
         
           <div class="nav-box">
            <h3><a href="/zh/docs/tutorials/hello-minikube/">Get Started</a></h3>
           <p>Ready to get your hands dirty? Build a simple Kubernetes cluster that runs "Hello World" for Node.js.</p>

            </div>
         
           <div class="nav-box">
            <h3><a href="/zh/docs/home/">文档</a></h3>
           <p>通过演练，示例和参考文档了解如何使用 Kubernetes。你甚至可以<a href="/editdocs/" data-auto-burger-exclude>帮助贡献文档</a>！</p>

            </div>
         
           <div class="nav-box">
            <h3><a href="/zh/blog/">博客</a></h3>
           <p>阅读关于 kubernetes 和容器规范的最新信息,以及获取最新的技术。</p>

            </div>
         
        </div>
        <div class="main-section" data-auto-burger="primary">
            <div class="left">
                <h5 class="github-invite">想要修改 Kubernetes 的核心源代码？</h5>
                <a href="https://github.com/kubernetes/kubernetes" class="button" data-auto-burger-exclude>在 GitHub 上查看</a>
            </div>

            <div class="right">
                <h5 class="github-invite">了解社区</h5>
                <div class="social">
                    <a href="https://twitter.com/kubernetesio" class="twitter"><span>Twitter</span></a>
                    <a href="https://github.com/kubernetes/kubernetes" class="github"><span>GitHub</span></a>
                    <a href="http://slack.k8s.io/" class="slack"><span>Slack Slack</span></a>
                    <a href="https://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                    <a href="https://www.youtube.com/kubernetescommunity" class="youtube"><span>YouTube</span></a>
                    <a href="https://discuss.kubernetes.io" class="mailing-list"><span>论坛</span></a>
                    <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>事件日历</span></a>
                </div>
            </div>
            <div class="clear" style="clear: both"></div>
        </div>
    </nav>
</header>

		
		
		<section id="hero" class="light-text no-sub">
			











<h1>任务</h1>
<h5></h5>








<div id="vendorStrip" class="light-text">
	<ul>
		
		
		<li><a href="/zh/docs/home/">主页</a></li>
		
		
		<li><a href="/zh/docs/setup/">入门</a></li>
		
		
		<li><a href="/zh/docs/concepts/">概念</a></li>
		
		
		<li><a href="/zh/docs/tasks/" class="YAH">任务</a></li>
		
		
		<li><a href="/zh/docs/tutorials/">教程</a></li>
		
		
		<li><a href="/zh/docs/reference/">参考</a></li>
		
		
		<li><a href="/zh/docs/contribute/">贡献</a></li>
		
	</ul>
	<form id="searchBox" action="/docs/search/" role="search">
		<input type="text" id="search" name="q" placeholder="搜索" aria-label="Search">
	</form>
</div>

		</section>
		
    
		
<section id="deprecationWarning">
  <main>
    <div class="content deprecation-warning">
      <h3>
	 Kubernetes v1.17
	  版本的文档已不再维护。您现在看到的版本来自于一份静态的快照。如需查阅最新文档，请点击
	 <a href="https://kubernetes.io/docs/home/">最新版本。</a>
      </h3>
    </div>
  </main>
</section>


    <main>
        <section id="encyclopedia">
          
<div id="docsToc">
     <div class="pi-accordion">
    	
        
        
        
        
        
         
             
                 
             
         
             
                 
             
         
             
                 
             
         
             
                 
                          
                          
                 
             
         
             
         
             
         
             
         
         
        
        <a class="item" data-title="任务" href="/zh/docs/tasks/"></a>

	
	
			
			
			
			
			
		
	
	
	
		
			
<div class="item" data-title="安装工具">
	<div class="container">
		
		
		
		<a class="item" data-title="安装工具" href="/zh/docs/tasks/tools/"></a>
		
		
	
	
			
			
			
			
			
		
	
	
	
		
			

<a class="item" data-title="安装并设置 kubectl" href="/zh/docs/tasks/tools/install-kubectl/"></a>

		
	
		
			

<a class="item" data-title="安装 Minikube" href="/zh/docs/tasks/tools/install-minikube/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="管理集群">
	<div class="container">
		
		
		
		<a class="item" data-title="管理集群" href="/zh/docs/tasks/administer-cluster/"></a>
		
		
	
	
			
			
			
			
			
		
	
	
	
		
			
<div class="item" data-title="用 kubeadm 进行管理">
	<div class="container">
		
		
		
		<a class="item" data-title="用 kubeadm 进行管理" href="/zh/docs/tasks/administer-cluster/kubeadm/"></a>
		
		
	
	
			
			
			
			
			
		
	
	
	
		
			

<a class="item" data-title="使用 kubeadm 进行证书管理" href="/zh/docs/tasks/administer-cluster/kubeadm/kubeadm-certs/"></a>

		
	
		
			

<a class="item" data-title="升级 kubeadm 集群" href="/zh/docs/tasks/administer-cluster/kubeadm/kubeadm-upgrade/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="管理内存，CPU 和 API 资源">
	<div class="container">
		
		
		
		<a class="item" data-title="管理内存，CPU 和 API 资源" href="/zh/docs/tasks/administer-cluster/manage-resources/"></a>
		
		
	
	
			
			
			
			
			
		
	
	
	
		
			

<a class="item" data-title="为命名空间配置默认的内存请求和限制" href="/zh/docs/tasks/administer-cluster/manage-resources/memory-default-namespace/"></a>

		
	
		
			

<a class="item" data-title="为命名空间配置默认的CPU请求和限制" href="/zh/docs/tasks/administer-cluster/manage-resources/cpu-default-namespace/"></a>

		
	
		
			

<a class="item" data-title="配置命名空间的最小和最大内存约束" href="/zh/docs/tasks/administer-cluster/manage-resources/memory-constraint-namespace/"></a>

		
	
		
			

<a class="item" data-title="为命名空间配置CPU最小和最大限制" href="/zh/docs/tasks/administer-cluster/manage-resources/cpu-constraint-namespace/"></a>

		
	
		
			

<a class="item" data-title="为命名空间配置内存和 CPU 配额" href="/zh/docs/tasks/administer-cluster/manage-resources/quota-memory-cpu-namespace/"></a>

		
	
		
			

<a class="item" data-title="配置命名空间下pod总数" href="/zh/docs/tasks/administer-cluster/manage-resources/quota-pod-namespace/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="Install a Network Policy Provider">
	<div class="container">
		
		
		
		<a class="item" data-title="Install a Network Policy Provider" href="/zh/docs/tasks/administer-cluster/network-policy-provider/"></a>
		
		
	
	
			
			
			
			
			
		
	
	
	
		
			

<a class="item" data-title="使用 Calico 作为 NetworkPolicy" href="/zh/docs/tasks/administer-cluster/network-policy-provider/calico-network-policy/"></a>

		
	
		
			

<a class="item" data-title="使用 Cilium 作为 NetworkPolicy" href="/zh/docs/tasks/administer-cluster/network-policy-provider/cilium-network-policy/"></a>

		
	
		
			

<a class="item" data-title="使用 Kube-router 作为 NetworkPolicy" href="/zh/docs/tasks/administer-cluster/network-policy-provider/kube-router-network-policy/"></a>

		
	
		
			

<a class="item" data-title="使用 Romana 作为 NetworkPolicy" href="/zh/docs/tasks/administer-cluster/network-policy-provider/romana-network-policy/"></a>

		
	
		
			

<a class="item" data-title="使用 Weave Net 作为 NetworkPolicy" href="/zh/docs/tasks/administer-cluster/network-policy-provider/weave-network-policy/"></a>

		
	

	</div>
</div>

		
	
		
			

<a class="item" data-title="Debug DNS 方案" href="/zh/docs/tasks/administer-cluster/dns-debugging-resolution/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Enabling Service Topology <small>(EN)</small>" href="/docs/tasks/administer-cluster/enabling-service-topology/"></a>

		
	
		
			

<a class="item" data-title="IP Masquerade Agent 用户指南" href="/zh/docs/tasks/administer-cluster/ip-masq-agent/"></a>

		
	
		
			

<a class="item" data-title="Kubernetes 云管理控制器" href="/zh/docs/tasks/administer-cluster/running-cloud-controller/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Safely Drain a Node while Respecting the PodDisruptionBudget <small>(EN)</small>" href="/docs/tasks/administer-cluster/safely-drain-node/"></a>

		
	
		
			

<a class="item" data-title="为 Kubernetes 运行 etcd 集群" href="/zh/docs/tasks/administer-cluster/configure-upgrade-etcd/"></a>

		
	
		
			

<a class="item" data-title="为系统守护进程预留计算资源" href="/zh/docs/tasks/administer-cluster/reserve-compute-resources/"></a>

		
	
		
			

<a class="item" data-title="为节点发布扩展资源" href="/zh/docs/tasks/administer-cluster/extended-resource-node/"></a>

		
	
		
			

<a class="item" data-title="使用 CoreDNS 进行服务发现" href="/zh/docs/tasks/administer-cluster/coredns/"></a>

		
	
		
			

<a class="item" data-title="使用 KMS 提供商进行数据加密" href="/zh/docs/tasks/administer-cluster/kms-provider/"></a>

		
	
		
			

<a class="item" data-title="使用 Kubernetes API 访问集群" href="/zh/docs/tasks/administer-cluster/access-cluster-api/"></a>

		
	
		
			

<a class="item" data-title="关键插件 Pod 的调度保证" href="/zh/docs/tasks/administer-cluster/guaranteed-scheduling-critical-addon-pods/"></a>

		
	
		
			

<a class="item" data-title="启用端点切片" href="/zh/docs/tasks/administer-cluster/enabling-endpointslices/"></a>

		
	
		
			

<a class="item" data-title="命名空间演练" href="/zh/docs/tasks/administer-cluster/namespaces-walkthrough/"></a>

		
	
		
			

<a class="item" data-title="在 Kubernetes 集群中使用 NodeLocal DNSCache" href="/zh/docs/tasks/administer-cluster/nodelocaldns/"></a>

		
	
		
			

<a class="item" data-title="在 Kubernetes 集群中使用 sysctl" href="/zh/docs/tasks/administer-cluster/sysctl-cluster/"></a>

		
	
		
			

<a class="item" data-title="在实时集群上重新配置节点的 Kubelet" href="/zh/docs/tasks/administer-cluster/reconfigure-kubelet/"></a>

		
	
		
			

<a class="item" data-title="声明网络策略" href="/zh/docs/tasks/administer-cluster/declare-network-policy/"></a>

		
	
		
			

<a class="item" data-title="开发云控制器管理器" href="/zh/docs/tasks/administer-cluster/developing-cloud-controller-manager/"></a>

		
	
		
			

<a class="item" data-title="控制节点上的 CPU 管理策略" href="/zh/docs/tasks/administer-cluster/cpu-management-policies/"></a>

		
	
		
			

<a class="item" data-title="控制节点上的拓扑管理策略" href="/zh/docs/tasks/administer-cluster/topology-manager/"></a>

		
	
		
			

<a class="item" data-title="搭建高可用的 Kubernetes Masters" href="/zh/docs/tasks/administer-cluster/highly-available-master/"></a>

		
	
		
			

<a class="item" data-title="改变默认 StorageClass" href="/zh/docs/tasks/administer-cluster/change-default-storage-class/"></a>

		
	
		
			

<a class="item" data-title="更改 PersistentVolume 的回收策略" href="/zh/docs/tasks/administer-cluster/change-pv-reclaim-policy/"></a>

		
	
		
			

<a class="item" data-title="自定义 DNS 服务" href="/zh/docs/tasks/administer-cluster/dns-custom-nameservers/"></a>

		
	
		
			

<a class="item" data-title="访问集群上运行的服务" href="/zh/docs/tasks/administer-cluster/access-cluster-services/"></a>

		
	
		
			

<a class="item" data-title="通过命名空间共享集群" href="/zh/docs/tasks/administer-cluster/namespaces/"></a>

		
	
		
			

<a class="item" data-title="通过配置文件设置 Kubelet 参数" href="/zh/docs/tasks/administer-cluster/kubelet-config-file/"></a>

		
	
		
			

<a class="item" data-title="配置 API 对象配额" href="/zh/docs/tasks/administer-cluster/quota-api-object/"></a>

		
	
		
			

<a class="item" data-title="配置多个调度器" href="/zh/docs/tasks/administer-cluster/configure-multiple-schedulers/"></a>

		
	
		
			

<a class="item" data-title="配置资源不足时的处理方式" href="/zh/docs/tasks/administer-cluster/out-of-resource/"></a>

		
	
		
			

<a class="item" data-title="限制存储消耗" href="/zh/docs/tasks/administer-cluster/limit-storage-consumption/"></a>

		
	
		
			

<a class="item" data-title="集群 DNS 服务自动伸缩" href="/zh/docs/tasks/administer-cluster/dns-horizontal-autoscaling/"></a>

		
	
		
			

<a class="item" data-title="集群安全" href="/zh/docs/tasks/administer-cluster/securing-a-cluster/"></a>

		
	
		
			

<a class="item" data-title="集群管理" href="/zh/docs/tasks/administer-cluster/cluster-management/"></a>

		
	
		
			

<a class="item" data-title="静态加密 Secret 数据" href="/zh/docs/tasks/administer-cluster/encrypt-data/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="配置 Pods 和容器">
	<div class="container">
		
		
		
		<a class="item" data-title="配置 Pods 和容器" href="/zh/docs/tasks/configure-pod-container/"></a>
		
		
	
	
			
			
			
			
			
		
	
	
	
		
			

<a class="item" data-title="为容器和 Pod 分配内存资源" href="/zh/docs/tasks/configure-pod-container/assign-memory-resource/"></a>

		
	
		
			

<a class="item" data-title="Assign CPU Resources to Containers and Pods" href="/zh/docs/tasks/configure-pod-container/assign-cpu-resource/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Configure GMSA for Windows Pods and containers <small>(EN)</small>" href="/docs/tasks/configure-pod-container/configure-gmsa/"></a>

		
	
		
			

<a class="item" data-title="为 Windows 的 pod 和容器配置 RunAsUserName" href="/zh/docs/tasks/configure-pod-container/configure-runasusername/"></a>

		
	
		
			

<a class="item" data-title="配置 Pod 的服务质量" href="/zh/docs/tasks/configure-pod-container/quality-service-pod/"></a>

		
	
		
			

<a class="item" data-title="为容器分派扩展资源" href="/zh/docs/tasks/configure-pod-container/extended-resource/"></a>

		
	
		
			

<a class="item" data-title="配置 Pod 以使用卷进行存储" href="/zh/docs/tasks/configure-pod-container/configure-volume-storage/"></a>

		
	
		
			

<a class="item" data-title="配置 Pod 以使用 PersistentVolume 作为存储" href="/zh/docs/tasks/configure-pod-container/configure-persistent-volume-storage/"></a>

		
	
		
			

<a class="item" data-title="配置 Pod 使用投射卷作存储" href="/zh/docs/tasks/configure-pod-container/configure-projected-volume-storage/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Configure a Security Context for a Pod or Container <small>(EN)</small>" href="/docs/tasks/configure-pod-container/security-context/"></a>

		
	
		
			

<a class="item" data-title="为 Pod 配置服务账户" href="/zh/docs/tasks/configure-pod-container/configure-service-account/"></a>

		
	
		
			

<a class="item" data-title="从私有仓库拉取镜像" href="/zh/docs/tasks/configure-pod-container/pull-image-private-registry/"></a>

		
	
		
			

<a class="item" data-title="配置存活、就绪和启动探测器" href="/zh/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/"></a>

		
	
		
			

<a class="item" data-title="将 Pod 分配给节点" href="/zh/docs/tasks/configure-pod-container/assign-pods-nodes/"></a>

		
	
		
			

<a class="item" data-title="配置 Pod 初始化" href="/zh/docs/tasks/configure-pod-container/configure-pod-initialization/"></a>

		
	
		
			

<a class="item" data-title="为容器的生命周期事件设置处理函数" href="/zh/docs/tasks/configure-pod-container/attach-handler-lifecycle-event/"></a>

		
	
		
			

<a class="item" data-title="使用 ConfigMap 配置 Pod" href="/zh/docs/tasks/configure-pod-container/configure-pod-configmap/"></a>

		
	
		
			

<a class="item" data-title="在 Pod 中的容器之间共享进程命名空间" href="/zh/docs/tasks/configure-pod-container/share-process-namespace/"></a>

		
	
		
			

<a class="item" data-title="创建静态 Pod" href="/zh/docs/tasks/configure-pod-container/static-pod/"></a>

		
	
		
			

<a class="item" data-title="将 Docker Compose 文件转换为 Kubernetes 资源" href="/zh/docs/tasks/configure-pod-container/translate-compose-kubernetes/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="管理 Kubernetes 对象">
	<div class="container">
		
		
		
		<a class="item" data-title="管理 Kubernetes 对象" href="/zh/docs/tasks/manage-kubernetes-objects/"></a>
		
		
	
	
			
			
			
			
			
		
	
	
	
		
			

<a class="item" target="_blank" data-title="Declarative Management of Kubernetes Objects Using Configuration Files <small>(EN)</small>" href="/docs/tasks/manage-kubernetes-objects/declarative-config/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Declarative Management of Kubernetes Objects Using Kustomize <small>(EN)</small>" href="/docs/tasks/manage-kubernetes-objects/kustomization/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Managing Kubernetes Objects Using Imperative Commands <small>(EN)</small>" href="/docs/tasks/manage-kubernetes-objects/imperative-command/"></a>

		
	
		
			

<a class="item" data-title="使用配置文件对 Kubernetes 对象进行命令式管理" href="/zh/docs/tasks/manage-kubernetes-objects/imperative-config/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="给应用注入数据">
	<div class="container">
		
		
		
		<a class="item" data-title="给应用注入数据" href="/zh/docs/tasks/inject-data-application/"></a>
		
		
	
	
			
			
			
			
			
		
	
	
	
		
			

<a class="item" data-title="为容器设置启动时要执行的命令及其入参" href="/zh/docs/tasks/inject-data-application/define-command-argument-container/"></a>

		
	
		
			

<a class="item" data-title="为容器设置环境变量" href="/zh/docs/tasks/inject-data-application/define-environment-variable-container/"></a>

		
	
		
			

<a class="item" data-title="使用 PodPreset 将信息注入 Pods" href="/zh/docs/tasks/inject-data-application/podpreset/"></a>

		
	
		
			

<a class="item" data-title="使用 Secret 安全地分发凭证" href="/zh/docs/tasks/inject-data-application/distribute-credentials-secure/"></a>

		
	
		
			

<a class="item" data-title="通过文件将Pod信息呈现给容器" href="/zh/docs/tasks/inject-data-application/downward-api-volume-expose-pod-information/"></a>

		
	
		
			

<a class="item" data-title="通过环境变量将Pod信息呈现给容器" href="/zh/docs/tasks/inject-data-application/environment-variable-expose-pod-information/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="运行应用">
	<div class="container">
		
		
		
		<a class="item" data-title="运行应用" href="/zh/docs/tasks/run-application/"></a>
		
		
	
	
			
			
			
			
			
		
	
	
	
		
			

<a class="item" data-title="运行一个有状态的应用程序" href="/zh/docs/tasks/run-application/run-replicated-stateful-application/"></a>

		
	
		
			

<a class="item" data-title="使用 kubectl patch 更新 API 对象" href="/zh/docs/tasks/run-application/update-api-object-kubectl-patch/"></a>

		
	
		
			

<a class="item" data-title="删除 StatefulSet" href="/zh/docs/tasks/run-application/delete-stateful-set/"></a>

		
	
		
			

<a class="item" data-title="强制删除 StatefulSet 类型的 Pods" href="/zh/docs/tasks/run-application/force-delete-stateful-set-pod/"></a>

		
	
		
			

<a class="item" data-title="基于Replication Controller执行滚动升级" href="/zh/docs/tasks/run-application/rolling-update-replication-controller/"></a>

		
	
		
			

<a class="item" data-title="Pod 水平自动伸缩" href="/zh/docs/tasks/run-application/horizontal-pod-autoscale/"></a>

		
	
		
			

<a class="item" data-title="Horizontal Pod Autoscaler演练" href="/zh/docs/tasks/run-application/horizontal-pod-autoscale-walkthrough/"></a>

		
	
		
			

<a class="item" data-title="指定应用程序的中断预算（Disruption Budget）" href="/zh/docs/tasks/run-application/configure-pdb/"></a>

		
	
		
			

<a class="item" data-title="使用Deployment运行一个无状态应用" href="/zh/docs/tasks/run-application/run-stateless-application-deployment/"></a>

		
	
		
			

<a class="item" data-title="弹缩StatefulSet" href="/zh/docs/tasks/run-application/scale-stateful-set/"></a>

		
	
		
			

<a class="item" data-title="运行一个单实例有状态应用" href="/zh/docs/tasks/run-application/run-single-instance-stateful-application/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="运行 Jobs">
	<div class="container">
		
		
		
		<a class="item" data-title="运行 Jobs" href="/zh/docs/tasks/job/"></a>
		
		
	
	
			
			
			
			
			
		
	
	
	
		
			

<a class="item" data-title="使用 CronJob 运行自动化任务" href="/zh/docs/tasks/job/automated-tasks-with-cron-jobs/"></a>

		
	
		
			

<a class="item" data-title="使用扩展进行并行处理" href="/zh/docs/tasks/job/parallel-processing-expansion/"></a>

		
	
		
			

<a class="item" data-title="使用工作队列进行粗粒度并行处理" href="/zh/docs/tasks/job/coarse-parallel-processing-work-queue/"></a>

		
	
		
			

<a class="item" data-title="使用工作队列进行精细的并行处理" href="/zh/docs/tasks/job/fine-parallel-processing-work-queue/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="访问集群中的应用程序">
	<div class="container">
		
		
		
		<a class="item" data-title="访问集群中的应用程序" href="/zh/docs/tasks/access-application-cluster/"></a>
		
		
	
	
			
			
			
			
			
		
	
	
	
		
			

<a class="item" data-title="网页界面 (Dashboard)" href="/zh/docs/tasks/access-application-cluster/web-ui-dashboard/"></a>

		
	
		
			

<a class="item" data-title="访问集群" href="/zh/docs/tasks/access-application-cluster/access-cluster/"></a>

		
	
		
			

<a class="item" data-title="使用端口转发来访问集群中的应用" href="/zh/docs/tasks/access-application-cluster/port-forward-access-application-cluster/"></a>

		
	
		
			

<a class="item" data-title="使用服务来访问集群中的应用" href="/zh/docs/tasks/access-application-cluster/service-access-application-cluster/"></a>

		
	
		
			

<a class="item" data-title="创建一个外部负载均衡器" href="/zh/docs/tasks/access-application-cluster/create-external-load-balancer/"></a>

		
	
		
			

<a class="item" data-title="配置你的云平台防火墙" href="/zh/docs/tasks/access-application-cluster/configure-cloud-provider-firewall/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Set up Ingress on Minikube with the NGINX Ingress Controller <small>(EN)</small>" href="/docs/tasks/access-application-cluster/ingress-minikube/"></a>

		
	
		
			

<a class="item" data-title="列出集群中所有运行容器的镜像" href="/zh/docs/tasks/access-application-cluster/list-all-running-container-images/"></a>

		
	
		
			

<a class="item" data-title="为集群配置 DNS" href="/zh/docs/tasks/access-application-cluster/configure-dns-cluster/"></a>

		
	
		
			

<a class="item" data-title="使用 Service 把前端连接到后端" href="/zh/docs/tasks/access-application-cluster/connecting-frontend-backend/"></a>

		
	
		
			

<a class="item" data-title="同 Pod 内的容器使用共享卷通信" href="/zh/docs/tasks/access-application-cluster/communicate-containers-same-pod-shared-volume/"></a>

		
	
		
			

<a class="item" data-title="配置对多集群的访问" href="/zh/docs/tasks/access-application-cluster/configure-access-multiple-clusters/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="监控、日志和排错">
	<div class="container">
		
		
		
		<a class="item" data-title="监控、日志和排错" href="/zh/docs/tasks/debug-application-cluster/"></a>
		
		
	
	
			
			
			
			
			
		
	
	
	
		
			

<a class="item" data-title="Auditing" href="/zh/docs/tasks/debug-application-cluster/audit/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Auditing with Falco <small>(EN)</small>" href="/docs/tasks/debug-application-cluster/falco/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Logging Using Stackdriver <small>(EN)</small>" href="/docs/tasks/debug-application-cluster/logging-stackdriver/"></a>

		
	
		
			

<a class="item" data-title="StackDriver 中的事件" href="/zh/docs/tasks/debug-application-cluster/events-stackdriver/"></a>

		
	
		
			

<a class="item" data-title="使用 crictl 对 Kubernetes 节点进行调试" href="/zh/docs/tasks/debug-application-cluster/crictl/"></a>

		
	
		
			

<a class="item" data-title="使用 ElasticSearch 和 Kibana 进行日志管理" href="/zh/docs/tasks/debug-application-cluster/logging-elasticsearch-kibana/"></a>

		
	
		
			

<a class="item" data-title="在本地开发和调试服务" href="/zh/docs/tasks/debug-application-cluster/local-debugging/"></a>

		
	
		
			

<a class="item" data-title="应用故障排查" href="/zh/docs/tasks/debug-application-cluster/debug-application/"></a>

		
	
		
			

<a class="item" data-title="应用自测与调试" href="/zh/docs/tasks/debug-application-cluster/debug-application-introspection/"></a>

		
	
		
			

<a class="item" data-title="排错" href="/zh/docs/tasks/debug-application-cluster/troubleshooting/"></a>

		
	
		
			

<a class="item" data-title="确定 Pod 失败的原因" href="/zh/docs/tasks/debug-application-cluster/determine-reason-pod-failure/"></a>

		
	
		
			

<a class="item" data-title="节点健康监测" href="/zh/docs/tasks/debug-application-cluster/monitor-node-health/"></a>

		
	
		
			

<a class="item" data-title="获取正在运行容器的 Shell" href="/zh/docs/tasks/debug-application-cluster/get-shell-running-container/"></a>

		
	
		
			

<a class="item" data-title="调试 Init 容器" href="/zh/docs/tasks/debug-application-cluster/debug-init-containers/"></a>

		
	
		
			

<a class="item" data-title="调试 Pods 和 Replication Controllers" href="/zh/docs/tasks/debug-application-cluster/debug-pod-replication-controller/"></a>

		
	
		
			

<a class="item" data-title="调试 Service" href="/zh/docs/tasks/debug-application-cluster/debug-service/"></a>

		
	
		
			

<a class="item" data-title="调试StatefulSet" href="/zh/docs/tasks/debug-application-cluster/debug-stateful-set/"></a>

		
	
		
			

<a class="item" data-title="资源指标管道" href="/zh/docs/tasks/debug-application-cluster/resource-metrics-pipeline/"></a>

		
	
		
			

<a class="item" data-title="资源监控工具" href="/zh/docs/tasks/debug-application-cluster/resource-usage-monitoring/"></a>

		
	
		
			

<a class="item" data-title="集群故障排查" href="/zh/docs/tasks/debug-application-cluster/debug-cluster/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="扩展 Kubernetes">
	<div class="container">
		
		
		
		<a class="item" data-title="扩展 Kubernetes" href="/zh/docs/tasks/access-kubernetes-api/"></a>
		
		
	
	
			
			
			
			
			
		
	
	
	
		
			
<div class="item" data-title="使用自定义资源">
	<div class="container">
		
		
		
		<a class="item" data-title="使用自定义资源" href="/zh/docs/tasks/access-kubernetes-api/custom-resources/"></a>
		
		
	
	
			
			
			
			
			
		
	
	
	
		
			

<a class="item" target="_blank" data-title="Extend the Kubernetes API with CustomResourceDefinitions <small>(EN)</small>" href="/docs/tasks/access-kubernetes-api/custom-resources/custom-resource-definitions/"></a>

		
	
		
			

<a class="item" data-title="用户自定义资源版本" href="/zh/docs/tasks/access-kubernetes-api/custom-resources/custom-resource-definition-versioning/"></a>

		
	

	</div>
</div>

		
	
		
			

<a class="item" data-title="配置聚合层" href="/zh/docs/tasks/access-kubernetes-api/configure-aggregation-layer/"></a>

		
	
		
			

<a class="item" data-title="设置一个扩展的 API server" href="/zh/docs/tasks/access-kubernetes-api/setup-extension-api-server/"></a>

		
	
		
			

<a class="item" data-title="使用 HTTP 代理访问 Kubernetes API" href="/zh/docs/tasks/access-kubernetes-api/http-proxy-access-api/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="TLS">
	<div class="container">
		
		
	
	
			
			
			
			
			
		
	
	
	
		
			

<a class="item" data-title="管理集群中的 TLS 认证" href="/zh/docs/tasks/tls/managing-tls-in-a-cluster/"></a>

		
	
		
			

<a class="item" data-title="证书轮换" href="/zh/docs/tasks/tls/certificate-rotation/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="联邦 - 在多个集群上运行一个应用">
	<div class="container">
		
		
		
		<a class="item" data-title="联邦 - 在多个集群上运行一个应用" href="/zh/docs/tasks/federation/"></a>
		
		
	
	
			
			
		
	
	
	
		
			

<a class="item" data-title="将 CoreDNS 设置为联邦集群的 DNS 提供者" href="/zh/docs/tasks/federation/set-up-coredns-provider-federation/"></a>

		
	
		
			

<a class="item" data-title="使用联合服务来实现跨集群的服务发现" href="/zh/docs/tasks/federation/federation-service-discovery/"></a>

		
	
		
			
<div class="item" data-title="管理联邦控制平面">
	<div class="container">
		
		
		
		<a class="item" data-title="管理联邦控制平面" href="/zh/docs/tasks/federation/administer-federation/"></a>
		
		
	
	
			
			
		
	
	
	
		
			

<a class="item" data-title="联邦 ConfigMap" href="/zh/docs/tasks/federation/administer-federation/configmap/"></a>

		
	
		
			

<a class="item" data-title="联邦 DaemonSet" href="/zh/docs/tasks/federation/administer-federation/daemonset/"></a>

		
	
		
			

<a class="item" data-title="联邦 Deployment" href="/zh/docs/tasks/federation/administer-federation/deployment/"></a>

		
	
		
			

<a class="item" data-title="联邦 Job" href="/zh/docs/tasks/federation/administer-federation/job/"></a>

		
	
		
			

<a class="item" data-title="联邦 ReplicaSet" href="/zh/docs/tasks/federation/administer-federation/replicaset/"></a>

		
	
		
			

<a class="item" data-title="联邦 Secret" href="/zh/docs/tasks/federation/administer-federation/secret/"></a>

		
	
		
			

<a class="item" data-title="联邦事件" href="/zh/docs/tasks/federation/administer-federation/events/"></a>

		
	
		
			

<a class="item" data-title="联邦命名空间" href="/zh/docs/tasks/federation/administer-federation/namespaces/"></a>

		
	

	</div>
</div>

		
	
		
			

<a class="item" data-title="在联邦中设置放置策略" href="/zh/docs/tasks/federation/set-up-placement-policies-federation/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="管理集群守护进程">
	<div class="container">
		
		
		
		<a class="item" data-title="管理集群守护进程" href="/zh/docs/tasks/manage-daemon/"></a>
		
		
	
	
			
			
			
			
			
		
	
	
	
		
			

<a class="item" data-title="对 DaemonSet 执行回滚" href="/zh/docs/tasks/manage-daemon/rollback-daemon-set/"></a>

		
	
		
			

<a class="item" data-title="对 DaemonSet 执行滚动更新" href="/zh/docs/tasks/manage-daemon/update-daemon-set/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="安装服务目录">
	<div class="container">
		
		
		
		<a class="item" data-title="安装服务目录" href="/zh/docs/tasks/service-catalog/"></a>
		
		
	
	
			
			
			
			
			
		
	
	
	
		
			

<a class="item" data-title="使用 Helm 安装 Service Catalog" href="/zh/docs/tasks/service-catalog/install-service-catalog-using-helm/"></a>

		
	
		
			

<a class="item" data-title="使用 SC 安装服务目录" href="/zh/docs/tasks/service-catalog/install-service-catalog-using-sc/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="网络">
	<div class="container">
		
		
		
		<a class="item" data-title="网络" href="/zh/docs/tasks/network/"></a>
		
		
	
	
			
			
			
			
			
		
	
	
	
		
			

<a class="item" data-title="验证 IPv4/IPv6 双协议栈" href="/zh/docs/tasks/network/validate-dual-stack/"></a>

		
	

	</div>
</div>

		
	
		
			

<a class="item" data-title="用插件扩展 kubectl" href="/zh/docs/tasks/extend-kubectl/kubectl-plugins/"></a>

		
	
		
			

<a class="item" data-title="管理巨页（HugePages）" href="/zh/docs/tasks/manage-hugepages/scheduling-hugepages/"></a>

		
	
		
			

<a class="item" data-title="调度 GPUs" href="/zh/docs/tasks/manage-gpus/scheduling-gpus/"></a>

		
	





     </div> 
    <button class="push-menu-close-button" onclick="kub.toggleToc()"></button>
</div> 


          <div id="docsContent">
            
    
    
    
    
    
    
	 
    
    
    
<p>
  <a href="https://github.com/kubernetes/website/edit/master/content/zh/docs/tasks/access-kubernetes-api/custom-resources/custom-resource-definition-versioning.md" id="editPageButton" target="_blank">
    Edit This Page
  </a>
</p>

<h1>用户自定义资源版本</h1>




<!--
This page explains how to add versioning information to
[CustomResourceDefinitions](/docs/reference/generated/kubernetes-api/v1.17/#customresourcedefinition-v1beta1-apiextensions), to indicate the stability
level of your CustomResourceDefinitions or advance your API to a new version with conversion between API representations. It also describes how to upgrade an object from one version to another.
-->

<p>本页介绍了如何添加版本信息到 <a href="/docs/reference/generated/kubernetes-api/v1.17/#customresourcedefinition-v1beta1-apiextensions">CustomResourceDefinitions</a>，如何表示 CustomResourceDefinitions 的稳定水平或者用 API 之间的表征的转换提高您的 API 到一个新的版本。它还描述了如何将对象从一个版本升级到另一个版本。</p>











<ul id="markdown-toc">










<li><a href="#%e5%87%86%e5%a4%87%e5%bc%80%e5%a7%8b">准备开始</a></li>












<li><a href="#%e6%a6%82%e8%a7%88">概览</a></li>




<li><a href="#%e6%8c%87%e5%ae%9a%e5%a4%9a%e4%b8%aa%e7%89%88%e6%9c%ac">指定多个版本</a></li>




<li><a href="#webhook%e8%bd%ac%e6%8d%a2">Webhook转换</a></li>




<li><a href="#webhook-%e8%af%b7%e6%b1%82%e5%92%8c%e5%93%8d%e5%ba%94">Webhook-请求和响应</a></li>




<li><a href="#%e7%bc%96%e5%86%99-%e8%af%bb%e5%8f%96%e5%92%8c%e6%9b%b4%e6%96%b0%e7%89%88%e6%9c%ac%e5%8c%96%e7%9a%84-customresourcedefinition-%e5%af%b9%e8%b1%a1">编写、读取和更新版本化的 CustomResourceDefinition 对象</a></li>




<li><a href="#%e5%b0%86%e7%8e%b0%e6%9c%89%e5%af%b9%e8%b1%a1%e5%8d%87%e7%ba%a7%e5%88%b0%e6%96%b0%e7%9a%84%e5%ad%98%e5%82%a8%e7%89%88%e6%9c%ac">将现有对象升级到新的存储版本</a></li>



























</ul>



<h2 id="准备开始">准备开始</h2>
<p>你必须拥有一个 Kubernetes 的集群，同时你的 Kubernetes 集群必须带有 kubectl 命令行工具。
如果你还没有集群，你可以通过 <a href="/docs/getting-started-guides/minikube">Minikube</a> 构建一
个你自己的集群，或者你可以使用下面任意一个 Kubernetes 工具构建：
<!--
You need to have a Kubernetes cluster, and the kubectl command-line tool must
be configured to communicate with your cluster. If you do not already have a
cluster, you can create one by using
[Minikube](/docs/getting-started-guides/minikube),
or you can use one of these Kubernetes playgrounds:
--></p>

<ul>
<li><a href="https://www.katacoda.com/courses/kubernetes/playground" target="_blank">Katacoda</a></li>
<li><a href="http://labs.play-with-k8s.com/" target="_blank">Play with Kubernetes</a></li>
</ul>
 

<p>要获知版本信息，请输入 <code>kubectl version</code>.</p>

<!--
* Make sure your Kubernetes cluster has a master version of 1.16.0 or higher for `apiextensions.k8s.io/v1`, or 1.11.0 or higher for `apiextensions.k8s.io/v1beta1`.
-->

<ul>
<li>确保您的 Kubernetes 集群的主版本为<code>apiextensions.k8s.io/v1</code>的1.16.0或更高版本，<code>apiextensions.k8s.io/v1beta1</code>的1.11.0或更高版本。</li>
</ul>

<!--
* Read about [custom resources](/docs/concepts/api-extension/custom-resources/).
-->

<ul>
<li>阅读 <a href="/docs/concepts/api-extension/custom-resources/">custom resources</a>。</li>
</ul>




<!--
## Overview
-->

<h2 id="概览">概览</h2>

<div style="margin-top: 10px; margin-bottom: 10px;">



<b>FEATURE STATE:</b> <code>Kubernetes v1.17</code>




    
    
    
    
    
<a href="#" id="feature-state-dialog-link" class="ui-state-default ui-corner-all"><span class="ui-icon ui-icon-newwin"></span>稳定</a>
<div id="feature-state-dialog" class="ui-dialog-content" title="稳定">
该功能是“稳定的”，意味着：</p>

<ul>
<li>版本名是 vX，其中 X 是整数。</li>
<li>该功能将出现在多个后续释出的软件稳定版中。</li>
</ul>
</div>
<script>
$(function(){
    
    $( "#feature-state-dialog" ).dialog({
        autoOpen: false,
        width: "600",
        buttons: [
            {
                text: "Ok",
                click: function() {
                    $( this ).dialog( "close" );
                }
            }
        ]
    });

    
    $( "#feature-state-dialog-link" ).click(function( event ) {
        $( "#feature-state-dialog" ).dialog( "open" );
        event.preventDefault();
    });

});
</script>

    

</div>

<!--
The CustomResourceDefinition API provides a workflow for introducing and upgrading
to new versions of a CustomResourceDefinition.

When a CustomResourceDefinition is created, the first version is set in the
CustomResourceDefinition `spec.versions` list to an appropriate stability level
and a version number. For example `v1beta1` would indicate that the first
version is not yet stable. All custom resource objects will initially be stored
at this version.

Once the CustomResourceDefinition is created, clients may begin using the
`v1beta1` API.

Later it might be necessary to add new version such as `v1`.

Adding a new version:

1. Pick a conversion strategy. Since custom resource objects need to be able to
   be served at both versions, that means they will sometimes be served at a
   different version than their storage version. In order for this to be
   possible, the custom resource objects must sometimes be converted between the
   version they are stored at and the version they are served at. If the
   conversion involves schema changes and requires custom logic, a conversion
   webhook should be used. If there are no schema changes, the default `None`
   conversion strategy may be used and only the `apiVersion` field will be
   modified when serving different versions.
2. If using conversion webhooks, create and deploy the conversion webhook. See
   the [Webhook conversion](#webhook-conversion) for more details.
3. Update the CustomResourceDefinition to include the new version in the
   `spec.versions` list with `served:true`.  Also, set `spec.conversion` field
   to the selected conversion strategy. If using a conversion webhook, configure
   `spec.conversion.webhookClientConfig` field to call the webhook.

Once the new version is added, clients may incrementally migrate to the new
version. It is perfectly safe for some clients to use the old version while
others use the new version.

Migrate stored objects to the new version:

1. See the [upgrade existing objects to a new stored version](#upgrade-existing-objects-to-a-new-stored-version) section.

It is safe for clients to use both the old and new version before, during and
after upgrading the objects to a new stored version.

Removing an old version:

1. Ensure all clients are fully migrated to the new version. The kube-apiserver
   logs can reviewed to help identify any clients that are still accessing via
   the old version.
1. Set `served` to `false` for the old version in the `spec.versions` list. If
   any clients are still unexpectedly using the old version they may begin reporting
   errors attempting to access the custom resource objects at the old version.
   If this occurs, switch back to using `served:true` on the old version, migrate the 
   remaining clients to the new version and repeat this step.
1. Ensure the [upgrade of existing objects to the new stored version](#upgrade-existing-objects-to-a-new-stored-version) step has been completed.
    1. Verify that the `stored` is set to `true` for the new version in the `spec.versions` list in the CustomResourceDefinition.
    1. Verify that the old version is no longer listed in the CustomResourceDefinition `status.storedVersions`.
1. Remove the old version from the CustomResourceDefinition `spec.versions` list.
1. Drop conversion support for the old version in conversion webhooks.

## Specify multiple versions

The CustomResourceDefinition API `versions` field can be used to support multiple versions of custom resources that you
have developed. Versions can have different schemas, and conversion webhooks can convert custom resources between versions.
Webhook conversions should follow the [Kubernetes API conventions](https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md) wherever applicable.
Specifically, See the [API change documentation](https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api_changes.md) for a set of useful gotchas and suggestions.
-->

<p>CustomResourceDefinition API 提供了用于引入和升级的工作流程到 CustomResourceDefinition 的新版本。</p>

<p>创建 CustomResourceDefinition 时，会在 CustomResourceDefinition <code>spec.versions</code> 列表设置适当的稳定级和版本号。例如<code>v1beta1</code>表示第一个版本尚未稳定。所有自定义资源对象将首先存储在这个版本</p>

<p>创建 CustomResourceDefinition 后，客户端可以开始使用 v1beta1 API。</p>

<p>稍后可能需要添加新版本，例如 v1。</p>

<p>增加一个新版本：</p>

<ol>
<li>选择一种转化策略。由于自定义资源对象需要能够两种版本都可用，这意味着它们有时会以与存储版本不同的版本。为了能够做到这一点，
有时必须在它们存储的版本和提供的版本。如果转换涉及结构变更，并且需要自定义逻辑，转换应该使用 webhook。如果没有结构变更，
则使用 None 默认转换策略，不同版本时只有<code>apiVersion</code>字段有变更。</li>
<li>如果使用转换 Webhook，请创建并部署转换 Webhook。希望看到更多详细信息，请参见 <a href="#webhook转换">Webhook conversion</a>。</li>
<li>更新 CustomResourceDefinition，来将新版本包含在具有<code>served：true</code>的 spec.versions 列表。另外，设置<code>spec.conversion</code>字段
到所选的转换策略。如果使用转换 Webhook，请配置<code>spec.conversion.webhookClientConfig</code>来调用 webhook。</li>
</ol>

<p>添加新版本后，客户端可以逐步迁移到新版本。对于某些客户而言，在使用旧版本的同时支持其他人使用新版本。</p>

<p>将存储的对象迁移到新版本：</p>

<ol>
<li>请参阅 <a href="#将现有对象升级到新的存储版本">将现有对象升级到新的存储版本</a> 章节。</li>
</ol>

<p>对于客户来说，在将对象升级到新的存储版本之前，期间和之后使用旧版本和新版本都是安全的。</p>

<p>删除旧版本：</p>

<ol>
<li>确保所有客户端都已完全迁移到新版本。kube-apiserver 可以查看日志以帮助识别仍通过进行访问的所有客户端旧版本。</li>
<li>在<code>spec.versions</code>列表中将旧版本的 served 设置为 false。如果任何客户端仍然意外地使用他们可能开始报告的旧版本尝试访问旧版本的自定义资源对象时出错。
如果发生这种情况，请切换回在旧版本上使用<code>served：true</code>，然后迁移其他客户使用新版本，然后重复此步骤。</li>
<li>确保已完成 <a href="#将现有对象升级到新的存储版本">将现有对象升级到新存储版本</a> 的步骤。

<ol>
<li>在 CustomResourceDefinition 的<code>spec.versions</code>列表中，确认新版本的<code>stored</code>已设置为<code>true</code>。</li>
<li>确认旧版本不再列在 CustomResourceDefinition <code>status.storedVersions</code>。</li>
</ol></li>
<li>从 CustomResourceDefinition<code>spec.versions</code> 列表中删除旧版本。</li>
<li>在转换 webhooks 中放弃对旧版本的转换支持。</li>
</ol>

<h2 id="指定多个版本">指定多个版本</h2>

<p>CustomResourceDefinition API 的<code>versions</code>字段可用于支持您自定义资源的多个版本已经开发的。版本可以具有不同的架构，并且转换 Webhooks 可以在版本之间转换自定义资源。
在适用的情况下，Webhook 转换应遵循 <a href="https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md" target="_blank">Kubernetes API</a>。</p>

<blockquote class="note">
  <div><strong>注意：</strong> In <code>apiextensions.k8s.io/v1beta1</code>, there was a <code>version</code> field instead of <code>versions</code>. The
<code>version</code> field is deprecated and optional, but if it is not empty, it must
match the first item in the <code>versions</code> field.</div>
</blockquote>

<!--
This example shows a CustomResourceDefinition with two versions. For the first
example, the assumption is all versions share the same schema with no conversion
between them. The comments in the YAML provide more context.
-->

<p>此示例显示了两个版本的 CustomResourceDefinition。第一个例子，假设所有的版本共享相同的模式而它们之间没有转换。YAML 中的评论提供了更多背景信息。</p>

<div id="customresourcedefinition-versioning-example-1">
<ul>
    
      
  <li><a href="#customresourcedefinition-versioning-example-1-0">apiextensions.k8s.io/v1</a></li>

      
  <li><a href="#customresourcedefinition-versioning-example-1-1">apiextensions.k8s.io/v1beta1</a></li>

</ul>


<div id="customresourcedefinition-versioning-example-1-0">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>apiextensions.k8s.io/v1beta1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>CustomResourceDefinition<span style="color:#bbb">
</span><span style="color:#bbb"></span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># name must match the spec fields below, and be in the form: &lt;plural&gt;.&lt;group&gt;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>name:<span style="color:#bbb"> </span>crontabs.example.com<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># group name to use for REST API: /apis/&lt;group&gt;/&lt;version&gt;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>group:<span style="color:#bbb"> </span>example.com<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># list of versions supported by this CustomResourceDefinition</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>versions:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>v1beta1<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># Each version can be enabled/disabled by Served flag.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>served:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># One and only one version must be marked as the storage version.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>storage:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># A schema is required</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>schema:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>openAPIV3Schema:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>type:<span style="color:#bbb"> </span>object<span style="color:#bbb">
</span><span style="color:#bbb">        </span>properties:<span style="color:#bbb">
</span><span style="color:#bbb">          </span>host:<span style="color:#bbb">
</span><span style="color:#bbb">            </span>type:<span style="color:#bbb"> </span>string<span style="color:#bbb">
</span><span style="color:#bbb">          </span>port:<span style="color:#bbb">
</span><span style="color:#bbb">            </span>type:<span style="color:#bbb"> </span>string<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb">    </span>served:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>storage:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">false</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>schema:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>openAPIV3Schema:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>type:<span style="color:#bbb"> </span>object<span style="color:#bbb">
</span><span style="color:#bbb">        </span>properties:<span style="color:#bbb">
</span><span style="color:#bbb">          </span>host:<span style="color:#bbb">
</span><span style="color:#bbb">            </span>type:<span style="color:#bbb"> </span>string<span style="color:#bbb">
</span><span style="color:#bbb">          </span>port:<span style="color:#bbb">
</span><span style="color:#bbb">            </span>type:<span style="color:#bbb"> </span>string<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># The conversion section is introduced in Kubernetes 1.13+ with a default value of</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># None conversion (strategy sub-field set to None).</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>conversion:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># None conversion assumes the same schema for all versions and only sets the apiVersion</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># field of custom resources to the proper value</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>strategy:<span style="color:#bbb"> </span>None<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># either Namespaced or Cluster</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>scope:<span style="color:#bbb"> </span>Namespaced<span style="color:#bbb">
</span><span style="color:#bbb">  </span>names:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># plural name to be used in the URL: /apis/&lt;group&gt;/&lt;version&gt;/&lt;plural&gt;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>plural:<span style="color:#bbb"> </span>crontabs<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># singular name to be used as an alias on the CLI and for display</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>singular:<span style="color:#bbb"> </span>crontab<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># kind is normally the CamelCased singular type. Your resource manifests use this.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>kind:<span style="color:#bbb"> </span>CronTab<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># shortNames allow shorter string to match your resource on the CLI</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>shortNames:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-<span style="color:#bbb"> </span>ct</code></pre></div>
    

<p></div></p>

<div id="customresourcedefinition-versioning-example-1-1">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#080;font-style:italic"># Deprecated in v1.16 in favor of apiextensions.k8s.io/v1</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>apiVersion:<span style="color:#bbb"> </span>apiextensions.k8s.io/v1beta1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>CustomResourceDefinition<span style="color:#bbb">
</span><span style="color:#bbb"></span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># name must match the spec fields below, and be in the form: &lt;plural&gt;.&lt;group&gt;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>name:<span style="color:#bbb"> </span>crontabs.example.com<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># group name to use for REST API: /apis/&lt;group&gt;/&lt;version&gt;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>group:<span style="color:#bbb"> </span>example.com<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># list of versions supported by this CustomResourceDefinition</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>versions:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>v1beta1<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># Each version can be enabled/disabled by Served flag.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>served:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># One and only one version must be marked as the storage version.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>storage:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb">    </span>served:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>storage:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">false</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>validation:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>openAPIV3Schema:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>type:<span style="color:#bbb"> </span>object<span style="color:#bbb">
</span><span style="color:#bbb">      </span>properties:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>host:<span style="color:#bbb">
</span><span style="color:#bbb">          </span>type:<span style="color:#bbb"> </span>string<span style="color:#bbb">
</span><span style="color:#bbb">        </span>port:<span style="color:#bbb">
</span><span style="color:#bbb">          </span>type:<span style="color:#bbb"> </span>string<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># The conversion section is introduced in Kubernetes 1.13+ with a default value of</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># None conversion (strategy sub-field set to None).</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>conversion:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># None conversion assumes the same schema for all versions and only sets the apiVersion</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># field of custom resources to the proper value</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>strategy:<span style="color:#bbb"> </span>None<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># either Namespaced or Cluster</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>scope:<span style="color:#bbb"> </span>Namespaced<span style="color:#bbb">
</span><span style="color:#bbb">  </span>names:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># plural name to be used in the URL: /apis/&lt;group&gt;/&lt;version&gt;/&lt;plural&gt;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>plural:<span style="color:#bbb"> </span>crontabs<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># singular name to be used as an alias on the CLI and for display</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>singular:<span style="color:#bbb"> </span>crontab<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># kind is normally the CamelCased singular type. Your resource manifests use this.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>kind:<span style="color:#bbb"> </span>CronTab<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># shortNames allow shorter string to match your resource on the CLI</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>shortNames:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-<span style="color:#bbb"> </span>ct</code></pre></div>
    

<p></div></p>

<p></div></p>

<script>$(function(){$("#customresourcedefinition-versioning-example-1").tabs();});</script>

<!--
You can save the CustomResourceDefinition in a YAML file, then use
`kubectl apply` to create it.
-->

<p>你可以将 CustomResourceDefinition 存储在 YAML 文件中，然后使用<code>kubectl apply</code>来创建它。</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl apply -f my-versioned-crontab.yaml</code></pre></div>
<!--
After creation, the API server starts to serve each enabled version at an HTTP
REST endpoint. In the above example, the API versions are available at
`/apis/example.com/v1beta1` and `/apis/example.com/v1`.
-->

<p>在创建之后，apiserver 开始在 HTTP REST 端点上为每个启用的版本提供服务。在上面的示例中，API 版本可以在<code>/apis/example.com/v1beta1</code> 和 <code>/apis/example.com/v1</code>中获得。</p>

<!--
### Version priority
-->

<h3 id="版本优先级">版本优先级</h3>

<!--
Regardless of the order in which versions are defined in a
CustomResourceDefinition, the version with the highest priority is used by
kubectl as the default version to access objects. The priority is determined
by parsing the _name_ field to determine the version number, the stability
(GA, Beta, or Alpha), and the sequence within that stability level.
-->

<p>不考虑 CustomResourceDefinition 中版本被定义的顺序，kubectl 使用具有最高优先级的版本作为访问对象的默认版本。
通过解析 <em>name</em> 字段确定优先级来决定版本号，稳定性（GA，Beta，或者 Alpha），以及该稳定性水平内的序列。</p>

<!--
The algorithm used for sorting the versions is designed to sort versions in the
same way that the Kubernetes project sorts Kubernetes versions. Versions start with a
`v` followed by a number, an optional `beta` or `alpha` designation, and
optional additional numeric versioning information. Broadly, a version string might look
like `v2` or `v2beta1`. Versions are sorted using the following algorithm:
-->

<p>用于对版本进行排序的算法被设计成与 Kubernetes 项目对 Kubernetes 版本进行排序的方式相同。
版本以<code>v</code>开头跟一个数字，一个可选的<code>beta</code> 或者 <code>alpha</code>命名，和一个可选的附加的数字型的版本信息。
从广义上讲，版本字符串可能看起来像<code>v2</code>或者<code>v2beta1</code>。
使用以下算法对版本进行排序：</p>

<!--
- Entries that follow Kubernetes version patterns are sorted before those that
  do not.
- For entries that follow Kubernetes version patterns, the numeric portions of
  the version string is sorted largest to smallest.
- If the strings `beta` or `alpha` follow the first numeric portion, they sorted
  in that order, after the equivalent string without the `beta` or `alpha`
  suffix (which is presumed to be the GA version).
- If another number follows the `beta`, or `alpha`, those numbers are also
  sorted from largest to smallest.
- Strings that don't fit the above format are sorted alphabetically and the
  numeric portions are not treated specially. Notice that in the example below,
  `foo1` is sorted above `foo10`. This is different from the sorting of the
  numeric portion of entries that do follow the Kubernetes version patterns.
-->

<ul>
<li>遵循 Kubernetes 版本模式的条目在不符合条件的条目之前进行排序。</li>
<li>对于遵循 Kubernetes 版本模式的条目，版本字符串的数字部分从最大到最小排序。</li>
<li>如果字符串<code>beta</code> 或 <code>alpha</code>跟随第一数字部分，它们按顺序排序，在没有<code>beta</code> 或 <code>alpha</code>后缀（假定为 GA 版本）的等效字符串后面。</li>
<li>如果另一个数字跟在<code>beta</code>或<code>alpha</code>之后，那么这些数字也是从最大到最小排序。</li>
<li>不符合上述格式的字符串按字母顺序排序，数字部分不经过特殊处理。请注意，在下面的示例中，<code>foo1</code>在 <code>foo10</code>上方排序。这与遵循 Kubernetes 版本模式的条目的数字部分排序不同。</li>
</ul>

<!--
This might make sense if you look at the following sorted version list:
-->

<p>如果查看以下排序版本列表可以明白：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-none" data-lang="none">- v10
- v2
- v1
- v11beta2
- v10beta3
- v3beta1
- v12alpha1
- v11alpha2
- foo1
- foo10</code></pre></div>
<!--
For the example in [Specify multiple versions](#specify-multiple-versions), the
version sort order is `v1`, followed by `v1beta1`. This causes the kubectl
command to use `v1` as the default version unless the provided object specifies
the version.
-->

<p>对于 <a href="#指定多个版本">指定多个版本</a> 中的示例，版本排序顺序为<code>v1</code>，后跟着<code>v1beta1</code>。
这导致了 kubectl 命令使用<code>v1</code>作为默认版本，除非提供对象指定版本。</p>

<!--
## Webhook conversion
-->

<h2 id="webhook转换">Webhook转换</h2>

<!--
Webhook conversion is introduced in Kubernetes 1.13 as an alpha feature. To use it, the
`CustomResourceWebhookConversion` feature should be enabled. Please refer to the [feature gate](/docs/reference/command-line-tools-reference/feature-gates/) documentation for more information.
-->

<blockquote class="note">
  <div><strong>注意：</strong> Webhook 转换在 Kubernetes 1.13 中作为 alpha 功能引入。要使用它，应启用<code>CustomResourceWebhookConversion</code>功能。请参阅 <a href="/docs/reference/command-line-tools-reference/feature-gates/">feature gate</a> 文档以获得更多信息。</div>
</blockquote>

<!--
The above example has a None conversion between versions which only sets the `apiVersion` field
on conversion and does not change the rest of the object. The API server also supports webhook
conversions that call an external service in case a conversion is required. For example when:
-->

<p>上面的例子在版本之间有一个 None 转换，它只在转换时设置<code>apiVersion</code>字段而不改变对象的其余部分。apiserver 还支持在需要转换时调用外部服务的 webhook 转换。例如：</p>

<!--
* custom resource is requested in a different version than stored version.
* Watch is created in one version but the changed object is stored in another version.
* custom resource PUT request is in a different version than storage version.
-->

<ul>
<li>自定义资源被要求在一个不同的版本里而不是一个存储的版本里。</li>
<li>Watch 在一个版本中创建，但更改对象存储在另一个版本中。</li>
<li>自定义资源 PUT 请求在一个不同的版本里而不是一个存储的版本。</li>
</ul>

<!--
To cover all of these cases and to optimize conversion by the API server, the conversion requests may contain multiple objects in order to minimize the external calls. The webhook should perform these conversions independently.
-->

<p>为了涵盖所有这些情况并通过 API 服务优化转换，转换对象可能包含多个对象，以便最大限度地减少外部调用。webhook 应该独立执行这些转换。</p>

<!--
### Write a conversion webhook server
-->

<h3 id="编写一个转换webhook服务">编写一个转换webhook服务</h3>

<!--
Please refer to the implementation of the [custom resource conversion webhook
server](https://github.com/kubernetes/kubernetes/tree/v1.15.0/test/images/crd-conversion-webhook/main.go)
that is validated in a Kubernetes e2e test. The webhook handles the
`ConversionReview` requests sent by the API servers, and sends back conversion
results wrapped in `ConversionResponse`. Note that the request
contains a list of custom resources that need to be converted independently without
changing the order of objects.
The example server is organized in a way to be reused for other conversions. Most of the common code are located in the [framework file](https://github.com/kubernetes/kubernetes/tree/v1.15.0/test/images/crd-conversion-webhook/converter/framework.go) that leaves only [one function](https://github.com/kubernetes/kubernetes/blob/v1.15.0/test/images/crd-conversion-webhook/converter/example_converter.go#L29-L80) to be implemented for different conversions.
-->

<p>请参考 <a href="https://github.com/kubernetes/kubernetes/tree/v1.13.0/test/images/crd-conversion-webhook/main.go" target="_blank">自定义资源转换 webhook 服务</a> 的实施，这在 Kubernetes e2e 测试中得到验证。webhook 处理由 apiserver 发送的<code>ConversionReview</code>请求，并发送回包含在<code>ConversionResponse</code>中的转换结果。请注意，请求包含需要独立转换不改变对象顺序的自定义资源列表。示例服务器的组织方式使其可以重用于其他转换。大多数常见代码都位于 <a href="https://github.com/kubernetes/kubernetes/tree/v1.14.0/test/images/crd-conversion-webhook/converter/framework.go" target="_blank">框架文件</a> 中，只留下 <a href="https://github.com/kubernetes/kubernetes/blob/v1.13.0/test/images/crd-conversion-webhook/converter/example_converter.go#L29-L80" target="_blank">示例</a> 用于实施不同的转换。</p>

<!--
The example conversion webhook server leaves the `ClientAuth` field
[empty](https://github.com/kubernetes/kubernetes/tree/v1.13.0/test/images/crd-conversion-webhook/config.go#L47-L48),
which defaults to `NoClientCert`. This means that the webhook server does not
authenticate the identity of the clients, supposedly API servers. If you need
mutual TLS or other ways to authenticate the clients, see
how to [authenticate API servers](/docs/reference/access-authn-authz/extensible-admission-controllers/#authenticate-apiservers).
-->

<blockquote class="note">
  <div><strong>注意：</strong> <p>示例转换 webhook 服务器留下<code>ClientAuth</code>字段 <a href="https://github.com/kubernetes/kubernetes/tree/v1.13.0/test/images/crd-conversion-webhook/config.go#L47-L48" target="_blank">empty</a>，默认为<code>NoClientCert</code>。</p>

<p>这意味着 webhook 服务器没有验证客户端的身份，据称是 apiserver。</p>

<p>如果您需要相互 TLS 或者其他方式来验证客户端，请参阅如何 <a href="/docs/reference/access-authn-authz/extensible-admission-controllers/#authenticate-apiservers">验证 API 服务</a>。</p>
</div>
</blockquote>

<!--
### Deploy the conversion webhook service
-->

<h3 id="部署转换webhook服务">部署转换webhook服务</h3>

<!--
Documentation for deploying the conversion webhook is the same as for the [admission webhook example service](/docs/reference/access-authn-authz/extensible-admission-controllers/#deploy_the_admission_webhook_service).
The assumption for next sections is that the conversion webhook server is deployed to a service named `example-conversion-webhook-server` in `default` namespace and serving traffic on path `/crdconvert`.
-->

<p>用于部署转换 webhook 的文档与 <a href="/docs/reference/access-authn-authz/extensible-admission-controllers/#deploy_the_admission_webhook_service">准入webhook示例服务</a>。
下一节的假设是转换 webhook 服务器部署到<code>default</code>命名空间中名为<code>example-conversion-webhook-server</code>的服务器上，并在路径<code>/crdconvert</code>上提供流量。</p>

<!--
When the webhook server is deployed into the Kubernetes cluster as a
service, it has to be exposed via a service on port 443 (The server
itself can have an arbitrary port but the service object should map it to port 443).
The communication between the API server and the webhook service may fail
if a different port is used for the service.
-->

<blockquote class="note">
  <div><strong>注意：</strong> 当 webhook 服务器作为一个部署到 Kubernetes 集群中的服务器时，它必须通过端口443上的服务器公开(服务器本身可以有一个任意端口，但是服务器对象应该将它映射到端口443)。
如果为服务器使用不同的端口，则 apiserver 和 webhook 服务器之间的通信可能会失败。</div>
</blockquote>

<!--
### Configure CustomResourceDefinition to use conversion webhooks
-->

<h3 id="配置customresourcedefinition以使用转换webhooks">配置CustomResourceDefinition以使用转换webhooks</h3>

<!--
The `None` conversion example can be extended to use the conversion webhook by modifying `conversion`
section of the `spec`:
-->

<p>通过修改<code>spec</code>中的<code>conversion</code>部分，可以扩展<code>None</code>转换示例来使用转换 webhook。</p>

<div id="customresourcedefinition-versioning-example-2">
<ul>
    
      
  <li><a href="#customresourcedefinition-versioning-example-2-0">apiextensions.k8s.io/v1</a></li>

      
  <li><a href="#customresourcedefinition-versioning-example-2-1">apiextensions.k8s.io/v1beta1</a></li>

</ul>


<div id="customresourcedefinition-versioning-example-2-0">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>apiextensions.k8s.io/v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>CustomResourceDefinition<span style="color:#bbb">
</span><span style="color:#bbb"></span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># name must match the spec fields below, and be in the form: &lt;plural&gt;.&lt;group&gt;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>name:<span style="color:#bbb"> </span>crontabs.example.com<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># group name to use for REST API: /apis/&lt;group&gt;/&lt;version&gt;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>group:<span style="color:#bbb"> </span>example.com<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># list of versions supported by this CustomResourceDefinition</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>versions:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>v1beta1<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># Each version can be enabled/disabled by Served flag.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>served:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># One and only one version must be marked as the storage version.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>storage:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># Each version can define it&#39;s own schema when there is no top-level</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># schema is defined.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>schema:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>openAPIV3Schema:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>type:<span style="color:#bbb"> </span>object<span style="color:#bbb">
</span><span style="color:#bbb">        </span>properties:<span style="color:#bbb">
</span><span style="color:#bbb">          </span>hostPort:<span style="color:#bbb">
</span><span style="color:#bbb">            </span>type:<span style="color:#bbb"> </span>string<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb">    </span>served:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>storage:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">false</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>schema:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>openAPIV3Schema:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>type:<span style="color:#bbb"> </span>object<span style="color:#bbb">
</span><span style="color:#bbb">        </span>properties:<span style="color:#bbb">
</span><span style="color:#bbb">          </span>host:<span style="color:#bbb">
</span><span style="color:#bbb">            </span>type:<span style="color:#bbb"> </span>string<span style="color:#bbb">
</span><span style="color:#bbb">          </span>port:<span style="color:#bbb">
</span><span style="color:#bbb">            </span>type:<span style="color:#bbb"> </span>string<span style="color:#bbb">
</span><span style="color:#bbb">  </span>conversion:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># a Webhook strategy instruct API server to call an external webhook for any conversion between custom resources.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>strategy:<span style="color:#bbb"> </span>Webhook<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># webhook is required when strategy is `Webhook` and it configures the webhook endpoint to be called by API server.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>webhook:<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># conversionReviewVersions indicates what ConversionReview versions are understood/preferred by the webhook.</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># The first version in the list understood by the API server is sent to the webhook.</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># The webhook must respond with a ConversionReview object in the same version it received.</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span>conversionReviewVersions:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;v1&#34;</span>,<span style="color:#b44">&#34;v1beta1&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">      </span>clientConfig:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>service:<span style="color:#bbb">
</span><span style="color:#bbb">          </span>namespace:<span style="color:#bbb"> </span>default<span style="color:#bbb">
</span><span style="color:#bbb">          </span>name:<span style="color:#bbb"> </span>example-conversion-webhook-server<span style="color:#bbb">
</span><span style="color:#bbb">          </span>path:<span style="color:#bbb"> </span>/crdconvert<span style="color:#bbb">
</span><span style="color:#bbb">        </span>caBundle:<span style="color:#bbb"> </span><span style="color:#b44">&#34;Ci0tLS0tQk...&lt;base64-encoded PEM bundle&gt;...tLS0K&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># either Namespaced or Cluster</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>scope:<span style="color:#bbb"> </span>Namespaced<span style="color:#bbb">
</span><span style="color:#bbb">  </span>names:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># plural name to be used in the URL: /apis/&lt;group&gt;/&lt;version&gt;/&lt;plural&gt;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>plural:<span style="color:#bbb"> </span>crontabs<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># singular name to be used as an alias on the CLI and for display</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>singular:<span style="color:#bbb"> </span>crontab<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># kind is normally the CamelCased singular type. Your resource manifests use this.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>kind:<span style="color:#bbb"> </span>CronTab<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># shortNames allow shorter string to match your resource on the CLI</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>shortNames:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-<span style="color:#bbb"> </span>ct</code></pre></div>
    

<p></div></p>

<div id="customresourcedefinition-versioning-example-2-1">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#080;font-style:italic"># Deprecated in v1.16 in favor of apiextensions.k8s.io/v1</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>apiVersion:<span style="color:#bbb"> </span>apiextensions.k8s.io/v1beta1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>CustomResourceDefinition<span style="color:#bbb">
</span><span style="color:#bbb"></span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># name must match the spec fields below, and be in the form: &lt;plural&gt;.&lt;group&gt;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>name:<span style="color:#bbb"> </span>crontabs.example.com<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># group name to use for REST API: /apis/&lt;group&gt;/&lt;version&gt;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>group:<span style="color:#bbb"> </span>example.com<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># prunes object fields that are not specified in OpenAPI schemas below.</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>preserveUnknownFields:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">false</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># list of versions supported by this CustomResourceDefinition</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>versions:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>v1beta1<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># Each version can be enabled/disabled by Served flag.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>served:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># One and only one version must be marked as the storage version.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>storage:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># Each version can define it&#39;s own schema when there is no top-level</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># schema is defined.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>schema:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>openAPIV3Schema:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>type:<span style="color:#bbb"> </span>object<span style="color:#bbb">
</span><span style="color:#bbb">        </span>properties:<span style="color:#bbb">
</span><span style="color:#bbb">          </span>hostPort:<span style="color:#bbb">
</span><span style="color:#bbb">            </span>type:<span style="color:#bbb"> </span>string<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb">    </span>served:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>storage:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">false</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>schema:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>openAPIV3Schema:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>type:<span style="color:#bbb"> </span>object<span style="color:#bbb">
</span><span style="color:#bbb">        </span>properties:<span style="color:#bbb">
</span><span style="color:#bbb">          </span>host:<span style="color:#bbb">
</span><span style="color:#bbb">            </span>type:<span style="color:#bbb"> </span>string<span style="color:#bbb">
</span><span style="color:#bbb">          </span>port:<span style="color:#bbb">
</span><span style="color:#bbb">            </span>type:<span style="color:#bbb"> </span>string<span style="color:#bbb">
</span><span style="color:#bbb">  </span>conversion:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># a Webhook strategy instruct API server to call an external webhook for any conversion between custom resources.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>strategy:<span style="color:#bbb"> </span>Webhook<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># webhookClientConfig is required when strategy is `Webhook` and it configures the webhook endpoint to be called by API server.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>webhookClientConfig:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>service:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>namespace:<span style="color:#bbb"> </span>default<span style="color:#bbb">
</span><span style="color:#bbb">        </span>name:<span style="color:#bbb"> </span>example-conversion-webhook-server<span style="color:#bbb">
</span><span style="color:#bbb">        </span>path:<span style="color:#bbb"> </span>/crdconvert<span style="color:#bbb">
</span><span style="color:#bbb">      </span>caBundle:<span style="color:#bbb"> </span><span style="color:#b44">&#34;Ci0tLS0tQk...&lt;base64-encoded PEM bundle&gt;...tLS0K&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># either Namespaced or Cluster</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>scope:<span style="color:#bbb"> </span>Namespaced<span style="color:#bbb">
</span><span style="color:#bbb">  </span>names:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># plural name to be used in the URL: /apis/&lt;group&gt;/&lt;version&gt;/&lt;plural&gt;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>plural:<span style="color:#bbb"> </span>crontabs<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># singular name to be used as an alias on the CLI and for display</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>singular:<span style="color:#bbb"> </span>crontab<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># kind is normally the CamelCased singular type. Your resource manifests use this.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>kind:<span style="color:#bbb"> </span>CronTab<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># shortNames allow shorter string to match your resource on the CLI</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>shortNames:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-<span style="color:#bbb"> </span>ct</code></pre></div>
    

<p></div></p>

<p></div></p>

<script>$(function(){$("#customresourcedefinition-versioning-example-2").tabs();});</script>

<!--
You can save the CustomResourceDefinition in a YAML file, then use
`kubectl apply` to apply it.
-->

<p>您可以将 CustomResourceDefinition 保存在 YAML 文件中，然后使用<code>kubectl apply</code>来应用它。</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl apply -f my-versioned-crontab-with-conversion.yaml</code></pre></div>
<!--
Make sure the conversion service is up and running before applying new changes.
-->

<p>在应用新更改之前，请确保转换服务器已启动并正在运行。</p>

<!--
### Contacting the webhook
-->

<h3 id="调用-webhook">调用-webhook</h3>

<!--
Once the API server has determined a request should be sent to a conversion webhook,
it needs to know how to contact the webhook. This is specified in the `webhookClientConfig`
stanza of the webhook configuration.

Conversion webhooks can either be called via a URL or a service reference,
and can optionally include a custom CA bundle to use to verify the TLS connection.
-->

<p>apiserver 一旦确定请求应发送到转换 webhook，它需要知道如何调用 webhook。这是在<code>webhookClientConfig</code>中指定的 webhook 配置。</p>

<p>转换 webhook 可以通过调用 URL 或服务，并且可以选择包含自定义 CA 包，以用于验证 TLS 连接。</p>

<h3 id="url">URL</h3>

<!--
`url` gives the location of the webhook, in standard URL form
(`scheme://host:port/path`). 

The `host` should not refer to a service running in the cluster; use
a service reference by specifying the `service` field instead.
The host might be resolved via external DNS in some apiservers
(i.e., `kube-apiserver` cannot resolve in-cluster DNS as that would 
be a layering violation). `host` may also be an IP address.

Please note that using `localhost` or `127.0.0.1` as a `host` is
risky unless you take great care to run this webhook on all hosts
which run an apiserver which might need to make calls to this
webhook. Such installs are likely to be non-portable, i.e., not easy
to turn up in a new cluster.
-->

<p>url 以标准 URL 形式给出 webhook 的位置（<code>scheme://host:port/path</code>）。
<code>host</code>不应引用集群中运行的服务；采用通过指定<code>service</code>字段来提供服务引用。
<code>host</code>可以通过某些 apiserver 中的外部 DNS 进行解析（即<code>kube-apiserver</code>无法解析集群内 DNS 违反分层规则）。主机也可以是 IP 地址。</p>

<p>请注意，除非您非常小心在所有主机上运行此 Webhook，否则 localhost 或 127.0.0.1 用作主机是风险很大的，运行一个 apiserver 可能需要对此进行调用
 webhook。这样的安装很可能是不可移植的，即不容易出现在新集群中。</p>

<!--
The scheme must be "https"; the URL must begin with "https://".

Attempting to use a user or basic auth e.g. "user:password@" is not allowed.
Fragments ("#...") and query parameters ("?...") are also not allowed.

Here is an example of a conversion webhook configured to call a URL
(and expects the TLS certificate to be verified using system trust roots, so does not specify a caBundle):
-->

<p>方案必须为<code>https</code>：URL 必须以<code>https://</code>开头。</p>

<p>尝试使用用户或基本身份验证，例如不允许使用<code>user:password@</code>。片段（<code>#...</code>）和查询参数（<code>?...</code>）也不允许。</p>

<p>这是配置为调用 URL 的转换 Webhook 的示例（并且期望使用系统信任根来验证 TLS 证书，因此不指定 caBundle）：</p>

<div id="customresourcedefinition-versioning-example-3">
<ul>
    
      
  <li><a href="#customresourcedefinition-versioning-example-3-0">apiextensions.k8s.io/v1</a></li>

      
  <li><a href="#customresourcedefinition-versioning-example-3-1">apiextensions.k8s.io/v1beta1</a></li>

</ul>


<div id="customresourcedefinition-versioning-example-3-0">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>apiextensions.k8s.io/v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>CustomResourceDefinition<span style="color:#bbb">
</span><span style="color:#bbb"></span>...<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>...<span style="color:#bbb">
</span><span style="color:#bbb">  </span>conversion:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>strategy:<span style="color:#bbb"> </span>Webhook<span style="color:#bbb">
</span><span style="color:#bbb">    </span>webhook:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>clientConfig:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>url:<span style="color:#bbb"> </span><span style="color:#b44">&#34;https://my-webhook.example.com:9443/my-webhook-path&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>...</code></pre></div>
    

<p></div></p>

<div id="customresourcedefinition-versioning-example-3-1">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#080;font-style:italic"># Deprecated in v1.16 in favor of apiextensions.k8s.io/v1</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>apiVersion:<span style="color:#bbb"> </span>apiextensions.k8s.io/v1beta1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>CustomResourceDefinition<span style="color:#bbb">
</span><span style="color:#bbb"></span>...<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>...<span style="color:#bbb">
</span><span style="color:#bbb">  </span>conversion:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>strategy:<span style="color:#bbb"> </span>Webhook<span style="color:#bbb">
</span><span style="color:#bbb">    </span>webhookClientConfig:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>url:<span style="color:#bbb"> </span><span style="color:#b44">&#34;https://my-webhook.example.com:9443/my-webhook-path&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>...</code></pre></div>
    

<p></div></p>

<p></div></p>

<script>$(function(){$("#customresourcedefinition-versioning-example-3").tabs();});</script>

<!--
### Service Reference

The `service` stanza inside `webhookClientConfig` is a reference to the service for a conversion webhook.
If the webhook is running within the cluster, then you should use `service` instead of `url`.
The service namespace and name are required. The port is optional and defaults to 443.
The path is optional and defaults to "/".

Here is an example of a webhook that is configured to call a service on port "1234"
at the subpath "/my-path", and to verify the TLS connection against the ServerName
`my-service-name.my-service-namespace.svc` using a custom CA bundle.
-->

<h3 id="服务引用">服务引用</h3>

<p><code>webhookClientConfig</code>内部的<code>service</code>段是对转换 webhook 服务的引用。如果 Webhook 在集群中运行，则应使用<code>service</code>而不是<code>url</code>。
服务名称空间和名称是必需的。端口是可选的，默认为 443。该路径是可选的，默认为<code>/</code>。</p>

<p>这是一个配置为在端口<code>1234</code>上调用服务的 Webhook 的示例在子路径<code>/my-path</code>下，并针对 ServerName 验证 TLS 连接
使用自定义 CA 捆绑包的<code>my-service-name.my-service-namespace.svc</code>。</p>

<div id="customresourcedefinition-versioning-example-4">
<ul>
    
      
  <li><a href="#customresourcedefinition-versioning-example-4-0">apiextensions.k8s.io/v1</a></li>

      
  <li><a href="#customresourcedefinition-versioning-example-4-1">apiextensions.k8s.io/v1beta1</a></li>

</ul>


<div id="customresourcedefinition-versioning-example-4-0">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>apiextensions.k8s.io/v1b<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>CustomResourceDefinition<span style="color:#bbb">
</span><span style="color:#bbb"></span>...<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>...<span style="color:#bbb">
</span><span style="color:#bbb">  </span>conversion:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>strategy:<span style="color:#bbb"> </span>Webhook<span style="color:#bbb">
</span><span style="color:#bbb">    </span>webhook:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>clientConfig:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>service:<span style="color:#bbb">
</span><span style="color:#bbb">          </span>namespace:<span style="color:#bbb"> </span>my-service-namespace<span style="color:#bbb">
</span><span style="color:#bbb">          </span>name:<span style="color:#bbb"> </span>my-service-name<span style="color:#bbb">
</span><span style="color:#bbb">          </span>path:<span style="color:#bbb"> </span>/my-path<span style="color:#bbb">
</span><span style="color:#bbb">          </span>port:<span style="color:#bbb"> </span><span style="color:#666">1234</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span>caBundle:<span style="color:#bbb"> </span><span style="color:#b44">&#34;Ci0tLS0tQk...&lt;base64-encoded PEM bundle&gt;...tLS0K&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>...</code></pre></div>
    

<p></div></p>

<div id="customresourcedefinition-versioning-example-4-1">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#080;font-style:italic"># Deprecated in v1.16 in favor of apiextensions.k8s.io/v1</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>apiVersion:<span style="color:#bbb"> </span>apiextensions.k8s.io/v1beta1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>CustomResourceDefinition<span style="color:#bbb">
</span><span style="color:#bbb"></span>...<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>...<span style="color:#bbb">
</span><span style="color:#bbb">  </span>conversion:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>strategy:<span style="color:#bbb"> </span>Webhook<span style="color:#bbb">
</span><span style="color:#bbb">    </span>webhookClientConfig:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>service:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>namespace:<span style="color:#bbb"> </span>my-service-namespace<span style="color:#bbb">
</span><span style="color:#bbb">        </span>name:<span style="color:#bbb"> </span>my-service-name<span style="color:#bbb">
</span><span style="color:#bbb">        </span>path:<span style="color:#bbb"> </span>/my-path<span style="color:#bbb">
</span><span style="color:#bbb">        </span>port:<span style="color:#bbb"> </span><span style="color:#666">1234</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span>caBundle:<span style="color:#bbb"> </span><span style="color:#b44">&#34;Ci0tLS0tQk...&lt;base64-encoded PEM bundle&gt;...tLS0K&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>...</code></pre></div>
    

<p></div></p>

<p></div></p>

<script>$(function(){$("#customresourcedefinition-versioning-example-4").tabs();});</script>

<!--
## Webhook request and response

### Request

Webhooks are sent a POST request, with `Content-Type: application/json`,
with a `ConversionReview` API object in the `apiextensions.k8s.io` API group
serialized to JSON as the body.

Webhooks can specify what versions of `ConversionReview` objects they accept
with the `conversionReviewVersions` field in their CustomResourceDefinition:
-->

<h2 id="webhook-请求和响应">Webhook-请求和响应</h2>

<h3 id="请求">请求</h3>

<p>向 Webhooks 发送 POST 请求，请求的内容类型为：application/json，与 APIapitensions.k8s.io API 组中的 ConversionReview API 对象一起使用序列化为 JSON 作为主体。</p>

<p>Webhooks 可以指定他们接受的<code>ConversionReview</code>对象的版本在其 CustomResourceDefinition 中使用<code>conversionReviewVersions</code>字段：</p>

<div id="conversionreviewversions">
<ul>
    
      
  <li><a href="#conversionreviewversions-0">apiextensions.k8s.io/v1</a></li>

      
  <li><a href="#conversionreviewversions-1">apiextensions.k8s.io/v1beta1</a></li>

</ul>


<div id="conversionreviewversions-0">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>apiextensions.k8s.io/v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>CustomResourceDefinition<span style="color:#bbb">
</span><span style="color:#bbb"></span>...<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>...<span style="color:#bbb">
</span><span style="color:#bbb">  </span>conversion:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>strategy:<span style="color:#bbb"> </span>Webhook<span style="color:#bbb">
</span><span style="color:#bbb">    </span>webhook:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>conversionReviewVersions:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;v1&#34;</span>,<span style="color:#bbb"> </span><span style="color:#b44">&#34;v1beta1&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">      </span>...</code></pre></div>
<!--
`conversionReviewVersions` is a required field when creating 
`apiextensions.k8s.io/v1` custom resource definitions.
Webhooks are required to support at least one `ConversionReview`
version understood by the current and previous API server.
-->

<p>创建时，<code>conversionReviewVersions</code>是必填字段<code>apiextensions.k8s.io/v1</code>自定义资源定义。
需要 Webhooks 支持至少一个<code>ConversionReview</code>当前和以前的 apiserver 可以理解的版本。</p>

    
</div>

<div id="conversionreviewversions-1">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#080;font-style:italic"># Deprecated in v1.16 in favor of apiextensions.k8s.io/v1</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>apiVersion:<span style="color:#bbb"> </span>apiextensions.k8s.io/v1beta1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>CustomResourceDefinition<span style="color:#bbb">
</span><span style="color:#bbb"></span>...<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>...<span style="color:#bbb">
</span><span style="color:#bbb">  </span>conversion:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>strategy:<span style="color:#bbb"> </span>Webhook<span style="color:#bbb">
</span><span style="color:#bbb">    </span>conversionReviewVersions:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;v1&#34;</span>,<span style="color:#bbb"> </span><span style="color:#b44">&#34;v1beta1&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>...</code></pre></div>
<!--
If no `conversionReviewVersions` are specified, the default when creating 
`apiextensions.k8s.io/v1beta1` custom resource definitions is `v1beta1`.
-->

<p>如果未指定<code>conversionReviewVersions</code>，则创建时的默认值 apiextensions.k8s.io/v1beta1 自定义资源定义为 v1beta1。</p>

    
</div>

<p></div></p>

<script>$(function(){$("#conversionreviewversions").tabs();});</script>

<p>API servers send the first <code>ConversionReview</code> version in the <code>conversionReviewVersions</code> list they support.
If none of the versions in the list are supported by the API server, the custom resource definition will not be allowed to be created.
If an API server encounters a conversion webhook configuration that was previously created and does not support any of the <code>ConversionReview</code>
versions the API server knows how to send, attempts to call to the webhook will fail.</p>

<!--
This example shows the data contained in an `ConversionReview` object
for a request to convert `CronTab` objects to `example.com/v1`:
-->

<p>此示例显示了包含在<code>ConversionReview</code>对象中的数据请求将<code>CronTab</code>对象转换为<code>example.com/v1</code>：</p>

<div id="conversionreview-request">
<ul>
    
      
  <li><a href="#conversionreview-request-0">apiextensions.k8s.io/v1</a></li>

      
  <li><a href="#conversionreview-request-1">apiextensions.k8s.io/v1beta1</a></li>

</ul>


<div id="conversionreview-request-0">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">{<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#b44">&#34;apiVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;apiextensions.k8s.io/v1&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#b44">&#34;kind&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;ConversionReview&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#b44">&#34;request&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># Random uid uniquely identifying this conversion call</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;uid&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;705ab4f5-6393-11e8-b7cc-42010a800002&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">    
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># The API group and version the objects should be converted to</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;desiredAPIVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;example.com/v1&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">    
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># The list of objects to convert.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># May contain one or more objects, in one or more versions.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;objects&#34;</span>:<span style="color:#bbb"> </span>[<span style="color:#bbb">
</span><span style="color:#bbb">      </span>{<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;kind&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;CronTab&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;apiVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;example.com/v1beta1&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;metadata&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;creationTimestamp&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;2019-09-04T14:03:02Z&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;name&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;local-crontab&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;namespace&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;default&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;resourceVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;143&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;uid&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;3415a7fc-162b-4300-b5da-fd6083580d66&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span>},<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;hostPort&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;localhost:1234&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span>},<span style="color:#bbb">
</span><span style="color:#bbb">      </span>{<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;kind&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;CronTab&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;apiVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;example.com/v1beta1&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;metadata&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;creationTimestamp&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;2019-09-03T13:02:01Z&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;name&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;remote-crontab&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;resourceVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;12893&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;uid&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;359a83ec-b575-460d-b553-d859cedde8a0&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span>},<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;hostPort&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;example.com:2345&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span>}<span style="color:#bbb">
</span><span style="color:#bbb">    </span>]<span style="color:#bbb">
</span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span><span style="color:#bbb"></span>}</code></pre></div>
    

<p></div></p>

<div id="conversionreview-request-1">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">{<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># Deprecated in v1.16 in favor of apiextensions.k8s.io/v1</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#b44">&#34;apiVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;apiextensions.k8s.io/v1beta1&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#b44">&#34;kind&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;ConversionReview&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#b44">&#34;request&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># Random uid uniquely identifying this conversion call</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;uid&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;705ab4f5-6393-11e8-b7cc-42010a800002&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">    
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># The API group and version the objects should be converted to</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;desiredAPIVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;example.com/v1&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">    
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># The list of objects to convert.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># May contain one or more objects, in one or more versions.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;objects&#34;</span>:<span style="color:#bbb"> </span>[<span style="color:#bbb">
</span><span style="color:#bbb">      </span>{<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;kind&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;CronTab&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;apiVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;example.com/v1beta1&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;metadata&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;creationTimestamp&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;2019-09-04T14:03:02Z&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;name&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;local-crontab&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;namespace&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;default&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;resourceVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;143&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;uid&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;3415a7fc-162b-4300-b5da-fd6083580d66&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span>},<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;hostPort&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;localhost:1234&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span>},<span style="color:#bbb">
</span><span style="color:#bbb">      </span>{<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;kind&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;CronTab&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;apiVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;example.com/v1beta1&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;metadata&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;creationTimestamp&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;2019-09-03T13:02:01Z&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;name&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;remote-crontab&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;resourceVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;12893&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;uid&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;359a83ec-b575-460d-b553-d859cedde8a0&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span>},<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;hostPort&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;example.com:2345&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span>}<span style="color:#bbb">
</span><span style="color:#bbb">    </span>]<span style="color:#bbb">
</span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span><span style="color:#bbb"></span>}</code></pre></div>
    

<p></div></p>

<p></div></p>

<script>$(function(){$("#conversionreview-request").tabs();});</script>

<!--
### Response

Webhooks respond with a 200 HTTP status code, `Content-Type: application/json`,
and a body containing a `ConversionReview` object (in the same version they were sent),
with the `response` stanza populated, serialized to JSON.

If conversion succeeds, a webhook should return a `response` stanza containing the following fields:
* `uid`, copied from the `request.uid` sent to the webhook
* `result`, set to `{"status":"Success"}`
* `convertedObjects`, containing all of the objects from `request.objects`, converted to `request.desiredVersion`

Example of a minimal successful response from a webhook:
-->

<h3 id="响应">响应</h3>

<p>Webhooks 响应是以 200 HTTP 状态代码，<code>Content-Type:application/json</code>，和包含 ConversionReview 对象的主体（与发送的版本相同），
带有<code>response</code>节的序列，并序列化为 JSON。</p>

<p>如果转换成功，则 Webhook 应该返回包含以下字段的<code>response</code>节：
* <code>uid</code>，从发送到 webhook 的<code>request.uid</code>复制而来
* <code>result</code>，设置为<code>{&quot;status&quot;:&quot;Success&quot;}}</code>
* <code>convertedObjects</code>，包含来自<code>request.objects</code>的所有对象，转换为<code>request.desiredVersion</code></p>

<p>Webhook 的最简单成功响应示例：</p>

<div id="conversionreview-response-success">
<ul>
    
      
  <li><a href="#conversionreview-response-success-0">apiextensions.k8s.io/v1</a></li>

      
  <li><a href="#conversionreview-response-success-1">apiextensions.k8s.io/v1beta1</a></li>

</ul>


<div id="conversionreview-response-success-0">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">{<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#b44">&#34;apiVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;apiextensions.k8s.io/v1&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#b44">&#34;kind&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;ConversionReview&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#b44">&#34;response&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># must match &lt;request.uid&gt;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;uid&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;705ab4f5-6393-11e8-b7cc-42010a800002&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;result&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#b44">&#34;status&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;Success&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>},<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># Objects must match the order of request.objects, and have apiVersion set to &lt;request.desiredAPIVersion&gt;.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># kind, metadata.uid, metadata.name, and metadata.namespace fields must not be changed by the webhook.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># metadata.labels and metadata.annotations fields may be changed by the webhook.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># All other changes to metadata fields by the webhook are ignored.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;convertedObjects&#34;</span>:<span style="color:#bbb"> </span>[<span style="color:#bbb">
</span><span style="color:#bbb">      </span>{<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;kind&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;CronTab&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;apiVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;example.com/v1&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;metadata&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;creationTimestamp&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;2019-09-04T14:03:02Z&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;name&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;local-crontab&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;namespace&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;default&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;resourceVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;143&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;uid&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;3415a7fc-162b-4300-b5da-fd6083580d66&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span>},<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;host&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;localhost&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;port&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;1234&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span>},<span style="color:#bbb">
</span><span style="color:#bbb">      </span>{<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;kind&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;CronTab&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;apiVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;example.com/v1&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;metadata&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;creationTimestamp&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;2019-09-03T13:02:01Z&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;name&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;remote-crontab&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;resourceVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;12893&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;uid&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;359a83ec-b575-460d-b553-d859cedde8a0&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span>},<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;host&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;example.com&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;port&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;2345&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span>}<span style="color:#bbb">
</span><span style="color:#bbb">    </span>]<span style="color:#bbb">
</span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span><span style="color:#bbb"></span>}</code></pre></div>
    

<p></div></p>

<div id="conversionreview-response-success-1">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">{<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># Deprecated in v1.16 in favor of apiextensions.k8s.io/v1</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#b44">&#34;apiVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;apiextensions.k8s.io/v1beta1&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#b44">&#34;kind&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;ConversionReview&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#b44">&#34;response&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># must match &lt;request.uid&gt;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;uid&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;705ab4f5-6393-11e8-b7cc-42010a800002&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;result&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#b44">&#34;status&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;Failed&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>},<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># Objects must match the order of request.objects, and have apiVersion set to &lt;request.desiredAPIVersion&gt;.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># kind, metadata.uid, metadata.name, and metadata.namespace fields must not be changed by the webhook.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># metadata.labels and metadata.annotations fields may be changed by the webhook.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># All other changes to metadata fields by the webhook are ignored.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;convertedObjects&#34;</span>:<span style="color:#bbb"> </span>[<span style="color:#bbb">
</span><span style="color:#bbb">      </span>{<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;kind&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;CronTab&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;apiVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;example.com/v1&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;metadata&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;creationTimestamp&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;2019-09-04T14:03:02Z&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;name&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;local-crontab&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;namespace&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;default&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;resourceVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;143&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;uid&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;3415a7fc-162b-4300-b5da-fd6083580d66&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span>},<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;host&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;localhost&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;port&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;1234&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span>},<span style="color:#bbb">
</span><span style="color:#bbb">      </span>{<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;kind&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;CronTab&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;apiVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;example.com/v1&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;metadata&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;creationTimestamp&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;2019-09-03T13:02:01Z&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;name&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;remote-crontab&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;resourceVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;12893&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;uid&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;359a83ec-b575-460d-b553-d859cedde8a0&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span>},<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;host&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;example.com&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;port&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;2345&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span>}<span style="color:#bbb">
</span><span style="color:#bbb">    </span>]<span style="color:#bbb">
</span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span><span style="color:#bbb"></span>}</code></pre></div>
    

<p></div></p>

<p></div></p>

<script>$(function(){$("#conversionreview-response-success").tabs();});</script>

<!--
If conversion fails, a webhook should return a `response` stanza containing the following fields:
* `uid`, copied from the `request.uid` sent to the webhook
* `result`, set to `{"status":"Failed"}`
-->

<p>如果转换失败，则 Webhook 应该返回包含以下字段的<code>response</code>节：
*<code>uid</code>，从发送到 webhook 的<code>request.uid</code>复制而来
*<code>result</code>，设置为<code>{&quot;status&quot;:&quot;Failed&quot;}</code></p>

<blockquote class="warning">
  <div><strong>警告：</strong> <!--
Failing conversion can disrupt read and write access to the custom resources,
including the ability to update or delete the resources. Conversion failures 
should be avoided whenever possible, and should not be used to enforce validation
 constraints (use validation schemas or webhook admission instead).
-->

<p>转换失败会破坏对自定义资源的读写访问，包括更新或删除资源的能力。转换失败应尽可能避免使用，并且不应用于强制验证
 约束（改用验证模式 或 Webhook admission）。</div>
</blockquote>

<!--
Example of a response from a webhook indicating a conversion request failed, with an optional message:
-->

<p>来自 Webhook 的响应示例，指示转换请求失败，并带有可选消息：</p>

<div id="conversionreview-response-failure">
<ul>
    
      
  <li><a href="#conversionreview-response-failure-0">apiextensions.k8s.io/v1</a></li>

      
  <li><a href="#conversionreview-response-failure-1">apiextensions.k8s.io/v1beta1</a></li>

</ul>


<div id="conversionreview-response-failure-0">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">{<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#b44">&#34;apiVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;apiextensions.k8s.io/v1&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#b44">&#34;kind&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;ConversionReview&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#b44">&#34;response&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;uid&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;&lt;value from request.uid&gt;&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;result&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#b44">&#34;status&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;Failed&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#b44">&#34;message&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;hostPort could not be parsed into a separate host and port&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span><span style="color:#bbb"></span>}</code></pre></div>
    

<p></div></p>

<div id="conversionreview-response-failure-1">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">{<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># Deprecated in v1.16 in favor of apiextensions.k8s.io/v1</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#b44">&#34;apiVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;apiextensions.k8s.io/v1beta1&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#b44">&#34;kind&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;ConversionReview&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#b44">&#34;response&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;uid&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;&lt;value from request.uid&gt;&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;result&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#b44">&#34;status&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;Failed&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#b44">&#34;message&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;hostPort could not be parsed into a separate host and port&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span><span style="color:#bbb"></span>}</code></pre></div>
    

<p></div></p>

<p></div></p>

<script>$(function(){$("#conversionreview-response-failure").tabs();});</script>

<!--
## Writing, reading, and updating versioned CustomResourceDefinition objects
-->

<h2 id="编写-读取和更新版本化的-customresourcedefinition-对象">编写、读取和更新版本化的 CustomResourceDefinition 对象</h2>

<!--
When an object is written, it is persisted at the version designated as the
storage version at the time of the write. If the storage version changes,
existing objects are never converted automatically. However, newly-created
or updated objects are written at the new storage version. It is possible for an
object to have been written at a version that is no longer served.
-->

<p>写入对象时，它将保留在写入时指定为存储版本的版本中。如果存储版本发生变化，现有对象永远不会自动转换。然而，新创建或更新的对象将在新的存储版本中编写。对象可能已在不再被服务的版本中编写。</p>

<!--
When you read an object, you specify the version as part of the path. If you
specify a version that is different from the object's persisted version,
Kubernetes returns the object to you at the version you requested, but the
persisted object is neither changed on disk, nor converted in any way
(other than changing the `apiVersion` string) while serving the request.
You can request an object at any version that is currently served.
-->

<p>当读取对象时，将版本指定为路径的一部分。
如果指定的版本与对象的持久版本不同，Kubernetes 会在您请求的版本里将对象返还给您，但是在提供请求时，持久化对象既不会在磁盘上更改，也不会以任何方式进行转换（除了更改<code>apiVersion</code>字符串）。您可以在当前提供的任何版本中请求对象。</p>

<!--
If you update an existing object, it is rewritten at the version that is
currently the storage version. This is the only way that objects can change from
one version to another.
-->

<p>如果您更新了一个现有对象，它将在现在的存储版本中被重写。
这是对象可以从一个版本改到另一个版本的唯一办法。</p>

<!--
To illustrate this, consider the following hypothetical series of events:
-->

<p>为了说明这一点，请考虑以下假设的一系列事件：</p>

<!--
1.  The storage version is `v1beta1`. You create an object. It is persisted in
    storage at version `v1beta1`
2.  You add version `v1` to your CustomResourceDefinition and designate it as
    the storage version.
3.  You read your object at version `v1beta1`, then you read the object again at
    version `v1`. Both returned objects are identical except for the apiVersion
    field.
4.  You create a new object. It is persisted in storage at version `v1`. You now
    have two objects, one of which is at `v1beta1`, and the other of which is at
    `v1`.
5.  You update the first object. It is now persisted at version `v1` since that
    is the current storage version.
-->

<ol>
<li>存储版本是<code>v1beta1</code>。
它保存在版本<code>v1beta1</code>的存储中。</li>
<li>您将版本<code>v1</code>添加到 CustomResourceDefinition 中，并将其指定为存储版本。</li>
<li>您在版本<code>v1beta1</code>中读取您的对象，然后您再次在版本<code>v1</code>中读取对象。
除了 apiVersion 字段之外，两个返回的对象都是相同的。</li>
<li>您创建一个新对象。
它存储在版本<code>v1</code>的存储中。
您现在有两个对象，其中一个位于<code>v1beta1</code>，另一个位于<code>v1</code>。</li>
<li>您更新第一个对象。
它现在保存在版本<code>v1</code>中，因为那是当前的存储版本。</li>
</ol>

<!--
### Previous storage versions
-->

<h3 id="以前的存储版本">以前的存储版本</h3>

<!--
The API server records each version which has ever been marked as the storage
version in the status field `storedVersions`. Objects may have been persisted
at any version that has ever been designated as a storage version. No objects
can exist in storage at a version that has never been a storage version.
-->

<p>API 服务在状态字段<code>storedVersions</code>中记录曾被标记为存储版本的每个版本。
对象可能已被保留在任何曾被指定为存储版本的版本中。
从未成为存储版本的版本的存储中不能存在任何对象。</p>

<!--
## Upgrade existing objects to a new stored version
-->

<h2 id="将现有对象升级到新的存储版本">将现有对象升级到新的存储版本</h2>

<!--
When deprecating versions and dropping support, devise a storage upgrade
procedure. The following is an example procedure to upgrade from `v1beta1`
to `v1`.
-->

<p>弃用版本并删除支持时，请设计存储升级过程。
以下是从<code>v1beta1</code>升级到<code>v1</code>的示例过程。</p>

<!--
1.  Set `v1` as the storage in the CustomResourceDefinition file and apply it
    using kubectl. The `storedVersions` is now `v1beta1, v1`.
2.  Write an upgrade procedure to list all existing objects and write them with
    the same content. This forces the backend to write objects in the current
    storage version, which is `v1`.
3.  Update the CustomResourceDefinition `Status` by removing `v1beta1` from
    `storedVersions` field.
-->

<ol>
<li>将<code>v1</code>设置为 CustomResourceDefinition 文件中的存储，并使用 kubectl 应用它。
<code>storedVersions</code>现在是<code>v1beta1、 v1</code>。</li>
<li>编写升级过程以列出所有现有对象并使用相同内容编写它们。
这会强制后端在当前存储版本中写入对象，即<code>v1</code>。</li>
<li>通过从<code>storedVersions</code>字段中删除<code>v1beta1</code>来更新 CustomResourceDefinition<code>Status</code>。</li>
</ol>






<!--
---
title: Versions in CustomResourceDefinitions
reviewers:
- sttts
- liggitt
content_template: templates/task
weight: 30
---
-->














    
    

    
            
  <h2>反馈</h2>
  <p class="feedback--prompt">此页是否对您有帮助？ </p>
  <button class="button feedback--yes">是</button>
  <button class="button feedback--no">否</button>
  <p class="feedback--response feedback--response__hidden">
    感谢反馈。如果您有一个关于如何使用 Kubernetes 的特定的、需要答案的问题，可以访问
    <a target="_blank" rel="noopener"
      href="https://stackoverflow.com/questions/tagged/kubernetes">
      Stack Overflow</a>.
    在 GitHub 仓库上登记新的问题
    <a class="feedback--link" target="_blank" rel="noopener"
      href="https://github.com/kubernetes/website/issues/new?title=Issue%20with%20k8s.io">
      报告问题</a>
    或者
    <a class="feedback--link" target="_blank" rel="noopener"
      href="https://github.com/kubernetes/website/issues/new?title=Improvement%20for%20k8s.io">
      提出改进建议</a>.
  </p>
  <script>
    const yes = document.querySelector('.feedback--yes');
    const no = document.querySelector('.feedback--no');
    document.querySelectorAll('.feedback--link').forEach(link => {
      link.href = link.href + window.location.pathname;
    });
    const sendFeedback = (value) => {
      if (!gtag) { console.log('!gtag'); }
      gtag('event', 'click', {
        'event_category': 'Helpful',
        'event_label': window.location.pathname,
        value
      });
    };
    const disableButtons = () => {
      yes.disabled = true;
      yes.classList.add('feedback--button__disabled');
      no.disabled = true;
      no.classList.add('feedback--button__disabled');
    };
    yes.addEventListener('click', () => {
      sendFeedback(1);
      disableButtons();
      document.querySelector('.feedback--response').classList.remove('feedback--response__hidden');
    });
    no.addEventListener('click', () => {
      sendFeedback(0);
      disableButtons();
      document.querySelector('.feedback--response').classList.remove('feedback--response__hidden');
    });
  </script>


    
            <div id="pre-footer"> 
  <hr />

  <div class="issue-button-container">
    <p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs/tasks/access-kubernetes-api/custom-resources/_index.md?pixel" alt="Analytics" /></a></p>
    
    
    <script type="text/javascript">
    PDRTJS_settings_8345992 = {
    "id" : "8345992",
    "unique_id" : "\/zh\/docs\/tasks\/access-kubernetes-api\/custom-resources\/",
    "title" : "使用自定义资源",
    "permalink" : "https:\/\/kubernetes.io\/zh\/docs\/tasks\/access-kubernetes-api\/custom-resources\/"
    };
    (function(d,c,j){if(!document.getElementById(j)){var pd=d.createElement(c),s;pd.id=j;pd.src=('https:'==document.location.protocol)?'https://polldaddy.com/js/rating/rating.js':'http://i0.poll.fm/js/rating/rating.js';s=document.getElementsByTagName(c)[0];s.parentNode.insertBefore(pd,s);}}(document,'script','pd-rating-js'));
    </script>
    <a href="" onclick="window.open('https://github.com/kubernetes/website/issues/new?template=bug-report.md&title=Issue%20with%20' +
    'k8s.io'+window.location.pathname)" class="button issue">报告 GitHub 问题</a>
    
    
    
    <a href="https://github.com/kubernetes/website/edit/master/content/zh/docs/tasks/access-kubernetes-api/custom-resources/_index.md" class="button issue">修改本页面</a>
    
  </div>
  

  <div id="lastedit" class="lastedit issue-button-container">
    页面最后一次修改于 December 25, 2019 at 8:51 AM PST 由：
    <a href="https://github.com/kubernetes/website/commit/b8b2cc7c7443e32de70834a2b3d2186cae6eea5a/">ZH-trans: merge release1.16-temporary to master (#18217)</a> (<a href="https://github.com/kubernetes/website/commits/master/content/en/docs/tasks/access-kubernetes-api/custom-resources/_index.md">页面历史</a>)
  </div>
  
</div>

          </div>
        </section>
    </main>
		<footer>
    <div class="light-text main-section">
        <nav>
            
            
            
            <a href="/zh/docs/home/">主页</a>
            
            <a href="/zh/blog/">博客</a>
            
            
            
            <a href="/zh/partners/">合作伙伴</a>
            
            <a href="/zh/community/">社区</a>
            
            <a href="/zh/case-studies/">案例分析</a>
            
        </nav>
        <div class="social" role="region" aria-label="Social hyperlinks">
            <div>
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>Twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>GitHub</span></a>
                <a href="https://slack.k8s.io/" class="slack"><span>Slack</span></a>
            </div>
            <div>
                <a href="https://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://www.youtube.com/kubernetescommunity" class="youtube"><span>YouTube</span></a>
                <a href="https://discuss.kubernetes.io" class="mailing-list"><span>论坛</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>事件日历</span></a>
            </div>
            <div>
                
                <a href="https://git.k8s.io/community/contributors/guide" class="button">贡献</a>
            </div>
        </div>
        <div class="miceType center">
            &copy; 2023 The Kubernetes 作者 | 文档发布基于 <a href="https://git.k8s.io/website/LICENSE" class="light-text">CC BY 4.0</a> 授权许可</a>
        </div>
        <div class="miceType center">
            Copyright &copy; 2023 Linux 基金会&reg;。保留所有权利。Linux 基金会已注册并使用商标。如需了解 Linux 基金会的商标列表，请访问<a href="https://www.linuxfoundation.org/trademark-usage" class="light-text">商标使用页面</a>
        </div>
        <div class="miceType center">
            ICP license: 京ICP备17074266号-3
        </div>
    </div>
</footer>

		<button class="flyout-button" onclick="kub.toggleToc()" aria-label="Toggle table of contents visibility"></button>

<script>

(function () {
    window.addEventListener('DOMContentLoaded', init)

        
        function init() {
            window.removeEventListener('DOMContentLoaded', init)
                hideNav()
        }

    function hideNav(toc){
        if (!toc) toc = document.querySelector('#docsToc')
        if (!toc) return
            var container = toc.querySelector('.container')

                
                if (container) {
                    if (container.childElementCount === 0 || toc.querySelectorAll('a.item').length === 1) {
                        toc.style.display = 'none'
                            document.getElementById('docsContent').style.width = '100%'
                    }
                } else {
                    requestAnimationFrame(function () {
                        hideNav(toc)
                    })
                }
    }
})();
</script>



    <script language="application/javascript">
      
      (function addHeadingLinks(){
        var article = document.getElementById('docsContent');
        var headings = article.querySelectorAll('h1, h2, h3, h4, h5, h6');
        headings.forEach(function(heading){
          if(heading.id){
            var a = document.createElement('a');
            a.innerHTML = heading.innerHTML;
            a.href = '#'+heading.id;
            a.classList.add('inpage_heading');
            heading.innerHTML = '';
            heading.appendChild(a);
          }
        });
      })();
    </script>
	</body>
</html>
