<!DOCTYPE html>
<html id="docs" lang="ko" class="">
	<head>
	

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-36037335-10"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-36037335-10');
</script>
<meta charset="utf-8">
<title>스테이트풀셋 기본 - Kubernetes</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#326ce5">
<link rel="shortcut icon" type="image/png" href="/images/favicon.png">









<link rel="stylesheet" href="/css/style.b7b8403eb5b1fddd0a2da2a8383d5b53e6ef81c23e4b0e292e6103bd91f9502d.css" integrity="sha256-t7hAPrWx/d0KLaKoOD1bU&#43;bvgcI&#43;Sw4pLmEDvZH5UC0=">


<link rel="stylesheet" href="/css/base_fonts.css">
<link rel="stylesheet" href="/css/jquery-ui.min.css">
<link rel="stylesheet" href="/css/callouts.css">
<link rel="stylesheet" href="/css/custom-jekyll/tags.css">



<meta name="description" content="">
<meta property="og:description" content="">
<meta name="twitter:description" content="">
<meta property="og:url" content="https://kubernetes.io/ko/docs/tutorials/stateful-application/basic-stateful-set/">
<meta property="og:title" content="스테이트풀셋 기본">
<meta name="twitter:title" content="스테이트풀셋 기본">
<meta name="twitter:image" content="https://kubernetes.io/images/favicon.png" />

<meta name="twitter:image:alt" content="Kubernetes">

<meta property="og:image" content="/images/kubernetes-horizontal-color.png">

<meta property="og:type" content="article">
<script src="/js/anchor-4.1.1.min.js"></script>
<script src="/js/jquery-3.2.1.min.js"></script>
<script src="/js/jquery-ui-1.12.1.min.js"></script>
<script src="/js/bootstrap-4.3.1.min.js"></script>
<script src="/js/sweetalert-2.1.2.min.js"></script>

<script src="/js/script.js"></script>
<script src="/js/custom-jekyll/tags.js"></script>


	</head>
	<body>
		<div id="cellophane" onclick="kub.toggleMenu()"></div>

<header>
    <a href="/ko/" class="logo" title="운영 수준의 컨테이너 오케스트레이션 - Kubernetes" aria-label="Kubernetes website"></a>

    <div class="nav-buttons" data-auto-burger="primary">
        <ul class="global-nav">
            
            
            <li><a href="/ko/docs/" class="active">문서</a></li>
            
            
            
            <li><a href="/ko/training/">교육</a></li>
            
            
            
            
            
            <li><a href="/ko/case-studies/">사례 연구</a></li>
            
            
            
             <li>
                <a href="#">
                    한국어 Korean <span class="ui-icon ui-icon-carat-1-s"></span>
                </a>
                <ul>
                
                    <li><a href="/docs/tutorials/stateful-application/basic-stateful-set/">English</a></li>
                
                    <li><a href="/zh/docs/tutorials/stateful-application/basic-stateful-set/">中文 Chinese</a></li>
                
                </ul>
            </li>

            <li>
                <a href="#">
                    v1.17 <span class="ui-icon ui-icon-carat-1-s"></span>
                </a>
                <ul>
                
                    <li><a href="https://kubernetes.io/ko/docs/tutorials/stateful-application/basic-stateful-set/">v1.21</a></li>
                
                    <li><a href="https://v1-20.docs.kubernetes.io/ko/docs/tutorials/stateful-application/basic-stateful-set/">v1.20</a></li>
                
                    <li><a href="https://v1-19.docs.kubernetes.io/ko/docs/tutorials/stateful-application/basic-stateful-set/">v1.19</a></li>
                
                    <li><a href="https://v1-18.docs.kubernetes.io/ko/docs/tutorials/stateful-application/basic-stateful-set/">v1.18</a></li>
                
                    <li><a href="https://v1-17.docs.kubernetes.io/ko/docs/tutorials/stateful-application/basic-stateful-set/">v1.17</a></li>
                
                </ul>
            </li>
        </ul>
        
        <a href="/ko/docs/tutorials/kubernetes-basics/" class="button" id="tryKubernetes" data-auto-burger-exclude>쿠버네티스 기초 학습</a>
        

        <button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
    </div>

    <nav id="mainNav">
        <div class="main-section" data-auto-burger="primary">
         
           <div class="nav-box">
            <h3><a href="/ko/docs/tutorials/hello-minikube/">Get Started</a></h3>
           <p>Ready to get your hands dirty? Build a simple Kubernetes cluster that runs "Hello World" for Node.js.</p>

            </div>
         
           <div class="nav-box">
            <h3><a href="/ko/docs/home/">문서</a></h3>
           <p>개념, 튜토리얼 및 참조 문서와 함께 쿠버네티스 사용하는 방법을 익힐 수 있다. 또한, <a href="/editdocs/" data-auto-burger-exclude>문서에 기여하는 것도 도움을 줄 수 있다</a>!</p>

            </div>
         
        </div>
        <div class="main-section" data-auto-burger="primary">
            <div class="left">
                <h5 class="github-invite">코어 쿠버네티스 코드 베이스를 살펴보는데 관심이 있으십니까?</h5>
                <a href="https://github.com/kubernetes/kubernetes" class="button" data-auto-burger-exclude>GitHub에서 보기</a>
            </div>

            <div class="right">
                <h5 class="github-invite">커뮤니티 둘러보기</h5>
                <div class="social">
                    <a href="https://twitter.com/kubernetesio" class="twitter"><span>Twitter</span></a>
                    <a href="https://github.com/kubernetes/kubernetes" class="github"><span>GitHub</span></a>
                    <a href="http://slack.k8s.io/" class="slack"><span>Slack Slack</span></a>
                    <a href="https://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                    <a href="https://www.youtube.com/kubernetescommunity" class="youtube"><span>YouTube</span></a>
                    <a href="https://discuss.kubernetes.io" class="mailing-list"><span>Forum</span></a>
                    <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>이벤트 캘린더</span></a>
                </div>
            </div>
            <div class="clear" style="clear: both"></div>
        </div>
    </nav>
</header>

		
		
		<section id="hero" class="light-text no-sub">
			













<h1>튜토리얼</h1>
<h5></h5>






<div id="vendorStrip" class="light-text">
	<ul>
		
		
		<li><a href="/ko/docs/home/">홈</a></li>
		
		
		<li><a href="/ko/docs/setup/">시작하기</a></li>
		
		
		<li><a href="/ko/docs/concepts/">개념</a></li>
		
		
		<li><a href="/ko/docs/tasks/">태스크</a></li>
		
		
		<li><a href="/ko/docs/tutorials/" class="YAH">튜토리얼</a></li>
		
		
		<li><a href="/ko/docs/reference/">레퍼런스</a></li>
		
		
		<li><a href="/ko/docs/contribute/">기여</a></li>
		
	</ul>
	<form id="searchBox" action="/docs/search/" role="search">
		<input type="text" id="search" name="q" placeholder="검색하기" aria-label="Search">
	</form>
</div>

		</section>
		
    
		
<section id="deprecationWarning">
  <main>
    <div class="content deprecation-warning">
      <h3>
	 Kubernetes v1.17
	  문서는 더 이상 적극적으로 관리되지 않음. 현재 보고있는 문서는 정적 스냅샷임. 최신 문서를 위해서는, 다음을 참고. 
	 <a href="https://kubernetes.io/docs/home/">최신 버전.</a>
      </h3>
    </div>
  </main>
</section>


    <main>
        <section id="encyclopedia">
          
<div id="docsToc">
     <div class="pi-accordion">
    	
        
        
        
        
        
         
             
                 
             
         
             
                 
             
         
             
                 
             
         
             
                 
             
         
             
                 
                          
                          
                 
             
         
             
         
             
         
         
        
        <a class="item" data-title="튜토리얼" href="/ko/docs/tutorials/"></a>

	
	
			
			
			
			
			
		
	
	
	
		
			

<a class="item" data-title="Hello Minikube" href="/ko/docs/tutorials/hello-minikube/"></a>

		
	
		
			
<div class="item" data-title="쿠버네티스 기초 학습">
	<div class="container">
		
		
		
		<a class="item" data-title="쿠버네티스 기초 학습" href="/ko/docs/tutorials/kubernetes-basics/"></a>
		
		
	
	
			
			
			
			
			
		
	
	
	
		
			
<div class="item" data-title="클러스터 생성하기">
	<div class="container">
		
		
	
	
			
			
			
			
			
		
	
	
	
		
			

<a class="item" data-title="Minikube를 사용해서 클러스터 생성하기" href="/ko/docs/tutorials/kubernetes-basics/create-cluster/cluster-intro/"></a>

		
	
		
			

<a class="item" data-title="대화형 튜토리얼 - 클러스터 생성하기" href="/ko/docs/tutorials/kubernetes-basics/create-cluster/cluster-interactive/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="앱 배포하기">
	<div class="container">
		
		
	
	
			
			
			
			
			
		
	
	
	
		
			

<a class="item" data-title="kubectl을 사용해서 디플로이먼트 생성하기" href="/ko/docs/tutorials/kubernetes-basics/deploy-app/deploy-intro/"></a>

		
	
		
			

<a class="item" data-title="대화형 튜토리얼 - 앱 배포하기" href="/ko/docs/tutorials/kubernetes-basics/deploy-app/deploy-interactive/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="앱 조사하기">
	<div class="container">
		
		
	
	
			
			
			
			
			
		
	
	
	
		
			

<a class="item" data-title="파드와 노드 보기" href="/ko/docs/tutorials/kubernetes-basics/explore/explore-intro/"></a>

		
	
		
			

<a class="item" data-title="대화형 튜토리얼 - 앱 조사하기" href="/ko/docs/tutorials/kubernetes-basics/explore/explore-interactive/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="앱 외부로 노출하기">
	<div class="container">
		
		
	
	
			
			
			
			
			
		
	
	
	
		
			

<a class="item" data-title="앱 노출을 위해 서비스 이용하기" href="/ko/docs/tutorials/kubernetes-basics/expose/expose-intro/"></a>

		
	
		
			

<a class="item" data-title="대화형 튜토리얼 - 앱 노출하기" href="/ko/docs/tutorials/kubernetes-basics/expose/expose-interactive/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="앱 스케일링하기">
	<div class="container">
		
		
	
	
			
			
			
			
			
		
	
	
	
		
			

<a class="item" data-title="복수의 앱 인스턴스를 구동하기" href="/ko/docs/tutorials/kubernetes-basics/scale/scale-intro/"></a>

		
	
		
			

<a class="item" data-title="대화형 튜토리얼 - 앱 스케일링하기" href="/ko/docs/tutorials/kubernetes-basics/scale/scale-interactive/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="앱 업데이트하기">
	<div class="container">
		
		
	
	
			
			
			
			
			
		
	
	
	
		
			

<a class="item" data-title="롤링 업데이트 수행하기" href="/ko/docs/tutorials/kubernetes-basics/update/update-intro/"></a>

		
	
		
			

<a class="item" data-title="대화형 튜토리얼 - 앱 업데이트 하기" href="/ko/docs/tutorials/kubernetes-basics/update/update-interactive/"></a>

		
	

	</div>
</div>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="설정">
	<div class="container">
		
		
	
	
			
			
			
			
			
		
	
	
	
		
			

<a class="item" data-title="컨피그 맵을 사용해서 Redis 설정하기" href="/ko/docs/tutorials/configuration/configure-redis-using-configmap/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="상태 유지를 하지 않는 애플리케이션">
	<div class="container">
		
		
	
	
			
			
			
			
			
		
	
	
	
		
			

<a class="item" data-title="외부 IP 주소를 노출하여 클러스터의 애플리케이션에 접속하기" href="/ko/docs/tutorials/stateless-application/expose-external-ip-address/"></a>

		
	
		
			

<a class="item" data-title="예시: Redis를 사용한 PHP 방명록 애플리케이션 배포하기" href="/ko/docs/tutorials/stateless-application/guestbook/"></a>

		
	
		
			

<a class="item" data-title="예제: PHP / Redis 방명록 예제에 로깅과 메트릭 추가" href="/ko/docs/tutorials/stateless-application/guestbook-logs-metrics-with-elk/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="상태 유지가 필요한(stateful) 애플리케이션">
	<div class="container">
		
		
	
	
			
			
			
			
			
		
	
	
	
		
			

<a class="item" data-title="스테이트풀셋 기본" href="/ko/docs/tutorials/stateful-application/basic-stateful-set/"></a>

		
	
		
			

<a class="item" data-title="예시: WordPress와 MySQL을 퍼시스턴트 볼륨에 배포하기" href="/ko/docs/tutorials/stateful-application/mysql-wordpress-persistent-volume/"></a>

		
	
		
			

<a class="item" data-title="예시: 카산드라를 스테이트풀셋으로 배포하기" href="/ko/docs/tutorials/stateful-application/cassandra/"></a>

		
	
		
			

<a class="item" data-title="분산 시스템 코디네이터 ZooKeeper 실행하기" href="/ko/docs/tutorials/stateful-application/zookeeper/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="클러스터">
	<div class="container">
		
		
	
	
			
			
			
			
			
		
	
	
	
		
			

<a class="item" data-title="AppArmor" href="/ko/docs/tutorials/clusters/apparmor/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="서비스">
	<div class="container">
		
		
	
	
			
			
			
			
			
		
	
	
	
		
			

<a class="item" data-title="소스 IP 주소 이용하기" href="/ko/docs/tutorials/services/source-ip/"></a>

		
	

	</div>
</div>

		
	





     </div> 
    <button class="push-menu-close-button" onclick="kub.toggleToc()"></button>
</div> 


          <div id="docsContent">
            

<p>
  <a href="https://github.com/kubernetes/website/edit/master/content/ko/docs/tutorials/stateful-application/basic-stateful-set.md" id="editPageButton" target="_blank">
    Edit This Page
  </a>
</p>

<h1>스테이트풀셋 기본</h1>



<p>이 튜토리얼은 스테이트풀셋(<a href="/ko/docs/concepts/workloads/controllers/statefulset/">StatefulSets</a>)을 이용하여
애플리케이션을 관리하는 방법을 소개한다. 어떻게 스테이트풀셋의 파드(Pod)을 생성하고 삭제하며
스케일링하고 업데이트하는지 시연한다.</p>












<ul id="markdown-toc">










<li><a href="#%eb%aa%a9%ec%a0%81">목적</a></li>












<li><a href="#%ec%8b%9c%ec%9e%91%ed%95%98%ea%b8%b0-%ec%a0%84%ec%97%90">시작하기 전에</a></li>












<li><a href="#%ec%8a%a4%ed%85%8c%ec%9d%b4%ed%8a%b8%ed%92%80%ec%85%8b-%ec%83%9d%ec%84%b1%ed%95%98%ea%b8%b0">스테이트풀셋 생성하기</a></li>




<li><a href="#%ec%8a%a4%ed%85%8c%ec%9d%b4%ed%8a%b8%ed%92%80%ec%85%8b-%ec%95%88%ec%97%90-%ed%8c%8c%eb%93%9c">스테이트풀셋 안에 파드</a></li>




<li><a href="#%ec%8a%a4%ed%85%8c%ec%9d%b4%ed%8a%b8%ed%92%80%ec%85%8b-%ec%8a%a4%ec%bc%80%ec%9d%bc%eb%a7%81">스테이트풀셋 스케일링</a></li>




<li><a href="#%ec%8a%a4%ed%85%8c%ec%9d%b4%ed%8a%b8%ed%92%80%ec%85%8b-%ec%97%85%eb%8d%b0%ec%9d%b4%ed%8a%b8%ed%95%98%ea%b8%b0">스테이트풀셋 업데이트하기</a></li>




<li><a href="#%ec%8a%a4%ed%85%8c%ec%9d%b4%ed%8a%b8%ed%92%80%ec%85%8b-%ec%82%ad%ec%a0%9c%ed%95%98%ea%b8%b0">스테이트풀셋 삭제하기</a></li>




<li><a href="#%ed%8c%8c%eb%93%9c-%ea%b4%80%eb%a6%ac-%ec%a0%95%ec%b1%85">파드 관리 정책</a></li>




















<li><a href="#%ec%a0%95%eb%a6%ac%ed%95%98%ea%b8%b0">정리하기</a></li>











</ul>



<h2 id="목적">목적</h2>
<p>스테이트풀셋은 상태 유지가 필요한(stateful) 애플리케이션과 분산시스템에서
이용하도록 의도했다. 그러나 쿠버네티스 상에 스테이트풀 애플리케이션과
분산시스템을 관리하는 것은 광범위하고 복잡한 주제이다. 스테이트풀셋의 기본 기능을 보여주기 위해
이 둘을 결합하지 않고, 스테이트풀셋을 사용한
단순 웹 애플리케이션을 배포할 것이다.</p>

<p>이 튜토리얼을 마치면 다음 항목에 대해 익숙해질 것이다.</p>

<ul>
<li>스테이트풀셋을 어떻게 생성하는지</li>
<li>스테이트풀셋이 어떻게 파드를 관리하는지</li>
<li>스테이트풀셋을 어떻게 삭제하는지</li>
<li>스테이트풀셋은 어떻게 스케일링하는지</li>
<li>스테이트풀셋의 파드는 어떻게 업데이트하는지</li>
</ul>





<h2 id="시작하기-전에">시작하기 전에</h2>
<p>튜토리얼을 시작하기 전에 다음의 쿠버네티스 컨셉에 대해
익숙해야 한다.</p>

<ul>
<li><a href="/docs/user-guide/pods/single-container/">파드</a></li>
<li><a href="/ko/docs/concepts/services-networking/dns-pod-service/">클러스터 DNS(Cluster DNS)</a></li>
<li><a href="/ko/docs/concepts/services-networking/service/#헤드리스-headless-서비스">헤드리스 서비스(Headless Services)</a></li>
<li><a href="/docs/concepts/storage/persistent-volumes/">퍼시스턴트볼륨(PersistentVolumes)</a></li>
<li><a href="https://github.com/kubernetes/examples/tree/v1.17.17/staging/persistent-volume-provisioning/" target="_blank">퍼시턴트볼륨 프로비저닝</a></li>
<li><a href="/ko/docs/concepts/workloads/controllers/statefulset/">스테이트풀셋</a></li>
<li><a href="/docs/user-guide/kubectl/">kubectl CLI</a></li>
</ul>

<p>이 튜토리얼은 클러스터가 퍼시스턴스볼륨을 동적으로 프로비저닝 하도록
설정되었다고 가정한다. 만약 클러스터가 이렇게 설정되어 있지 않다면,
튜토리얼 시작 전에 수동으로 2개의 1 GiB 볼륨을
프로비저닝해야 한다.</p>




<h2 id="스테이트풀셋-생성하기">스테이트풀셋 생성하기</h2>

<p>아래 예제를 이용해서 스테이트풀셋을 생성하자. 이는
<a href="/ko/docs/concepts/workloads/controllers/statefulset/">스테이트풀셋</a> 개념에서 보인
예제와 유사하다. 이것은 <code>web</code>과 이 스테이트풀셋 파드의 IP 주소를 게시하는
<a href="/ko/docs/concepts/services-networking/service/#헤드리스-headless-서비스">헤드리스 서비스</a>인
<code>nginx</code> 를 생성한다.</p>

<table class="includecode" id="application-web-web-yaml">
    <thead>
        <tr>
            <th>
                <a href="https://raw.githubusercontent.com/kubernetes/website/master/content/ko/examples/application/web/web.yaml" download="application/web/web.yaml">
                    <code>application/web/web.yaml</code>
                </a>
                <img src="/images/copycode.svg" style="max-height:24px; cursor: pointer" onclick="copyCode('application-web-web-yaml')" title="Copy application/web/web.yaml to clipboard">
            </th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>Service<span style="color:#bbb">
</span><span style="color:#bbb"></span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>name:<span style="color:#bbb"> </span>nginx<span style="color:#bbb">
</span><span style="color:#bbb">  </span>labels:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>app:<span style="color:#bbb"> </span>nginx<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>ports:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>port:<span style="color:#bbb"> </span><span style="color:#666">80</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>name:<span style="color:#bbb"> </span>web<span style="color:#bbb">
</span><span style="color:#bbb">  </span>clusterIP:<span style="color:#bbb"> </span>None<span style="color:#bbb">
</span><span style="color:#bbb">  </span>selector:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>app:<span style="color:#bbb"> </span>nginx<span style="color:#bbb">
</span><span style="color:#bbb"></span>---<span style="color:#bbb">
</span><span style="color:#bbb"></span>apiVersion:<span style="color:#bbb"> </span>apps/v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>StatefulSet<span style="color:#bbb">
</span><span style="color:#bbb"></span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>name:<span style="color:#bbb"> </span>web<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>serviceName:<span style="color:#bbb"> </span><span style="color:#b44">&#34;nginx&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>replicas:<span style="color:#bbb"> </span><span style="color:#666">2</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>selector:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>matchLabels:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>app:<span style="color:#bbb"> </span>nginx<span style="color:#bbb">
</span><span style="color:#bbb">  </span>template:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>labels:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>app:<span style="color:#bbb"> </span>nginx<span style="color:#bbb">
</span><span style="color:#bbb">    </span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>containers:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>nginx<span style="color:#bbb">
</span><span style="color:#bbb">        </span>image:<span style="color:#bbb"> </span>k8s.gcr.io/nginx-slim:<span style="color:#666">0.8</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span>ports:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>-<span style="color:#bbb"> </span>containerPort:<span style="color:#bbb"> </span><span style="color:#666">80</span><span style="color:#bbb">
</span><span style="color:#bbb">          </span>name:<span style="color:#bbb"> </span>web<span style="color:#bbb">
</span><span style="color:#bbb">        </span>volumeMounts:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>www<span style="color:#bbb">
</span><span style="color:#bbb">          </span>mountPath:<span style="color:#bbb"> </span>/usr/share/nginx/html<span style="color:#bbb">
</span><span style="color:#bbb">  </span>volumeClaimTemplates:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>name:<span style="color:#bbb"> </span>www<span style="color:#bbb">
</span><span style="color:#bbb">    </span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>accessModes:<span style="color:#bbb"> </span>[<span style="color:#bbb"> </span><span style="color:#b44">&#34;ReadWriteOnce&#34;</span><span style="color:#bbb"> </span>]<span style="color:#bbb">
</span><span style="color:#bbb">      </span>resources:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>requests:<span style="color:#bbb">
</span><span style="color:#bbb">          </span>storage:<span style="color:#bbb"> </span>1Gi<span style="color:#bbb">
</span><span style="color:#bbb">
</span></code></pre></div>  </td>
        </tr>
    </tbody>
</table>

<p>위에 예제를 다운로드 받아서 파일이름을 <code>web.yaml</code>으로 저장하자.</p>

<p>2개의 터미널창을 사용한다. 첫째 터미널에서
<a href="/docs/reference/generated/kubectl/kubectl-commands/#get"><code>kubectl get</code></a>을 이용해서
스테이트풀셋의 파드가 생성되는지 감시하자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl get pods -w -l <span style="color:#b8860b">app</span><span style="color:#666">=</span>nginx</code></pre></div>
<p>두 번째 터미널에서
<a href="/docs/reference/generated/kubectl/kubectl-commands/#apply"><code>kubectl apply</code></a>로
<code>web.yaml</code>에 정의된 헤드리스 서비스와 스테이트풀셋을 생성한다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl apply -f web.yaml
service/nginx created
statefulset.apps/web created</code></pre></div>
<p>상기 명령어는 <a href="https://www.nginx.com" target="_blank">NGINX</a> 웹 서버를
실행하는 2개의 파드를 생성한다. <code>nginx</code> 서비스와
<code>web</code> 스테이트풀셋이 성공적으로 생성되었는지 알아보자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl get service nginx
NAME      TYPE         CLUSTER-IP   EXTERNAL-IP   PORT<span style="color:#666">(</span>S<span style="color:#666">)</span>   AGE
nginx     ClusterIP    None         &lt;none&gt;        <span style="color:#666">80</span>/TCP    12s

kubectl get statefulset web
NAME      DESIRED   CURRENT   AGE
web       <span style="color:#666">2</span>         <span style="color:#666">1</span>         20s</code></pre></div>
<h3 id="차례대로-파드-생성하기">차례대로 파드 생성하기</h3>

<p>N개의 레플리카를 가진 스테이트풀셋은 배포 시에
순차적으로 {0..N-1} 순으로 생성된다.
첫째 터미널에서 <code>kubectl get</code> 명령의 출력 내용을 살펴보자.
결국 그 내용은 아래 예와 비슷할 것이다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl get pods -w -l <span style="color:#b8860b">app</span><span style="color:#666">=</span>nginx
NAME      READY     STATUS    RESTARTS   AGE
web-0     <span style="color:#666">0</span>/1       Pending   <span style="color:#666">0</span>          0s
web-0     <span style="color:#666">0</span>/1       Pending   <span style="color:#666">0</span>         0s
web-0     <span style="color:#666">0</span>/1       ContainerCreating   <span style="color:#666">0</span>         0s
web-0     <span style="color:#666">1</span>/1       Running   <span style="color:#666">0</span>         19s
web-1     <span style="color:#666">0</span>/1       Pending   <span style="color:#666">0</span>         0s
web-1     <span style="color:#666">0</span>/1       Pending   <span style="color:#666">0</span>         0s
web-1     <span style="color:#666">0</span>/1       ContainerCreating   <span style="color:#666">0</span>         0s
web-1     <span style="color:#666">1</span>/1       Running   <span style="color:#666">0</span>         18s</code></pre></div>
<p><code>web-1</code> 파드는 <code>web-0</code> 파드가 <a href="/ko/docs/concepts/workloads/pods/pod-lifecycle/">Running과 Ready</a> 상태가 되기 전에
시작하지 않음을 주의하자.</p>

<h2 id="스테이트풀셋-안에-파드">스테이트풀셋 안에 파드</h2>

<p>스테이트풀셋 안에 파드는 고유한 순번과 동일한 네트워크 신원을 가진다.</p>

<h3 id="파드-순번-살펴보기">파드 순번 살펴보기</h3>

<p>스테이트풀셋의 파드를 가져오자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl get pods -l <span style="color:#b8860b">app</span><span style="color:#666">=</span>nginx
NAME      READY     STATUS    RESTARTS   AGE
web-0     <span style="color:#666">1</span>/1       Running   <span style="color:#666">0</span>          1m
web-1     <span style="color:#666">1</span>/1       Running   <span style="color:#666">0</span>          1m</code></pre></div>
<p><a href="/ko/docs/concepts/workloads/controllers/statefulset/">스테이트풀셋</a> 개념에서
언급했듯 스테이트풀셋의 파드는 끈끈하고 고유한 정체성을 가진다.
이 정체성은 스테이트풀 컨트롤러에서 각 파드에 주어지는
고유한 순번에 기인한다. 파드의 이름의 형식은
<code>&lt;스테이트풀셋 이름&gt;-&lt;순번&gt;</code> 이다.  앞서 <code>web</code> 스테이트풀셋은
2개의 레플리카를 가졌으므로 <code>web-0</code> 과 <code>web-1</code> 2개 파드를 생성한다.</p>

<h3 id="안정적인-네트워크-신원-사용하기">안정적인 네트워크 신원 사용하기</h3>

<p>각 파드는 각 순번에 따른 안정적인 호스트네임을 갖는다. 각 파드에서
<code>hostname</code> 명령어를 실행하도록
<a href="/docs/reference/generated/kubectl/kubectl-commands/#exec"><code>kubectl exec</code></a>를 이용하자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#a2f;font-weight:bold">for</span> i in <span style="color:#666">0</span> <span style="color:#666">1</span>; <span style="color:#a2f;font-weight:bold">do</span> kubectl <span style="color:#a2f">exec</span> web-<span style="color:#b8860b">$i</span> -- sh -c <span style="color:#b44">&#39;hostname&#39;</span>; <span style="color:#a2f;font-weight:bold">done</span>
web-0
web-1</code></pre></div>
<p><code>dnsutils</code> 패키지에서 <code>nslookup</code> 명령을 제공하는 컨테이너를
실행하도록 <a href="/docs/reference/generated/kubectl/kubectl-commands/#run"><code>kubectl run</code></a>을 이용하자.
파드의 호스트네임에 <code>nslookup</code>을 이용하면 클러스터 내부 DNS 주소를
확인할 수 있다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl run -i --tty --image busybox:1.28 dns-test --restart<span style="color:#666">=</span>Never --rm
nslookup web-0.nginx
Server:    <span style="color:#666">10</span>.0.0.10
Address <span style="color:#666">1</span>: <span style="color:#666">10</span>.0.0.10 kube-dns.kube-system.svc.cluster.local

Name:      web-0.nginx
Address <span style="color:#666">1</span>: <span style="color:#666">10</span>.244.1.6

nslookup web-1.nginx
Server:    <span style="color:#666">10</span>.0.0.10
Address <span style="color:#666">1</span>: <span style="color:#666">10</span>.0.0.10 kube-dns.kube-system.svc.cluster.local

Name:      web-1.nginx
Address <span style="color:#666">1</span>: <span style="color:#666">10</span>.244.2.6</code></pre></div>
<p>헤드리스 서비스의 CNAME은 SRV 레코드를 지칭한다
(Running과 Ready 상태의 각 파드마다 1개).
SRV 레코드는 파드의 IP 주소를 포함한 A 레코드 엔트리를 지칭한다.</p>

<p>첫째 터미널에서 스테이트풀셋의 파드를 가져오자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl get pod -w -l <span style="color:#b8860b">app</span><span style="color:#666">=</span>nginx</code></pre></div>
<p>두 번째 터미널에서 스테이트풀셋 내에 파드를 모두 삭제하기 위해
<a href="/docs/reference/generated/kubectl/kubectl-commands/#delete"><code>kubectl delete</code></a>를
이용하자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl delete pod -l <span style="color:#b8860b">app</span><span style="color:#666">=</span>nginx
pod <span style="color:#b44">&#34;web-0&#34;</span> deleted
pod <span style="color:#b44">&#34;web-1&#34;</span> deleted</code></pre></div>
<p>스테이트풀셋이 재시작되고 두 파드가 Running과 Ready 상태로
전환되도록 기다리자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl get pod -w -l <span style="color:#b8860b">app</span><span style="color:#666">=</span>nginx
NAME      READY     STATUS              RESTARTS   AGE
web-0     <span style="color:#666">0</span>/1       ContainerCreating   <span style="color:#666">0</span>          0s
NAME      READY     STATUS    RESTARTS   AGE
web-0     <span style="color:#666">1</span>/1       Running   <span style="color:#666">0</span>          2s
web-1     <span style="color:#666">0</span>/1       Pending   <span style="color:#666">0</span>         0s
web-1     <span style="color:#666">0</span>/1       Pending   <span style="color:#666">0</span>         0s
web-1     <span style="color:#666">0</span>/1       ContainerCreating   <span style="color:#666">0</span>         0s
web-1     <span style="color:#666">1</span>/1       Running   <span style="color:#666">0</span>         34s</code></pre></div>
<p>파드의 호스트네임과 클러스터 내부 DNS 엔트리를 보기 위해
<code>kubectl exec</code>과 <code>kubectl run</code>을 이용하자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#a2f;font-weight:bold">for</span> i in <span style="color:#666">0</span> <span style="color:#666">1</span>; <span style="color:#a2f;font-weight:bold">do</span> kubectl <span style="color:#a2f">exec</span> web-<span style="color:#b8860b">$i</span> -- sh -c <span style="color:#b44">&#39;hostname&#39;</span>; <span style="color:#a2f;font-weight:bold">done</span>
web-0
web-1

kubectl run -i --tty --image busybox:1.28 dns-test --restart<span style="color:#666">=</span>Never --rm /bin/sh
nslookup web-0.nginx
Server:    <span style="color:#666">10</span>.0.0.10
Address <span style="color:#666">1</span>: <span style="color:#666">10</span>.0.0.10 kube-dns.kube-system.svc.cluster.local

Name:      web-0.nginx
Address <span style="color:#666">1</span>: <span style="color:#666">10</span>.244.1.7

nslookup web-1.nginx
Server:    <span style="color:#666">10</span>.0.0.10
Address <span style="color:#666">1</span>: <span style="color:#666">10</span>.0.0.10 kube-dns.kube-system.svc.cluster.local

Name:      web-1.nginx
Address <span style="color:#666">1</span>: <span style="color:#666">10</span>.244.2.8</code></pre></div>
<p>파드의 순번, 호스트네임, SRV 레코드와 A 레코드이름은 변경되지 않지만
파드의 IP 주소는 변경될 수 있다. 이는 튜토리얼에서 사용하는 클러스터나
다른 클러스터에도 동일하다. 따라서 다른 애플리케이션이 IP 주소로
스테이트풀셋의 파드에 접속하지 않도록 하는 것이 중요하다.</p>

<p>스테이트풀셋의 활성 멤버를 찾아 연결할 경우
헤드리스 서비스(<code>nginx.default.svc.cluster.local</code>)의 CNAME을 쿼리해야 한다.
CNAME과 연관된 SRV 레코드는 스테이트풀셋의
Running과 Ready 상태의 모든 파드들을
담고 있다.</p>

<p>애플리케이션에서 이미 활성상태(liveness)와 준비성(readiness) 테스트하는
연결 로직을 구현되어 있다면
파드<code>web-0.nginx.default.svc.cluster.local</code>,
<code>web-1.nginx.default.svc.cluster.local</code>)의  SRV레코드를 안정적으로 사용할 수 있어
애플리케이션은 파드가 Running과 Ready 상태로 전환할 때
파드의 주소를 검색할 수 있다.</p>

<h3 id="writing-to-stable-storage">안정적인 스토리지에 쓰기</h3>

<p><code>web-0</code>과 <code>web-1</code>에 대해 퍼시스턴트볼륨클레임(PersistentVolumeClaim)을 가져오자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl get pvc -l <span style="color:#b8860b">app</span><span style="color:#666">=</span>nginx
NAME        STATUS    VOLUME                                     CAPACITY   ACCESSMODES   AGE
www-web-0   Bound     pvc-15c268c7-b507-11e6-932f-42010a800002   1Gi        RWO           48s
www-web-1   Bound     pvc-15c79307-b507-11e6-932f-42010a800002   1Gi        RWO           48s</code></pre></div>
<p>스테이트풀셋 컨트롤러는 2개의 <a href="/docs/concepts/storage/persistent-volumes/">퍼시스턴트볼륨</a>에
묶인 2개의 퍼시스턴트볼륨클레임을 생성했다. 본 튜토리얼에서 사용되는 클러스터는 퍼시스턴트볼륨을 동적으로
프로비저닝하도록 설정되었으므로 생성된 퍼시스턴트볼륨도 자동으로 묶인다.</p>

<p>NGINX 웹서버는 기본 색인 파일로
<code>/usr/share/nginx/html/index.html</code>을 이용합니다.
스테이트풀셋 <code>spec</code>내의 <code>volumeMounts</code> 필드는 <code>/usr/share/nginx/html</code> 디렉터리가
퍼시스턴트볼륨으로 제공되는지 보증합니다.</p>

<p>파드의 호스트네임을 <code>index.html</code> 파일에 작성하고
NGINX 웹서버가 해당 호스트네임을 제공하는지 확인해보자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#a2f;font-weight:bold">for</span> i in <span style="color:#666">0</span> <span style="color:#666">1</span>; <span style="color:#a2f;font-weight:bold">do</span> kubectl <span style="color:#a2f">exec</span> web-<span style="color:#b8860b">$i</span> -- sh -c <span style="color:#b44">&#39;echo $(hostname) &gt; /usr/share/nginx/html/index.html&#39;</span>; <span style="color:#a2f;font-weight:bold">done</span>

<span style="color:#a2f;font-weight:bold">for</span> i in <span style="color:#666">0</span> <span style="color:#666">1</span>; <span style="color:#a2f;font-weight:bold">do</span> kubectl <span style="color:#a2f">exec</span> -it web-<span style="color:#b8860b">$i</span> -- curl localhost; <span style="color:#a2f;font-weight:bold">done</span>
web-0
web-1</code></pre></div>
<blockquote class="note">
  <div><strong>참고:</strong> <p>위에 curl 명령어로 403 Forbidden 아닌 응답을 보려면
<code>volumeMounts</code>로 마운트된 디렉터리의 퍼미션을 수정해야 한다
(<a href="https://github.com/kubernetes/kubernetes/issues/2630" target="_blank">hostPath 볼륨을 사용할 때에 버그</a>로 인함).</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#a2f;font-weight:bold">for</span> i in <span style="color:#666">0</span> <span style="color:#666">1</span>; <span style="color:#a2f;font-weight:bold">do</span> kubectl <span style="color:#a2f">exec</span> web-<span style="color:#b8860b">$i</span> -- chmod <span style="color:#666">755</span> /usr/share/nginx/html; <span style="color:#a2f;font-weight:bold">done</span></code></pre></div>
<p>위에 curl 명령을 재시도하기 전에</p>
</div>
</blockquote>

<p>첫째 터미널에서 스테이트풀셋의 파드를 감시하자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl get pod -w -l <span style="color:#b8860b">app</span><span style="color:#666">=</span>nginx</code></pre></div>
<p>두 번째 터미널에서 스테이트풀셋의 모든 파드를 삭제하자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl delete pod -l <span style="color:#b8860b">app</span><span style="color:#666">=</span>nginx
pod <span style="color:#b44">&#34;web-0&#34;</span> deleted
pod <span style="color:#b44">&#34;web-1&#34;</span> deleted</code></pre></div>
<p>첫 번째 터미널에서 실행 중인 <code>kubectl get</code>명령어의 출력을 확인하고,
모든 파드가 Running과 Ready 상태로 전환될 때까지 기다리자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl get pod -w -l <span style="color:#b8860b">app</span><span style="color:#666">=</span>nginx
NAME      READY     STATUS              RESTARTS   AGE
web-0     <span style="color:#666">0</span>/1       ContainerCreating   <span style="color:#666">0</span>          0s
NAME      READY     STATUS    RESTARTS   AGE
web-0     <span style="color:#666">1</span>/1       Running   <span style="color:#666">0</span>          2s
web-1     <span style="color:#666">0</span>/1       Pending   <span style="color:#666">0</span>         0s
web-1     <span style="color:#666">0</span>/1       Pending   <span style="color:#666">0</span>         0s
web-1     <span style="color:#666">0</span>/1       ContainerCreating   <span style="color:#666">0</span>         0s
web-1     <span style="color:#666">1</span>/1       Running   <span style="color:#666">0</span>         34s</code></pre></div>
<p>웹서버에서 자신의 호스트네임을 계속 제공하는지 확인하자.</p>

<pre><code>for i in 0 1; do kubectl exec -it web-$i -- curl localhost; done
web-0
web-1
</code></pre>

<p>비록 <code>web-0</code>과 <code>web-1</code>이 재스케줄링되어도 계속해서
자신의 호스트네임을 제공하는데 이는 각 퍼시스턴트볼륨클레임에
연관된 퍼시스턴트볼륨이 해당 <code>volumeMounts</code>로 재마운트되기 때문이다.
<code>web-0</code>과 <code>web-1</code>의 스케줄링에 관계없이
각각의 퍼시스턴트볼륨은 적절하게 마운트된다.</p>

<h2 id="스테이트풀셋-스케일링">스테이트풀셋 스케일링</h2>

<p>스테이트풀셋을 스케일링하는 것은 레플리카 개수를 늘리거나 줄이는 것을 의미한다. 이것은 <code>replicas</code> 필드를 갱신하여 이뤄진다.
<a href="/docs/reference/generated/kubectl/kubectl-commands/#scale"><code>kubectl scale</code></a>이나
<a href="/docs/reference/generated/kubectl/kubectl-commands/#patch"><code>kubectl patch</code></a>을
이용해서 스테이트풀셋을 스케일링할 수 있다.</p>

<h3 id="스케일-업">스케일 업</h3>

<p>터미널창에서 스테이트풀셋의 파드를 감시하자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl get pods -w -l <span style="color:#b8860b">app</span><span style="color:#666">=</span>nginx</code></pre></div>
<p>다른 터미널창에서 <code>kubectl scale</code>을 이용하여 레플리카 개수를
5로 스케일링하자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl scale sts web --replicas<span style="color:#666">=</span><span style="color:#666">5</span>
statefulset.apps/web scaled</code></pre></div>
<p>첫 번째 터미널에서 실행 중인 <code>kubectl get</code>명령어의 출력을 확인하고,
3개의 추가 파드가 Running과 Ready 상태로 전환될 때까지 기다리자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl get pods -w -l <span style="color:#b8860b">app</span><span style="color:#666">=</span>nginx
NAME      READY     STATUS    RESTARTS   AGE
web-0     <span style="color:#666">1</span>/1       Running   <span style="color:#666">0</span>          2h
web-1     <span style="color:#666">1</span>/1       Running   <span style="color:#666">0</span>          2h
NAME      READY     STATUS    RESTARTS   AGE
web-2     <span style="color:#666">0</span>/1       Pending   <span style="color:#666">0</span>          0s
web-2     <span style="color:#666">0</span>/1       Pending   <span style="color:#666">0</span>         0s
web-2     <span style="color:#666">0</span>/1       ContainerCreating   <span style="color:#666">0</span>         0s
web-2     <span style="color:#666">1</span>/1       Running   <span style="color:#666">0</span>         19s
web-3     <span style="color:#666">0</span>/1       Pending   <span style="color:#666">0</span>         0s
web-3     <span style="color:#666">0</span>/1       Pending   <span style="color:#666">0</span>         0s
web-3     <span style="color:#666">0</span>/1       ContainerCreating   <span style="color:#666">0</span>         0s
web-3     <span style="color:#666">1</span>/1       Running   <span style="color:#666">0</span>         18s
web-4     <span style="color:#666">0</span>/1       Pending   <span style="color:#666">0</span>         0s
web-4     <span style="color:#666">0</span>/1       Pending   <span style="color:#666">0</span>         0s
web-4     <span style="color:#666">0</span>/1       ContainerCreating   <span style="color:#666">0</span>         0s
web-4     <span style="color:#666">1</span>/1       Running   <span style="color:#666">0</span>         19s</code></pre></div>
<p>스테이트풀셋 컨트롤러는 레플리카개수를 스케일링한다.
<a href="#차례대로-파드-생성하기">스테이트풀셋 생성</a>으로 스테이트풀셋 컨트롤러는
각 파드을 순차적으로 각 순번에 따라 생성하고 후속 파드 시작 전에
이전 파드가 Running과 Ready 상태가 될 때까지
기다린다.</p>

<h3 id="scaling-down">스케일 다운</h3>

<p>터미널에서 스테이트풀셋의 파드를 감시하자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl get pods -w -l <span style="color:#b8860b">app</span><span style="color:#666">=</span>nginx</code></pre></div>
<p>다른 터미널에서 <code>kubectl patch</code>으로 스테이트풀셋을 뒤로
 3개의 레플리카로 스케일링하자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl patch sts web -p <span style="color:#b44">&#39;{&#34;spec&#34;:{&#34;replicas&#34;:3}}&#39;</span>
statefulset.apps/web patched</code></pre></div>
<p><code>web-4</code>와 <code>web-3</code>이 Terminating으로 전환되기까지 기다리자.</p>

<pre><code>kubectl get pods -w -l app=nginx
NAME      READY     STATUS              RESTARTS   AGE
web-0     1/1       Running             0          3h
web-1     1/1       Running             0          3h
web-2     1/1       Running             0          55s
web-3     1/1       Running             0          36s
web-4     0/1       ContainerCreating   0          18s
NAME      READY     STATUS    RESTARTS   AGE
web-4     1/1       Running   0          19s
web-4     1/1       Terminating   0         24s
web-4     1/1       Terminating   0         24s
web-3     1/1       Terminating   0         42s
web-3     1/1       Terminating   0         42s
</code></pre>

<h3 id="순차-파드-종료">순차 파드 종료</h3>

<p>컨트롤러는 순번의 역순으로 한 번에 1개 파드를 삭제하고
다음 파드를 삭제하기 전에
각각이 완전하게 종료되기까지 기다린다.</p>

<p>스테이트풀셋의 퍼시스턴트볼륨클레임을 가져오자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl get pvc -l <span style="color:#b8860b">app</span><span style="color:#666">=</span>nginx
NAME        STATUS    VOLUME                                     CAPACITY   ACCESSMODES   AGE
www-web-0   Bound     pvc-15c268c7-b507-11e6-932f-42010a800002   1Gi        RWO           13h
www-web-1   Bound     pvc-15c79307-b507-11e6-932f-42010a800002   1Gi        RWO           13h
www-web-2   Bound     pvc-e1125b27-b508-11e6-932f-42010a800002   1Gi        RWO           13h
www-web-3   Bound     pvc-e1176df6-b508-11e6-932f-42010a800002   1Gi        RWO           13h
www-web-4   Bound     pvc-e11bb5f8-b508-11e6-932f-42010a800002   1Gi        RWO           13h</code></pre></div>
<p>여전히 5개의 퍼시스턴트볼륨클레임과 5개의 퍼시스턴트볼륨이 있다.
파드의 <a href="#writing-to-stable-storage">안전한 스토리지</a>를 탐색하면서 스테이트풀셋의 파드가 삭제될 때에 파드에 마운트된 스테이트풀셋의 퍼시스턴트볼륨이 삭제되지 않은 것을 보았다. 스테이트풀셋 스케일 다운으로 파드 삭제할 때에도 여전히 사실이다.</p>

<h2 id="스테이트풀셋-업데이트하기">스테이트풀셋 업데이트하기</h2>

<p>쿠버네티스 1.7 이상에서 스테이트풀셋 컨트롤러는 자동 업데이트를 지원한다.
전략은 스테이트풀셋 API 오브젝트의 <code>spec.updateStrategy</code> 필드로 결정된다.
이 기능은 컨테이너 이미지, 스테이트풀셋의 리소스 요청이나
혹은 한계와 레이블과 파드의 어노테이션을 업그레이드하기 위해 사용될 수 있다.
<code>RollingUpdate</code>과 <code>OnDelete</code>의 2개의
유효한 업데이트 전략이 있다.</p>

<p><code>RollingUpdate</code> 업데이트 전략은 스테이트풀셋에서 기본 값이다.</p>

<h3 id="롤링-업데이트">롤링 업데이트</h3>

<p><code>RollingUpdate</code> 업데이트 전략은 스테이트풀셋을 보장하면서 스테이트풀셋 내에 파드를 역순으로 업데이트합니다.</p>

<p>스테이트풀셋 <code>web</code>의 업데이트 전략을 <code>RollingUpdate</code>으로 패치하자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl patch statefulset web -p <span style="color:#b44">&#39;{&#34;spec&#34;:{&#34;updateStrategy&#34;:{&#34;type&#34;:&#34;RollingUpdate&#34;}}}&#39;</span>
statefulset.apps/web patched</code></pre></div>
<p>터미널 창에서 스테이트풀셋 <code>web</code>의 컨테이너 이미지를 바꾸도록
또 패치하자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl patch statefulset web --type<span style="color:#666">=</span><span style="color:#b44">&#39;json&#39;</span> -p<span style="color:#666">=</span><span style="color:#b44">&#39;[{&#34;op&#34;: &#34;replace&#34;, &#34;path&#34;: &#34;/spec/template/spec/containers/0/image&#34;, &#34;value&#34;:&#34;gcr.io/google_containers/nginx-slim:0.8&#34;}]&#39;</span>
statefulset.apps/web patched</code></pre></div>
<p>다른 터미널창에서 스테이트풀셋의 파드를 감시하자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl get po -l <span style="color:#b8860b">app</span><span style="color:#666">=</span>nginx -w
NAME      READY     STATUS    RESTARTS   AGE
web-0     <span style="color:#666">1</span>/1       Running   <span style="color:#666">0</span>          7m
web-1     <span style="color:#666">1</span>/1       Running   <span style="color:#666">0</span>          7m
web-2     <span style="color:#666">1</span>/1       Running   <span style="color:#666">0</span>          8m
web-2     <span style="color:#666">1</span>/1       Terminating   <span style="color:#666">0</span>         8m
web-2     <span style="color:#666">1</span>/1       Terminating   <span style="color:#666">0</span>         8m
web-2     <span style="color:#666">0</span>/1       Terminating   <span style="color:#666">0</span>         8m
web-2     <span style="color:#666">0</span>/1       Terminating   <span style="color:#666">0</span>         8m
web-2     <span style="color:#666">0</span>/1       Terminating   <span style="color:#666">0</span>         8m
web-2     <span style="color:#666">0</span>/1       Terminating   <span style="color:#666">0</span>         8m
web-2     <span style="color:#666">0</span>/1       Pending   <span style="color:#666">0</span>         0s
web-2     <span style="color:#666">0</span>/1       Pending   <span style="color:#666">0</span>         0s
web-2     <span style="color:#666">0</span>/1       ContainerCreating   <span style="color:#666">0</span>         0s
web-2     <span style="color:#666">1</span>/1       Running   <span style="color:#666">0</span>         19s
web-1     <span style="color:#666">1</span>/1       Terminating   <span style="color:#666">0</span>         8m
web-1     <span style="color:#666">0</span>/1       Terminating   <span style="color:#666">0</span>         8m
web-1     <span style="color:#666">0</span>/1       Terminating   <span style="color:#666">0</span>         8m
web-1     <span style="color:#666">0</span>/1       Terminating   <span style="color:#666">0</span>         8m
web-1     <span style="color:#666">0</span>/1       Pending   <span style="color:#666">0</span>         0s
web-1     <span style="color:#666">0</span>/1       Pending   <span style="color:#666">0</span>         0s
web-1     <span style="color:#666">0</span>/1       ContainerCreating   <span style="color:#666">0</span>         0s
web-1     <span style="color:#666">1</span>/1       Running   <span style="color:#666">0</span>         6s
web-0     <span style="color:#666">1</span>/1       Terminating   <span style="color:#666">0</span>         7m
web-0     <span style="color:#666">1</span>/1       Terminating   <span style="color:#666">0</span>         7m
web-0     <span style="color:#666">0</span>/1       Terminating   <span style="color:#666">0</span>         7m
web-0     <span style="color:#666">0</span>/1       Terminating   <span style="color:#666">0</span>         7m
web-0     <span style="color:#666">0</span>/1       Terminating   <span style="color:#666">0</span>         7m
web-0     <span style="color:#666">0</span>/1       Terminating   <span style="color:#666">0</span>         7m
web-0     <span style="color:#666">0</span>/1       Pending   <span style="color:#666">0</span>         0s
web-0     <span style="color:#666">0</span>/1       Pending   <span style="color:#666">0</span>         0s
web-0     <span style="color:#666">0</span>/1       ContainerCreating   <span style="color:#666">0</span>         0s
web-0     <span style="color:#666">1</span>/1       Running   <span style="color:#666">0</span>         10s</code></pre></div>
<p>스테이트풀셋 내에 파드는 순번의 역순으로 업데이트된다.
이 스테이트풀셋 컨트롤러는 각 파드를 종료시키고 다음 파드를 업데이트하기 전에
그것이 Running과 Ready 상태로 전환될 때까지 기다린다.
알아둘 것은 비록 스테이트풀셋 컨트롤러에서 이전 파드가 Running과 Ready 상태가 되기까지
다음 파드를 업데이트하지 않아도 현재 버전으로 파드를 업데이트하다 실패하면 복원한다는 것이다.
업데이트를 이미 받은 파드는 업데이트된 버전으로 복원되고 아직 업데이트를 받지 못한 파드는
이전 버전으로 복원한다.
이런 식으로 컨트롤러는 간헐적인 오류가 발생해도
애플리케이션을 계속 건강하게 유지하고
업데이트도 일관되게 유지하려 한다.</p>

<p>컨테이너 이미지를 살펴보기 위해 파드를 가져오자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#a2f;font-weight:bold">for</span> p in <span style="color:#666">0</span> <span style="color:#666">1</span> <span style="color:#666">2</span>; <span style="color:#a2f;font-weight:bold">do</span> kubectl get po web-<span style="color:#b8860b">$p</span> --template <span style="color:#b44">&#39;{{range $i, $c := .spec.containers}}{{$c.image}}{{end}}&#39;</span>; echo; <span style="color:#a2f;font-weight:bold">done</span>
k8s.gcr.io/nginx-slim:0.8
k8s.gcr.io/nginx-slim:0.8
k8s.gcr.io/nginx-slim:0.8</code></pre></div>
<p>스테이트풀셋의 모든 파드가 지금은 이전 컨테이너 이미지를 실행 중이이다.</p>

<p><strong>팁</strong> 롤링 업데이트 상황을 살펴보기 위해 <code>kubectl rollout status sts/&lt;name&gt;</code>
명령어도 사용할 수 있다.</p>

<h4 id="staging-an-update">단계적으로 업데이트 하기</h4>

<p><code>RollingUpdate</code> 업데이트 전략의 파라미터인 <code>partition</code>를 이용하여
스테이트풀셋의 단계적으로 업데이트할 수 있다.
단계적 업데이트는 스테이트풀셋의 모든 파드를 현재 버전으로 유지하면서
스테이트풀셋의 <code>.spec.template</code>에 변경을 허용한다.</p>

<p>스테이트풀셋 <code>web</code>의 <code>updateStrategy</code> 필드에 partition을 추가하자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl patch statefulset web -p <span style="color:#b44">&#39;{&#34;spec&#34;:{&#34;updateStrategy&#34;:{&#34;type&#34;:&#34;RollingUpdate&#34;,&#34;rollingUpdate&#34;:{&#34;partition&#34;:3}}}}&#39;</span>
statefulset.apps/web patched</code></pre></div>
<p>컨테이너의 이미지를 바꾸도록 스테이트풀셋을 또 패치하자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl patch statefulset web --type<span style="color:#666">=</span><span style="color:#b44">&#39;json&#39;</span> -p<span style="color:#666">=</span><span style="color:#b44">&#39;[{&#34;op&#34;: &#34;replace&#34;, &#34;path&#34;: &#34;/spec/template/spec/containers/0/image&#34;, &#34;value&#34;:&#34;k8s.gcr.io/nginx-slim:0.7&#34;}]&#39;</span>
statefulset.apps/web patched</code></pre></div>
<p>스테이트풀셋의 파드를 삭제하자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl delete po web-2
pod <span style="color:#b44">&#34;web-2&#34;</span> deleted</code></pre></div>
<p>파드가 Running과 Ready 상태가 되기까지 기다리자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl get po -l <span style="color:#b8860b">app</span><span style="color:#666">=</span>nginx -w
NAME      READY     STATUS              RESTARTS   AGE
web-0     <span style="color:#666">1</span>/1       Running             <span style="color:#666">0</span>          4m
web-1     <span style="color:#666">1</span>/1       Running             <span style="color:#666">0</span>          4m
web-2     <span style="color:#666">0</span>/1       ContainerCreating   <span style="color:#666">0</span>          11s
web-2     <span style="color:#666">1</span>/1       Running   <span style="color:#666">0</span>         18s</code></pre></div>
<p>파드의 컨테이너를 가져오자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl get po web-2 --template <span style="color:#b44">&#39;{{range $i, $c := .spec.containers}}{{$c.image}}{{end}}&#39;</span>
k8s.gcr.io/nginx-slim:0.8</code></pre></div>
<p>비록 업데이트 전략이 <code>RollingUpdate</code>이지만 스테이트풀셋은
파드를 그것의 원래 컨테이너로 복원한다.
파드의 순번이 <code>updateStrategy</code>에서 지정된
<code>파티션</code>보다 작기 때문이다.</p>

<h4 id="카나리-canary-롤링-아웃">카나리(Canary) 롤링 아웃</h4>

<p><a href="#staging-an-update">위에서</a> 지정한 <code>partition</code>값을 차감시키면
변경사항을 테스트하기 위해 카나리 롤아웃을 할 수 있다.</p>

<p>스테이트풀셋에 partition을 차감하도록 패치하자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl patch statefulset web -p <span style="color:#b44">&#39;{&#34;spec&#34;:{&#34;updateStrategy&#34;:{&#34;type&#34;:&#34;RollingUpdate&#34;,&#34;rollingUpdate&#34;:{&#34;partition&#34;:2}}}}&#39;</span>
statefulset.apps/web patched</code></pre></div>
<p><code>web-2</code> 파드가 Running과 Ready 상태가 되기까지 기다리자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl get po -l <span style="color:#b8860b">app</span><span style="color:#666">=</span>nginx -w
NAME      READY     STATUS              RESTARTS   AGE
web-0     <span style="color:#666">1</span>/1       Running             <span style="color:#666">0</span>          4m
web-1     <span style="color:#666">1</span>/1       Running             <span style="color:#666">0</span>          4m
web-2     <span style="color:#666">0</span>/1       ContainerCreating   <span style="color:#666">0</span>          11s
web-2     <span style="color:#666">1</span>/1       Running   <span style="color:#666">0</span>         18s</code></pre></div>
<p>파드의 컨테이너를 가져오자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl get po web-2 --template <span style="color:#b44">&#39;{{range $i, $c := .spec.containers}}{{$c.image}}{{end}}&#39;</span>
k8s.gcr.io/nginx-slim:0.7</code></pre></div>
<p><code>partition</code>을 바꾸면 스테이트풀셋 컨트롤러는 자동으로
<code>web-2</code> 파드를 업데이트하는데
이는 해당 파드의 순번이 <code>partition</code> 이상이기 때문이다.</p>

<p><code>web-1</code> 파드를 삭제하자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl delete po web-1
pod <span style="color:#b44">&#34;web-1&#34;</span> deleted</code></pre></div>
<p><code>web-1</code> 파드가 Running과 Ready 상태가 되기까지 기다리자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl get po -l <span style="color:#b8860b">app</span><span style="color:#666">=</span>nginx -w
NAME      READY     STATUS        RESTARTS   AGE
web-0     <span style="color:#666">1</span>/1       Running       <span style="color:#666">0</span>          6m
web-1     <span style="color:#666">0</span>/1       Terminating   <span style="color:#666">0</span>          6m
web-2     <span style="color:#666">1</span>/1       Running       <span style="color:#666">0</span>          2m
web-1     <span style="color:#666">0</span>/1       Terminating   <span style="color:#666">0</span>         6m
web-1     <span style="color:#666">0</span>/1       Terminating   <span style="color:#666">0</span>         6m
web-1     <span style="color:#666">0</span>/1       Terminating   <span style="color:#666">0</span>         6m
web-1     <span style="color:#666">0</span>/1       Pending   <span style="color:#666">0</span>         0s
web-1     <span style="color:#666">0</span>/1       Pending   <span style="color:#666">0</span>         0s
web-1     <span style="color:#666">0</span>/1       ContainerCreating   <span style="color:#666">0</span>         0s
web-1     <span style="color:#666">1</span>/1       Running   <span style="color:#666">0</span>         18s</code></pre></div>
<p><code>web-1</code> 파드의 컨테이너를 가져오자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl get po web-1 --template <span style="color:#b44">&#39;{{range $i, $c := .spec.containers}}{{$c.image}}{{end}}&#39;</span>
k8s.gcr.io/nginx-slim:0.8</code></pre></div>
<p><code>web-1</code> 는 원래 환경설정으로 복원되었는데
이는 파드의 순번이 partition보다 작기 때문이다.
스테이트풀셋의 <code>.spec.template</code>이 갱신되면, 지정된 partition 이상의 순번을
가진 모든 파드는 업데이트된다. 미만의 순번을 가진 파드라면 삭제되거나
종료되어 원래 환경설정으로 복원된다.</p>

<h4 id="단계적-롤아웃">단계적 롤아웃</h4>

<p><a href="#카나리-canary-롤링-아웃">카나리 롤아웃</a>에서 했던 방법과 비슷하게
분할된 롤링 업데이트를 이용하여 단계적 롤아웃(e.g. 선형, 기하 또는 지수적 롤아웃)을
수행할 수 있다. 단계적 롤아웃을 수행하려면
컨트롤러가 업데이트를 일시 중지할 순번으로
<code>partition</code>를 정하자.</p>

<p>partition은 현재 <code>2</code>이다. partition을 <code>0</code>으로 바꾸자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl patch statefulset web -p <span style="color:#b44">&#39;{&#34;spec&#34;:{&#34;updateStrategy&#34;:{&#34;type&#34;:&#34;RollingUpdate&#34;,&#34;rollingUpdate&#34;:{&#34;partition&#34;:0}}}}&#39;</span>
statefulset.apps/web patched</code></pre></div>
<p>스테이트풀셋의 모든 파드가 Running과 Ready 상태가 되기까지 기다리자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl get po -l <span style="color:#b8860b">app</span><span style="color:#666">=</span>nginx -w
NAME      READY     STATUS              RESTARTS   AGE
web-0     <span style="color:#666">1</span>/1       Running             <span style="color:#666">0</span>          3m
web-1     <span style="color:#666">0</span>/1       ContainerCreating   <span style="color:#666">0</span>          11s
web-2     <span style="color:#666">1</span>/1       Running             <span style="color:#666">0</span>          2m
web-1     <span style="color:#666">1</span>/1       Running   <span style="color:#666">0</span>         18s
web-0     <span style="color:#666">1</span>/1       Terminating   <span style="color:#666">0</span>         3m
web-0     <span style="color:#666">1</span>/1       Terminating   <span style="color:#666">0</span>         3m
web-0     <span style="color:#666">0</span>/1       Terminating   <span style="color:#666">0</span>         3m
web-0     <span style="color:#666">0</span>/1       Terminating   <span style="color:#666">0</span>         3m
web-0     <span style="color:#666">0</span>/1       Terminating   <span style="color:#666">0</span>         3m
web-0     <span style="color:#666">0</span>/1       Terminating   <span style="color:#666">0</span>         3m
web-0     <span style="color:#666">0</span>/1       Pending   <span style="color:#666">0</span>         0s
web-0     <span style="color:#666">0</span>/1       Pending   <span style="color:#666">0</span>         0s
web-0     <span style="color:#666">0</span>/1       ContainerCreating   <span style="color:#666">0</span>         0s
web-0     <span style="color:#666">1</span>/1       Running   <span style="color:#666">0</span>         3s</code></pre></div>
<p>파드의 컨테이너를 가져오자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#a2f;font-weight:bold">for</span> p in <span style="color:#666">0</span> <span style="color:#666">1</span> <span style="color:#666">2</span>; <span style="color:#a2f;font-weight:bold">do</span> kubectl get po web-<span style="color:#b8860b">$p</span> --template <span style="color:#b44">&#39;{{range $i, $c := .spec.containers}}{{$c.image}}{{end}}&#39;</span>; echo; <span style="color:#a2f;font-weight:bold">done</span>
k8s.gcr.io/nginx-slim:0.7
k8s.gcr.io/nginx-slim:0.7
k8s.gcr.io/nginx-slim:0.7</code></pre></div>
<p><code>partition</code>을 <code>0</code>으로 이동하여 스테이트풀셋 컨트롤러에서 계속해서
업데이트 처리를 하도록 허용하였다.</p>

<h3 id="삭제-시-동작">삭제 시 동작</h3>

<p><code>OnDelete</code> 업데이트 전략은 예전 동작(1.6 이하)으로,
이 업데이트 전략을 선택하면 스테이트풀셋 컨트롤러는 스테이트풀셋의
<code>.spec.template</code> 필드에 수정 사항이 발생해도 자동으로 파드를 업데이트하지 않는다.
이 전략은 <code>.spec.template.updateStrategy.type</code>을 <code>OnDelete</code>로 설정하여 선택할 수 있다.</p>

<h2 id="스테이트풀셋-삭제하기">스테이트풀셋 삭제하기</h2>

<p>스테이트풀셋은 비종속적(non-cascading), 종속적(cascading) 삭제를 둘 다 지원한다.
비종속적 삭제에서는 스테이트풀셋이 지워질 때에 스테이트풀셋의 파드는 지워지지 않는다.
종속적 삭제에서는 스테이트풀셋과 그에 속한 파드가 모두 지워진다.</p>

<h3 id="비종속적-삭제">비종속적 삭제</h3>

<p>터미널창에서 스테이트풀셋의 파드를 감시하자.</p>

<pre><code>kubectl get pods -w -l app=nginx
</code></pre>

<p>다른 터미널에서는 스테이트풀셋을 지우기 위해
<a href="/docs/reference/generated/kubectl/kubectl-commands/#delete"><code>kubectl delete</code></a> 명령어를 이용하자.
이 명령어에 <code>--cascade=false</code> 파라미터가 추가되었다.
이 파라미터는 쿠버네티스에 스테이트풀셋만 삭제하고 그에 속한 파드는 지우지 않도록 요청한다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl delete statefulset web --cascade<span style="color:#666">=</span><span style="color:#a2f">false</span>
statefulset.apps <span style="color:#b44">&#34;web&#34;</span> deleted</code></pre></div>
<p>상태를 확인하기 위해 파드를 가져오자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl get pods -l <span style="color:#b8860b">app</span><span style="color:#666">=</span>nginx
NAME      READY     STATUS    RESTARTS   AGE
web-0     <span style="color:#666">1</span>/1       Running   <span style="color:#666">0</span>          6m
web-1     <span style="color:#666">1</span>/1       Running   <span style="color:#666">0</span>          7m
web-2     <span style="color:#666">1</span>/1       Running   <span style="color:#666">0</span>          5m</code></pre></div>
<p>비록 <code>web</code>이 삭제되고 있어도, 모든 파드는 여전히 Running과 Ready 상태이다.
<code>web-0</code>을 삭제하자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl delete pod web-0
pod <span style="color:#b44">&#34;web-0&#34;</span> deleted</code></pre></div>
<p>스테이트풀셋의 파드를 가져오자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl get pods -l <span style="color:#b8860b">app</span><span style="color:#666">=</span>nginx
NAME      READY     STATUS    RESTARTS   AGE
web-1     <span style="color:#666">1</span>/1       Running   <span style="color:#666">0</span>          10m
web-2     <span style="color:#666">1</span>/1       Running   <span style="color:#666">0</span>          7m</code></pre></div>
<p>스테이트풀셋 <code>web</code>이 삭제되는 동안 <code>web-0</code>은 재시작하지 않았다.</p>

<p>첫째 터미널에서 스테이트풀셋의 파드를 감시하자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl get pods -w -l <span style="color:#b8860b">app</span><span style="color:#666">=</span>nginx</code></pre></div>
<p>두 번째 터미널에서 스테이트풀셋을 다시 생성하자.
<code>nginx</code> 서비스(가지지 말았어야 하는)를 삭제하기 전까지는 그 서비스가 이미 존재한다는 에러를
볼 것이라는 것을 명심하자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl apply -f web.yaml
statefulset.apps/web created
service/nginx unchanged</code></pre></div>
<p>이 에러는 무시하자. 이것은 다만 해당 서비스가 있더라도
nginx 헤드리스 서비스를 생성하려고 했음을 뜻한다.</p>

<p>첫째 터미널에서 실행 중인 <code>kubectl get</code> 명령어의 출력을 살펴보자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl get pods -w -l <span style="color:#b8860b">app</span><span style="color:#666">=</span>nginx
NAME      READY     STATUS    RESTARTS   AGE
web-1     <span style="color:#666">1</span>/1       Running   <span style="color:#666">0</span>          16m
web-2     <span style="color:#666">1</span>/1       Running   <span style="color:#666">0</span>          2m
NAME      READY     STATUS    RESTARTS   AGE
web-0     <span style="color:#666">0</span>/1       Pending   <span style="color:#666">0</span>          0s
web-0     <span style="color:#666">0</span>/1       Pending   <span style="color:#666">0</span>         0s
web-0     <span style="color:#666">0</span>/1       ContainerCreating   <span style="color:#666">0</span>         0s
web-0     <span style="color:#666">1</span>/1       Running   <span style="color:#666">0</span>         18s
web-2     <span style="color:#666">1</span>/1       Terminating   <span style="color:#666">0</span>         3m
web-2     <span style="color:#666">0</span>/1       Terminating   <span style="color:#666">0</span>         3m
web-2     <span style="color:#666">0</span>/1       Terminating   <span style="color:#666">0</span>         3m
web-2     <span style="color:#666">0</span>/1       Terminating   <span style="color:#666">0</span>         3m</code></pre></div>
<p><code>web</code> 스테이트풀셋이 다시 생성될 때 먼저 <code>web-0</code> 시작한다.
<code>web-1</code>은 이미  Running과 Ready 상태이므로 <code>web-0</code>이 Running과 Ready 상태로
전환될 때는 단순히 이 파드에 적용됬다. 스테이트풀셋에<code>replicas</code>를 2로 하고
<code>web-0</code>을 재생성했다면 <code>web-1</code>이
이미 Running과 Ready 상태이고,
<code>web-2</code>은 종료되었을 것이다.</p>

<p>파드의 웹서버에서 제공한 <code>index.html</code> 파일 내용을
다른 관점으로 살펴보자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#a2f;font-weight:bold">for</span> i in <span style="color:#666">0</span> <span style="color:#666">1</span>; <span style="color:#a2f;font-weight:bold">do</span> kubectl <span style="color:#a2f">exec</span> -it web-<span style="color:#b8860b">$i</span> -- curl localhost; <span style="color:#a2f;font-weight:bold">done</span>
web-0
web-1</code></pre></div>
<p>스테이트풀셋과 <code>web-0</code> 파드를 둘 다 삭제했으나 여전히 <code>index.html</code> 파일에 입력했던
원래 호스트네임을 제공한다. 스테이트풀셋은
파드에 할당된 퍼시스턴트볼륨을 결코 삭제하지 않기때문이다.
다시 스테이트풀셋을 생성하면 <code>web-0</code>을 시작하며
원래 퍼시스턴트볼륨을 다시 마운트한다.</p>

<h3 id="단계식-삭제">단계식 삭제</h3>

<p>터미널창에서 스테이트풀셋의 파드를 감시하자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl get pods -w -l <span style="color:#b8860b">app</span><span style="color:#666">=</span>nginx</code></pre></div>
<p>다른 터미널창에서 스테이트풀셋을 다시 지우자. 이번에는
<code>--cascade=false</code> 파라미터를 생략하자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl delete statefulset web
statefulset.apps <span style="color:#b44">&#34;web&#34;</span> deleted</code></pre></div>
<p>첫째 터미널에서 실행 중인 <code>kubectl get</code> 명령어의 출력을 살펴보고
모든 파드가 Terminating 상태로 전환될 때까지 기다리자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl get pods -w -l <span style="color:#b8860b">app</span><span style="color:#666">=</span>nginx
NAME      READY     STATUS    RESTARTS   AGE
web-0     <span style="color:#666">1</span>/1       Running   <span style="color:#666">0</span>          11m
web-1     <span style="color:#666">1</span>/1       Running   <span style="color:#666">0</span>          27m
NAME      READY     STATUS        RESTARTS   AGE
web-0     <span style="color:#666">1</span>/1       Terminating   <span style="color:#666">0</span>          12m
web-1     <span style="color:#666">1</span>/1       Terminating   <span style="color:#666">0</span>         29m
web-0     <span style="color:#666">0</span>/1       Terminating   <span style="color:#666">0</span>         12m
web-0     <span style="color:#666">0</span>/1       Terminating   <span style="color:#666">0</span>         12m
web-0     <span style="color:#666">0</span>/1       Terminating   <span style="color:#666">0</span>         12m
web-1     <span style="color:#666">0</span>/1       Terminating   <span style="color:#666">0</span>         29m
web-1     <span style="color:#666">0</span>/1       Terminating   <span style="color:#666">0</span>         29m
web-1     <span style="color:#666">0</span>/1       Terminating   <span style="color:#666">0</span>         29m</code></pre></div>
<p><a href="#scaling-down">스케일 다운</a> 섹션에서 보았듯 파드는
각 순번의 역순으로 하나씩 종료된다. 파드가 종료될 때
스테이트풀 컨트롤러는 이전 파드가
완전히 종료되기까지 기다린다.</p>

<p>스테이트풀셋과 그 파드를 종속적으로 삭제하는 중에 연관된 헤드리스 서비스를
삭제하지 않음을 주의하자.
꼭 <code>nginx</code> 서비스를 수동으로 삭제해라.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl delete service nginx
service <span style="color:#b44">&#34;nginx&#34;</span> deleted</code></pre></div>
<p>스테이트풀셋과 헤드리스 서비스를 한번 더 다시 생성하자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl apply -f web.yaml
service/nginx created
statefulset.apps/web created</code></pre></div>
<p>스테이트풀셋의 모든 파드가 Running과 Ready 상태로 전환될 때
<code>index.html</code> 파일 내용을 검색하자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#a2f;font-weight:bold">for</span> i in <span style="color:#666">0</span> <span style="color:#666">1</span>; <span style="color:#a2f;font-weight:bold">do</span> kubectl <span style="color:#a2f">exec</span> -it web-<span style="color:#b8860b">$i</span> -- curl localhost; <span style="color:#a2f;font-weight:bold">done</span>
web-0
web-1</code></pre></div>
<p>스테이트풀셋과 그 내부의 모든 파드를 삭제했지만 퍼시스턴트볼륨이 마운트된 채로
다시 생성되고 <code>web-0</code>과 <code>web-1</code>은 여전히
각 호스트네임을 제공한다.</p>

<p>최종적으로 <code>web</code> 스테이트풀셋과<code>nginx</code> 서비스를 삭제한다.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl delete service nginx
service <span style="color:#b44">&#34;nginx&#34;</span> deleted

kubectl delete statefulset web
statefulset <span style="color:#b44">&#34;web&#34;</span> deleted</code></pre></div>
<h2 id="파드-관리-정책">파드 관리 정책</h2>

<p>일부 분산 시스템의 경우 스테이트풀셋의 순서 보증은
불필요하거나 바람직하지 않다. 이러한 시스템은 고유성과 신원만 필요하다.
이를 해결하기 위해 쿠버네티스 1.7에서 <code>.spec.podManagementPolicy</code>를
스테이트풀셋 API 오브젝트에 도입했다.</p>

<h3 id="orderedready-파드-관리">OrderedReady 파드 관리</h3>

<p><code>OrderedReady</code> 파드 관리는 스테이트풀셋에서는 기본이다.
이는 스테이트풀셋 컨트롤러가 지금까지 위에서 설명했던 순서를
보증함을 뜻한다.</p>

<h3 id="parallel-파드-관리">Parallel 파드 관리</h3>

<p><code>Parallel</code> 파드 관리는 스테이트풀셋 컨트롤러가 모든 파드를
병렬로 시작하고 종료하는 것으로 다른 파드를 시작/종료하기 전에
파드가 Running과 Ready 상태로 전환되거나 완전히 종료되기까지
기다리지 않음을 뜻한다.</p>

<table class="includecode" id="application-web-web-parallel-yaml">
    <thead>
        <tr>
            <th>
                <a href="https://raw.githubusercontent.com/kubernetes/website/master/content/ko/examples/application/web/web-parallel.yaml" download="application/web/web-parallel.yaml">
                    <code>application/web/web-parallel.yaml</code>
                </a>
                <img src="/images/copycode.svg" style="max-height:24px; cursor: pointer" onclick="copyCode('application-web-web-parallel-yaml')" title="Copy application/web/web-parallel.yaml to clipboard">
            </th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>Service<span style="color:#bbb">
</span><span style="color:#bbb"></span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>name:<span style="color:#bbb"> </span>nginx<span style="color:#bbb">
</span><span style="color:#bbb">  </span>labels:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>app:<span style="color:#bbb"> </span>nginx<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>ports:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>port:<span style="color:#bbb"> </span><span style="color:#666">80</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>name:<span style="color:#bbb"> </span>web<span style="color:#bbb">
</span><span style="color:#bbb">  </span>clusterIP:<span style="color:#bbb"> </span>None<span style="color:#bbb">
</span><span style="color:#bbb">  </span>selector:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>app:<span style="color:#bbb"> </span>nginx<span style="color:#bbb">
</span><span style="color:#bbb"></span>---<span style="color:#bbb">
</span><span style="color:#bbb"></span>apiVersion:<span style="color:#bbb"> </span>apps/v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>StatefulSet<span style="color:#bbb">
</span><span style="color:#bbb"></span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>name:<span style="color:#bbb"> </span>web<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>serviceName:<span style="color:#bbb"> </span><span style="color:#b44">&#34;nginx&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>podManagementPolicy:<span style="color:#bbb"> </span><span style="color:#b44">&#34;Parallel&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>replicas:<span style="color:#bbb"> </span><span style="color:#666">2</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>selector:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>matchLabels:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>app:<span style="color:#bbb"> </span>nginx<span style="color:#bbb">
</span><span style="color:#bbb">  </span>template:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>labels:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>app:<span style="color:#bbb"> </span>nginx<span style="color:#bbb">
</span><span style="color:#bbb">    </span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>containers:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>nginx<span style="color:#bbb">
</span><span style="color:#bbb">        </span>image:<span style="color:#bbb"> </span>k8s.gcr.io/nginx-slim:<span style="color:#666">0.8</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span>ports:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>-<span style="color:#bbb"> </span>containerPort:<span style="color:#bbb"> </span><span style="color:#666">80</span><span style="color:#bbb">
</span><span style="color:#bbb">          </span>name:<span style="color:#bbb"> </span>web<span style="color:#bbb">
</span><span style="color:#bbb">        </span>volumeMounts:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>www<span style="color:#bbb">
</span><span style="color:#bbb">          </span>mountPath:<span style="color:#bbb"> </span>/usr/share/nginx/html<span style="color:#bbb">
</span><span style="color:#bbb">  </span>volumeClaimTemplates:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>name:<span style="color:#bbb"> </span>www<span style="color:#bbb">
</span><span style="color:#bbb">    </span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>accessModes:<span style="color:#bbb"> </span>[<span style="color:#bbb"> </span><span style="color:#b44">&#34;ReadWriteOnce&#34;</span><span style="color:#bbb"> </span>]<span style="color:#bbb">
</span><span style="color:#bbb">      </span>resources:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>requests:<span style="color:#bbb">
</span><span style="color:#bbb">          </span>storage:<span style="color:#bbb"> </span>1Gi<span style="color:#bbb">
</span></code></pre></div>  </td>
        </tr>
    </tbody>
</table>

<p>상기 예제를 다운로드받아 파일 이름을 <code>web-parallel.yaml</code>로 저장하자.</p>

<p>이 매니페스트는 <code>web</code> 스테이트풀셋의 <code>.spec.podManagementPolicy</code>이
<code>Parallel</code>인 것 말고는 이전에 다운로드 받았던 것과 동일하다.</p>

<p>터미널에서 스테이트풀셋의 파드를 감시하자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl get po -l <span style="color:#b8860b">app</span><span style="color:#666">=</span>nginx -w</code></pre></div>
<p>다른 터미널에서 매니페스트 안에 스테이트풀셋과 서비스를 생성하자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl apply -f web-parallel.yaml
service/nginx created
statefulset.apps/web created</code></pre></div>
<p>첫째 터미널에서 실행했던 <code>kubectl get</code> 명령어의 출력을 살펴보자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl get po -l <span style="color:#b8860b">app</span><span style="color:#666">=</span>nginx -w
NAME      READY     STATUS    RESTARTS   AGE
web-0     <span style="color:#666">0</span>/1       Pending   <span style="color:#666">0</span>          0s
web-0     <span style="color:#666">0</span>/1       Pending   <span style="color:#666">0</span>         0s
web-1     <span style="color:#666">0</span>/1       Pending   <span style="color:#666">0</span>         0s
web-1     <span style="color:#666">0</span>/1       Pending   <span style="color:#666">0</span>         0s
web-0     <span style="color:#666">0</span>/1       ContainerCreating   <span style="color:#666">0</span>         0s
web-1     <span style="color:#666">0</span>/1       ContainerCreating   <span style="color:#666">0</span>         0s
web-0     <span style="color:#666">1</span>/1       Running   <span style="color:#666">0</span>         10s
web-1     <span style="color:#666">1</span>/1       Running   <span style="color:#666">0</span>         10s</code></pre></div>
<p>스테이트풀셋 컨트롤러는 <code>web-0</code>와  <code>web-1</code>를 둘 다 동시에 시작했다.</p>

<p>두 번째 터미널을 열어 놓고 다른 터미널창에서 스테이트풀셋을
스케일링 하자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl scale statefulset/web --replicas<span style="color:#666">=</span><span style="color:#666">4</span>
statefulset.apps/web scaled</code></pre></div>
<p><code>kubectl get</code> 명령어를 실행 중인 터미널의 출력을 살펴보자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">web-3     <span style="color:#666">0</span>/1       Pending   <span style="color:#666">0</span>         0s
web-3     <span style="color:#666">0</span>/1       Pending   <span style="color:#666">0</span>         0s
web-3     <span style="color:#666">0</span>/1       Pending   <span style="color:#666">0</span>         7s
web-3     <span style="color:#666">0</span>/1       ContainerCreating   <span style="color:#666">0</span>         7s
web-2     <span style="color:#666">1</span>/1       Running   <span style="color:#666">0</span>         10s
web-3     <span style="color:#666">1</span>/1       Running   <span style="color:#666">0</span>         26s</code></pre></div>
<p>스테이트풀 컨트롤러는 두 개의 새 파드를 시작하였다.
두 번째 것을 런칭하기 위해 먼저 런칭한 것이 Running과 Ready 상태가 될 때까지 기다리지 않는다.</p>

<p>이 터미널을 열어 놓고 다른 터미널에서 <code>web</code> 스테이트풀셋을 삭제하자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl delete sts web</code></pre></div>
<p>다시 한번 다른 터미널에서 실행 중인 <code>kubectl get</code>명령의 출력을 확인해보자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">web-3     <span style="color:#666">1</span>/1       Terminating   <span style="color:#666">0</span>         9m
web-2     <span style="color:#666">1</span>/1       Terminating   <span style="color:#666">0</span>         9m
web-3     <span style="color:#666">1</span>/1       Terminating   <span style="color:#666">0</span>         9m
web-2     <span style="color:#666">1</span>/1       Terminating   <span style="color:#666">0</span>         9m
web-1     <span style="color:#666">1</span>/1       Terminating   <span style="color:#666">0</span>         44m
web-0     <span style="color:#666">1</span>/1       Terminating   <span style="color:#666">0</span>         44m
web-0     <span style="color:#666">0</span>/1       Terminating   <span style="color:#666">0</span>         44m
web-3     <span style="color:#666">0</span>/1       Terminating   <span style="color:#666">0</span>         9m
web-2     <span style="color:#666">0</span>/1       Terminating   <span style="color:#666">0</span>         9m
web-1     <span style="color:#666">0</span>/1       Terminating   <span style="color:#666">0</span>         44m
web-0     <span style="color:#666">0</span>/1       Terminating   <span style="color:#666">0</span>         44m
web-2     <span style="color:#666">0</span>/1       Terminating   <span style="color:#666">0</span>         9m
web-2     <span style="color:#666">0</span>/1       Terminating   <span style="color:#666">0</span>         9m
web-2     <span style="color:#666">0</span>/1       Terminating   <span style="color:#666">0</span>         9m
web-1     <span style="color:#666">0</span>/1       Terminating   <span style="color:#666">0</span>         44m
web-1     <span style="color:#666">0</span>/1       Terminating   <span style="color:#666">0</span>         44m
web-1     <span style="color:#666">0</span>/1       Terminating   <span style="color:#666">0</span>         44m
web-0     <span style="color:#666">0</span>/1       Terminating   <span style="color:#666">0</span>         44m
web-0     <span style="color:#666">0</span>/1       Terminating   <span style="color:#666">0</span>         44m
web-0     <span style="color:#666">0</span>/1       Terminating   <span style="color:#666">0</span>         44m
web-3     <span style="color:#666">0</span>/1       Terminating   <span style="color:#666">0</span>         9m
web-3     <span style="color:#666">0</span>/1       Terminating   <span style="color:#666">0</span>         9m
web-3     <span style="color:#666">0</span>/1       Terminating   <span style="color:#666">0</span>         9m</code></pre></div>
<p>스테이트풀 컨트롤러는 모든 파드를 동시에 삭제한다. 파드를 삭제하기 전에
그 파드의 순서상 후계자를 기다리지 않는다.</p>

<p><code>kubectl get</code> 명령어가 실행된 터미널을 닫고
<code>nginx</code> 서비스를 삭제하자.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl delete svc nginx</code></pre></div>















<h2 id="정리하기">정리하기</h2>
<p>이 튜토리얼에서 사용된 퍼시턴트볼륨을 위한
퍼시스턴트 스토리지 미디어를 삭제해야 한다.
모든 스토리지를 반환하도록 환경, 스토리지 설정과
프로비저닝 방법에 따른 단계를 따르자.</p>











    
            
  <h2>피드백</h2>
  <p class="feedback--prompt">이 페이지가 도움이 되었나요? </p>
  <button class="button feedback--yes">네</button>
  <button class="button feedback--no">아니요</button>
  <p class="feedback--response feedback--response__hidden">
    피드백 감사합니다. 쿠버네티스 사용 방법에 대해서 구체적이고 답변 가능한 질문이 있다면, 다음 링크에서 질문하십시오.
    <a target="_blank" rel="noopener"
      href="https://stackoverflow.com/questions/tagged/kubernetes">
      Stack Overflow</a>.
    원한다면 GitHub 리포지터리에 이슈를 열어서
    <a class="feedback--link" target="_blank" rel="noopener"
      href="https://github.com/kubernetes/website/issues/new?title=Issue%20with%20k8s.io">
      문제 리포트</a>
    또는
    <a class="feedback--link" target="_blank" rel="noopener"
      href="https://github.com/kubernetes/website/issues/new?title=Improvement%20for%20k8s.io">
      개선 제안이 가능합니다.</a>.
  </p>
  <script>
    const yes = document.querySelector('.feedback--yes');
    const no = document.querySelector('.feedback--no');
    document.querySelectorAll('.feedback--link').forEach(link => {
      link.href = link.href + window.location.pathname;
    });
    const sendFeedback = (value) => {
      if (!gtag) { console.log('!gtag'); }
      gtag('event', 'click', {
        'event_category': 'Helpful',
        'event_label': window.location.pathname,
        value
      });
    };
    const disableButtons = () => {
      yes.disabled = true;
      yes.classList.add('feedback--button__disabled');
      no.disabled = true;
      no.classList.add('feedback--button__disabled');
    };
    yes.addEventListener('click', () => {
      sendFeedback(1);
      disableButtons();
      document.querySelector('.feedback--response').classList.remove('feedback--response__hidden');
    });
    no.addEventListener('click', () => {
      sendFeedback(0);
      disableButtons();
      document.querySelector('.feedback--response').classList.remove('feedback--response__hidden');
    });
  </script>


    
            <div id="pre-footer"> 
  <hr />

  <div class="issue-button-container">
    <p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs/tutorials/stateful-application/basic-stateful-set.md?pixel" alt="Analytics" /></a></p>
    
    
    <script type="text/javascript">
    PDRTJS_settings_8345992 = {
    "id" : "8345992",
    "unique_id" : "\/ko\/docs\/tutorials\/stateful-application\/basic-stateful-set\/",
    "title" : "스테이트풀셋 기본",
    "permalink" : "https:\/\/kubernetes.io\/ko\/docs\/tutorials\/stateful-application\/basic-stateful-set\/"
    };
    (function(d,c,j){if(!document.getElementById(j)){var pd=d.createElement(c),s;pd.id=j;pd.src=('https:'==document.location.protocol)?'https://polldaddy.com/js/rating/rating.js':'http://i0.poll.fm/js/rating/rating.js';s=document.getElementsByTagName(c)[0];s.parentNode.insertBefore(pd,s);}}(document,'script','pd-rating-js'));
    </script>
    <a href="" onclick="window.open('https://github.com/kubernetes/website/issues/new?template=bug-report.md&title=Issue%20with%20' +
    'k8s.io'+window.location.pathname)" class="button issue">이슈 생성하기</a>
    
    
    
    <a href="https://github.com/kubernetes/website/edit/master/content/ko/docs/tutorials/stateful-application/basic-stateful-set.md" class="button issue">페이지 편집하기</a>
    
  </div>
  

  <div id="lastedit" class="lastedit issue-button-container">
    최종 수정일시 February 28, 2020 at 11:56 AM PST , 다음 변경에 의해서:
    <a href="https://github.com/kubernetes/website/commit/f9a9884c0cba16b99f7a09701341976f044ff753/">Fifth Korean l10n work for release 1.17 (#19335)</a> (<a href="https://github.com/kubernetes/website/commits/master/content/en/docs/tutorials/stateful-application/basic-stateful-set.md">페이지 변경 이력</a>)
  </div>
  
</div>

          </div>
        </section>
    </main>
		<footer>
    <div class="light-text main-section">
        <nav>
            
            
            
            <a href="/ko/docs/home/">홈</a>
            
            
            
            <a href="/ko/training/">교육</a>
            
            
            
            
            
            <a href="/ko/case-studies/">사례 연구</a>
            
        </nav>
        <div class="social" role="region" aria-label="Social hyperlinks">
            <div>
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>Twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>GitHub</span></a>
                <a href="https://slack.k8s.io/" class="slack"><span>Slack</span></a>
            </div>
            <div>
                <a href="https://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://www.youtube.com/kubernetescommunity" class="youtube"><span>YouTube</span></a>
                <a href="https://discuss.kubernetes.io" class="mailing-list"><span>Forum</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>이벤트 캘린더</span></a>
            </div>
            <div>
                
                <a href="https://git.k8s.io/community/contributors/guide" class="button">기여하기</a>
            </div>
        </div>
        <div class="miceType center">
            &copy; 2023 The Kubernetes Authors | Documentation Distributed under <a href="https://git.k8s.io/website/LICENSE" class="light-text">CC BY 4.0</a></a>
        </div>
        <div class="miceType center">
            Copyright &copy; 2023 The Linux Foundation &reg;. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage" class="light-text">Trademark Usage page</a>
        </div>
        <div class="miceType center">
            ICP license: 京ICP备17074266号-3
        </div>
    </div>
</footer>

		<button class="flyout-button" onclick="kub.toggleToc()" aria-label="Toggle table of contents visibility"></button>

<script>

(function () {
    window.addEventListener('DOMContentLoaded', init)

        
        function init() {
            window.removeEventListener('DOMContentLoaded', init)
                hideNav()
        }

    function hideNav(toc){
        if (!toc) toc = document.querySelector('#docsToc')
        if (!toc) return
            var container = toc.querySelector('.container')

                
                if (container) {
                    if (container.childElementCount === 0 || toc.querySelectorAll('a.item').length === 1) {
                        toc.style.display = 'none'
                            document.getElementById('docsContent').style.width = '100%'
                    }
                } else {
                    requestAnimationFrame(function () {
                        hideNav(toc)
                    })
                }
    }
})();
</script>



    <script language="application/javascript">
      
      (function addHeadingLinks(){
        var article = document.getElementById('docsContent');
        var headings = article.querySelectorAll('h1, h2, h3, h4, h5, h6');
        headings.forEach(function(heading){
          if(heading.id){
            var a = document.createElement('a');
            a.innerHTML = heading.innerHTML;
            a.href = '#'+heading.id;
            a.classList.add('inpage_heading');
            heading.innerHTML = '';
            heading.appendChild(a);
          }
        });
      })();
    </script>
	</body>
</html>
