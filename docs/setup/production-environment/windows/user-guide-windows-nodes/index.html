<!DOCTYPE html>
<html id="docs" lang="en" class="">
	<head>
	

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-36037335-10"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-36037335-10');
</script>
<meta charset="utf-8">
<title>Guide for adding Windows Nodes in Kubernetes - Kubernetes</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#326ce5">
<link rel="shortcut icon" type="image/png" href="/images/favicon.png">









<link rel="stylesheet" href="/css/style.b7b8403eb5b1fddd0a2da2a8383d5b53e6ef81c23e4b0e292e6103bd91f9502d.css" integrity="sha256-t7hAPrWx/d0KLaKoOD1bU&#43;bvgcI&#43;Sw4pLmEDvZH5UC0=">


<link rel="stylesheet" href="/css/base_fonts.css">
<link rel="stylesheet" href="/css/jquery-ui.min.css">
<link rel="stylesheet" href="/css/callouts.css">
<link rel="stylesheet" href="/css/custom-jekyll/tags.css">



<meta name="description" content="">
<meta property="og:description" content="">
<meta name="twitter:description" content="">
<meta property="og:url" content="https://kubernetes.io/docs/setup/production-environment/windows/user-guide-windows-nodes/">
<meta property="og:title" content="Guide for adding Windows Nodes in Kubernetes">
<meta name="twitter:title" content="Guide for adding Windows Nodes in Kubernetes">
<meta name="twitter:image" content="https://kubernetes.io/images/favicon.png" />

<meta name="twitter:image:alt" content="Kubernetes">

<meta property="og:image" content="/images/kubernetes-horizontal-color.png">

<meta property="og:type" content="article">
<script src="/js/anchor-4.1.1.min.js"></script>
<script src="/js/jquery-3.2.1.min.js"></script>
<script src="/js/jquery-ui-1.12.1.min.js"></script>
<script src="/js/bootstrap-4.3.1.min.js"></script>
<script src="/js/sweetalert-2.1.2.min.js"></script>

<script src="/js/script.js"></script>
<script src="/js/custom-jekyll/tags.js"></script>


	</head>
	<body>
		<div id="cellophane" onclick="kub.toggleMenu()"></div>

<header>
    <a href="/" class="logo" title="Production-Grade Container Orchestration - Kubernetes" aria-label="Kubernetes website"></a>

    <div class="nav-buttons" data-auto-burger="primary">
        <ul class="global-nav">
            
            
            <li><a href="/docs/" class="active">Documentation</a></li>
            
            <li><a href="/blog/">Blog</a></li>
            
            <li><a href="/training/">Training</a></li>
            
            <li><a href="/partners/">Partners</a></li>
            
            <li><a href="/community/">Community</a></li>
            
            <li><a href="/case-studies/">Case Studies</a></li>
            
            
            
             <li>
                <a href="#">
                    English <span class="ui-icon ui-icon-carat-1-s"></span>
                </a>
                <ul>
                
                    <li><a href="/ko/docs/setup/production-environment/windows/user-guide-windows-nodes/">한국어 Korean</a></li>
                
                    <li><a href="/ja/docs/setup/production-environment/windows/user-guide-windows-nodes/">日本語 Japanese</a></li>
                
                </ul>
            </li>

            <li>
                <a href="#">
                    v1.17 <span class="ui-icon ui-icon-carat-1-s"></span>
                </a>
                <ul>
                
                    <li><a href="https://kubernetes.io/docs/setup/production-environment/windows/user-guide-windows-nodes/">v1.21</a></li>
                
                    <li><a href="https://v1-20.docs.kubernetes.io/docs/setup/production-environment/windows/user-guide-windows-nodes/">v1.20</a></li>
                
                    <li><a href="https://v1-19.docs.kubernetes.io/docs/setup/production-environment/windows/user-guide-windows-nodes/">v1.19</a></li>
                
                    <li><a href="https://v1-18.docs.kubernetes.io/docs/setup/production-environment/windows/user-guide-windows-nodes/">v1.18</a></li>
                
                    <li><a href="https://v1-17.docs.kubernetes.io/docs/setup/production-environment/windows/user-guide-windows-nodes/">v1.17</a></li>
                
                </ul>
            </li>
        </ul>
        
        <a href="/docs/tutorials/kubernetes-basics/" class="button" id="tryKubernetes" data-auto-burger-exclude>Learn Kubernetes Basics</a>
        

        <button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
    </div>

    <nav id="mainNav">
        <div class="main-section" data-auto-burger="primary">
         
           <div class="nav-box">
            <h3><a href="/docs/tutorials/hello-minikube/">Get Started</a></h3>
           <p>Ready to get your hands dirty? Build a simple Kubernetes cluster that runs "Hello World" for Node.js.</p>

            </div>
         
           <div class="nav-box">
            <h3><a href="/docs/home/">Documentation</a></h3>
           <p>Learn how to use Kubernetes with conceptual, tutorial, and reference documentation. You can even <a href="/editdocs/" data-auto-burger-exclude>help contribute to the docs</a>!</p>

            </div>
         
           <div class="nav-box">
            <h3><a href="/blog/">Blog</a></h3>
           <p>Read the latest news for Kubernetes and the containers space in general, and get technical how-tos hot off the presses.</p>

            </div>
         
        </div>
        <div class="main-section" data-auto-burger="primary">
            <div class="left">
                <h5 class="github-invite">Interested in hacking on the core Kubernetes code base?</h5>
                <a href="https://github.com/kubernetes/kubernetes" class="button" data-auto-burger-exclude>View On GitHub</a>
            </div>

            <div class="right">
                <h5 class="github-invite">Explore the community</h5>
                <div class="social">
                    <a href="https://twitter.com/kubernetesio" class="twitter"><span>Twitter</span></a>
                    <a href="https://github.com/kubernetes/kubernetes" class="github"><span>GitHub</span></a>
                    <a href="http://slack.k8s.io/" class="slack"><span>Slack Slack</span></a>
                    <a href="https://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                    <a href="https://www.youtube.com/kubernetescommunity" class="youtube"><span>YouTube</span></a>
                    <a href="https://discuss.kubernetes.io" class="mailing-list"><span>Forum</span></a>
                    <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
                </div>
            </div>
            <div class="clear" style="clear: both"></div>
        </div>
    </nav>
</header>

		
		
		<section id="hero" class="light-text no-sub">
			







<h1>Getting started</h1>
<h5></h5>












<div id="vendorStrip" class="light-text">
	<ul>
		
		
		<li><a href="/docs/home/">HOME</a></li>
		
		
		<li><a href="/docs/setup/" class="YAH">GETTING STARTED</a></li>
		
		
		<li><a href="/docs/concepts/">CONCEPTS</a></li>
		
		
		<li><a href="/docs/tasks/">TASKS</a></li>
		
		
		<li><a href="/docs/tutorials/">TUTORIALS</a></li>
		
		
		<li><a href="/docs/reference/">REFERENCE</a></li>
		
		
		<li><a href="/docs/contribute/">CONTRIBUTE</a></li>
		
	</ul>
	<form id="searchBox" action="/docs/search/" role="search">
		<input type="text" id="search" name="q" placeholder="Search" aria-label="Search">
	</form>
</div>

		</section>
		
    
		
<section id="deprecationWarning">
  <main>
    <div class="content deprecation-warning">
      <h3>
	 Kubernetes v1.17
	  documentation is no longer actively maintained. The version you are currently viewing is a static snapshot. For up-to-date documentation, see the 
	 <a href="https://kubernetes.io/docs/home/">latest version.</a>
      </h3>
    </div>
  </main>
</section>


    <main>
        <section id="encyclopedia">
          
<div id="docsToc">
     <div class="pi-accordion">
    	
        
        
        
        
        
         
             
                 
             
         
             
                 
                          
                          
                 
             
         
             
         
             
         
             
         
             
         
             
         
         
        
        <a class="item" data-title="Getting started" href="/docs/setup/"></a>

	
	
	
	
		
			
<div class="item" data-title="Release notes and version skew">
	<div class="container">
		
		
	
	
	
	
		
			

<a class="item" data-title="v1.17 Release Notes" href="/docs/setup/release/notes/"></a>

		
	
		
			

<a class="item" data-title="Kubernetes version and version skew support policy" href="/docs/setup/release/version-skew-policy/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="Learning environment">
	<div class="container">
		
		
	
	
	
	
		
			

<a class="item" data-title="Installing Kubernetes with Minikube" href="/docs/setup/learning-environment/minikube/"></a>

		
	
		
			

<a class="item" data-title="Installing Kubernetes with Kind" href="/docs/setup/learning-environment/kind/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="Production environment">
	<div class="container">
		
		
	
	
	
	
		
			

<a class="item" data-title="Container runtimes" href="/docs/setup/production-environment/container-runtimes/"></a>

		
	
		
			
<div class="item" data-title="Installing Kubernetes with deployment tools">
	<div class="container">
		
		
	
	
	
	
		
			
<div class="item" data-title="Bootstrapping clusters with kubeadm">
	<div class="container">
		
		
	
	
	
	
		
			

<a class="item" data-title="Installing kubeadm" href="/docs/setup/production-environment/tools/kubeadm/install-kubeadm/"></a>

		
	
		
			

<a class="item" data-title="Troubleshooting kubeadm" href="/docs/setup/production-environment/tools/kubeadm/troubleshooting-kubeadm/"></a>

		
	
		
			

<a class="item" data-title="Creating a single control-plane cluster with kubeadm" href="/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/"></a>

		
	
		
			

<a class="item" data-title="Customizing control plane configuration with kubeadm" href="/docs/setup/production-environment/tools/kubeadm/control-plane-flags/"></a>

		
	
		
			

<a class="item" data-title="Options for Highly Available topology" href="/docs/setup/production-environment/tools/kubeadm/ha-topology/"></a>

		
	
		
			

<a class="item" data-title="Creating Highly Available clusters with kubeadm" href="/docs/setup/production-environment/tools/kubeadm/high-availability/"></a>

		
	
		
			

<a class="item" data-title="Set up a High Availability etcd cluster with kubeadm" href="/docs/setup/production-environment/tools/kubeadm/setup-ha-etcd-with-kubeadm/"></a>

		
	
		
			

<a class="item" data-title="Configuring each kubelet in your cluster using kubeadm" href="/docs/setup/production-environment/tools/kubeadm/kubelet-integration/"></a>

		
	
		
			

<a class="item" data-title="Configuring your kubernetes cluster to self-host the control plane" href="/docs/setup/production-environment/tools/kubeadm/self-hosting/"></a>

		
	

	</div>
</div>

		
	
		
			

<a class="item" data-title="Installing Kubernetes with kops" href="/docs/setup/production-environment/tools/kops/"></a>

		
	
		
			

<a class="item" data-title="Installing Kubernetes with KRIB" href="/docs/setup/production-environment/tools/krib/"></a>

		
	
		
			

<a class="item" data-title="Installing Kubernetes with Kubespray" href="/docs/setup/production-environment/tools/kubespray/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="Turnkey Cloud Solutions">
	<div class="container">
		
		
	
	
	
	
		
			

<a class="item" data-title="Running Kubernetes on Alibaba Cloud" href="/docs/setup/production-environment/turnkey/alibaba-cloud/"></a>

		
	
		
			

<a class="item" data-title="Running Kubernetes on AWS EC2" href="/docs/setup/production-environment/turnkey/aws/"></a>

		
	
		
			

<a class="item" data-title="Running Kubernetes on Azure" href="/docs/setup/production-environment/turnkey/azure/"></a>

		
	
		
			

<a class="item" data-title="Running Kubernetes on CenturyLink Cloud" href="/docs/setup/production-environment/turnkey/clc/"></a>

		
	
		
			

<a class="item" data-title="Running Kubernetes on Google Compute Engine" href="/docs/setup/production-environment/turnkey/gce/"></a>

		
	
		
			

<a class="item" data-title="Running Kubernetes on Multiple Clouds with IBM Cloud Private" href="/docs/setup/production-environment/turnkey/icp/"></a>

		
	
		
			

<a class="item" data-title="Running Kubernetes on Tencent Kubernetes Engine" href="/docs/setup/production-environment/turnkey/tencent/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="On-Premises VMs">
	<div class="container">
		
		
	
	
	
	
		
			

<a class="item" data-title="Cloudstack" href="/docs/setup/production-environment/on-premises-vm/cloudstack/"></a>

		
	
		
			

<a class="item" data-title="Kubernetes on DC/OS" href="/docs/setup/production-environment/on-premises-vm/dcos/"></a>

		
	
		
			

<a class="item" data-title="oVirt" href="/docs/setup/production-environment/on-premises-vm/ovirt/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="Windows in Kubernetes">
	<div class="container">
		
		
	
	
	
	
		
			

<a class="item" data-title="Intro to Windows support in Kubernetes" href="/docs/setup/production-environment/windows/intro-windows-in-kubernetes/"></a>

		
	
		
			

<a class="item" data-title="Guide for adding Windows Nodes in Kubernetes" href="/docs/setup/production-environment/windows/user-guide-windows-nodes/"></a>

		
	
		
			

<a class="item" data-title="Guide for scheduling Windows containers in Kubernetes" href="/docs/setup/production-environment/windows/user-guide-windows-containers/"></a>

		
	

	</div>
</div>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="Best practices">
	<div class="container">
		
		
	
	
	
	
		
			

<a class="item" data-title="Running in multiple zones" href="/docs/setup/best-practices/multiple-zones/"></a>

		
	
		
			

<a class="item" data-title="Building large clusters" href="/docs/setup/best-practices/cluster-large/"></a>

		
	
		
			

<a class="item" data-title="Validate node setup" href="/docs/setup/best-practices/node-conformance/"></a>

		
	
		
			

<a class="item" data-title="PKI certificates and requirements" href="/docs/setup/best-practices/certificates/"></a>

		
	

	</div>
</div>

		
	





     </div> 
    <button class="push-menu-close-button" onclick="kub.toggleToc()"></button>
</div> 


          <div id="docsContent">
            

<p>
  <a href="https://github.com/kubernetes/website/edit/master/content/en/docs/setup/production-environment/windows/user-guide-windows-nodes.md" id="editPageButton" target="_blank">
    Edit This Page
  </a>
</p>

<h1>Guide for adding Windows Nodes in Kubernetes</h1>



<p>The Kubernetes platform can now be used to run both Linux and Windows containers. This page shows how one or more Windows nodes can be registered to a cluster.</p>












<ul id="markdown-toc">










<li><a href="#objectives">Objectives</a></li>












<li><a href="#before-you-begin">Before you begin</a></li>












<li><a href="#getting-started-adding-a-windows-node-to-your-cluster">Getting Started: Adding a Windows Node to Your Cluster</a></li>



























</ul>



<h2 id="objectives">Objectives</h2>
<ul>
<li>Register a Windows node to the cluster</li>
<li>Configure networking so Pods and Services on Linux and Windows can communicate with each other</li>
</ul>





<h2 id="before-you-begin">Before you begin</h2>
<ul>
<li><p>Obtain a <a href="https://www.microsoft.com/en-us/cloud-platform/windows-server-pricing" target="_blank">Windows Server 2019 license</a>  (or higher) in order to configure the Windows node that hosts Windows containers. You can use your organization&rsquo;s licenses for the cluster, or acquire one from Microsoft, a reseller, or via the major cloud providers such as GCP, AWS, and Azure by provisioning a virtual machine running Windows Server through their marketplaces. A <a href="https://www.microsoft.com/en-us/cloud-platform/windows-server-trial" target="_blank">time-limited trial</a> is also available.</p></li>

<li><p>Build a Linux-based Kubernetes cluster in which you have access to the control-plane (some examples include <a href="/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/">Creating a single control-plane cluster with kubeadm</a>, <a href="/docs/setup/production-environment/turnkey/azure/">AKS Engine</a>, <a href="/docs/setup/production-environment/turnkey/gce/">GCE</a>, <a href="/docs/setup/production-environment/turnkey/aws/">AWS</a>.</p></li>
</ul>




<h2 id="getting-started-adding-a-windows-node-to-your-cluster">Getting Started: Adding a Windows Node to Your Cluster</h2>

<h3 id="plan-ip-addressing">Plan IP Addressing</h3>

<p>Kubernetes cluster management requires careful planning of your IP addresses so that you do not inadvertently cause network collision. This guide assumes that you are familiar with the <a href="/docs/concepts/cluster-administration/networking/">Kubernetes networking concepts</a>.</p>

<p>In order to deploy your cluster you need the following address spaces:</p>

<table>
<thead>
<tr>
<th>Subnet / address range</th>
<th>Description</th>
<th>Default value</th>
</tr>
</thead>

<tbody>
<tr>
<td>Service Subnet</td>
<td>A non-routable, purely virtual subnet that is used by pods to uniformly access services without caring about the network topology. It is translated to/from routable address space by <code>kube-proxy</code> running on the nodes.</td>
<td>10.96.0.0/12</td>
</tr>

<tr>
<td>Cluster Subnet</td>
<td>This is a global subnet that is used by all pods in the cluster. Each node is assigned a smaller /24 subnet from this for their pods to use. It must be large enough to accommodate all pods used in your cluster. To calculate <em>minimumsubnet</em> size: <code>(number of nodes) + (number of nodes * maximum pods per node that you configure)</code>. Example: for a 5 node cluster for 100 pods per node: <code>(5) + (5 * 100) = 505.</code></td>
<td>10.244.0.0/16</td>
</tr>

<tr>
<td>Kubernetes DNS Service IP</td>
<td>IP address of <code>kube-dns</code> service that is used for DNS resolution &amp; cluster service discovery.</td>
<td>10.96.0.10</td>
</tr>
</tbody>
</table>

<p>Review the networking options supported in &lsquo;Intro to Windows containers in Kubernetes: Supported Functionality: Networking&rsquo; to determine how you need to allocate IP addresses for your cluster.</p>

<h3 id="components-that-run-on-windows">Components that run on Windows</h3>

<p>While the Kubernetes control-plane runs on your Linux node(s), the following components are configured and run on your Windows node(s).</p>

<ol>
<li>kubelet</li>
<li>kube-proxy</li>
<li>kubectl (optional)</li>
<li>Container runtime</li>
</ol>

<p>Get the latest binaries from <a href="https://github.com/kubernetes/kubernetes/releases" target="_blank">https://github.com/kubernetes/kubernetes/releases</a>, starting with v1.14 or later. The Windows-amd64 binaries for kubeadm, kubectl, kubelet, and kube-proxy can be found under the CHANGELOG link.</p>

<h3 id="networking-configuration">Networking Configuration</h3>

<p>Once you have a Linux-based Kubernetes control-plane (&ldquo;Master&rdquo;) node you are ready to choose a networking solution. This guide illustrates using Flannel in VXLAN mode for simplicity.</p>

<h4 id="configuring-flannel-in-vxlan-mode-on-the-linux-control-plane">Configuring Flannel in VXLAN mode on the Linux control-plane</h4>

<ol>
<li><p>Prepare Kubernetes master for Flannel</p>

<p>Some minor preparation is recommended on the Kubernetes master in our cluster. It is recommended to enable bridged IPv4 traffic to iptables chains when using Flannel. This can be done using the following command:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo sysctl net.bridge.bridge-nf-call-iptables<span style="color:#666">=</span><span style="color:#666">1</span></code></pre></div></li>

<li><p>Download &amp; configure Flannel</p>

<p>Download the most recent Flannel manifest:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">wget https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</code></pre></div>
<p>There are two sections you should modify to enable the vxlan networking backend:</p>

<p>After applying the steps below, the <code>net-conf.json</code> section of <code>kube-flannel.yml</code> should look as follows:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="">net-conf.json:</span> <span style="">|</span>
    {
      <span style="color:#008000;font-weight:bold">&#34;Network&#34;</span>: <span style="color:#b44">&#34;10.244.0.0/16&#34;</span>,
      <span style="color:#008000;font-weight:bold">&#34;Backend&#34;</span>: {
        <span style="color:#008000;font-weight:bold">&#34;Type&#34;</span>: <span style="color:#b44">&#34;vxlan&#34;</span>,
        <span style="color:#008000;font-weight:bold">&#34;VNI&#34;</span> : <span style="color:#666">4096</span>,
        <span style="color:#008000;font-weight:bold">&#34;Port&#34;</span>: <span style="color:#666">4789</span>
      }
    }</code></pre></div>
<blockquote class="note">
<div><strong>Note:</strong> The VNI must be set to 4096 and port 4789 for Flannel on Linux to interoperate with Flannel on Windows. Support for other VNIs is coming soon. See the <a href="https://github.com/coreos/flannel/blob/master/Documentation/backends.md#vxlan" target="_blank">VXLAN documentation</a>
for an explanation of these fields.</div>
</blockquote></li>

<li><p>In the <code>net-conf.json</code> section of your <code>kube-flannel.yml</code>, double-check:</p>

<ol>
<li>The cluster subnet (e.g. &ldquo;10.244.0.0/16&rdquo;) is set as per your IP plan.

<ul>
<li>VNI 4096 is set in the backend</li>
<li>Port 4789 is set in the backend</li>
</ul></li>
<li>In the <code>cni-conf.json</code> section of your <code>kube-flannel.yml</code>, change the network name to <code>vxlan0</code>.</li>
</ol>

<p>Your <code>cni-conf.json</code> should look as follows:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="">cni-conf.json:</span> <span style="">|</span>
    {
      <span style="color:#008000;font-weight:bold">&#34;name&#34;</span>: <span style="color:#b44">&#34;vxlan0&#34;</span>,
      <span style="color:#008000;font-weight:bold">&#34;plugins&#34;</span>: [
        {
          <span style="color:#008000;font-weight:bold">&#34;type&#34;</span>: <span style="color:#b44">&#34;flannel&#34;</span>,
          <span style="color:#008000;font-weight:bold">&#34;delegate&#34;</span>: {
            <span style="color:#008000;font-weight:bold">&#34;hairpinMode&#34;</span>: <span style="color:#a2f;font-weight:bold">true</span>,
            <span style="color:#008000;font-weight:bold">&#34;isDefaultGateway&#34;</span>: <span style="color:#a2f;font-weight:bold">true</span>
          }
        },
        {
          <span style="color:#008000;font-weight:bold">&#34;type&#34;</span>: <span style="color:#b44">&#34;portmap&#34;</span>,
          <span style="color:#008000;font-weight:bold">&#34;capabilities&#34;</span>: {
            <span style="color:#008000;font-weight:bold">&#34;portMappings&#34;</span>: <span style="color:#a2f;font-weight:bold">true</span>
          }
        }
      ]
    }</code></pre></div></li>

<li><p>Apply the Flannel manifest and validate</p>

<p>Let&rsquo;s apply the Flannel configuration:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl apply -f kube-flannel.yml</code></pre></div>
<p>After a few minutes, you should see all the pods as running if the Flannel pod network was deployed.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl get pods --all-namespaces</code></pre></div>
<p>The output looks like as follows:</p>

<pre><code>NAMESPACE     NAME                                      READY        STATUS    RESTARTS   AGE
kube-system   etcd-flannel-master                       1/1          Running   0          1m
kube-system   kube-apiserver-flannel-master             1/1          Running   0          1m
kube-system   kube-controller-manager-flannel-master    1/1          Running   0          1m
kube-system   kube-dns-86f4d74b45-hcx8x                 3/3          Running   0          12m
kube-system   kube-flannel-ds-54954                     1/1          Running   0          1m
kube-system   kube-proxy-Zjlxz                          1/1          Running   0          1m
kube-system   kube-scheduler-flannel-master             1/1          Running   0          1m
</code></pre>

<p>Verify that the Flannel DaemonSet has the NodeSelector applied.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl get ds -n kube-system</code></pre></div>
<p>The output looks like as follows. The NodeSelector <code>beta.kubernetes.io/os=linux</code> is applied.</p>

<pre><code>NAME              DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR                                               AGE
kube-flannel-ds   2         2         2       2            2           beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux   21d
kube-proxy        2         2         2       2            2           beta.kubernetes.io/os=linux                                 26d
</code></pre></li>
</ol>

<h3 id="join-windows-worker-node">Join Windows Worker Node</h3>

<p>In this section we&rsquo;ll cover configuring a Windows node from scratch to join a cluster on-prem. If your cluster is on a cloud you&rsquo;ll likely want to follow the cloud specific guides in the <a href="#public-cloud-providers">public cloud providers section</a>.</p>

<h4 id="preparing-a-windows-node">Preparing a Windows Node</h4>

<blockquote class="note">
  <div><strong>Note:</strong> All code snippets in Windows sections are to be run in a PowerShell environment with elevated permissions (Administrator) on the Windows worker node.</div>
</blockquote>

<ol>
<li><p>Download the <a href="https://github.com/kubernetes-sigs/sig-windows-tools" target="_blank">SIG Windows tools</a> repository containing install and join scripts</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PowerShell" data-lang="PowerShell"><span style="color:#800">[Net.ServicePointManager]</span>::SecurityProtocol = <span style="color:#800">[Net.SecurityProtocolType]</span>::Tls12
<span style="color:#a2f">Start-BitsTransfer</span> https<span style="">:</span>//github.com/kubernetes-sigs/sig-windows-tools/archive/master.zip
tar -xvf .\master.zip --strip-components 3 sig-windows-tools-master/kubeadm/v1.15.0/*
<span style="color:#a2f">Remove-Item</span> .\master.zip</code></pre></div></li>

<li><p>Customize the Kubernetes <a href="https://github.com/kubernetes-sigs/sig-windows-tools/blob/master/kubeadm/v1.15.0/Kubeclustervxlan.json" target="_blank">configuration file</a></p>

<pre><code>{
&quot;Cri&quot; : {  // Contains values for container runtime and base container setup
    &quot;Name&quot; : &quot;dockerd&quot;, // Container runtime name
    &quot;Images&quot; : {
        &quot;Pause&quot; : &quot;mcr.microsoft.com/k8s/core/pause:1.2.0&quot;,  // Infrastructure container image
        &quot;Nanoserver&quot; : &quot;mcr.microsoft.com/windows/nanoserver:1809&quot;,  // Base Nanoserver container image
        &quot;ServerCore&quot; : &quot;mcr.microsoft.com/windows/servercore:ltsc2019&quot;  // Base ServerCore container image
    }
},
&quot;Cni&quot; : {  // Contains values for networking executables
    &quot;Name&quot; : &quot;flannel&quot;,  // Name of network fabric
    &quot;Source&quot; : [{ // Contains array of objects containing values for network daemon(s)
        &quot;Name&quot; : &quot;flanneld&quot;,  // Name of network daemon
        &quot;Url&quot; : &quot;https://github.com/coreos/flannel/releases/download/v0.11.0/flanneld.exe&quot;  // Direct URL pointing to network daemon executable
        }
    ],
    &quot;Plugin&quot; : {  // Contains values for CNI network plugin
        &quot;Name&quot;: &quot;vxlan&quot; // Backend network mechanism to use: [&quot;vxlan&quot; | &quot;bridge&quot;]
    },
    &quot;InterfaceName&quot; : &quot;Ethernet&quot;  // Designated network interface name on Windows node to use as container network
},
&quot;Kubernetes&quot; : {  // Contains values for Kubernetes node binaries
    &quot;Source&quot; : {  // Contains values for Kubernetes node binaries 
        &quot;Release&quot; : &quot;1.15.0&quot;,  // Version of Kubernetes node binaries
        &quot;Url&quot; : &quot;https://dl.k8s.io/v1.15.0/kubernetes-node-windows-amd64.tar.gz&quot;  // Direct URL pointing to Kubernetes node binaries tarball
    },
    &quot;ControlPlane&quot; : {  // Contains values associated with Kubernetes control-plane (&quot;Master&quot;) node
        &quot;IpAddress&quot; : &quot;kubemasterIP&quot;,  // IP address of control-plane (&quot;Master&quot;) node
        &quot;Username&quot; : &quot;localadmin&quot;,  // Username on control-plane (&quot;Master&quot;) node with remote SSH access  
        &quot;KubeadmToken&quot; : &quot;token&quot;,  // Kubeadm bootstrap token
        &quot;KubeadmCAHash&quot; : &quot;discovery-token-ca-cert-hash&quot;  // Kubeadm CA key hash
    },
    &quot;KubeProxy&quot; : {  // Contains values for Kubernetes network proxy configuration
        &quot;Gates&quot; : &quot;WinOverlay=true&quot;  // Comma-separated key-value pairs passed to kube-proxy feature gate flag
    },
    &quot;Network&quot; : {  // Contains values for IP ranges in CIDR notation for Kubernetes networking
        &quot;ServiceCidr&quot; : &quot;10.96.0.0/12&quot;,  // Service IP subnet used by Services in CIDR notation
        &quot;ClusterCidr&quot; : &quot;10.244.0.0/16&quot;  // Cluster IP subnet used by Pods in CIDR notation 
    }
},
&quot;Install&quot; : {  // Contains values and configurations for Windows node installation
    &quot;Destination&quot; : &quot;C:\\ProgramData\\Kubernetes&quot;  // Absolute DOS path where Kubernetes will be installed on the Windows node
}
}
</code></pre></li>
</ol>

<blockquote class="note">
  <div><strong>Note:</strong> Users can generate values for the <code>ControlPlane.KubeadmToken</code> and <code>ControlPlane.KubeadmCAHash</code> fields by running  <code>kubeadm token create --print-join-command</code> on the Kubernetes control-plane (&ldquo;Master&rdquo;) node.</div>
</blockquote>

<ol>
<li>Install containers and Kubernetes (requires a system reboot)</li>
</ol>

<p>Use the previously downloaded <a href="https://github.com/kubernetes-sigs/sig-windows-tools/blob/master/kubeadm/KubeCluster.ps1" target="_blank">KubeCluster.ps1</a> script to install Kubernetes on the Windows Server container host:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PowerShell" data-lang="PowerShell">    .\KubeCluster.ps1 -ConfigFile .\Kubeclustervxlan.json -install </code></pre></div>
<p>where <code>-ConfigFile</code> points to the path of the Kubernetes configuration file.</p>

<blockquote class="note">
  <div><strong>Note:</strong> In the example below, we are using overlay networking mode. This requires Windows Server version 2019 with <a href="https://support.microsoft.com/help/4489899" target="_blank">KB4489899</a> and at least Kubernetes v1.14 or above. Users that cannot meet this requirement must use  <code>L2bridge</code> networking instead by selecting <code>bridge</code> as the <a href="https://github.com/kubernetes-sigs/sig-windows-tools/blob/master/kubeadm/v1.15.0/Kubeclusterbridge.json#L18" target="_blank">plugin</a> in the configuration file.</div>
</blockquote>

<p><img src="../kubecluster.ps1-install.gif" alt="alt_text" title="KubeCluster.ps1 install output" /></p>

<p>On the Windows node you target, this step will:</p>

<ol>
<li>Enable Windows Server containers role (and reboot)</li>
<li>Download and install the chosen container runtime</li>
<li>Download all needed container images</li>
<li>Download Kubernetes binaries and add them to the <code>$PATH</code> environment variable</li>
<li>Download CNI plugins based on the selection made in the Kubernetes Configuration file</li>

<li><p>(Optionally) Generate a new SSH key which is required to connect to the control-plane (&ldquo;Master&rdquo;) node during joining</p>

<p><blockquote class="note">
<div><strong>Note:</strong> For the SSH key generation step, you also need to add the generated public SSH key to the <code>authorized_keys</code> file on your (Linux) control-plane node. You only need to do this once. The script prints out the steps you can follow to do this, at the end of its output.</div>
</blockquote></p></li>
</ol>

<p>Once installation is complete, any of the generated configuration files or binaries can be modified before joining the Windows node.</p>

<h4 id="join-the-windows-node-to-the-kubernetes-cluster">Join the Windows Node to the Kubernetes cluster</h4>

<p>This section covers how to join a <a href="#preparing-a-windows-node">Windows node with Kubernetes installed</a> with an existing (Linux) control-plane, to form a cluster.</p>

<p>Use the previously downloaded <a href="https://github.com/kubernetes-sigs/sig-windows-tools/blob/master/kubeadm/KubeCluster.ps1" target="_blank">KubeCluster.ps1</a> script to join the Windows node to the cluster:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PowerShell" data-lang="PowerShell">    .\KubeCluster.ps1 -ConfigFile .\Kubeclustervxlan.json -join </code></pre></div>
<p>where <code>-ConfigFile</code> points to the path of the Kubernetes configuration file.</p>

<p><img src="../kubecluster.ps1-join.gif" alt="alt_text" title="KubeCluster.ps1 join output" /></p>

<blockquote class="note">
  <div><strong>Note:</strong> Should the script fail during the bootstrap or joining procedure for whatever reason, start a new PowerShell session before starting each consecutive join attempt.</div>
</blockquote>

<p>This step will perform the following actions:</p>

<ol>
<li>Connect to the control-plane (&ldquo;Master&rdquo;) node via SSH, to retrieve the <a href="/docs/concepts/configuration/organize-cluster-access-kubeconfig/">Kubeconfig file</a> file.</li>
<li>Register kubelet as a Windows service</li>
<li>Configure CNI network plugins</li>
<li>Create an HNS network on top of the chosen network interface
<blockquote class="note">
<div><strong>Note:</strong> This may cause a network blip for a few seconds while the vSwitch is being created.</div>
</blockquote></li>
<li>(If vxlan plugin is selected) Open up inbound firewall UDP port 4789 for overlay traffic</li>
<li>Register flanneld as a Windows service</li>
<li>Register kube-proxy as a Windows service</li>
</ol>

<p>Now you can view the Windows nodes in your cluster by running the following:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl get nodes</code></pre></div>
<h4 id="remove-the-windows-node-from-the-kubernetes-cluster">Remove the Windows Node from the Kubernetes cluster</h4>

<p>In this section we&rsquo;ll cover how to remove a Windows node from a Kubernetes cluster.</p>

<p>Use the previously downloaded <a href="https://github.com/kubernetes-sigs/sig-windows-tools/blob/master/kubeadm/KubeCluster.ps1" target="_blank">KubeCluster.ps1</a> script to remove the Windows node from the cluster:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PowerShell" data-lang="PowerShell">    .\KubeCluster.ps1 -ConfigFile .\Kubeclustervxlan.json -reset </code></pre></div>
<p>where <code>-ConfigFile</code> points to the path of the Kubernetes configuration file.</p>

<p><img src="../kubecluster.ps1-reset.gif" alt="alt_text" title="KubeCluster.ps1 reset output" /></p>

<p>This step will perform the following actions on the targeted Windows node:</p>

<ol>
<li>Delete the Windows node from the Kubernetes cluster</li>
<li>Stop all running containers</li>
<li>Remove all container networking (HNS) resources</li>
<li>Unregister all Kubernetes services (flanneld, kubelet, kube-proxy)</li>
<li>Delete all Kubernetes binaries (kube-proxy.exe, kubelet.exe, flanneld.exe, kubeadm.exe)</li>
<li>Delete all CNI network plugins binaries</li>
<li>Delete <a href="/docs/concepts/configuration/organize-cluster-access-kubeconfig/">Kubeconfig file</a> used to access the Kubernetes cluster</li>
</ol>

<h3 id="public-cloud-providers">Public Cloud Providers</h3>

<h4 id="azure">Azure</h4>

<p>AKS-Engine can deploy a complete, customizable Kubernetes cluster with both Linux &amp; Windows nodes. There is a step-by-step walkthrough available in the <a href="https://github.com/Azure/aks-engine/blob/master/docs/topics/windows.md" target="_blank">docs on GitHub</a>.</p>

<h4 id="gcp">GCP</h4>

<p>Users can easily deploy a complete Kubernetes cluster on GCE following this step-by-step walkthrough on <a href="https://github.com/kubernetes/kubernetes/blob/master/cluster/gce/windows/README-GCE-Windows-kube-up.md" target="_blank">GitHub</a></p>

<h4 id="deployment-with-kubeadm-and-cluster-api">Deployment with kubeadm and cluster API</h4>

<p>Kubeadm is becoming the de facto standard for users to deploy a Kubernetes cluster. Windows node support in kubeadm is an alpha feature since Kubernetes release v1.16. We are also making investments in cluster API to ensure Windows nodes are properly provisioned. For more details, please consult the <a href="https://github.com/kubernetes/enhancements/blob/master/keps/sig-cluster-lifecycle/kubeadm/20190424-kubeadm-for-windows.md" target="_blank">kubeadm for Windows KEP</a>.</p>

<h3 id="next-steps">Next Steps</h3>

<p>Now that you&rsquo;ve configured a Windows worker in your cluster to run Windows containers you may want to add one or more Linux nodes as well to run Linux containers. You are now ready to schedule Windows containers on your cluster.</p>























    
            
  <h2>Feedback</h2>
  <p class="feedback--prompt">Was this page helpful? </p>
  <button class="button feedback--yes">Yes</button>
  <button class="button feedback--no">No</button>
  <p class="feedback--response feedback--response__hidden">
    Thanks for the feedback. If you have a specific, answerable question about how to use Kubernetes, ask it on
    <a target="_blank" rel="noopener"
      href="https://stackoverflow.com/questions/tagged/kubernetes">
      Stack Overflow</a>.
    Open an issue in the GitHub repo if you want to 
    <a class="feedback--link" target="_blank" rel="noopener"
      href="https://github.com/kubernetes/website/issues/new?title=Issue%20with%20k8s.io">
      report a problem</a>
    or
    <a class="feedback--link" target="_blank" rel="noopener"
      href="https://github.com/kubernetes/website/issues/new?title=Improvement%20for%20k8s.io">
      suggest an improvement</a>.
  </p>
  <script>
    const yes = document.querySelector('.feedback--yes');
    const no = document.querySelector('.feedback--no');
    document.querySelectorAll('.feedback--link').forEach(link => {
      link.href = link.href + window.location.pathname;
    });
    const sendFeedback = (value) => {
      if (!gtag) { console.log('!gtag'); }
      gtag('event', 'click', {
        'event_category': 'Helpful',
        'event_label': window.location.pathname,
        value
      });
    };
    const disableButtons = () => {
      yes.disabled = true;
      yes.classList.add('feedback--button__disabled');
      no.disabled = true;
      no.classList.add('feedback--button__disabled');
    };
    yes.addEventListener('click', () => {
      sendFeedback(1);
      disableButtons();
      document.querySelector('.feedback--response').classList.remove('feedback--response__hidden');
    });
    no.addEventListener('click', () => {
      sendFeedback(0);
      disableButtons();
      document.querySelector('.feedback--response').classList.remove('feedback--response__hidden');
    });
  </script>


    
            <div id="pre-footer"> 
  <hr />

  <div class="issue-button-container">
    <p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs/setup/production-environment/windows/user-guide-windows-nodes.md?pixel" alt="Analytics" /></a></p>
    
    
    <script type="text/javascript">
    PDRTJS_settings_8345992 = {
    "id" : "8345992",
    "unique_id" : "\/docs\/setup\/production-environment\/windows\/user-guide-windows-nodes\/",
    "title" : "Guide for adding Windows Nodes in Kubernetes",
    "permalink" : "https:\/\/kubernetes.io\/docs\/setup\/production-environment\/windows\/user-guide-windows-nodes\/"
    };
    (function(d,c,j){if(!document.getElementById(j)){var pd=d.createElement(c),s;pd.id=j;pd.src=('https:'==document.location.protocol)?'https://polldaddy.com/js/rating/rating.js':'http://i0.poll.fm/js/rating/rating.js';s=document.getElementsByTagName(c)[0];s.parentNode.insertBefore(pd,s);}}(document,'script','pd-rating-js'));
    </script>
    <a href="" onclick="window.open('https://github.com/kubernetes/website/issues/new?template=bug-report.md&title=Issue%20with%20' +
    'k8s.io'+window.location.pathname)" class="button issue">Create an Issue</a>
    
    
    
    <a href="https://github.com/kubernetes/website/edit/master/content/en/docs/setup/production-environment/windows/user-guide-windows-nodes.md" class="button issue">Edit This Page</a>
    
  </div>
  

  <div id="lastedit" class="lastedit issue-button-container">
    Page last modified on January 17, 2020 at 11:54 PM PST by
    <a href="https://github.com/kubernetes/website/commit/e3a7a56878516820ddc9daa3285388d5c170357c/">Remove redundant information when deploy flannel on kubernetes include windows node (#18274)</a> (<a href="https://github.com/kubernetes/website/commits/master/content/en/docs/setup/production-environment/windows/user-guide-windows-nodes.md">Page History</a>)
  </div>
  
</div>

          </div>
        </section>
    </main>
		<footer>
    <div class="light-text main-section">
        <nav>
            
            
            
            <a href="/docs/home/">Home</a>
            
            <a href="/blog/">Blog</a>
            
            <a href="/training/">Training</a>
            
            <a href="/partners/">Partners</a>
            
            <a href="/community/">Community</a>
            
            <a href="/case-studies/">Case Studies</a>
            
        </nav>
        <div class="social" role="region" aria-label="Social hyperlinks">
            <div>
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>Twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>GitHub</span></a>
                <a href="https://slack.k8s.io/" class="slack"><span>Slack</span></a>
            </div>
            <div>
                <a href="https://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://www.youtube.com/kubernetescommunity" class="youtube"><span>YouTube</span></a>
                <a href="https://discuss.kubernetes.io" class="mailing-list"><span>Forum</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
            <div>
                
                <a href="https://git.k8s.io/community/contributors/guide" class="button">Contribute</a>
            </div>
        </div>
        <div class="miceType center">
            &copy; 2023 The Kubernetes Authors | Documentation Distributed under <a href="https://git.k8s.io/website/LICENSE" class="light-text">CC BY 4.0</a></a>
        </div>
        <div class="miceType center">
            Copyright &copy; 2023 The Linux Foundation &reg;. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage" class="light-text">Trademark Usage page</a>
        </div>
        <div class="miceType center">
            ICP license: 京ICP备17074266号-3
        </div>
    </div>
</footer>

		<button class="flyout-button" onclick="kub.toggleToc()" aria-label="Toggle table of contents visibility"></button>

<script>

(function () {
    window.addEventListener('DOMContentLoaded', init)

        
        function init() {
            window.removeEventListener('DOMContentLoaded', init)
                hideNav()
        }

    function hideNav(toc){
        if (!toc) toc = document.querySelector('#docsToc')
        if (!toc) return
            var container = toc.querySelector('.container')

                
                if (container) {
                    if (container.childElementCount === 0 || toc.querySelectorAll('a.item').length === 1) {
                        toc.style.display = 'none'
                            document.getElementById('docsContent').style.width = '100%'
                    }
                } else {
                    requestAnimationFrame(function () {
                        hideNav(toc)
                    })
                }
    }
})();
</script>



    <script language="application/javascript">
      
      (function addHeadingLinks(){
        var article = document.getElementById('docsContent');
        var headings = article.querySelectorAll('h1, h2, h3, h4, h5, h6');
        headings.forEach(function(heading){
          if(heading.id){
            var a = document.createElement('a');
            a.innerHTML = heading.innerHTML;
            a.href = '#'+heading.id;
            a.classList.add('inpage_heading');
            heading.innerHTML = '';
            heading.appendChild(a);
          }
        });
      })();
    </script>
	</body>
</html>
