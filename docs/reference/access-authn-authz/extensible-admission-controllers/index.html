<!DOCTYPE html>
<html id="docs" lang="en" class="">
	<head>
	

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-36037335-10"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-36037335-10');
</script>
<meta charset="utf-8">
<title>Dynamic Admission Control - Kubernetes</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#326ce5">
<link rel="shortcut icon" type="image/png" href="/images/favicon.png">









<link rel="stylesheet" href="/css/style.b7b8403eb5b1fddd0a2da2a8383d5b53e6ef81c23e4b0e292e6103bd91f9502d.css" integrity="sha256-t7hAPrWx/d0KLaKoOD1bU&#43;bvgcI&#43;Sw4pLmEDvZH5UC0=">


<link rel="stylesheet" href="/css/base_fonts.css">
<link rel="stylesheet" href="/css/jquery-ui.min.css">
<link rel="stylesheet" href="/css/callouts.css">
<link rel="stylesheet" href="/css/custom-jekyll/tags.css">



<meta name="description" content="">
<meta property="og:description" content="">
<meta name="twitter:description" content="">
<meta property="og:url" content="https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/">
<meta property="og:title" content="Dynamic Admission Control">
<meta name="twitter:title" content="Dynamic Admission Control">
<meta name="twitter:image" content="https://kubernetes.io/images/favicon.png" />

<meta name="twitter:image:alt" content="Kubernetes">

<meta property="og:image" content="/images/kubernetes-horizontal-color.png">

<meta property="og:type" content="article">
<script src="/js/anchor-4.1.1.min.js"></script>
<script src="/js/jquery-3.2.1.min.js"></script>
<script src="/js/jquery-ui-1.12.1.min.js"></script>
<script src="/js/bootstrap-4.3.1.min.js"></script>
<script src="/js/sweetalert-2.1.2.min.js"></script>

<script src="/js/script.js"></script>
<script src="/js/custom-jekyll/tags.js"></script>


	</head>
	<body>
		<div id="cellophane" onclick="kub.toggleMenu()"></div>

<header>
    <a href="/" class="logo" title="Production-Grade Container Orchestration - Kubernetes" aria-label="Kubernetes website"></a>

    <div class="nav-buttons" data-auto-burger="primary">
        <ul class="global-nav">
            
            
            <li><a href="/docs/" class="active">Documentation</a></li>
            
            <li><a href="/blog/">Blog</a></li>
            
            <li><a href="/training/">Training</a></li>
            
            <li><a href="/partners/">Partners</a></li>
            
            <li><a href="/community/">Community</a></li>
            
            <li><a href="/case-studies/">Case Studies</a></li>
            
            
            
             <li>
                <a href="#">
                    English <span class="ui-icon ui-icon-carat-1-s"></span>
                </a>
                <ul>
                
                    <li><a href="/zh/docs/reference/access-authn-authz/extensible-admission-controllers/">中文 Chinese</a></li>
                
                </ul>
            </li>

            <li>
                <a href="#">
                    v1.17 <span class="ui-icon ui-icon-carat-1-s"></span>
                </a>
                <ul>
                
                    <li><a href="https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/">v1.21</a></li>
                
                    <li><a href="https://v1-20.docs.kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/">v1.20</a></li>
                
                    <li><a href="https://v1-19.docs.kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/">v1.19</a></li>
                
                    <li><a href="https://v1-18.docs.kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/">v1.18</a></li>
                
                    <li><a href="https://v1-17.docs.kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/">v1.17</a></li>
                
                </ul>
            </li>
        </ul>
        
        <a href="/docs/tutorials/kubernetes-basics/" class="button" id="tryKubernetes" data-auto-burger-exclude>Learn Kubernetes Basics</a>
        

        <button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
    </div>

    <nav id="mainNav">
        <div class="main-section" data-auto-burger="primary">
         
           <div class="nav-box">
            <h3><a href="/docs/tutorials/hello-minikube/">Get Started</a></h3>
           <p>Ready to get your hands dirty? Build a simple Kubernetes cluster that runs "Hello World" for Node.js.</p>

            </div>
         
           <div class="nav-box">
            <h3><a href="/docs/home/">Documentation</a></h3>
           <p>Learn how to use Kubernetes with conceptual, tutorial, and reference documentation. You can even <a href="/editdocs/" data-auto-burger-exclude>help contribute to the docs</a>!</p>

            </div>
         
           <div class="nav-box">
            <h3><a href="/blog/">Blog</a></h3>
           <p>Read the latest news for Kubernetes and the containers space in general, and get technical how-tos hot off the presses.</p>

            </div>
         
        </div>
        <div class="main-section" data-auto-burger="primary">
            <div class="left">
                <h5 class="github-invite">Interested in hacking on the core Kubernetes code base?</h5>
                <a href="https://github.com/kubernetes/kubernetes" class="button" data-auto-burger-exclude>View On GitHub</a>
            </div>

            <div class="right">
                <h5 class="github-invite">Explore the community</h5>
                <div class="social">
                    <a href="https://twitter.com/kubernetesio" class="twitter"><span>Twitter</span></a>
                    <a href="https://github.com/kubernetes/kubernetes" class="github"><span>GitHub</span></a>
                    <a href="http://slack.k8s.io/" class="slack"><span>Slack Slack</span></a>
                    <a href="https://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                    <a href="https://www.youtube.com/kubernetescommunity" class="youtube"><span>YouTube</span></a>
                    <a href="https://discuss.kubernetes.io" class="mailing-list"><span>Forum</span></a>
                    <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
                </div>
            </div>
            <div class="clear" style="clear: both"></div>
        </div>
    </nav>
</header>

		
		
		<section id="hero" class="light-text no-sub">
			















<h1>Reference</h1>
<h5></h5>




<div id="vendorStrip" class="light-text">
	<ul>
		
		
		<li><a href="/docs/home/">HOME</a></li>
		
		
		<li><a href="/docs/setup/">GETTING STARTED</a></li>
		
		
		<li><a href="/docs/concepts/">CONCEPTS</a></li>
		
		
		<li><a href="/docs/tasks/">TASKS</a></li>
		
		
		<li><a href="/docs/tutorials/">TUTORIALS</a></li>
		
		
		<li><a href="/docs/reference/" class="YAH">REFERENCE</a></li>
		
		
		<li><a href="/docs/contribute/">CONTRIBUTE</a></li>
		
	</ul>
	<form id="searchBox" action="/docs/search/" role="search">
		<input type="text" id="search" name="q" placeholder="Search" aria-label="Search">
	</form>
</div>

		</section>
		
    
		
<section id="deprecationWarning">
  <main>
    <div class="content deprecation-warning">
      <h3>
	 Kubernetes v1.17
	  documentation is no longer actively maintained. The version you are currently viewing is a static snapshot. For up-to-date documentation, see the 
	 <a href="https://kubernetes.io/docs/home/">latest version.</a>
      </h3>
    </div>
  </main>
</section>


    <main>
        <section id="encyclopedia">
          
<div id="docsToc">
     <div class="pi-accordion">
    	
        
        
        
        
        
         
             
                 
             
         
             
                 
             
         
             
                 
             
         
             
                 
             
         
             
                 
             
         
             
                 
                          
                          
                 
             
         
             
         
         
        
        <a class="item" data-title="Reference" href="/docs/reference/"></a>

	
	
	
	
		
			

<a class="item" data-title="Standardized Glossary" href="/docs/reference/glossary/"></a>

		
	
		
			
<div class="item" data-title="Kubernetes Issues and Security">
	<div class="container">
		
		
	
	
	
	
		
			

<a class="item" data-title="Kubernetes Issue Tracker" href="/docs/reference/issues-security/issues/"></a>

		
	
		
			

<a class="item" data-title="Kubernetes Security and Disclosure Information" href="/docs/reference/issues-security/security/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="Using the Kubernetes API">
	<div class="container">
		
		
	
	
	
	
		
			

<a class="item" data-title="Kubernetes API Overview" href="/docs/reference/using-api/api-overview/"></a>

		
	
		
			

<a class="item" data-title="Kubernetes API Concepts" href="/docs/reference/using-api/api-concepts/"></a>

		
	
		
			

<a class="item" data-title="Client Libraries" href="/docs/reference/using-api/client-libraries/"></a>

		
	
		
			

<a class="item" data-title="Kubernetes Deprecation Policy" href="/docs/reference/using-api/deprecation-policy/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="Accessing the API">
	<div class="container">
		
		
	
	
	
	
		
			

<a class="item" data-title="Controlling Access to the Kubernetes API" href="/docs/reference/access-authn-authz/controlling-access/"></a>

		
	
		
			

<a class="item" data-title="Authenticating" href="/docs/reference/access-authn-authz/authentication/"></a>

		
	
		
			

<a class="item" data-title="Authenticating with Bootstrap Tokens" href="/docs/reference/access-authn-authz/bootstrap-tokens/"></a>

		
	
		
			

<a class="item" data-title="Using Admission Controllers" href="/docs/reference/access-authn-authz/admission-controllers/"></a>

		
	
		
			

<a class="item" data-title="Dynamic Admission Control" href="/docs/reference/access-authn-authz/extensible-admission-controllers/"></a>

		
	
		
			

<a class="item" data-title="Managing Service Accounts" href="/docs/reference/access-authn-authz/service-accounts-admin/"></a>

		
	
		
			

<a class="item" data-title="Authorization Overview" href="/docs/reference/access-authn-authz/authorization/"></a>

		
	
		
			

<a class="item" data-title="Using RBAC Authorization" href="/docs/reference/access-authn-authz/rbac/"></a>

		
	
		
			

<a class="item" data-title="Using ABAC Authorization" href="/docs/reference/access-authn-authz/abac/"></a>

		
	
		
			

<a class="item" data-title="Using Node Authorization" href="/docs/reference/access-authn-authz/node/"></a>

		
	
		
			

<a class="item" data-title="Webhook Mode" href="/docs/reference/access-authn-authz/webhook/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="API Reference">
	<div class="container">
		
		
	
	
	
	
		
			

<a class="item" data-title="v1.17" href="/docs/reference/kubernetes-api/api-index/"></a>

		
	
		
			

<a class="item" data-title="Well-Known Labels, Annotations and Taints" href="/docs/reference/kubernetes-api/labels-annotations-taints/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="Setup tools reference">
	<div class="container">
		
		
	
	
	
	
		
			
<div class="item" data-title="Kubeadm">
	<div class="container">
		
		
	
	
	
	
		
			

<a class="item" data-title="Overview of kubeadm" href="/docs/reference/setup-tools/kubeadm/kubeadm/"></a>

		
	
		
			

<a class="item" data-title="kubeadm init" href="/docs/reference/setup-tools/kubeadm/kubeadm-init/"></a>

		
	
		
			

<a class="item" data-title="kubeadm join" href="/docs/reference/setup-tools/kubeadm/kubeadm-join/"></a>

		
	
		
			

<a class="item" data-title="kubeadm upgrade" href="/docs/reference/setup-tools/kubeadm/kubeadm-upgrade/"></a>

		
	
		
			

<a class="item" data-title="kubeadm config" href="/docs/reference/setup-tools/kubeadm/kubeadm-config/"></a>

		
	
		
			

<a class="item" data-title="kubeadm reset" href="/docs/reference/setup-tools/kubeadm/kubeadm-reset/"></a>

		
	
		
			

<a class="item" data-title="kubeadm token" href="/docs/reference/setup-tools/kubeadm/kubeadm-token/"></a>

		
	
		
			

<a class="item" data-title="kubeadm version" href="/docs/reference/setup-tools/kubeadm/kubeadm-version/"></a>

		
	
		
			

<a class="item" data-title="kubeadm alpha" href="/docs/reference/setup-tools/kubeadm/kubeadm-alpha/"></a>

		
	
		
			

<a class="item" data-title="kubeadm init phase" href="/docs/reference/setup-tools/kubeadm/kubeadm-init-phase/"></a>

		
	
		
			

<a class="item" data-title="kubeadm join phase" href="/docs/reference/setup-tools/kubeadm/kubeadm-join-phase/"></a>

		
	
		
			

<a class="item" data-title="kubeadm reset phase" href="/docs/reference/setup-tools/kubeadm/kubeadm-reset-phase/"></a>

		
	
		
			

<a class="item" data-title="kubeadm upgrade phase" href="/docs/reference/setup-tools/kubeadm/kubeadm-upgrade-phase/"></a>

		
	
		
			

<a class="item" data-title="Implementation details" href="/docs/reference/setup-tools/kubeadm/implementation-details/"></a>

		
	

	</div>
</div>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="Command line tools reference">
	<div class="container">
		
		
	
	
	
	
		
			

<a class="item" data-title="Feature Gates" href="/docs/reference/command-line-tools-reference/feature-gates/"></a>

		
	
		
			

<a class="item" data-title="cloud-controller-manager" href="/docs/reference/command-line-tools-reference/cloud-controller-manager/"></a>

		
	
		
			

<a class="item" data-title="kube-apiserver" href="/docs/reference/command-line-tools-reference/kube-apiserver/"></a>

		
	
		
			

<a class="item" data-title="kube-controller-manager" href="/docs/reference/command-line-tools-reference/kube-controller-manager/"></a>

		
	
		
			

<a class="item" data-title="kube-proxy" href="/docs/reference/command-line-tools-reference/kube-proxy/"></a>

		
	
		
			

<a class="item" data-title="kube-scheduler" href="/docs/reference/command-line-tools-reference/kube-scheduler/"></a>

		
	
		
			

<a class="item" data-title="kubelet" href="/docs/reference/command-line-tools-reference/kubelet/"></a>

		
	
		
			

<a class="item" data-title="Kubelet authentication/authorization" href="/docs/reference/command-line-tools-reference/kubelet-authentication-authorization/"></a>

		
	
		
			

<a class="item" data-title="TLS bootstrapping" href="/docs/reference/command-line-tools-reference/kubelet-tls-bootstrapping/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="kubectl CLI">
	<div class="container">
		
		
	
	
	
	
		
			

<a class="item" data-title="Overview of kubectl" href="/docs/reference/kubectl/overview/"></a>

		
	
		
			

<a class="item" data-title="JSONPath Support" href="/docs/reference/kubectl/jsonpath/"></a>

		
	
		
			

<a class="item" data-title="kubectl" href="/docs/reference/kubectl/kubectl/"></a>

		
	
		
			

<a class="item" data-title="kubectl Cheat Sheet" href="/docs/reference/kubectl/cheatsheet/"></a>

		
	
		
			

<a class="item" data-title="kubectl Commands" href="/docs/reference/kubectl/kubectl-cmds/"></a>

		
	
		
			

<a class="item" data-title="kubectl for Docker Users" href="/docs/reference/kubectl/docker-cli-to-kubectl/"></a>

		
	
		
			

<a class="item" data-title="kubectl Usage Conventions" href="/docs/reference/kubectl/conventions/"></a>

		
	

	</div>
</div>

		
	
		
			

<a class="item" data-title="Tools" href="/docs/reference/tools/"></a>

		
	





     </div> 
    <button class="push-menu-close-button" onclick="kub.toggleToc()"></button>
</div> 


          <div id="docsContent">
            

<p>
  <a href="https://github.com/kubernetes/website/edit/master/content/en/docs/reference/access-authn-authz/extensible-admission-controllers.md" id="editPageButton" target="_blank">
    Edit This Page
  </a>
</p>

<h1>Dynamic Admission Control</h1>



<p>In addition to <a href="/docs/reference/access-authn-authz/admission-controllers/">compiled-in admission plugins</a>,
admission plugins can be developed as extensions and run as webhooks configured at runtime.
This page describes how to build, configure, use, and monitor admission webhooks.</p>









<ul id="markdown-toc">










<li><a href="#what-are-admission-webhooks">What are admission webhooks?</a></li>




<li><a href="#experimenting-with-admission-webhooks">Experimenting with admission webhooks</a></li>




<li><a href="#webhook-request-and-response">Webhook request and response</a></li>




<li><a href="#webhook-configuration">Webhook configuration</a></li>




<li><a href="#monitoring-admission-webhooks">Monitoring admission webhooks</a></li>




<li><a href="#best-practices-and-warnings">Best practices and warnings</a></li>



















</ul>


<h2 id="what-are-admission-webhooks">What are admission webhooks?</h2>

<p>Admission webhooks are HTTP callbacks that receive admission requests and do
something with them. You can define two types of admission webhooks,
<a href="/docs/reference/access-authn-authz/admission-controllers/#validatingadmissionwebhook">validating admission Webhook</a>
and
<a href="/docs/reference/access-authn-authz/admission-controllers/#mutatingadmissionwebhook">mutating admission webhook</a>.
Mutating admission Webhooks are invoked first, and can modify objects sent to the API server to enforce custom defaults.
After all object modifications are complete, and after the incoming object is validated by the API server,
validating admission webhooks are invoked and can reject requests to enforce custom policies.</p>

<blockquote class="note">
  <div><strong>Note:</strong> Admission webhooks that need to guarantee they see the final state of the object in order to enforce policy
should use a validating admission webhook, since objects can be modified after being seen by mutating webhooks.</div>
</blockquote>

<h2 id="experimenting-with-admission-webhooks">Experimenting with admission webhooks</h2>

<p>Admission webhooks are essentially part of the cluster control-plane. You should
write and deploy them with great caution. Please read the <a href="/docs/reference/access-authn-authz/extensible-admission-controllers/#write-an-admission-webhook-server">user
guides</a> for
instructions if you intend to write/deploy production-grade admission webhooks.
In the following, we describe how to quickly experiment with admission webhooks.</p>

<h3 id="prerequisites">Prerequisites</h3>

<ul>
<li><p>Ensure that the Kubernetes cluster is at least as new as v1.16 (to use <code>admissionregistration.k8s.io/v1</code>),
or v1.9 (to use <code>admissionregistration.k8s.io/v1beta1</code>).</p></li>

<li><p>Ensure that MutatingAdmissionWebhook and ValidatingAdmissionWebhook
admission controllers are enabled.
<a href="/docs/reference/access-authn-authz/admission-controllers/#is-there-a-recommended-set-of-admission-controllers-to-use">Here</a>
is a recommended set of admission controllers to enable in general.</p></li>

<li><p>Ensure that the <code>admissionregistration.k8s.io/v1</code> or <code>admissionregistration.k8s.io/v1beta1</code> API is enabled.</p></li>
</ul>

<h3 id="write-an-admission-webhook-server">Write an admission webhook server</h3>

<p>Please refer to the implementation of the <a href="https://github.com/kubernetes/kubernetes/blob/v1.13.0/test/images/webhook/main.go" target="_blank">admission webhook
server</a>
that is validated in a Kubernetes e2e test. The webhook handles the
<code>AdmissionReview</code> request sent by the apiservers, and sends back its decision
as an <code>AdmissionReview</code> object in the same version it received.</p>

<p>See the <a href="#request">webhook request</a> section for details on the data sent to webhooks.</p>

<p>See the <a href="#response">webhook response</a> section for the data expected from webhooks.</p>

<p>The example admission webhook server leaves the <code>ClientAuth</code> field
<a href="https://github.com/kubernetes/kubernetes/blob/v1.13.0/test/images/webhook/config.go#L47-L48" target="_blank">empty</a>,
which defaults to <code>NoClientCert</code>. This means that the webhook server does not
authenticate the identity of the clients, supposedly apiservers. If you need
mutual TLS or other ways to authenticate the clients, see
how to <a href="#authenticate-apiservers">authenticate apiservers</a>.</p>

<h3 id="deploy-the-admission-webhook-service">Deploy the admission webhook service</h3>

<p>The webhook server in the e2e test is deployed in the Kubernetes cluster, via
the <a href="/docs/reference/generated/kubernetes-api/v1.17/#deployment-v1-apps">deployment API</a>.
The test also creates a <a href="/docs/reference/generated/kubernetes-api/v1.17/#service-v1-core">service</a>
as the front-end of the webhook server. See
<a href="https://github.com/kubernetes/kubernetes/blob/v1.15.0/test/e2e/apimachinery/webhook.go#L301" target="_blank">code</a>.</p>

<p>You may also deploy your webhooks outside of the cluster. You will need to update
your webhook configurations accordingly.</p>

<h3 id="configure-admission-webhooks-on-the-fly">Configure admission webhooks on the fly</h3>

<p>You can dynamically configure what resources are subject to what admission
webhooks via
<a href="/docs/reference/generated/kubernetes-api/v1.17/#validatingwebhookconfiguration-v1-admissionregistration-k8s-io">ValidatingWebhookConfiguration</a>
or
<a href="/docs/reference/generated/kubernetes-api/v1.17/#mutatingwebhookconfiguration-v1-admissionregistration-k8s-io">MutatingWebhookConfiguration</a>.</p>

<p>The following is an example <code>ValidatingWebhookConfiguration</code>, a mutating webhook configuration is similar.
See the <a href="#webhook-configuration">webhook configuration</a> section for details about each config field.</p>

<div id="validatingwebhookconfiguration-example-1">
<ul>
    
      
  <li><a href="#validatingwebhookconfiguration-example-1-0">admissionregistration.k8s.io/v1</a></li>

      
  <li><a href="#validatingwebhookconfiguration-example-1-1">admissionregistration.k8s.io/v1beta1</a></li>

</ul>


<div id="validatingwebhookconfiguration-example-1-0">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>admissionregistration.k8s.io/v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>ValidatingWebhookConfiguration<span style="color:#bbb">
</span><span style="color:#bbb"></span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>name:<span style="color:#bbb"> </span><span style="color:#b44">&#34;pod-policy.example.com&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>webhooks:<span style="color:#bbb">
</span><span style="color:#bbb"></span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span><span style="color:#b44">&#34;pod-policy.example.com&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>rules:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>apiGroups:<span style="color:#bbb">   </span>[<span style="color:#b44">&#34;&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>apiVersions:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;v1&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>operations:<span style="color:#bbb">  </span>[<span style="color:#b44">&#34;CREATE&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>resources:<span style="color:#bbb">   </span>[<span style="color:#b44">&#34;pods&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>scope:<span style="color:#bbb">       </span><span style="color:#b44">&#34;Namespaced&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>clientConfig:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>service:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>namespace:<span style="color:#bbb"> </span><span style="color:#b44">&#34;example-namespace&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span>name:<span style="color:#bbb"> </span><span style="color:#b44">&#34;example-service&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>caBundle:<span style="color:#bbb"> </span><span style="color:#b44">&#34;Ci0tLS0tQk...&lt;`caBundle` is a PEM encoded CA bundle which will be used to validate the webhook&#39;s server certificate.&gt;...tLS0K&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>admissionReviewVersions:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;v1&#34;</span>,<span style="color:#bbb"> </span><span style="color:#b44">&#34;v1beta1&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">  </span>sideEffects:<span style="color:#bbb"> </span>None<span style="color:#bbb">
</span><span style="color:#bbb">  </span>timeoutSeconds:<span style="color:#bbb"> </span><span style="color:#666">5</span></code></pre></div>
    

<p></div></p>

<div id="validatingwebhookconfiguration-example-1-1">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#080;font-style:italic"># Deprecated in v1.16 in favor of admissionregistration.k8s.io/v1</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>apiVersion:<span style="color:#bbb"> </span>admissionregistration.k8s.io/v1beta1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>ValidatingWebhookConfiguration<span style="color:#bbb">
</span><span style="color:#bbb"></span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>name:<span style="color:#bbb"> </span><span style="color:#b44">&#34;pod-policy.example.com&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>webhooks:<span style="color:#bbb">
</span><span style="color:#bbb"></span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span><span style="color:#b44">&#34;pod-policy.example.com&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>rules:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>apiGroups:<span style="color:#bbb">   </span>[<span style="color:#b44">&#34;&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>apiVersions:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;v1&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>operations:<span style="color:#bbb">  </span>[<span style="color:#b44">&#34;CREATE&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>resources:<span style="color:#bbb">   </span>[<span style="color:#b44">&#34;pods&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>scope:<span style="color:#bbb">       </span><span style="color:#b44">&#34;Namespaced&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>clientConfig:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>service:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>namespace:<span style="color:#bbb"> </span><span style="color:#b44">&#34;example-namespace&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span>name:<span style="color:#bbb"> </span><span style="color:#b44">&#34;example-service&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>caBundle:<span style="color:#bbb"> </span><span style="color:#b44">&#34;Ci0tLS0tQk...&lt;`caBundle` is a PEM encoded CA bundle which will be used to validate the webhook&#39;s server certificate&gt;...tLS0K&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>admissionReviewVersions:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;v1beta1&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">  </span>timeoutSeconds:<span style="color:#bbb"> </span><span style="color:#666">5</span></code></pre></div>
    

<p></div></p>

<p></div></p>

<script>$(function(){$("#validatingwebhookconfiguration-example-1").tabs();});</script>

<p>The scope field specifies if only cluster-scoped resources (&ldquo;Cluster&rdquo;) or namespace-scoped
resources (&ldquo;Namespaced&rdquo;) will match this rule. &ldquo;*&rdquo; means that there are no scope restrictions.</p>

<blockquote class="note">
  <div><strong>Note:</strong> When using <code>clientConfig.service</code>, the server cert must be valid for
<code>&lt;svc_name&gt;.&lt;svc_namespace&gt;.svc</code>.</div>
</blockquote>

<blockquote class="note">
  <div><strong>Note:</strong> Default timeout for a webhook call is 10 seconds for webhooks registered created using <code>admissionregistration.k8s.io/v1</code>,
and 30 seconds for webhooks created using <code>admissionregistration.k8s.io/v1beta1</code>. Starting in kubernetes 1.14 you
can set the timeout and it is encouraged to use a small timeout for webhooks.
If the webhook call times out, the request is handled according to the webhook&rsquo;s
failure policy.</div>
</blockquote>

<p>When an apiserver receives a request that matches one of the <code>rules</code>, the
apiserver sends an <code>admissionReview</code> request to webhook as specified in the
<code>clientConfig</code>.</p>

<p>After you create the webhook configuration, the system will take a few seconds
to honor the new configuration.</p>

<h3 id="authenticate-apiservers">Authenticate apiservers</h3>

<p>If your admission webhooks require authentication, you can configure the
apiservers to use basic auth, bearer token, or a cert to authenticate itself to
the webhooks. There are three steps to complete the configuration.</p>

<ul>
<li><p>When starting the apiserver, specify the location of the admission control
configuration file via the <code>--admission-control-config-file</code> flag.</p></li>

<li><p>In the admission control configuration file, specify where the
MutatingAdmissionWebhook controller and ValidatingAdmissionWebhook controller
should read the credentials. The credentials are stored in kubeConfig files
(yes, the same schema that&rsquo;s used by kubectl), so the field name is
<code>kubeConfigFile</code>. Here is an example admission control configuration file:</p></li>
</ul>

<div id="admissionconfiguration-example1">
<ul>
    
      
  <li><a href="#admissionconfiguration-example1-0">apiserver.config.k8s.io/v1</a></li>

      
  <li><a href="#admissionconfiguration-example1-1">apiserver.k8s.io/v1alpha1</a></li>

</ul>


<div id="admissionconfiguration-example1-0">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>apiserver.config.k8s.io/v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>AdmissionConfiguration<span style="color:#bbb">
</span><span style="color:#bbb"></span>plugins:<span style="color:#bbb">
</span><span style="color:#bbb"></span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>ValidatingAdmissionWebhook<span style="color:#bbb">
</span><span style="color:#bbb">  </span>configuration:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>apiVersion:<span style="color:#bbb"> </span>apiserver.config.k8s.io/v1<span style="color:#bbb">
</span><span style="color:#bbb">    </span>kind:<span style="color:#bbb"> </span>WebhookAdmissionConfiguration<span style="color:#bbb">
</span><span style="color:#bbb">    </span>kubeConfigFile:<span style="color:#bbb"> </span><span style="color:#b44">&#34;&lt;path-to-kubeconfig-file&gt;&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>MutatingAdmissionWebhook<span style="color:#bbb">
</span><span style="color:#bbb">  </span>configuration:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>apiVersion:<span style="color:#bbb"> </span>apiserver.config.k8s.io/v1<span style="color:#bbb">
</span><span style="color:#bbb">    </span>kind:<span style="color:#bbb"> </span>WebhookAdmissionConfiguration<span style="color:#bbb">
</span><span style="color:#bbb">    </span>kubeConfigFile:<span style="color:#bbb"> </span><span style="color:#b44">&#34;&lt;path-to-kubeconfig-file&gt;&#34;</span></code></pre></div>
    

<p></div></p>

<div id="admissionconfiguration-example1-1">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#080;font-style:italic"># Deprecated in v1.17 in favor of apiserver.config.k8s.io/v1</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>apiVersion:<span style="color:#bbb"> </span>apiserver.k8s.io/v1alpha1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>AdmissionConfiguration<span style="color:#bbb">
</span><span style="color:#bbb"></span>plugins:<span style="color:#bbb">
</span><span style="color:#bbb"></span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>ValidatingAdmissionWebhook<span style="color:#bbb">
</span><span style="color:#bbb">  </span>configuration:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># Deprecated in v1.17 in favor of apiserver.config.k8s.io/v1, kind=WebhookAdmissionConfiguration</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>apiVersion:<span style="color:#bbb"> </span>apiserver.config.k8s.io/v1alpha1<span style="color:#bbb">
</span><span style="color:#bbb">    </span>kind:<span style="color:#bbb"> </span>WebhookAdmission<span style="color:#bbb">
</span><span style="color:#bbb">    </span>kubeConfigFile:<span style="color:#bbb"> </span><span style="color:#b44">&#34;&lt;path-to-kubeconfig-file&gt;&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>MutatingAdmissionWebhook<span style="color:#bbb">
</span><span style="color:#bbb">  </span>configuration:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># Deprecated in v1.17 in favor of apiserver.config.k8s.io/v1, kind=WebhookAdmissionConfiguration</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>apiVersion:<span style="color:#bbb"> </span>apiserver.config.k8s.io/v1alpha1<span style="color:#bbb">
</span><span style="color:#bbb">    </span>kind:<span style="color:#bbb"> </span>WebhookAdmission<span style="color:#bbb">
</span><span style="color:#bbb">    </span>kubeConfigFile:<span style="color:#bbb"> </span><span style="color:#b44">&#34;&lt;path-to-kubeconfig-file&gt;&#34;</span></code></pre></div>
    

<p></div></p>

<p></div></p>

<script>$(function(){$("#admissionconfiguration-example1").tabs();});</script>

<p>For more information about <code>AdmissionConfiguration</code>, see the
<a href="https://github.com/kubernetes/kubernetes/blob/v1.17.0/staging/src/k8s.io/apiserver/pkg/apis/apiserver/v1/types.go#L27" target="_blank">AdmissionConfiguration schema</a>.
See the <a href="#webhook-configuration">webhook configuration</a> section for details about each config field.</p>

<ul>
<li><p>In the kubeConfig file, provide the credentials:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>Config<span style="color:#bbb">
</span><span style="color:#bbb"></span>users:<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#080;font-style:italic"># name should be set to the DNS name of the service or the host (including port) of the URL the webhook is configured to speak to.</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#080;font-style:italic"># If a non-443 port is used for services, it must be included in the name when configuring 1.16+ API servers.</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#080;font-style:italic">#</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#080;font-style:italic"># For a webhook configured to speak to a service on the default port (443), specify the DNS name of the service:</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#080;font-style:italic"># - name: webhook1.ns1.svc</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#080;font-style:italic">#   user: ...</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#080;font-style:italic">#</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#080;font-style:italic"># For a webhook configured to speak to a service on non-default port (e.g. 8443), specify the DNS name and port of the service in 1.16+:</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#080;font-style:italic"># - name: webhook1.ns1.svc:8443</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#080;font-style:italic">#   user: ...</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#080;font-style:italic"># and optionally create a second stanza using only the DNS name of the service for compatibility with 1.15 API servers:</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#080;font-style:italic"># - name: webhook1.ns1.svc</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#080;font-style:italic">#   user: ...</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#080;font-style:italic">#</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#080;font-style:italic"># For webhooks configured to speak to a URL, match the host (and port) specified in the webhook&#39;s URL. Examples:</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#080;font-style:italic"># A webhook with `url: https://www.example.com`:</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#080;font-style:italic"># - name: www.example.com</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#080;font-style:italic">#   user: ...</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#080;font-style:italic">#</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#080;font-style:italic"># A webhook with `url: https://www.example.com:443`:</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#080;font-style:italic"># - name: www.example.com:443</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#080;font-style:italic">#   user: ...</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#080;font-style:italic">#</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#080;font-style:italic"># A webhook with `url: https://www.example.com:8443`:</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#080;font-style:italic"># - name: www.example.com:8443</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#080;font-style:italic">#   user: ...</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#080;font-style:italic">#</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span><span style="color:#b44">&#39;webhook1.ns1.svc&#39;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>user:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>client-certificate-data:<span style="color:#bbb"> </span><span style="color:#b44">&#34;&lt;pem encoded certificate&gt;&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>client-key-data:<span style="color:#bbb"> </span><span style="color:#b44">&#34;&lt;pem encoded key&gt;&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#080;font-style:italic"># The `name` supports using * to wildcard-match prefixing segments.</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span><span style="color:#b44">&#39;*.webhook-company.org&#39;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>user:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>password:<span style="color:#bbb"> </span><span style="color:#b44">&#34;&lt;password&gt;&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>username:<span style="color:#bbb"> </span><span style="color:#b44">&#34;&lt;name&gt;&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#080;font-style:italic"># &#39;*&#39; is the default match.</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span><span style="color:#b44">&#39;*&#39;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>user:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>token:<span style="color:#bbb"> </span><span style="color:#b44">&#34;&lt;token&gt;&#34;</span></code></pre></div></li>
</ul>

<p>Of course you need to set up the webhook server to handle these authentications.</p>

<h2 id="webhook-request-and-response">Webhook request and response</h2>

<h3 id="request">Request</h3>

<p>Webhooks are sent a POST request, with <code>Content-Type: application/json</code>,
with an <code>AdmissionReview</code> API object in the <code>admission.k8s.io</code> API group
serialized to JSON as the body.</p>

<p>Webhooks can specify what versions of <code>AdmissionReview</code> objects they accept
with the <code>admissionReviewVersions</code> field in their configuration:</p>

<div id="validatingwebhookconfiguration-admissionreviewversions">
<ul>
    
      
  <li><a href="#validatingwebhookconfiguration-admissionreviewversions-0">admissionregistration.k8s.io/v1</a></li>

      
  <li><a href="#validatingwebhookconfiguration-admissionreviewversions-1">admissionregistration.k8s.io/v1beta1</a></li>

</ul>


<div id="validatingwebhookconfiguration-admissionreviewversions-0">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>admissionregistration.k8s.io/v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>ValidatingWebhookConfiguration<span style="color:#bbb">
</span><span style="color:#bbb"></span>...<span style="color:#bbb">
</span><span style="color:#bbb"></span>webhooks:<span style="color:#bbb">
</span><span style="color:#bbb"></span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>my-webhook.example.com<span style="color:#bbb">
</span><span style="color:#bbb">  </span>admissionReviewVersions:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;v1&#34;</span>,<span style="color:#bbb"> </span><span style="color:#b44">&#34;v1beta1&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">  </span>...</code></pre></div>
<p><code>admissionReviewVersions</code> is a required field when creating
<code>admissionregistration.k8s.io/v1</code> webhook configurations.
Webhooks are required to support at least one <code>AdmissionReview</code>
version understood by the current and previous API server.</p>

    
</div>

<div id="validatingwebhookconfiguration-admissionreviewversions-1">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#080;font-style:italic"># Deprecated in v1.16 in favor of admissionregistration.k8s.io/v1</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>apiVersion:<span style="color:#bbb"> </span>admissionregistration.k8s.io/v1beta1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>ValidatingWebhookConfiguration<span style="color:#bbb">
</span><span style="color:#bbb"></span>...<span style="color:#bbb">
</span><span style="color:#bbb"></span>webhooks:<span style="color:#bbb">
</span><span style="color:#bbb"></span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>my-webhook.example.com<span style="color:#bbb">
</span><span style="color:#bbb">  </span>admissionReviewVersions:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;v1beta1&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">  </span>...</code></pre></div>
<p>If no <code>admissionReviewVersions</code> are specified, the default when creating
<code>admissionregistration.k8s.io/v1beta1</code> webhook configurations is <code>v1beta1</code>.</p>

    
</div>

<p></div></p>

<script>$(function(){$("#validatingwebhookconfiguration-admissionreviewversions").tabs();});</script>

<p>API servers send the first <code>AdmissionReview</code> version in the <code>admissionReviewVersions</code> list they support.
If none of the versions in the list are supported by the API server, the configuration will not be allowed to be created.
If an API server encounters a webhook configuration that was previously created and does not support any of the <code>AdmissionReview</code>
versions the API server knows how to send, attempts to call to the webhook will fail and be subject to the <a href="#failure-policy">failure policy</a>.</p>

<p>This example shows the data contained in an <code>AdmissionReview</code> object
for a request to update the <code>scale</code> subresource of an <code>apps/v1</code> <code>Deployment</code>:</p>

<div id="admissionreview-request">
<ul>
    
      
  <li><a href="#admissionreview-request-0">admission.k8s.io/v1</a></li>

      
  <li><a href="#admissionreview-request-1">admission.k8s.io/v1beta1</a></li>

</ul>


<div id="admissionreview-request-0">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">{<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#b44">&#34;apiVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;admission.k8s.io/v1&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#b44">&#34;kind&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;AdmissionReview&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#b44">&#34;request&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># Random uid uniquely identifying this admission call</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;uid&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;705ab4f5-6393-11e8-b7cc-42010a800002&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># Fully-qualified group/version/kind of the incoming object</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;kind&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#b44">&#34;group&#34;</span>:<span style="color:#b44">&#34;autoscaling&#34;</span>,<span style="color:#b44">&#34;version&#34;</span>:<span style="color:#b44">&#34;v1&#34;</span>,<span style="color:#b44">&#34;kind&#34;</span>:<span style="color:#b44">&#34;Scale&#34;</span>},<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># Fully-qualified group/version/kind of the resource being modified</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;resource&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#b44">&#34;group&#34;</span>:<span style="color:#b44">&#34;apps&#34;</span>,<span style="color:#b44">&#34;version&#34;</span>:<span style="color:#b44">&#34;v1&#34;</span>,<span style="color:#b44">&#34;resource&#34;</span>:<span style="color:#b44">&#34;deployments&#34;</span>},<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># subresource, if the request is to a subresource</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;subResource&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;scale&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># Fully-qualified group/version/kind of the incoming object in the original request to the API server.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># This only differs from `kind` if the webhook specified `matchPolicy: Equivalent` and the</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># original request to the API server was converted to a version the webhook registered for.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;requestKind&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#b44">&#34;group&#34;</span>:<span style="color:#b44">&#34;autoscaling&#34;</span>,<span style="color:#b44">&#34;version&#34;</span>:<span style="color:#b44">&#34;v1&#34;</span>,<span style="color:#b44">&#34;kind&#34;</span>:<span style="color:#b44">&#34;Scale&#34;</span>},<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># Fully-qualified group/version/kind of the resource being modified in the original request to the API server.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># This only differs from `resource` if the webhook specified `matchPolicy: Equivalent` and the</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># original request to the API server was converted to a version the webhook registered for.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;requestResource&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#b44">&#34;group&#34;</span>:<span style="color:#b44">&#34;apps&#34;</span>,<span style="color:#b44">&#34;version&#34;</span>:<span style="color:#b44">&#34;v1&#34;</span>,<span style="color:#b44">&#34;resource&#34;</span>:<span style="color:#b44">&#34;deployments&#34;</span>},<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># subresource, if the request is to a subresource</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># This only differs from `subResource` if the webhook specified `matchPolicy: Equivalent` and the</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># original request to the API server was converted to a version the webhook registered for.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;requestSubResource&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;scale&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># Name of the resource being modified</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;name&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;my-deployment&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># Namespace of the resource being modified, if the resource is namespaced (or is a Namespace object)</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;namespace&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;my-namespace&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># operation can be CREATE, UPDATE, DELETE, or CONNECT</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;operation&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;UPDATE&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;userInfo&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># Username of the authenticated user making the request to the API server</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#b44">&#34;username&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;admin&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># UID of the authenticated user making the request to the API server</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#b44">&#34;uid&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;014fbff9a07c&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># Group memberships of the authenticated user making the request to the API server</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#b44">&#34;groups&#34;</span>:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;system:authenticated&#34;</span>,<span style="color:#b44">&#34;my-admin-group&#34;</span>],<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># Arbitrary extra info associated with the user making the request to the API server.</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># This is populated by the API server authentication layer and should be included</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># if any SubjectAccessReview checks are performed by the webhook.</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#b44">&#34;extra&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;some-key&#34;</span>:[<span style="color:#b44">&#34;some-value1&#34;</span>,<span style="color:#bbb"> </span><span style="color:#b44">&#34;some-value2&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">      </span>}<span style="color:#bbb">
</span><span style="color:#bbb">    </span>},<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># object is the new object being admitted.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># It is null for DELETE operations.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;object&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#b44">&#34;apiVersion&#34;</span>:<span style="color:#b44">&#34;autoscaling/v1&#34;</span>,<span style="color:#b44">&#34;kind&#34;</span>:<span style="color:#b44">&#34;Scale&#34;</span>,...},<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># oldObject is the existing object.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># It is null for CREATE and CONNECT operations.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;oldObject&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#b44">&#34;apiVersion&#34;</span>:<span style="color:#b44">&#34;autoscaling/v1&#34;</span>,<span style="color:#b44">&#34;kind&#34;</span>:<span style="color:#b44">&#34;Scale&#34;</span>,...},<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># options contains the options for the operation being admitted, like meta.k8s.io/v1 CreateOptions, UpdateOptions, or DeleteOptions.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># It is null for CONNECT operations.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;options&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#b44">&#34;apiVersion&#34;</span>:<span style="color:#b44">&#34;meta.k8s.io/v1&#34;</span>,<span style="color:#b44">&#34;kind&#34;</span>:<span style="color:#b44">&#34;UpdateOptions&#34;</span>,...},<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># dryRun indicates the API request is running in dry run mode and will not be persisted.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># Webhooks with side effects should avoid actuating those side effects when dryRun is true.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># See http://k8s.io/docs/reference/using-api/api-concepts/#make-a-dry-run-request for more details.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;dryRun&#34;</span>:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">false</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span><span style="color:#bbb"></span>}</code></pre></div>
    

<p></div></p>

<div id="admissionreview-request-1">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">{<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># Deprecated in v1.16 in favor of admission.k8s.io/v1</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#b44">&#34;apiVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;admission.k8s.io/v1beta1&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#b44">&#34;kind&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;AdmissionReview&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#b44">&#34;request&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># Random uid uniquely identifying this admission call</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;uid&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;705ab4f5-6393-11e8-b7cc-42010a800002&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># Fully-qualified group/version/kind of the incoming object</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;kind&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#b44">&#34;group&#34;</span>:<span style="color:#b44">&#34;autoscaling&#34;</span>,<span style="color:#b44">&#34;version&#34;</span>:<span style="color:#b44">&#34;v1&#34;</span>,<span style="color:#b44">&#34;kind&#34;</span>:<span style="color:#b44">&#34;Scale&#34;</span>},<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># Fully-qualified group/version/kind of the resource being modified</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;resource&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#b44">&#34;group&#34;</span>:<span style="color:#b44">&#34;apps&#34;</span>,<span style="color:#b44">&#34;version&#34;</span>:<span style="color:#b44">&#34;v1&#34;</span>,<span style="color:#b44">&#34;resource&#34;</span>:<span style="color:#b44">&#34;deployments&#34;</span>},<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># subresource, if the request is to a subresource</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;subResource&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;scale&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># Fully-qualified group/version/kind of the incoming object in the original request to the API server.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># This only differs from `kind` if the webhook specified `matchPolicy: Equivalent` and the</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># original request to the API server was converted to a version the webhook registered for.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># Only sent by v1.15+ API servers.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;requestKind&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#b44">&#34;group&#34;</span>:<span style="color:#b44">&#34;autoscaling&#34;</span>,<span style="color:#b44">&#34;version&#34;</span>:<span style="color:#b44">&#34;v1&#34;</span>,<span style="color:#b44">&#34;kind&#34;</span>:<span style="color:#b44">&#34;Scale&#34;</span>},<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># Fully-qualified group/version/kind of the resource being modified in the original request to the API server.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># This only differs from `resource` if the webhook specified `matchPolicy: Equivalent` and the</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># original request to the API server was converted to a version the webhook registered for.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># Only sent by v1.15+ API servers.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;requestResource&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#b44">&#34;group&#34;</span>:<span style="color:#b44">&#34;apps&#34;</span>,<span style="color:#b44">&#34;version&#34;</span>:<span style="color:#b44">&#34;v1&#34;</span>,<span style="color:#b44">&#34;resource&#34;</span>:<span style="color:#b44">&#34;deployments&#34;</span>},<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># subresource, if the request is to a subresource</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># This only differs from `subResource` if the webhook specified `matchPolicy: Equivalent` and the</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># original request to the API server was converted to a version the webhook registered for.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># Only sent by v1.15+ API servers.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;requestSubResource&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;scale&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># Name of the resource being modified</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;name&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;my-deployment&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># Namespace of the resource being modified, if the resource is namespaced (or is a Namespace object)</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;namespace&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;my-namespace&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># operation can be CREATE, UPDATE, DELETE, or CONNECT</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;operation&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;UPDATE&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;userInfo&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># Username of the authenticated user making the request to the API server</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#b44">&#34;username&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;admin&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># UID of the authenticated user making the request to the API server</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#b44">&#34;uid&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;014fbff9a07c&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># Group memberships of the authenticated user making the request to the API server</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#b44">&#34;groups&#34;</span>:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;system:authenticated&#34;</span>,<span style="color:#b44">&#34;my-admin-group&#34;</span>],<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># Arbitrary extra info associated with the user making the request to the API server.</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># This is populated by the API server authentication layer and should be included</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># if any SubjectAccessReview checks are performed by the webhook.</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#b44">&#34;extra&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;some-key&#34;</span>:[<span style="color:#b44">&#34;some-value1&#34;</span>,<span style="color:#bbb"> </span><span style="color:#b44">&#34;some-value2&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">      </span>}<span style="color:#bbb">
</span><span style="color:#bbb">    </span>},<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># object is the new object being admitted.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># It is null for DELETE operations.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;object&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#b44">&#34;apiVersion&#34;</span>:<span style="color:#b44">&#34;autoscaling/v1&#34;</span>,<span style="color:#b44">&#34;kind&#34;</span>:<span style="color:#b44">&#34;Scale&#34;</span>,...},<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># oldObject is the existing object.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># It is null for CREATE and CONNECT operations (and for DELETE operations in API servers prior to v1.15.0)</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;oldObject&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#b44">&#34;apiVersion&#34;</span>:<span style="color:#b44">&#34;autoscaling/v1&#34;</span>,<span style="color:#b44">&#34;kind&#34;</span>:<span style="color:#b44">&#34;Scale&#34;</span>,...},<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># options contains the options for the operation being admitted, like meta.k8s.io/v1 CreateOptions, UpdateOptions, or DeleteOptions.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># It is null for CONNECT operations.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># Only sent by v1.15+ API servers.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;options&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#b44">&#34;apiVersion&#34;</span>:<span style="color:#b44">&#34;meta.k8s.io/v1&#34;</span>,<span style="color:#b44">&#34;kind&#34;</span>:<span style="color:#b44">&#34;UpdateOptions&#34;</span>,...},<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># dryRun indicates the API request is running in dry run mode and will not be persisted.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># Webhooks with side effects should avoid actuating those side effects when dryRun is true.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># See http://k8s.io/docs/reference/using-api/api-concepts/#make-a-dry-run-request for more details.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;dryRun&#34;</span>:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">false</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span><span style="color:#bbb"></span>}</code></pre></div>
    

<p></div></p>

<p></div></p>

<script>$(function(){$("#admissionreview-request").tabs();});</script>

<h3 id="response">Response</h3>

<p>Webhooks respond with a 200 HTTP status code, <code>Content-Type: application/json</code>,
and a body containing an <code>AdmissionReview</code> object (in the same version they were sent),
with the <code>response</code> stanza populated, serialized to JSON.</p>

<p>At a minimum, the <code>response</code> stanza must contain the following fields:</p>

<ul>
<li><code>uid</code>, copied from the <code>request.uid</code> sent to the webhook</li>
<li><code>allowed</code>, either set to <code>true</code> or <code>false</code></li>
</ul>

<p>Example of a minimal response from a webhook to allow a request:</p>

<div id="admissionreview-response-allow">
<ul>
    
      
  <li><a href="#admissionreview-response-allow-0">admission.k8s.io/v1</a></li>

      
  <li><a href="#admissionreview-response-allow-1">admission.k8s.io/v1beta1</a></li>

</ul>


<div id="admissionreview-response-allow-0">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#008000;font-weight:bold">&#34;apiVersion&#34;</span>: <span style="color:#b44">&#34;admission.k8s.io/v1&#34;</span>,
  <span style="color:#008000;font-weight:bold">&#34;kind&#34;</span>: <span style="color:#b44">&#34;AdmissionReview&#34;</span>,
  <span style="color:#008000;font-weight:bold">&#34;response&#34;</span>: {
    <span style="color:#008000;font-weight:bold">&#34;uid&#34;</span>: <span style="color:#b44">&#34;&lt;value from request.uid&gt;&#34;</span>,
    <span style="color:#008000;font-weight:bold">&#34;allowed&#34;</span>: <span style="color:#a2f;font-weight:bold">true</span>
  }
}</code></pre></div>
    

<p></div></p>

<div id="admissionreview-response-allow-1">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#008000;font-weight:bold">&#34;apiVersion&#34;</span>: <span style="color:#b44">&#34;admission.k8s.io/v1beta1&#34;</span>,
  <span style="color:#008000;font-weight:bold">&#34;kind&#34;</span>: <span style="color:#b44">&#34;AdmissionReview&#34;</span>,
  <span style="color:#008000;font-weight:bold">&#34;response&#34;</span>: {
    <span style="color:#008000;font-weight:bold">&#34;uid&#34;</span>: <span style="color:#b44">&#34;&lt;value from request.uid&gt;&#34;</span>,
    <span style="color:#008000;font-weight:bold">&#34;allowed&#34;</span>: <span style="color:#a2f;font-weight:bold">true</span>
  }
}</code></pre></div>
    

<p></div></p>

<p></div></p>

<script>$(function(){$("#admissionreview-response-allow").tabs();});</script>

<p>Example of a minimal response from a webhook to forbid a request:</p>

<div id="admissionreview-response-forbid-minimal">
<ul>
    
      
  <li><a href="#admissionreview-response-forbid-minimal-0">admission.k8s.io/v1</a></li>

      
  <li><a href="#admissionreview-response-forbid-minimal-1">admission.k8s.io/v1beta1</a></li>

</ul>


<div id="admissionreview-response-forbid-minimal-0">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#008000;font-weight:bold">&#34;apiVersion&#34;</span>: <span style="color:#b44">&#34;admission.k8s.io/v1&#34;</span>,
  <span style="color:#008000;font-weight:bold">&#34;kind&#34;</span>: <span style="color:#b44">&#34;AdmissionReview&#34;</span>,
  <span style="color:#008000;font-weight:bold">&#34;response&#34;</span>: {
    <span style="color:#008000;font-weight:bold">&#34;uid&#34;</span>: <span style="color:#b44">&#34;&lt;value from request.uid&gt;&#34;</span>,
    <span style="color:#008000;font-weight:bold">&#34;allowed&#34;</span>: <span style="color:#a2f;font-weight:bold">false</span>
  }
}</code></pre></div>
    

<p></div></p>

<div id="admissionreview-response-forbid-minimal-1">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#008000;font-weight:bold">&#34;apiVersion&#34;</span>: <span style="color:#b44">&#34;admission.k8s.io/v1beta1&#34;</span>,
  <span style="color:#008000;font-weight:bold">&#34;kind&#34;</span>: <span style="color:#b44">&#34;AdmissionReview&#34;</span>,
  <span style="color:#008000;font-weight:bold">&#34;response&#34;</span>: {
    <span style="color:#008000;font-weight:bold">&#34;uid&#34;</span>: <span style="color:#b44">&#34;&lt;value from request.uid&gt;&#34;</span>,
    <span style="color:#008000;font-weight:bold">&#34;allowed&#34;</span>: <span style="color:#a2f;font-weight:bold">false</span>
  }
}</code></pre></div>
    

<p></div></p>

<p></div></p>

<script>$(function(){$("#admissionreview-response-forbid-minimal").tabs();});</script>

<p>When rejecting a request, the webhook can customize the http code and message returned to the user using the <code>status</code> field.
The specified status object is returned to the user.
See the <a href="/docs/reference/generated/kubernetes-api/v1.14/#status-v1-meta">API documentation</a> for details about the status type.
Example of a response to forbid a request, customizing the HTTP status code and message presented to the user:</p>

<div id="admissionreview-response-forbid-details">
<ul>
    
      
  <li><a href="#admissionreview-response-forbid-details-0">admission.k8s.io/v1</a></li>

      
  <li><a href="#admissionreview-response-forbid-details-1">admission.k8s.io/v1beta1</a></li>

</ul>


<div id="admissionreview-response-forbid-details-0">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#008000;font-weight:bold">&#34;apiVersion&#34;</span>: <span style="color:#b44">&#34;admission.k8s.io/v1&#34;</span>,
  <span style="color:#008000;font-weight:bold">&#34;kind&#34;</span>: <span style="color:#b44">&#34;AdmissionReview&#34;</span>,
  <span style="color:#008000;font-weight:bold">&#34;response&#34;</span>: {
    <span style="color:#008000;font-weight:bold">&#34;uid&#34;</span>: <span style="color:#b44">&#34;&lt;value from request.uid&gt;&#34;</span>,
    <span style="color:#008000;font-weight:bold">&#34;allowed&#34;</span>: <span style="color:#a2f;font-weight:bold">false</span>,
    <span style="color:#008000;font-weight:bold">&#34;status&#34;</span>: {
      <span style="color:#008000;font-weight:bold">&#34;code&#34;</span>: <span style="color:#666">403</span>,
      <span style="color:#008000;font-weight:bold">&#34;message&#34;</span>: <span style="color:#b44">&#34;You cannot do this because it is Tuesday and your name starts with A&#34;</span>
    }
  }
}</code></pre></div>
    

<p></div></p>

<div id="admissionreview-response-forbid-details-1">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#008000;font-weight:bold">&#34;apiVersion&#34;</span>: <span style="color:#b44">&#34;admission.k8s.io/v1beta1&#34;</span>,
  <span style="color:#008000;font-weight:bold">&#34;kind&#34;</span>: <span style="color:#b44">&#34;AdmissionReview&#34;</span>,
  <span style="color:#008000;font-weight:bold">&#34;response&#34;</span>: {
    <span style="color:#008000;font-weight:bold">&#34;uid&#34;</span>: <span style="color:#b44">&#34;&lt;value from request.uid&gt;&#34;</span>,
    <span style="color:#008000;font-weight:bold">&#34;allowed&#34;</span>: <span style="color:#a2f;font-weight:bold">false</span>,
    <span style="color:#008000;font-weight:bold">&#34;status&#34;</span>: {
      <span style="color:#008000;font-weight:bold">&#34;code&#34;</span>: <span style="color:#666">403</span>,
      <span style="color:#008000;font-weight:bold">&#34;message&#34;</span>: <span style="color:#b44">&#34;You cannot do this because it is Tuesday and your name starts with A&#34;</span>
    }
  }
}</code></pre></div>
    

<p></div></p>

<p></div></p>

<script>$(function(){$("#admissionreview-response-forbid-details").tabs();});</script>

<p>When allowing a request, a mutating admission webhook may optionally modify the incoming object as well.
This is done using the <code>patch</code> and <code>patchType</code> fields in the response.
The only currently supported <code>patchType</code> is <code>JSONPatch</code>.
See <a href="http://jsonpatch.com/" target="_blank">JSON patch</a> documentation for more details.
For <code>patchType: JSONPatch</code>, the <code>patch</code> field contains a base64-encoded array of JSON patch operations.</p>

<p>As an example, a single patch operation that would set <code>spec.replicas</code> would be <code>[{&quot;op&quot;: &quot;add&quot;, &quot;path&quot;: &quot;/spec/replicas&quot;, &quot;value&quot;: 3}]</code></p>

<p>Base64-encoded, this would be <code>W3sib3AiOiAiYWRkIiwgInBhdGgiOiAiL3NwZWMvcmVwbGljYXMiLCAidmFsdWUiOiAzfV0=</code></p>

<p>So a webhook response to add that label would be:</p>

<div id="admissionreview-response-modify">
<ul>
    
      
  <li><a href="#admissionreview-response-modify-0">admission.k8s.io/v1</a></li>

      
  <li><a href="#admissionreview-response-modify-1">admission.k8s.io/v1beta1</a></li>

</ul>


<div id="admissionreview-response-modify-0">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#008000;font-weight:bold">&#34;apiVersion&#34;</span>: <span style="color:#b44">&#34;admission.k8s.io/v1&#34;</span>,
  <span style="color:#008000;font-weight:bold">&#34;kind&#34;</span>: <span style="color:#b44">&#34;AdmissionReview&#34;</span>,
  <span style="color:#008000;font-weight:bold">&#34;response&#34;</span>: {
    <span style="color:#008000;font-weight:bold">&#34;uid&#34;</span>: <span style="color:#b44">&#34;&lt;value from request.uid&gt;&#34;</span>,
    <span style="color:#008000;font-weight:bold">&#34;allowed&#34;</span>: <span style="color:#a2f;font-weight:bold">true</span>,
    <span style="color:#008000;font-weight:bold">&#34;patchType&#34;</span>: <span style="color:#b44">&#34;JSONPatch&#34;</span>,
    <span style="color:#008000;font-weight:bold">&#34;patch&#34;</span>: <span style="color:#b44">&#34;W3sib3AiOiAiYWRkIiwgInBhdGgiOiAiL3NwZWMvcmVwbGljYXMiLCAidmFsdWUiOiAzfV0=&#34;</span>
  }
}</code></pre></div>
    

<p></div></p>

<div id="admissionreview-response-modify-1">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#008000;font-weight:bold">&#34;apiVersion&#34;</span>: <span style="color:#b44">&#34;admission.k8s.io/v1beta1&#34;</span>,
  <span style="color:#008000;font-weight:bold">&#34;kind&#34;</span>: <span style="color:#b44">&#34;AdmissionReview&#34;</span>,
  <span style="color:#008000;font-weight:bold">&#34;response&#34;</span>: {
    <span style="color:#008000;font-weight:bold">&#34;uid&#34;</span>: <span style="color:#b44">&#34;&lt;value from request.uid&gt;&#34;</span>,
    <span style="color:#008000;font-weight:bold">&#34;allowed&#34;</span>: <span style="color:#a2f;font-weight:bold">true</span>,
    <span style="color:#008000;font-weight:bold">&#34;patchType&#34;</span>: <span style="color:#b44">&#34;JSONPatch&#34;</span>,
    <span style="color:#008000;font-weight:bold">&#34;patch&#34;</span>: <span style="color:#b44">&#34;W3sib3AiOiAiYWRkIiwgInBhdGgiOiAiL3NwZWMvcmVwbGljYXMiLCAidmFsdWUiOiAzfV0=&#34;</span>
  }
}</code></pre></div>
    

<p></div></p>

<p></div></p>

<script>$(function(){$("#admissionreview-response-modify").tabs();});</script>

<h2 id="webhook-configuration">Webhook configuration</h2>

<p>To register admission webhooks, create <code>MutatingWebhookConfiguration</code> or <code>ValidatingWebhookConfiguration</code> API objects.
The name of a <code>MutatingWebhookConfiguration</code> or a <code>ValidatingWebhookConfiguration</code> object must be a valid
<a href="/docs/concepts/overview/working-with-objects/names#dns-subdomain-names">DNS subdomain name</a>.</p>

<p>Each configuration can contain one or more webhooks.
If multiple webhooks are specified in a single configuration, each should be given a unique name.
This is required in <code>admissionregistration.k8s.io/v1</code>, but strongly recommended when using <code>admissionregistration.k8s.io/v1beta1</code>,
in order to make resulting audit logs and metrics easier to match up to active configurations.</p>

<p>Each webhook defines the following things.</p>

<h3 id="matching-requests-rules">Matching requests: rules</h3>

<p>Each webhook must specify a list of rules used to determine if a request to the API server should be sent to the webhook.
Each rule specifies one or more operations, apiGroups, apiVersions, and resources, and a resource scope:</p>

<ul>
<li><code>operations</code> lists one or more operations to match. Can be <code>&quot;CREATE&quot;</code>, <code>&quot;UPDATE&quot;</code>, <code>&quot;DELETE&quot;</code>, <code>&quot;CONNECT&quot;</code>, or <code>&quot;*&quot;</code> to match all.</li>
<li><code>apiGroups</code> lists one or more API groups to match. <code>&quot;&quot;</code> is the core API group. <code>&quot;*&quot;</code> matches all API groups.</li>
<li><code>apiVersions</code> lists one or more API versions to match. <code>&quot;*&quot;</code> matches all API versions.</li>
<li><code>resources</code> lists one or more resources to match.

<ul>
<li><code>&quot;*&quot;</code> matches all resources, but not subresources.</li>
<li><code>&quot;*/*&quot;</code> matches all resources and subresources.</li>
<li><code>&quot;pods/*&quot;</code> matches all subresources of pods.</li>
<li><code>&quot;*/status&quot;</code> matches all status subresources.</li>
</ul></li>
<li><code>scope</code> specifies a scope to match. Valid values are <code>&quot;Cluster&quot;</code>, <code>&quot;Namespaced&quot;</code>, and <code>&quot;*&quot;</code>. Subresources match the scope of their parent resource. Supported in v1.14+. Default is <code>&quot;*&quot;</code>, matching pre-1.14 behavior.

<ul>
<li><code>&quot;Cluster&quot;</code> means that only cluster-scoped resources will match this rule (Namespace API objects are cluster-scoped).</li>
<li><code>&quot;Namespaced&quot;</code> means that only namespaced resources will match this rule.</li>
<li><code>&quot;*&quot;</code> means that there are no scope restrictions.</li>
</ul></li>
</ul>

<p>If an incoming request matches one of the specified operations, groups, versions, resources, and scope for any of a webhook&rsquo;s rules, the request is sent to the webhook.</p>

<p>Here are other examples of rules that could be used to specify which resources should be intercepted.</p>

<p>Match <code>CREATE</code> or <code>UPDATE</code> requests to <code>apps/v1</code> and <code>apps/v1beta1</code> <code>deployments</code> and <code>replicasets</code>:</p>

<div id="validatingwebhookconfiguration-rules-1">
<ul>
    
      
  <li><a href="#validatingwebhookconfiguration-rules-1-0">admissionregistration.k8s.io/v1</a></li>

      
  <li><a href="#validatingwebhookconfiguration-rules-1-1">admissionregistration.k8s.io/v1beta1</a></li>

</ul>


<div id="validatingwebhookconfiguration-rules-1-0">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>admissionregistration.k8s.io/v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>ValidatingWebhookConfiguration<span style="color:#bbb">
</span><span style="color:#bbb"></span>...<span style="color:#bbb">
</span><span style="color:#bbb"></span>webhooks:<span style="color:#bbb">
</span><span style="color:#bbb"></span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>my-webhook.example.com<span style="color:#bbb">
</span><span style="color:#bbb">  </span>rules:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>operations:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;CREATE&#34;</span>,<span style="color:#bbb"> </span><span style="color:#b44">&#34;UPDATE&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>apiGroups:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;apps&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>apiVersions:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;v1&#34;</span>,<span style="color:#bbb"> </span><span style="color:#b44">&#34;v1beta1&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>resources:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;deployments&#34;</span>,<span style="color:#bbb"> </span><span style="color:#b44">&#34;replicasets&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>scope:<span style="color:#bbb"> </span><span style="color:#b44">&#34;Namespaced&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>...</code></pre></div>
    

<p></div></p>

<div id="validatingwebhookconfiguration-rules-1-1">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#080;font-style:italic"># Deprecated in v1.16 in favor of admissionregistration.k8s.io/v1</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>apiVersion:<span style="color:#bbb"> </span>admissionregistration.k8s.io/v1beta1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>ValidatingWebhookConfiguration<span style="color:#bbb">
</span><span style="color:#bbb"></span>...<span style="color:#bbb">
</span><span style="color:#bbb"></span>webhooks:<span style="color:#bbb">
</span><span style="color:#bbb"></span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>my-webhook.example.com<span style="color:#bbb">
</span><span style="color:#bbb">  </span>rules:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>operations:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;CREATE&#34;</span>,<span style="color:#bbb"> </span><span style="color:#b44">&#34;UPDATE&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>apiGroups:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;apps&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>apiVersions:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;v1&#34;</span>,<span style="color:#bbb"> </span><span style="color:#b44">&#34;v1beta1&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>resources:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;deployments&#34;</span>,<span style="color:#bbb"> </span><span style="color:#b44">&#34;replicasets&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>scope:<span style="color:#bbb"> </span><span style="color:#b44">&#34;Namespaced&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>...</code></pre></div>
    

<p></div></p>

<p></div></p>

<script>$(function(){$("#validatingwebhookconfiguration-rules-1").tabs();});</script>

<p>Match create requests for all resources (but not subresources) in all API groups and versions:</p>

<div id="validatingwebhookconfiguration-rules-2">
<ul>
    
      
  <li><a href="#validatingwebhookconfiguration-rules-2-0">admissionregistration.k8s.io/v1</a></li>

      
  <li><a href="#validatingwebhookconfiguration-rules-2-1">admissionregistration.k8s.io/v1beta1</a></li>

</ul>


<div id="validatingwebhookconfiguration-rules-2-0">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>admissionregistration.k8s.io/v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>ValidatingWebhookConfiguration<span style="color:#bbb">
</span><span style="color:#bbb"></span>...<span style="color:#bbb">
</span><span style="color:#bbb"></span>webhooks:<span style="color:#bbb">
</span><span style="color:#bbb"></span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>my-webhook.example.com<span style="color:#bbb">
</span><span style="color:#bbb">  </span>rules:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>operations:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;CREATE&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>apiGroups:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;*&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>apiVersions:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;*&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>resources:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;*&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>scope:<span style="color:#bbb"> </span><span style="color:#b44">&#34;*&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>...</code></pre></div>
    

<p></div></p>

<div id="validatingwebhookconfiguration-rules-2-1">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#080;font-style:italic"># Deprecated in v1.16 in favor of admissionregistration.k8s.io/v1</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>apiVersion:<span style="color:#bbb"> </span>admissionregistration.k8s.io/v1beta1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>ValidatingWebhookConfiguration<span style="color:#bbb">
</span><span style="color:#bbb"></span>...<span style="color:#bbb">
</span><span style="color:#bbb"></span>webhooks:<span style="color:#bbb">
</span><span style="color:#bbb"></span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>my-webhook.example.com<span style="color:#bbb">
</span><span style="color:#bbb">  </span>rules:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>operations:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;CREATE&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>apiGroups:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;*&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>apiVersions:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;*&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>resources:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;*&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>scope:<span style="color:#bbb"> </span><span style="color:#b44">&#34;*&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>...</code></pre></div>
    

<p></div></p>

<p></div></p>

<script>$(function(){$("#validatingwebhookconfiguration-rules-2").tabs();});</script>

<p>Match update requests for all <code>status</code> subresources in all API groups and versions:</p>

<div id="validatingwebhookconfiguration-rules-3">
<ul>
    
      
  <li><a href="#validatingwebhookconfiguration-rules-3-0">admissionregistration.k8s.io/v1</a></li>

      
  <li><a href="#validatingwebhookconfiguration-rules-3-1">admissionregistration.k8s.io/v1beta1</a></li>

</ul>


<div id="validatingwebhookconfiguration-rules-3-0">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>admissionregistration.k8s.io/v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>ValidatingWebhookConfiguration<span style="color:#bbb">
</span><span style="color:#bbb"></span>...<span style="color:#bbb">
</span><span style="color:#bbb"></span>webhooks:<span style="color:#bbb">
</span><span style="color:#bbb"></span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>my-webhook.example.com<span style="color:#bbb">
</span><span style="color:#bbb">  </span>rules:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>operations:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;UPDATE&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>apiGroups:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;*&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>apiVersions:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;*&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>resources:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;*/status&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>scope:<span style="color:#bbb"> </span><span style="color:#b44">&#34;*&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>...</code></pre></div>
    

<p></div></p>

<div id="validatingwebhookconfiguration-rules-3-1">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#080;font-style:italic"># Deprecated in v1.16 in favor of admissionregistration.k8s.io/v1</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>apiVersion:<span style="color:#bbb"> </span>admissionregistration.k8s.io/v1beta1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>ValidatingWebhookConfiguration<span style="color:#bbb">
</span><span style="color:#bbb"></span>...<span style="color:#bbb">
</span><span style="color:#bbb"></span>webhooks:<span style="color:#bbb">
</span><span style="color:#bbb"></span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>my-webhook.example.com<span style="color:#bbb">
</span><span style="color:#bbb">  </span>rules:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>operations:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;UPDATE&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>apiGroups:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;*&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>apiVersions:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;*&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>resources:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;*/status&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>scope:<span style="color:#bbb"> </span><span style="color:#b44">&#34;*&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>...</code></pre></div>
    

<p></div></p>

<p></div></p>

<script>$(function(){$("#validatingwebhookconfiguration-rules-3").tabs();});</script>

<h3 id="matching-requests-objectselector">Matching requests: objectSelector</h3>

<p>In v1.15+, webhooks may optionally limit which requests are intercepted based on the labels of the
objects they would be sent, by specifying an <code>objectSelector</code>. If specified, the objectSelector
is evaluated against both the object and oldObject that would be sent to the webhook,
and is considered to match if either object matches the selector.</p>

<p>A null object (oldObject in the case of create, or newObject in the case of delete),
or an object that cannot have labels (like a <code>DeploymentRollback</code> or a <code>PodProxyOptions</code> object)
is not considered to match.</p>

<p>Use the object selector only if the webhook is opt-in, because end users may skip the admission webhook by setting the labels.</p>

<p>This example shows a mutating webhook that would match a <code>CREATE</code> of any resource with the label <code>foo: bar</code>:</p>

<div id="objectselector-example">
<ul>
    
      
  <li><a href="#objectselector-example-0">admissionregistration.k8s.io/v1</a></li>

      
  <li><a href="#objectselector-example-1">admissionregistration.k8s.io/v1beta1</a></li>

</ul>


<div id="objectselector-example-0">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>admissionregistration.k8s.io/v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>MutatingWebhookConfiguration<span style="color:#bbb">
</span><span style="color:#bbb"></span>...<span style="color:#bbb">
</span><span style="color:#bbb"></span>webhooks:<span style="color:#bbb">
</span><span style="color:#bbb"></span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>my-webhook.example.com<span style="color:#bbb">
</span><span style="color:#bbb">  </span>objectSelector:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>matchLabels:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>foo:<span style="color:#bbb"> </span>bar<span style="color:#bbb">
</span><span style="color:#bbb">  </span>rules:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>operations:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;CREATE&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>apiGroups:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;*&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>apiVersions:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;*&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>resources:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;*&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>scope:<span style="color:#bbb"> </span><span style="color:#b44">&#34;*&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>...</code></pre></div>
    

<p></div></p>

<div id="objectselector-example-1">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#080;font-style:italic"># Deprecated in v1.16 in favor of admissionregistration.k8s.io/v1</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>apiVersion:<span style="color:#bbb"> </span>admissionregistration.k8s.io/v1beta1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>MutatingWebhookConfiguration<span style="color:#bbb">
</span><span style="color:#bbb"></span>...<span style="color:#bbb">
</span><span style="color:#bbb"></span>webhooks:<span style="color:#bbb">
</span><span style="color:#bbb"></span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>my-webhook.example.com<span style="color:#bbb">
</span><span style="color:#bbb">  </span>objectSelector:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>matchLabels:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>foo:<span style="color:#bbb"> </span>bar<span style="color:#bbb">
</span><span style="color:#bbb">  </span>rules:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>operations:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;CREATE&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>apiGroups:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;*&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>apiVersions:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;*&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>resources:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;*&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>scope:<span style="color:#bbb"> </span><span style="color:#b44">&#34;*&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>...</code></pre></div>
    

<p></div></p>

<p></div></p>

<script>$(function(){$("#objectselector-example").tabs();});</script>

<p>See <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels" target="_blank">https://kubernetes.io/docs/concepts/overview/working-with-objects/labels</a> for more examples of label selectors.</p>

<h3 id="matching-requests-namespaceselector">Matching requests: namespaceSelector</h3>

<p>Webhooks may optionally limit which requests for namespaced resources are intercepted,
based on the labels of the containing namespace, by specifying a <code>namespaceSelector</code>.</p>

<p>The <code>namespaceSelector</code> decides whether to run the webhook on a request for a namespaced resource
(or a Namespace object), based on whether the namespace&rsquo;s labels match the selector.
If the object itself is a namespace, the matching is performed on object.metadata.labels.
If the object is a cluster scoped resource other than a Namespace, <code>namespaceSelector</code> has no effect.</p>

<p>This example shows a mutating webhook that matches a <code>CREATE</code> of any namespaced resource inside a namespace
that does not have a &ldquo;runlevel&rdquo; label of &ldquo;0&rdquo; or &ldquo;1&rdquo;:</p>

<div id="mutatingwebhookconfiguration-namespaceselector-1">
<ul>
    
      
  <li><a href="#mutatingwebhookconfiguration-namespaceselector-1-0">admissionregistration.k8s.io/v1</a></li>

      
  <li><a href="#mutatingwebhookconfiguration-namespaceselector-1-1">admissionregistration.k8s.io/v1beta1</a></li>

</ul>


<div id="mutatingwebhookconfiguration-namespaceselector-1-0">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>admissionregistration.k8s.io/v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>MutatingWebhookConfiguration<span style="color:#bbb">
</span><span style="color:#bbb"></span>...<span style="color:#bbb">
</span><span style="color:#bbb"></span>webhooks:<span style="color:#bbb">
</span><span style="color:#bbb"></span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>my-webhook.example.com<span style="color:#bbb">
</span><span style="color:#bbb">  </span>namespaceSelector:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>matchExpressions:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-<span style="color:#bbb"> </span>key:<span style="color:#bbb"> </span>runlevel<span style="color:#bbb">
</span><span style="color:#bbb">      </span>operator:<span style="color:#bbb"> </span>NotIn<span style="color:#bbb">
</span><span style="color:#bbb">      </span>values:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;0&#34;</span>,<span style="color:#b44">&#34;1&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">  </span>rules:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>operations:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;CREATE&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>apiGroups:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;*&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>apiVersions:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;*&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>resources:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;*&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>scope:<span style="color:#bbb"> </span><span style="color:#b44">&#34;Namespaced&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>...</code></pre></div>
    

<p></div></p>

<div id="mutatingwebhookconfiguration-namespaceselector-1-1">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#080;font-style:italic"># Deprecated in v1.16 in favor of admissionregistration.k8s.io/v1</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>apiVersion:<span style="color:#bbb"> </span>admissionregistration.k8s.io/v1beta1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>MutatingWebhookConfiguration<span style="color:#bbb">
</span><span style="color:#bbb"></span>...<span style="color:#bbb">
</span><span style="color:#bbb"></span>webhooks:<span style="color:#bbb">
</span><span style="color:#bbb"></span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>my-webhook.example.com<span style="color:#bbb">
</span><span style="color:#bbb">  </span>namespaceSelector:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>matchExpressions:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-<span style="color:#bbb"> </span>key:<span style="color:#bbb"> </span>runlevel<span style="color:#bbb">
</span><span style="color:#bbb">      </span>operator:<span style="color:#bbb"> </span>NotIn<span style="color:#bbb">
</span><span style="color:#bbb">      </span>values:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;0&#34;</span>,<span style="color:#b44">&#34;1&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">  </span>rules:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>operations:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;CREATE&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>apiGroups:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;*&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>apiVersions:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;*&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>resources:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;*&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>scope:<span style="color:#bbb"> </span><span style="color:#b44">&#34;Namespaced&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>...</code></pre></div>
    

<p></div></p>

<p></div></p>

<script>$(function(){$("#mutatingwebhookconfiguration-namespaceselector-1").tabs();});</script>

<p>This example shows a validating webhook that matches a <code>CREATE</code> of any namespaced resource inside a namespace
that is associated with the &ldquo;environment&rdquo; of &ldquo;prod&rdquo; or &ldquo;staging&rdquo;:</p>

<div id="validatingwebhookconfiguration-namespaceselector-2">
<ul>
    
      
  <li><a href="#validatingwebhookconfiguration-namespaceselector-2-0">admissionregistration.k8s.io/v1</a></li>

      
  <li><a href="#validatingwebhookconfiguration-namespaceselector-2-1">admissionregistration.k8s.io/v1beta1</a></li>

</ul>


<div id="validatingwebhookconfiguration-namespaceselector-2-0">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>admissionregistration.k8s.io/v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>ValidatingWebhookConfiguration<span style="color:#bbb">
</span><span style="color:#bbb"></span>...<span style="color:#bbb">
</span><span style="color:#bbb"></span>webhooks:<span style="color:#bbb">
</span><span style="color:#bbb"></span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>my-webhook.example.com<span style="color:#bbb">
</span><span style="color:#bbb">  </span>namespaceSelector:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>matchExpressions:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-<span style="color:#bbb"> </span>key:<span style="color:#bbb"> </span>environment<span style="color:#bbb">
</span><span style="color:#bbb">      </span>operator:<span style="color:#bbb"> </span>In<span style="color:#bbb">
</span><span style="color:#bbb">      </span>values:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;prod&#34;</span>,<span style="color:#b44">&#34;staging&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">  </span>rules:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>operations:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;CREATE&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>apiGroups:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;*&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>apiVersions:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;*&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>resources:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;*&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>scope:<span style="color:#bbb"> </span><span style="color:#b44">&#34;Namespaced&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>...</code></pre></div>
    

<p></div></p>

<div id="validatingwebhookconfiguration-namespaceselector-2-1">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#080;font-style:italic"># Deprecated in v1.16 in favor of admissionregistration.k8s.io/v1</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>apiVersion:<span style="color:#bbb"> </span>admissionregistration.k8s.io/v1beta1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>ValidatingWebhookConfiguration<span style="color:#bbb">
</span><span style="color:#bbb"></span>...<span style="color:#bbb">
</span><span style="color:#bbb"></span>webhooks:<span style="color:#bbb">
</span><span style="color:#bbb"></span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>my-webhook.example.com<span style="color:#bbb">
</span><span style="color:#bbb">  </span>namespaceSelector:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>matchExpressions:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-<span style="color:#bbb"> </span>key:<span style="color:#bbb"> </span>environment<span style="color:#bbb">
</span><span style="color:#bbb">      </span>operator:<span style="color:#bbb"> </span>In<span style="color:#bbb">
</span><span style="color:#bbb">      </span>values:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;prod&#34;</span>,<span style="color:#b44">&#34;staging&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">  </span>rules:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>operations:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;CREATE&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>apiGroups:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;*&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>apiVersions:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;*&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>resources:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;*&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>scope:<span style="color:#bbb"> </span><span style="color:#b44">&#34;Namespaced&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>...</code></pre></div>
    

<p></div></p>

<p></div></p>

<script>$(function(){$("#validatingwebhookconfiguration-namespaceselector-2").tabs();});</script>

<p>See <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels" target="_blank">https://kubernetes.io/docs/concepts/overview/working-with-objects/labels</a> for more examples of label selectors.</p>

<h3 id="matching-requests-matchpolicy">Matching requests: matchPolicy</h3>

<p>API servers can make objects available via multiple API groups or versions.
For example, the Kubernetes API server allows creating and modifying <code>Deployment</code> objects
via <code>extensions/v1beta1</code>, <code>apps/v1beta1</code>, <code>apps/v1beta2</code>, and <code>apps/v1</code> APIs.</p>

<p>For example, if a webhook only specified a rule for some API groups/versions (like <code>apiGroups:[&quot;apps&quot;], apiVersions:[&quot;v1&quot;,&quot;v1beta1&quot;]</code>),
and a request was made to modify the resource via another API group/version (like <code>extensions/v1beta1</code>),
the request would not be sent to the webhook.</p>

<p>In v1.15+, <code>matchPolicy</code> lets a webhook define how its <code>rules</code> are used to match incoming requests.
Allowed values are <code>Exact</code> or <code>Equivalent</code>.</p>

<ul>
<li><code>Exact</code> means a request should be intercepted only if it exactly matches a specified rule.</li>
<li><code>Equivalent</code> means a request should be intercepted if modifies a resource listed in <code>rules</code>, even via another API group or version.</li>
</ul>

<p>In the example given above, the webhook that only registered for <code>apps/v1</code> could use <code>matchPolicy</code>:</p>

<ul>
<li><code>matchPolicy: Exact</code> would mean the <code>extensions/v1beta1</code> request would not be sent to the webhook</li>
<li><code>matchPolicy: Equivalent</code> means the <code>extensions/v1beta1</code> request would be sent to the webhook (with the objects converted to a version the webhook had specified: <code>apps/v1</code>)</li>
</ul>

<p>Specifying <code>Equivalent</code> is recommended, and ensures that webhooks continue to intercept the
resources they expect when upgrades enable new versions of the resource in the API server.</p>

<p>When a resource stops being served by the API server, it is no longer considered equivalent to other versions of that resource that are still served.
For example, <code>extensions/v1beta1</code> deployments were first deprecated and then removed (in Kubernetes v1.16).</p>

<p>Since that removal, a webhook with a <code>apiGroups:[&quot;extensions&quot;], apiVersions:[&quot;v1beta1&quot;], resources:[&quot;deployments&quot;]</code> rule
does not intercept deployments created via <code>apps/v1</code> APIs. For that reason, webhooks should prefer registering
for stable versions of resources.</p>

<p>This example shows a validating webhook that intercepts modifications to deployments (no matter the API group or version),
and is always sent an <code>apps/v1</code> <code>Deployment</code> object:</p>

<div id="validatingwebhookconfiguration-matchpolicy">
<ul>
    
      
  <li><a href="#validatingwebhookconfiguration-matchpolicy-0">admissionregistration.k8s.io/v1</a></li>

      
  <li><a href="#validatingwebhookconfiguration-matchpolicy-1">admissionregistration.k8s.io/v1beta1</a></li>

</ul>


<div id="validatingwebhookconfiguration-matchpolicy-0">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>admissionregistration.k8s.io/v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>ValidatingWebhookConfiguration<span style="color:#bbb">
</span><span style="color:#bbb"></span>...<span style="color:#bbb">
</span><span style="color:#bbb"></span>webhooks:<span style="color:#bbb">
</span><span style="color:#bbb"></span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>my-webhook.example.com<span style="color:#bbb">
</span><span style="color:#bbb">  </span>matchPolicy:<span style="color:#bbb"> </span>Equivalent<span style="color:#bbb">
</span><span style="color:#bbb">  </span>rules:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>operations:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;CREATE&#34;</span>,<span style="color:#b44">&#34;UPDATE&#34;</span>,<span style="color:#b44">&#34;DELETE&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>apiGroups:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;apps&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>apiVersions:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;v1&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>resources:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;deployments&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>scope:<span style="color:#bbb"> </span><span style="color:#b44">&#34;Namespaced&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>...</code></pre></div>
<p>Admission webhooks created using <code>admissionregistration.k8s.io/v1</code> default to <code>Equivalent</code>.</p>

    
</div>

<div id="validatingwebhookconfiguration-matchpolicy-1">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#080;font-style:italic"># Deprecated in v1.16 in favor of admissionregistration.k8s.io/v1</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>apiVersion:<span style="color:#bbb"> </span>admissionregistration.k8s.io/v1beta1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>ValidatingWebhookConfiguration<span style="color:#bbb">
</span><span style="color:#bbb"></span>...<span style="color:#bbb">
</span><span style="color:#bbb"></span>webhooks:<span style="color:#bbb">
</span><span style="color:#bbb"></span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>my-webhook.example.com<span style="color:#bbb">
</span><span style="color:#bbb">  </span>matchPolicy:<span style="color:#bbb"> </span>Equivalent<span style="color:#bbb">
</span><span style="color:#bbb">  </span>rules:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>operations:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;CREATE&#34;</span>,<span style="color:#b44">&#34;UPDATE&#34;</span>,<span style="color:#b44">&#34;DELETE&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>apiGroups:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;apps&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>apiVersions:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;v1&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>resources:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;deployments&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>scope:<span style="color:#bbb"> </span><span style="color:#b44">&#34;Namespaced&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>...</code></pre></div>
<p>Admission webhooks created using <code>admissionregistration.k8s.io/v1beta1</code> default to <code>Exact</code>.</p>

    
</div>

<p></div></p>

<script>$(function(){$("#validatingwebhookconfiguration-matchpolicy").tabs();});</script>

<h3 id="contacting-the-webhook">Contacting the webhook</h3>

<p>Once the API server has determined a request should be sent to a webhook,
it needs to know how to contact the webhook. This is specified in the <code>clientConfig</code>
stanza of the webhook configuration.</p>

<p>Webhooks can either be called via a URL or a service reference,
and can optionally include a custom CA bundle to use to verify the TLS connection.</p>

<h4 id="url">URL</h4>

<p><code>url</code> gives the location of the webhook, in standard URL form
(<code>scheme://host:port/path</code>).</p>

<p>The <code>host</code> should not refer to a service running in the cluster; use
a service reference by specifying the <code>service</code> field instead.
The host might be resolved via external DNS in some apiservers
(e.g., <code>kube-apiserver</code> cannot resolve in-cluster DNS as that would
be a layering violation). <code>host</code> may also be an IP address.</p>

<p>Please note that using <code>localhost</code> or <code>127.0.0.1</code> as a <code>host</code> is
risky unless you take great care to run this webhook on all hosts
which run an apiserver which might need to make calls to this
webhook. Such installs are likely to be non-portable, i.e., not easy
to turn up in a new cluster.</p>

<p>The scheme must be &ldquo;https&rdquo;; the URL must begin with &ldquo;https://&ldquo;.</p>

<p>Attempting to use a user or basic auth (for example &ldquo;user:password@&ldquo;) is not allowed.
Fragments (&ldquo;#&hellip;&rdquo;) and query parameters (&ldquo;?&hellip;&rdquo;) are also not allowed.</p>

<p>Here is an example of a mutating webhook configured to call a URL
(and expects the TLS certificate to be verified using system trust roots, so does not specify a caBundle):</p>

<div id="mutatingwebhookconfiguration-url">
<ul>
    
      
  <li><a href="#mutatingwebhookconfiguration-url-0">admissionregistration.k8s.io/v1</a></li>

      
  <li><a href="#mutatingwebhookconfiguration-url-1">admissionregistration.k8s.io/v1beta1</a></li>

</ul>


<div id="mutatingwebhookconfiguration-url-0">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>admissionregistration.k8s.io/v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>MutatingWebhookConfiguration<span style="color:#bbb">
</span><span style="color:#bbb"></span>...<span style="color:#bbb">
</span><span style="color:#bbb"></span>webhooks:<span style="color:#bbb">
</span><span style="color:#bbb"></span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>my-webhook.example.com<span style="color:#bbb">
</span><span style="color:#bbb">  </span>clientConfig:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>url:<span style="color:#bbb"> </span><span style="color:#b44">&#34;https://my-webhook.example.com:9443/my-webhook-path&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>...</code></pre></div>
    

<p></div></p>

<div id="mutatingwebhookconfiguration-url-1">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#080;font-style:italic"># Deprecated in v1.16 in favor of admissionregistration.k8s.io/v1</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>apiVersion:<span style="color:#bbb"> </span>admissionregistration.k8s.io/v1beta1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>MutatingWebhookConfiguration<span style="color:#bbb">
</span><span style="color:#bbb"></span>...<span style="color:#bbb">
</span><span style="color:#bbb"></span>webhooks:<span style="color:#bbb">
</span><span style="color:#bbb"></span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>my-webhook.example.com<span style="color:#bbb">
</span><span style="color:#bbb">  </span>clientConfig:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>url:<span style="color:#bbb"> </span><span style="color:#b44">&#34;https://my-webhook.example.com:9443/my-webhook-path&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>...</code></pre></div>
    

<p></div></p>

<p></div></p>

<script>$(function(){$("#mutatingwebhookconfiguration-url").tabs();});</script>

<h4 id="service-reference">Service reference</h4>

<p>The <code>service</code> stanza inside <code>clientConfig</code> is a reference to the service for this webhook.
If the webhook is running within the cluster, then you should use <code>service</code> instead of <code>url</code>.
The service namespace and name are required. The port is optional and defaults to 443.
The path is optional and defaults to &ldquo;/&rdquo;.</p>

<p>Here is an example of a mutating webhook configured to call a service on port &ldquo;1234&rdquo;
at the subpath &ldquo;/my-path&rdquo;, and to verify the TLS connection against the ServerName
<code>my-service-name.my-service-namespace.svc</code> using a custom CA bundle:</p>

<div id="mutatingwebhookconfiguration-service">
<ul>
    
      
  <li><a href="#mutatingwebhookconfiguration-service-0">admissionregistration.k8s.io/v1</a></li>

      
  <li><a href="#mutatingwebhookconfiguration-service-1">admissionregistration.k8s.io/v1beta1</a></li>

</ul>


<div id="mutatingwebhookconfiguration-service-0">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>admissionregistration.k8s.io/v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>MutatingWebhookConfiguration<span style="color:#bbb">
</span><span style="color:#bbb"></span>...<span style="color:#bbb">
</span><span style="color:#bbb"></span>webhooks:<span style="color:#bbb">
</span><span style="color:#bbb"></span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>my-webhook.example.com<span style="color:#bbb">
</span><span style="color:#bbb">  </span>clientConfig:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>caBundle:<span style="color:#bbb"> </span><span style="color:#b44">&#34;Ci0tLS0tQk...&lt;base64-encoded PEM bundle containing the CA that signed the webhook&#39;s serving certificate&gt;...tLS0K&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>service:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>namespace:<span style="color:#bbb"> </span>my-service-namespace<span style="color:#bbb">
</span><span style="color:#bbb">      </span>name:<span style="color:#bbb"> </span>my-service-name<span style="color:#bbb">
</span><span style="color:#bbb">      </span>path:<span style="color:#bbb"> </span>/my-path<span style="color:#bbb">
</span><span style="color:#bbb">      </span>port:<span style="color:#bbb"> </span><span style="color:#666">1234</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>...</code></pre></div>
    

<p></div></p>

<div id="mutatingwebhookconfiguration-service-1">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#080;font-style:italic"># Deprecated in v1.16 in favor of admissionregistration.k8s.io/v1</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>apiVersion:<span style="color:#bbb"> </span>admissionregistration.k8s.io/v1beta1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>MutatingWebhookConfiguration<span style="color:#bbb">
</span><span style="color:#bbb"></span>...<span style="color:#bbb">
</span><span style="color:#bbb"></span>webhooks:<span style="color:#bbb">
</span><span style="color:#bbb"></span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>my-webhook.example.com<span style="color:#bbb">
</span><span style="color:#bbb">  </span>clientConfig:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>caBundle:<span style="color:#bbb"> </span><span style="color:#b44">&#34;Ci0tLS0tQk...&lt;`caBundle` is a PEM encoded CA bundle which will be used to validate the webhook&#39;s server certificate&gt;...tLS0K&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>service:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>namespace:<span style="color:#bbb"> </span>my-service-namespace<span style="color:#bbb">
</span><span style="color:#bbb">      </span>name:<span style="color:#bbb"> </span>my-service-name<span style="color:#bbb">
</span><span style="color:#bbb">      </span>path:<span style="color:#bbb"> </span>/my-path<span style="color:#bbb">
</span><span style="color:#bbb">      </span>port:<span style="color:#bbb"> </span><span style="color:#666">1234</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>...</code></pre></div>
    

<p></div></p>

<p></div></p>

<script>$(function(){$("#mutatingwebhookconfiguration-service").tabs();});</script>

<h3 id="side-effects">Side effects</h3>

<p>Webhooks typically operate only on the content of the <code>AdmissionReview</code> sent to them.
Some webhooks, however, make out-of-band changes as part of processing admission requests.</p>

<p>Webhooks that make out-of-band changes (&ldquo;side effects&rdquo;) must also have a reconciliation mechanism
(like a controller) that periodically determines the actual state of the world, and adjusts
the out-of-band data modified by the admission webhook to reflect reality.
This is because a call to an admission webhook does not guarantee the admitted object will be persisted as is, or at all.
Later webhooks can modify the content of the object, a conflict could be encountered while writing to storage,
or the server could power off before persisting the object.</p>

<p>Additionally, webhooks with side effects must skip those side-effects when <code>dryRun: true</code> admission requests are handled.
A webhook must explicitly indicate that it will not have side-effects when run with <code>dryRun</code>,
or the dry-run request will not be sent to the webhook and the API request will fail instead.</p>

<p>Webhooks indicate whether they have side effects using the <code>sideEffects</code> field in the webhook configuration:</p>

<ul>
<li><code>Unknown</code>: no information is known about the side effects of calling the webhook.
If a request with <code>dryRun: true</code> would trigger a call to this webhook, the request will instead fail, and the webhook will not be called.</li>
<li><code>None</code>: calling the webhook will have no side effects.</li>
<li><code>Some</code>: calling the webhook will possibly have side effects.
If a request with the dry-run attribute would trigger a call to this webhook, the request will instead fail, and the webhook will not be called.</li>
<li><code>NoneOnDryRun</code>: calling the webhook will possibly have side effects,
but if a request with <code>dryRun: true</code> is sent to the webhook, the webhook will suppress the side effects (the webhook is <code>dryRun</code>-aware).</li>
</ul>

<p>Allowed values:</p>

<ul>
<li>In <code>admissionregistration.k8s.io/v1beta1</code>, <code>sideEffects</code> may be set to <code>Unknown</code>, <code>None</code>, <code>Some</code>, or <code>NoneOnDryRun</code>, and defaults to <code>Unknown</code>.</li>
<li>In <code>admissionregistration.k8s.io/v1</code>, <code>sideEffects</code> must be set to <code>None</code> or <code>NoneOnDryRun</code>.</li>
</ul>

<p>Here is an example of a validating webhook indicating it has no side effects on <code>dryRun: true</code> requests:</p>

<div id="validatingwebhookconfiguration-sideeffects">
<ul>
    
      
  <li><a href="#validatingwebhookconfiguration-sideeffects-0">admissionregistration.k8s.io/v1</a></li>

      
  <li><a href="#validatingwebhookconfiguration-sideeffects-1">admissionregistration.k8s.io/v1beta1</a></li>

</ul>


<div id="validatingwebhookconfiguration-sideeffects-0">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>admissionregistration.k8s.io/v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>ValidatingWebhookConfiguration<span style="color:#bbb">
</span><span style="color:#bbb"></span>...<span style="color:#bbb">
</span><span style="color:#bbb"></span>webhooks:<span style="color:#bbb">
</span><span style="color:#bbb"></span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>my-webhook.example.com<span style="color:#bbb">
</span><span style="color:#bbb">  </span>sideEffects:<span style="color:#bbb"> </span>NoneOnDryRun<span style="color:#bbb">
</span><span style="color:#bbb">  </span>...</code></pre></div>
    

<p></div></p>

<div id="validatingwebhookconfiguration-sideeffects-1">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#080;font-style:italic"># Deprecated in v1.16 in favor of admissionregistration.k8s.io/v1</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>apiVersion:<span style="color:#bbb"> </span>admissionregistration.k8s.io/v1beta1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>ValidatingWebhookConfiguration<span style="color:#bbb">
</span><span style="color:#bbb"></span>...<span style="color:#bbb">
</span><span style="color:#bbb"></span>webhooks:<span style="color:#bbb">
</span><span style="color:#bbb"></span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>my-webhook.example.com<span style="color:#bbb">
</span><span style="color:#bbb">  </span>sideEffects:<span style="color:#bbb"> </span>NoneOnDryRun<span style="color:#bbb">
</span><span style="color:#bbb">  </span>...</code></pre></div>
    

<p></div></p>

<p></div></p>

<script>$(function(){$("#validatingwebhookconfiguration-sideeffects").tabs();});</script>

<h3 id="timeouts">Timeouts</h3>

<p>Because webhooks add to API request latency, they should evaluate as quickly as possible.
<code>timeoutSeconds</code> allows configuring how long the API server should wait for a webhook to respond
before treating the call as a failure.</p>

<p>If the timeout expires before the webhook responds, the webhook call will be ignored or
the API call will be rejected based on the <a href="#failure-policy">failure policy</a>.</p>

<p>The timeout value must be between 1 and 30 seconds.</p>

<p>Here is an example of a validating webhook with a custom timeout of 2 seconds:</p>

<div id="validatingwebhookconfiguration-timeoutseconds">
<ul>
    
      
  <li><a href="#validatingwebhookconfiguration-timeoutseconds-0">admissionregistration.k8s.io/v1</a></li>

      
  <li><a href="#validatingwebhookconfiguration-timeoutseconds-1">admissionregistration.k8s.io/v1beta1</a></li>

</ul>


<div id="validatingwebhookconfiguration-timeoutseconds-0">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>admissionregistration.k8s.io/v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>ValidatingWebhookConfiguration<span style="color:#bbb">
</span><span style="color:#bbb"></span>...<span style="color:#bbb">
</span><span style="color:#bbb"></span>webhooks:<span style="color:#bbb">
</span><span style="color:#bbb"></span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>my-webhook.example.com<span style="color:#bbb">
</span><span style="color:#bbb">  </span>timeoutSeconds:<span style="color:#bbb"> </span><span style="color:#666">2</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>...</code></pre></div>
<p>Admission webhooks created using <code>admissionregistration.k8s.io/v1</code> default timeouts to 10 seconds.</p>

    
</div>

<div id="validatingwebhookconfiguration-timeoutseconds-1">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#080;font-style:italic"># Deprecated in v1.16 in favor of admissionregistration.k8s.io/v1</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>apiVersion:<span style="color:#bbb"> </span>admissionregistration.k8s.io/v1beta1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>ValidatingWebhookConfiguration<span style="color:#bbb">
</span><span style="color:#bbb"></span>...<span style="color:#bbb">
</span><span style="color:#bbb"></span>webhooks:<span style="color:#bbb">
</span><span style="color:#bbb"></span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>my-webhook.example.com<span style="color:#bbb">
</span><span style="color:#bbb">  </span>timeoutSeconds:<span style="color:#bbb"> </span><span style="color:#666">2</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>...</code></pre></div>
<p>Admission webhooks created using <code>admissionregistration.k8s.io/v1</code> default timeouts to 30 seconds.</p>

    
</div>

<p></div></p>

<script>$(function(){$("#validatingwebhookconfiguration-timeoutseconds").tabs();});</script>

<h3 id="reinvocation-policy">Reinvocation policy</h3>

<p>A single ordering of mutating admissions plugins (including webhooks) does not work for all cases
(see <a href="https://issue.k8s.io/64333" target="_blank">https://issue.k8s.io/64333</a> as an example). A mutating webhook can add a new sub-structure
to the object (like adding a <code>container</code> to a <code>pod</code>), and other mutating plugins which have already
run may have opinions on those new structures (like setting an <code>imagePullPolicy</code> on all containers).</p>

<p>In v1.15+, to allow mutating admission plugins to observe changes made by other plugins,
built-in mutating admission plugins are re-run if a mutating webhook modifies an object,
and mutating webhooks can specify a <code>reinvocationPolicy</code> to control whether they are reinvoked as well.</p>

<p><code>reinvocationPolicy</code> may be set to <code>Never</code> or <code>IfNeeded</code>. It defaults to <code>Never</code>.</p>

<ul>
<li><code>Never</code>: the webhook must not be called more than once in a single admission evaluation</li>
<li><code>IfNeeded</code>: the webhook may be called again as part of the admission evaluation if the object
being admitted is modified by other admission plugins after the initial webhook call.</li>
</ul>

<p>The important elements to note are:</p>

<ul>
<li>The number of additional invocations is not guaranteed to be exactly one.</li>
<li>If additional invocations result in further modifications to the object, webhooks are not guaranteed to be invoked again.</li>
<li>Webhooks that use this option may be reordered to minimize the number of additional invocations.</li>
<li>To validate an object after all mutations are guaranteed complete, use a validating admission webhook instead (recommended for webhooks with side-effects).</li>
</ul>

<p>Here is an example of a mutating webhook opting into being re-invoked if later admission plugins modify the object:</p>

<div id="mutatingwebhookconfiguration-reinvocationpolicy">
<ul>
    
      
  <li><a href="#mutatingwebhookconfiguration-reinvocationpolicy-0">admissionregistration.k8s.io/v1</a></li>

      
  <li><a href="#mutatingwebhookconfiguration-reinvocationpolicy-1">admissionregistration.k8s.io/v1beta1</a></li>

</ul>


<div id="mutatingwebhookconfiguration-reinvocationpolicy-0">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>admissionregistration.k8s.io/v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>MutatingWebhookConfiguration<span style="color:#bbb">
</span><span style="color:#bbb"></span>...<span style="color:#bbb">
</span><span style="color:#bbb"></span>webhooks:<span style="color:#bbb">
</span><span style="color:#bbb"></span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>my-webhook.example.com<span style="color:#bbb">
</span><span style="color:#bbb">  </span>reinvocationPolicy:<span style="color:#bbb"> </span>IfNeeded<span style="color:#bbb">
</span><span style="color:#bbb">  </span>...</code></pre></div>
    

<p></div></p>

<div id="mutatingwebhookconfiguration-reinvocationpolicy-1">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#080;font-style:italic"># Deprecated in v1.16 in favor of admissionregistration.k8s.io/v1</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>apiVersion:<span style="color:#bbb"> </span>admissionregistration.k8s.io/v1beta1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>MutatingWebhookConfiguration<span style="color:#bbb">
</span><span style="color:#bbb"></span>...<span style="color:#bbb">
</span><span style="color:#bbb"></span>webhooks:<span style="color:#bbb">
</span><span style="color:#bbb"></span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>my-webhook.example.com<span style="color:#bbb">
</span><span style="color:#bbb">  </span>reinvocationPolicy:<span style="color:#bbb"> </span>IfNeeded<span style="color:#bbb">
</span><span style="color:#bbb">  </span>...</code></pre></div>
    

<p></div></p>

<p></div></p>

<script>$(function(){$("#mutatingwebhookconfiguration-reinvocationpolicy").tabs();});</script>

<p>Mutating webhooks must be <a href="#idempotence">idempotent</a>, able to successfully process an object they have already admitted
and potentially modified. This is true for all mutating admission webhooks, since any change they can make
in an object could already exist in the user-provided object, but it is essential for webhooks that opt into reinvocation.</p>

<h3 id="failure-policy">Failure policy</h3>

<p><code>failurePolicy</code> defines how unrecognized errors and timeout errors from the admission webhook
are handled. Allowed values are <code>Ignore</code> or <code>Fail</code>.</p>

<ul>
<li><code>Ignore</code> means that an error calling the webhook is ignored and the API request is allowed to continue.</li>
<li><code>Fail</code> means that an error calling the webhook causes the admission to fail and the API request to be rejected.</li>
</ul>

<p>Here is a mutating webhook configured to reject an API request if errors are encountered calling the admission webhook:</p>

<div id="mutatingwebhookconfiguration-failurepolicy">
<ul>
    
      
  <li><a href="#mutatingwebhookconfiguration-failurepolicy-0">admissionregistration.k8s.io/v1</a></li>

      
  <li><a href="#mutatingwebhookconfiguration-failurepolicy-1">admissionregistration.k8s.io/v1beta1</a></li>

</ul>


<div id="mutatingwebhookconfiguration-failurepolicy-0">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>admissionregistration.k8s.io/v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>MutatingWebhookConfiguration<span style="color:#bbb">
</span><span style="color:#bbb"></span>...<span style="color:#bbb">
</span><span style="color:#bbb"></span>webhooks:<span style="color:#bbb">
</span><span style="color:#bbb"></span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>my-webhook.example.com<span style="color:#bbb">
</span><span style="color:#bbb">  </span>failurePolicy:<span style="color:#bbb"> </span>Fail<span style="color:#bbb">
</span><span style="color:#bbb">  </span>...</code></pre></div>
<p>Admission webhooks created using <code>admissionregistration.k8s.io/v1</code> default <code>failurePolicy</code> to <code>Fail</code>.</p>

    
</div>

<div id="mutatingwebhookconfiguration-failurepolicy-1">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#080;font-style:italic"># Deprecated in v1.16 in favor of admissionregistration.k8s.io/v1</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>apiVersion:<span style="color:#bbb"> </span>admissionregistration.k8s.io/v1beta1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>MutatingWebhookConfiguration<span style="color:#bbb">
</span><span style="color:#bbb"></span>...<span style="color:#bbb">
</span><span style="color:#bbb"></span>webhooks:<span style="color:#bbb">
</span><span style="color:#bbb"></span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>my-webhook.example.com<span style="color:#bbb">
</span><span style="color:#bbb">  </span>failurePolicy:<span style="color:#bbb"> </span>Fail<span style="color:#bbb">
</span><span style="color:#bbb">  </span>...</code></pre></div>
<p>Admission webhooks created using <code>admissionregistration.k8s.io/v1beta1</code> default <code>failurePolicy</code> to <code>Ignore</code>.</p>

    
</div>

<p></div></p>

<script>$(function(){$("#mutatingwebhookconfiguration-failurepolicy").tabs();});</script>

<h2 id="monitoring-admission-webhooks">Monitoring admission webhooks</h2>

<p>The API server provides ways to monitor admission webhook behaviors. These
monitoring mechanisms help cluster admins to answer questions like:</p>

<ol>
<li><p>Which mutating webhook mutated the object in a API request?</p></li>

<li><p>What change did the mutating webhook applied to the object?</p></li>

<li><p>Which webhooks are frequently rejecting API requests? What&rsquo;s the reason for a
rejection?</p></li>
</ol>

<h3 id="mutating-webhook-auditing-annotations">Mutating webhook auditing annotations</h3>

<p>Sometimes it&rsquo;s useful to know which mutating webhook mutated the object in a API request, and what change did the
webhook apply.</p>

<p>In v1.16+, kube-apiserver performs <a href="/docs/tasks/debug-application-cluster/audit/">auditing</a> on each mutating webhook
invocation. Each invocation generates an auditing annotation
capturing if a request object is mutated by the invocation, and optionally generates an annotation capturing the applied
patch from the webhook admission response. The annotations are set in the audit event for given request on given stage of
its execution, which is then pre-processed according to a certain policy and written to a backend.</p>

<p>The audit level of a event determines which annotations get recorded:</p>

<ul>
<li>At <code>Metadata</code> audit level or higher, an annotation with key
<code>mutation.webhook.admission.k8s.io/round_{round idx}_index_{order idx}</code> gets logged with JSON payload indicating
a webhook gets invoked for given request and whether it mutated the object or not.</li>
</ul>

<p>For example, the following annotation gets recorded for a webhook being reinvoked. The webhook is ordered the third in the
mutating webhook chain, and didn&rsquo;t mutated the request object during the invocation.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#080;font-style:italic"># the audit event recorded</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>{<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;kind&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;Event&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;apiVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;audit.k8s.io/v1&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;annotations&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;mutation.webhook.admission.k8s.io/round_1_index_2&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;{\&#34;configuration\&#34;:\&#34;my-mutating-webhook-configuration.example.com\&#34;,\&#34;webhook\&#34;:\&#34;my-webhook.example.com\&#34;,\&#34;mutated\&#34;: false}&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#080;font-style:italic"># other annotations</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span>...<span style="color:#bbb">
</span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># other fields</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>...<span style="color:#bbb">
</span><span style="color:#bbb"></span>}</code></pre></div><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#080;font-style:italic"># the annotation value deserialized</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>{<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;configuration&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;my-mutating-webhook-configuration.example.com&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;webhook&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;my-webhook.example.com&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;mutated&#34;</span>:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">false</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>}</code></pre></div>
<p>The following annotation gets recorded for a webhook being invoked in the first round. The webhook is ordered the first in<br />
the mutating webhook chain, and mutated the request object during the invocation.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#080;font-style:italic"># the audit event recorded</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>{<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;kind&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;Event&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;apiVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;audit.k8s.io/v1&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;annotations&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;mutation.webhook.admission.k8s.io/round_0_index_0&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;{\&#34;configuration\&#34;:\&#34;my-mutating-webhook-configuration.example.com\&#34;,\&#34;webhook\&#34;:\&#34;my-webhook-always-mutate.example.com\&#34;,\&#34;mutated\&#34;: true}&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#080;font-style:italic"># other annotations</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span>...<span style="color:#bbb">
</span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># other fields</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>...<span style="color:#bbb">
</span><span style="color:#bbb"></span>}</code></pre></div><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#080;font-style:italic"># the annotation value deserialized</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>{<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;configuration&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;my-mutating-webhook-configuration.example.com&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;webhook&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;my-webhook-always-mutate.example.com&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;mutated&#34;</span>:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>}</code></pre></div>
<ul>
<li>At <code>Request</code> audit level or higher, an annotation with key
<code>patch.webhook.admission.k8s.io/round_{round idx}_index_{order idx}</code> gets logged with JSON payload indicating
a webhook gets invoked for given request and what patch gets applied to the request object.</li>
</ul>

<p>For example, the following annotation gets recorded for a webhook being reinvoked. The webhook is ordered the fourth in the
mutating webhook chain, and responded with a JSON patch which got applied to the request object.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#080;font-style:italic"># the audit event recorded</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>{<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;kind&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;Event&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;apiVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;audit.k8s.io/v1&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;annotations&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;patch.webhook.admission.k8s.io/round_1_index_3&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;{\&#34;configuration\&#34;:\&#34;my-other-mutating-webhook-configuration.example.com\&#34;,\&#34;webhook\&#34;:\&#34;my-webhook-always-mutate.example.com\&#34;,\&#34;patch\&#34;:[{\&#34;op\&#34;:\&#34;add\&#34;,\&#34;path\&#34;:\&#34;/data/mutation-stage\&#34;,\&#34;value\&#34;:\&#34;yes\&#34;}],\&#34;patchType\&#34;:\&#34;JSONPatch\&#34;}&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#080;font-style:italic"># other annotations</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span>...<span style="color:#bbb">
</span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># other fields</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>...<span style="color:#bbb">
</span><span style="color:#bbb"></span>}</code></pre></div><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#080;font-style:italic"># the annotation value deserialized</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>{<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;configuration&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;my-other-mutating-webhook-configuration.example.com&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;webhook&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;my-webhook-always-mutate.example.com&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;patchType&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;JSONPatch&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;patch&#34;</span>:<span style="color:#bbb"> </span>[<span style="color:#bbb">
</span><span style="color:#bbb">        </span>{<span style="color:#bbb">
</span><span style="color:#bbb">            </span><span style="color:#b44">&#34;op&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;add&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">            </span><span style="color:#b44">&#34;path&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;/data/mutation-stage&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">            </span><span style="color:#b44">&#34;value&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;yes&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span>}<span style="color:#bbb">
</span><span style="color:#bbb">    </span>]<span style="color:#bbb">
</span><span style="color:#bbb"></span>}</code></pre></div>
<h3 id="admission-webhook-metrics">Admission webhook metrics</h3>

<p>Kube-apiserver exposes Prometheus metrics from the <code>/metrics</code> endpoint, which can be used for monitoring and
diagnosing API server status. The following metrics record status related to admission webhooks.</p>

<h4 id="api-server-admission-webhook-rejection-count">API server admission webhook rejection count</h4>

<p>Sometimes it&rsquo;s useful to know which admission webhooks are frequently rejecting API requests, and the
reason for a rejection.</p>

<p>In v1.16+, kube-apiserver exposes a Prometheus counter metric recording admission webhook rejections. The
metrics are labelled to identify the causes of webhook rejection(s):</p>

<ul>
<li><code>name</code>: the name of the webhook that rejected a request.</li>
<li><code>operation</code>: the operation type of the request, can be one of <code>CREATE</code>,
<code>UPDATE</code>, <code>DELETE</code> and <code>CONNECT</code>.</li>
<li><code>type</code>: the admission webhook type, can be one of <code>admit</code> and <code>validating</code>.</li>
<li><code>error_type</code>: identifies if an error occurred during the webhook invocation
that caused the rejection. Its value can be one of:

<ul>
<li><code>calling_webhook_error</code>: unrecognized errors or timeout errors from the admission webhook happened and the
webhook&rsquo;s <a href="#failure-policy">Failure policy</a> is set to <code>Fail</code>.</li>
<li><code>no_error</code>: no error occurred. The webhook rejected the request with <code>allowed: false</code> in the admission
response. The metrics label <code>rejection_code</code> records the <code>.status.code</code> set in the admission response.</li>
<li><code>apiserver_internal_error</code>: an API server internal error happened.</li>
</ul></li>
<li><code>rejection_code</code>: the HTTP status code set in the admission response when a
webhook rejected a request.</li>
</ul>

<p>Example of the rejection count metrics:</p>

<pre><code># HELP apiserver_admission_webhook_rejection_count [ALPHA] Admission webhook rejection count, identified by name and broken out for each admission type (validating or admit) and operation. Additional labels specify an error type (calling_webhook_error or apiserver_internal_error if an error occurred; no_error otherwise) and optionally a non-zero rejection code if the webhook rejects the request with an HTTP status code (honored by the apiserver when the code is greater or equal to 400). Codes greater than 600 are truncated to 600, to keep the metrics cardinality bounded.
# TYPE apiserver_admission_webhook_rejection_count counter
apiserver_admission_webhook_rejection_count{error_type=&quot;calling_webhook_error&quot;,name=&quot;always-timeout-webhook.example.com&quot;,operation=&quot;CREATE&quot;,rejection_code=&quot;0&quot;,type=&quot;validating&quot;} 1
apiserver_admission_webhook_rejection_count{error_type=&quot;calling_webhook_error&quot;,name=&quot;invalid-admission-response-webhook.example.com&quot;,operation=&quot;CREATE&quot;,rejection_code=&quot;0&quot;,type=&quot;validating&quot;} 1
apiserver_admission_webhook_rejection_count{error_type=&quot;no_error&quot;,name=&quot;deny-unwanted-configmap-data.example.com&quot;,operation=&quot;CREATE&quot;,rejection_code=&quot;400&quot;,type=&quot;validating&quot;} 13
</code></pre>

<h2 id="best-practices-and-warnings">Best practices and warnings</h2>

<h3 id="idempotence">Idempotence</h3>

<p>An idempotent mutating admission webhook is able to successfully process an object it has already admitted
and potentially modified. The admission can be applied multiple times without changing the result beyond
the initial application.</p>

<h4 id="example-of-idempotent-mutating-admission-webhooks">Example of idempotent mutating admission webhooks:</h4>

<ol>
<li><p>For a <code>CREATE</code> pod request, set the field <code>.spec.securityContext.runAsNonRoot</code> of the
pod to true, to enforce security best practices.</p></li>

<li><p>For a <code>CREATE</code> pod request, if the field <code>.spec.containers[].resources.limits</code>
of a container is not set, set default resource limits.</p></li>

<li><p>For a <code>CREATE</code> pod request, inject a sidecar container with name <code>foo-sidecar</code> if no container with the name <code>foo-sidecar</code> already exists.</p></li>
</ol>

<p>In the cases above, the webhook can be safely reinvoked, or admit an object that already has the fields set.</p>

<h4 id="example-of-non-idempotent-mutating-admission-webhooks">Example of non-idempotent mutating admission webhooks:</h4>

<ol>
<li><p>For a <code>CREATE</code> pod request, inject a sidecar container with name <code>foo-sidecar</code>
suffixed with the current timestamp (e.g. <code>foo-sidecar-19700101-000000</code>).</p></li>

<li><p>For a <code>CREATE</code>/<code>UPDATE</code> pod request, reject if the pod has label <code>&quot;env&quot;</code> set,
otherwise add an <code>&quot;env&quot;: &quot;prod&quot;</code> label to the pod.</p></li>

<li><p>For a <code>CREATE</code> pod request, blindly append a sidecar container named
<code>foo-sidecar</code> without looking to see if there is already a <code>foo-sidecar</code>
container in the pod.</p></li>
</ol>

<p>In the first case above, reinvoking the webhook can result in the same sidecar being injected multiple times to a pod, each time
with a different container name. Similarly the webhook can inject duplicated containers if the sidecar already exists in
a user-provided pod.</p>

<p>In the second case above, reinvoking the webhook will result in the webhook failing on its own output.</p>

<p>In the third case above, reinvoking the webhook will result in duplicated containers in the pod spec, which makes
the request invalid and rejected by the API server.</p>

<h3 id="intercepting-all-versions-of-an-object">Intercepting all versions of an object</h3>

<p>It is recommended that admission webhooks should always intercept all versions of an object by setting <code>.webhooks[].matchPolicy</code>
to <code>Equivalent</code>. It is also recommended that admission webhooks should prefer registering for stable versions of resources.
Failure to intercept all versions of an object can result in admission policies not being enforced for requests in certain
versions. See <a href="#matching-requests-matchpolicy">Matching requests: matchPolicy</a> for examples.</p>

<h3 id="availability">Availability</h3>

<p>It is recommended that admission webhooks should evaluate as quickly as possible (typically in milliseconds), since they add to API request latency.
It is encouraged to use a small timeout for webhooks. See <a href="#timeouts">Timeouts</a> for more detail.</p>

<p>It is recommended that admission webhooks should leverage some format of load-balancing, to provide high availability and
performance benefits. If a webhook is running within the cluster, you can run multiple webhook backends behind a service
to leverage the load-balancing that service supports.</p>

<h3 id="guaranteeing-the-final-state-of-the-object-is-seen">Guaranteeing the final state of the object is seen</h3>

<p>Admission webhooks that need to guarantee they see the final state of the object in order to enforce policy
should use a validating admission webhook, since objects can be modified after being seen by mutating webhooks.</p>

<p>For example, a mutating admission webhook is configured to inject a sidecar container with name &ldquo;foo-sidecar&rdquo; on every
<code>CREATE</code> pod request. If the sidecar <em>must</em> be present, a validating admisson webhook should also be configured to intercept <code>CREATE</code> pod requests, and validate
that a container with name &ldquo;foo-sidecar&rdquo; with the expected configuration exists in the to-be-created object.</p>

<h3 id="avoiding-deadlocks-in-self-hosted-webhooks">Avoiding deadlocks in self-hosted webhooks</h3>

<p>A webhook running inside the cluster might cause deadlocks for its own deployment if it is configured
to intercept resources required to start its own pods.</p>

<p>For example, a mutating admission webhook is configured to admit <code>CREATE</code> pod requests only if a certain label is set in the
pod (e.g. <code>&quot;env&quot;: &quot;prod&quot;</code>). The webhook server runs in a deployment which doesn&rsquo;t set the <code>&quot;env&quot;</code> label.
When a node that runs the webhook server pods
becomes unhealthy, the webhook deployment will try to reschedule the pods to another node. However the requests will
get rejected by the existing webhook server since the <code>&quot;env&quot;</code> label is unset, and the migration cannot happen.</p>

<p>It is recommended to exclude the namespace where your webhook is running with a <a href="#matching-requests-namespaceselector">namespaceSelector</a>.</p>

<h3 id="side-effects-1">Side effects</h3>

<p>It is recommended that admission webhooks should avoid side effects if possible, which means the webhooks operate only on the
content of the <code>AdmissionReview</code> sent to them, and do not make out-of-band changes. The <code>.webhooks[].sideEffects</code> field should
be set to <code>None</code> if a webhook doesn&rsquo;t have any side effect.</p>

<p>If side effects are required during the admission evaluation, they must be suppressed when processing an
<code>AdmissionReview</code> object with <code>dryRun</code> set to <code>true</code>, and the <code>.webhooks[].sideEffects</code> field should be
set to <code>NoneOnDryRun</code>. See <a href="#side-effects">Side effects</a> for more detail.</p>

<h3 id="avoiding-operating-on-the-kube-system-namespace">Avoiding operating on the kube-system namespace</h3>

<p>The <code>kube-system</code> namespace contains objects created by the Kubernetes system,
e.g. service accounts for the control plane components, pods like <code>kube-dns</code>.
Accidentally mutating or rejecting requests in the <code>kube-system</code> namespace may
cause the control plane components to stop functioning or introduce unknown behavior.
If your admission webhooks don&rsquo;t intend to modify the behavior of the Kubernetes control
plane, exclude the <code>kube-system</code> namespace from being intercepted using a
<a href="#matching-requests-namespaceselector"><code>namespaceSelector</code></a>.</p>















    
            
  <h2>Feedback</h2>
  <p class="feedback--prompt">Was this page helpful? </p>
  <button class="button feedback--yes">Yes</button>
  <button class="button feedback--no">No</button>
  <p class="feedback--response feedback--response__hidden">
    Thanks for the feedback. If you have a specific, answerable question about how to use Kubernetes, ask it on
    <a target="_blank" rel="noopener"
      href="https://stackoverflow.com/questions/tagged/kubernetes">
      Stack Overflow</a>.
    Open an issue in the GitHub repo if you want to 
    <a class="feedback--link" target="_blank" rel="noopener"
      href="https://github.com/kubernetes/website/issues/new?title=Issue%20with%20k8s.io">
      report a problem</a>
    or
    <a class="feedback--link" target="_blank" rel="noopener"
      href="https://github.com/kubernetes/website/issues/new?title=Improvement%20for%20k8s.io">
      suggest an improvement</a>.
  </p>
  <script>
    const yes = document.querySelector('.feedback--yes');
    const no = document.querySelector('.feedback--no');
    document.querySelectorAll('.feedback--link').forEach(link => {
      link.href = link.href + window.location.pathname;
    });
    const sendFeedback = (value) => {
      if (!gtag) { console.log('!gtag'); }
      gtag('event', 'click', {
        'event_category': 'Helpful',
        'event_label': window.location.pathname,
        value
      });
    };
    const disableButtons = () => {
      yes.disabled = true;
      yes.classList.add('feedback--button__disabled');
      no.disabled = true;
      no.classList.add('feedback--button__disabled');
    };
    yes.addEventListener('click', () => {
      sendFeedback(1);
      disableButtons();
      document.querySelector('.feedback--response').classList.remove('feedback--response__hidden');
    });
    no.addEventListener('click', () => {
      sendFeedback(0);
      disableButtons();
      document.querySelector('.feedback--response').classList.remove('feedback--response__hidden');
    });
  </script>


    
            <div id="pre-footer"> 
  <hr />

  <div class="issue-button-container">
    <p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs/reference/access-authn-authz/extensible-admission-controllers.md?pixel" alt="Analytics" /></a></p>
    
    
    <script type="text/javascript">
    PDRTJS_settings_8345992 = {
    "id" : "8345992",
    "unique_id" : "\/docs\/reference\/access-authn-authz\/extensible-admission-controllers\/",
    "title" : "Dynamic Admission Control",
    "permalink" : "https:\/\/kubernetes.io\/docs\/reference\/access-authn-authz\/extensible-admission-controllers\/"
    };
    (function(d,c,j){if(!document.getElementById(j)){var pd=d.createElement(c),s;pd.id=j;pd.src=('https:'==document.location.protocol)?'https://polldaddy.com/js/rating/rating.js':'http://i0.poll.fm/js/rating/rating.js';s=document.getElementsByTagName(c)[0];s.parentNode.insertBefore(pd,s);}}(document,'script','pd-rating-js'));
    </script>
    <a href="" onclick="window.open('https://github.com/kubernetes/website/issues/new?template=bug-report.md&title=Issue%20with%20' +
    'k8s.io'+window.location.pathname)" class="button issue">Create an Issue</a>
    
    
    
    <a href="https://github.com/kubernetes/website/edit/master/content/en/docs/reference/access-authn-authz/extensible-admission-controllers.md" class="button issue">Edit This Page</a>
    
  </div>
  

  <div id="lastedit" class="lastedit issue-button-container">
    Page last modified on March 16, 2020 at 6:28 AM PST by
    <a href="https://github.com/kubernetes/website/commit/5f496a6ce641975f9b44091aaefa5915877a8888/">Changed &#39;caBundle&#39; description (#19341)</a> (<a href="https://github.com/kubernetes/website/commits/master/content/en/docs/reference/access-authn-authz/extensible-admission-controllers.md">Page History</a>)
  </div>
  
</div>

          </div>
        </section>
    </main>
		<footer>
    <div class="light-text main-section">
        <nav>
            
            
            
            <a href="/docs/home/">Home</a>
            
            <a href="/blog/">Blog</a>
            
            <a href="/training/">Training</a>
            
            <a href="/partners/">Partners</a>
            
            <a href="/community/">Community</a>
            
            <a href="/case-studies/">Case Studies</a>
            
        </nav>
        <div class="social" role="region" aria-label="Social hyperlinks">
            <div>
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>Twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>GitHub</span></a>
                <a href="https://slack.k8s.io/" class="slack"><span>Slack</span></a>
            </div>
            <div>
                <a href="https://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://www.youtube.com/kubernetescommunity" class="youtube"><span>YouTube</span></a>
                <a href="https://discuss.kubernetes.io" class="mailing-list"><span>Forum</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
            <div>
                
                <a href="https://git.k8s.io/community/contributors/guide" class="button">Contribute</a>
            </div>
        </div>
        <div class="miceType center">
            &copy; 2023 The Kubernetes Authors | Documentation Distributed under <a href="https://git.k8s.io/website/LICENSE" class="light-text">CC BY 4.0</a></a>
        </div>
        <div class="miceType center">
            Copyright &copy; 2023 The Linux Foundation &reg;. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage" class="light-text">Trademark Usage page</a>
        </div>
        <div class="miceType center">
            ICP license: 京ICP备17074266号-3
        </div>
    </div>
</footer>

		<button class="flyout-button" onclick="kub.toggleToc()" aria-label="Toggle table of contents visibility"></button>

<script>

(function () {
    window.addEventListener('DOMContentLoaded', init)

        
        function init() {
            window.removeEventListener('DOMContentLoaded', init)
                hideNav()
        }

    function hideNav(toc){
        if (!toc) toc = document.querySelector('#docsToc')
        if (!toc) return
            var container = toc.querySelector('.container')

                
                if (container) {
                    if (container.childElementCount === 0 || toc.querySelectorAll('a.item').length === 1) {
                        toc.style.display = 'none'
                            document.getElementById('docsContent').style.width = '100%'
                    }
                } else {
                    requestAnimationFrame(function () {
                        hideNav(toc)
                    })
                }
    }
})();
</script>



    <script language="application/javascript">
      
      (function addHeadingLinks(){
        var article = document.getElementById('docsContent');
        var headings = article.querySelectorAll('h1, h2, h3, h4, h5, h6');
        headings.forEach(function(heading){
          if(heading.id){
            var a = document.createElement('a');
            a.innerHTML = heading.innerHTML;
            a.href = '#'+heading.id;
            a.classList.add('inpage_heading');
            heading.innerHTML = '';
            heading.appendChild(a);
          }
        });
      })();
    </script>
	</body>
</html>
