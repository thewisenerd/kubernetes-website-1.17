<!DOCTYPE html>
<html id="docs" lang="en" class="">
	<head>
	

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-36037335-10"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-36037335-10');
</script>
<meta charset="utf-8">
<title>Versions in CustomResourceDefinitions - Kubernetes</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#326ce5">
<link rel="shortcut icon" type="image/png" href="/images/favicon.png">









<link rel="stylesheet" href="/css/style.b7b8403eb5b1fddd0a2da2a8383d5b53e6ef81c23e4b0e292e6103bd91f9502d.css" integrity="sha256-t7hAPrWx/d0KLaKoOD1bU&#43;bvgcI&#43;Sw4pLmEDvZH5UC0=">


<link rel="stylesheet" href="/css/base_fonts.css">
<link rel="stylesheet" href="/css/jquery-ui.min.css">
<link rel="stylesheet" href="/css/callouts.css">
<link rel="stylesheet" href="/css/custom-jekyll/tags.css">



<meta name="description" content="">
<meta property="og:description" content="">
<meta name="twitter:description" content="">
<meta property="og:url" content="https://kubernetes.io/docs/tasks/access-kubernetes-api/custom-resources/custom-resource-definition-versioning/">
<meta property="og:title" content="Versions in CustomResourceDefinitions">
<meta name="twitter:title" content="Versions in CustomResourceDefinitions">
<meta name="twitter:image" content="https://kubernetes.io/images/favicon.png" />

<meta name="twitter:image:alt" content="Kubernetes">

<meta property="og:image" content="/images/kubernetes-horizontal-color.png">

<meta property="og:type" content="article">
<script src="/js/anchor-4.1.1.min.js"></script>
<script src="/js/jquery-3.2.1.min.js"></script>
<script src="/js/jquery-ui-1.12.1.min.js"></script>
<script src="/js/bootstrap-4.3.1.min.js"></script>
<script src="/js/sweetalert-2.1.2.min.js"></script>

<script src="/js/script.js"></script>
<script src="/js/custom-jekyll/tags.js"></script>


	</head>
	<body>
		<div id="cellophane" onclick="kub.toggleMenu()"></div>

<header>
    <a href="/" class="logo" title="Production-Grade Container Orchestration - Kubernetes" aria-label="Kubernetes website"></a>

    <div class="nav-buttons" data-auto-burger="primary">
        <ul class="global-nav">
            
            
            <li><a href="/docs/" class="active">Documentation</a></li>
            
            <li><a href="/blog/">Blog</a></li>
            
            <li><a href="/training/">Training</a></li>
            
            <li><a href="/partners/">Partners</a></li>
            
            <li><a href="/community/">Community</a></li>
            
            <li><a href="/case-studies/">Case Studies</a></li>
            
            
            
             <li>
                <a href="#">
                    English <span class="ui-icon ui-icon-carat-1-s"></span>
                </a>
                <ul>
                
                    <li><a href="/zh/docs/tasks/access-kubernetes-api/custom-resources/custom-resource-definition-versioning/">中文 Chinese</a></li>
                
                </ul>
            </li>

            <li>
                <a href="#">
                    v1.17 <span class="ui-icon ui-icon-carat-1-s"></span>
                </a>
                <ul>
                
                    <li><a href="https://kubernetes.io/docs/tasks/access-kubernetes-api/custom-resources/custom-resource-definition-versioning/">v1.21</a></li>
                
                    <li><a href="https://v1-20.docs.kubernetes.io/docs/tasks/access-kubernetes-api/custom-resources/custom-resource-definition-versioning/">v1.20</a></li>
                
                    <li><a href="https://v1-19.docs.kubernetes.io/docs/tasks/access-kubernetes-api/custom-resources/custom-resource-definition-versioning/">v1.19</a></li>
                
                    <li><a href="https://v1-18.docs.kubernetes.io/docs/tasks/access-kubernetes-api/custom-resources/custom-resource-definition-versioning/">v1.18</a></li>
                
                    <li><a href="https://v1-17.docs.kubernetes.io/docs/tasks/access-kubernetes-api/custom-resources/custom-resource-definition-versioning/">v1.17</a></li>
                
                </ul>
            </li>
        </ul>
        
        <a href="/docs/tutorials/kubernetes-basics/" class="button" id="tryKubernetes" data-auto-burger-exclude>Learn Kubernetes Basics</a>
        

        <button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
    </div>

    <nav id="mainNav">
        <div class="main-section" data-auto-burger="primary">
         
           <div class="nav-box">
            <h3><a href="/docs/tutorials/hello-minikube/">Get Started</a></h3>
           <p>Ready to get your hands dirty? Build a simple Kubernetes cluster that runs "Hello World" for Node.js.</p>

            </div>
         
           <div class="nav-box">
            <h3><a href="/docs/home/">Documentation</a></h3>
           <p>Learn how to use Kubernetes with conceptual, tutorial, and reference documentation. You can even <a href="/editdocs/" data-auto-burger-exclude>help contribute to the docs</a>!</p>

            </div>
         
           <div class="nav-box">
            <h3><a href="/blog/">Blog</a></h3>
           <p>Read the latest news for Kubernetes and the containers space in general, and get technical how-tos hot off the presses.</p>

            </div>
         
        </div>
        <div class="main-section" data-auto-burger="primary">
            <div class="left">
                <h5 class="github-invite">Interested in hacking on the core Kubernetes code base?</h5>
                <a href="https://github.com/kubernetes/kubernetes" class="button" data-auto-burger-exclude>View On GitHub</a>
            </div>

            <div class="right">
                <h5 class="github-invite">Explore the community</h5>
                <div class="social">
                    <a href="https://twitter.com/kubernetesio" class="twitter"><span>Twitter</span></a>
                    <a href="https://github.com/kubernetes/kubernetes" class="github"><span>GitHub</span></a>
                    <a href="http://slack.k8s.io/" class="slack"><span>Slack Slack</span></a>
                    <a href="https://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                    <a href="https://www.youtube.com/kubernetescommunity" class="youtube"><span>YouTube</span></a>
                    <a href="https://discuss.kubernetes.io" class="mailing-list"><span>Forum</span></a>
                    <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
                </div>
            </div>
            <div class="clear" style="clear: both"></div>
        </div>
    </nav>
</header>

		
		
		<section id="hero" class="light-text no-sub">
			











<h1>Tasks</h1>
<h5></h5>








<div id="vendorStrip" class="light-text">
	<ul>
		
		
		<li><a href="/docs/home/">HOME</a></li>
		
		
		<li><a href="/docs/setup/">GETTING STARTED</a></li>
		
		
		<li><a href="/docs/concepts/">CONCEPTS</a></li>
		
		
		<li><a href="/docs/tasks/" class="YAH">TASKS</a></li>
		
		
		<li><a href="/docs/tutorials/">TUTORIALS</a></li>
		
		
		<li><a href="/docs/reference/">REFERENCE</a></li>
		
		
		<li><a href="/docs/contribute/">CONTRIBUTE</a></li>
		
	</ul>
	<form id="searchBox" action="/docs/search/" role="search">
		<input type="text" id="search" name="q" placeholder="Search" aria-label="Search">
	</form>
</div>

		</section>
		
    
		
<section id="deprecationWarning">
  <main>
    <div class="content deprecation-warning">
      <h3>
	 Kubernetes v1.17
	  documentation is no longer actively maintained. The version you are currently viewing is a static snapshot. For up-to-date documentation, see the 
	 <a href="https://kubernetes.io/docs/home/">latest version.</a>
      </h3>
    </div>
  </main>
</section>


    <main>
        <section id="encyclopedia">
          
<div id="docsToc">
     <div class="pi-accordion">
    	
        
        
        
        
        
         
             
                 
             
         
             
                 
             
         
             
                 
             
         
             
                 
                          
                          
                 
             
         
             
         
             
         
             
         
         
        
        <a class="item" data-title="Tasks" href="/docs/tasks/"></a>

	
	
	
	
		
			
<div class="item" data-title="Install Tools">
	<div class="container">
		
		
	
	
	
	
		
			

<a class="item" data-title="Install and Set Up kubectl" href="/docs/tasks/tools/install-kubectl/"></a>

		
	
		
			

<a class="item" data-title="Install Minikube" href="/docs/tasks/tools/install-minikube/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="Administer a Cluster">
	<div class="container">
		
		
	
	
	
	
		
			
<div class="item" data-title="Administration with kubeadm">
	<div class="container">
		
		
	
	
	
	
		
			

<a class="item" data-title="Certificate Management with kubeadm" href="/docs/tasks/administer-cluster/kubeadm/kubeadm-certs/"></a>

		
	
		
			

<a class="item" data-title="Upgrading kubeadm clusters" href="/docs/tasks/administer-cluster/kubeadm/kubeadm-upgrade/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="Manage Memory, CPU, and API Resources">
	<div class="container">
		
		
	
	
	
	
		
			

<a class="item" data-title="Configure Default Memory Requests and Limits for a Namespace" href="/docs/tasks/administer-cluster/manage-resources/memory-default-namespace/"></a>

		
	
		
			

<a class="item" data-title="Configure Default CPU Requests and Limits for a Namespace" href="/docs/tasks/administer-cluster/manage-resources/cpu-default-namespace/"></a>

		
	
		
			

<a class="item" data-title="Configure Minimum and Maximum Memory Constraints for a Namespace" href="/docs/tasks/administer-cluster/manage-resources/memory-constraint-namespace/"></a>

		
	
		
			

<a class="item" data-title="Configure Minimum and Maximum CPU Constraints for a Namespace" href="/docs/tasks/administer-cluster/manage-resources/cpu-constraint-namespace/"></a>

		
	
		
			

<a class="item" data-title="Configure Memory and CPU Quotas for a Namespace" href="/docs/tasks/administer-cluster/manage-resources/quota-memory-cpu-namespace/"></a>

		
	
		
			

<a class="item" data-title="Configure a Pod Quota for a Namespace" href="/docs/tasks/administer-cluster/manage-resources/quota-pod-namespace/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="Install a Network Policy Provider">
	<div class="container">
		
		
	
	
	
	
		
			

<a class="item" data-title="Use Calico for NetworkPolicy" href="/docs/tasks/administer-cluster/network-policy-provider/calico-network-policy/"></a>

		
	
		
			

<a class="item" data-title="Use Cilium for NetworkPolicy" href="/docs/tasks/administer-cluster/network-policy-provider/cilium-network-policy/"></a>

		
	
		
			

<a class="item" data-title="Use Kube-router for NetworkPolicy" href="/docs/tasks/administer-cluster/network-policy-provider/kube-router-network-policy/"></a>

		
	
		
			

<a class="item" data-title="Romana for NetworkPolicy" href="/docs/tasks/administer-cluster/network-policy-provider/romana-network-policy/"></a>

		
	
		
			

<a class="item" data-title="Weave Net for NetworkPolicy" href="/docs/tasks/administer-cluster/network-policy-provider/weave-network-policy/"></a>

		
	

	</div>
</div>

		
	
		
			

<a class="item" data-title="Access Clusters Using the Kubernetes API" href="/docs/tasks/administer-cluster/access-cluster-api/"></a>

		
	
		
			

<a class="item" data-title="Access Services Running on Clusters" href="/docs/tasks/administer-cluster/access-cluster-services/"></a>

		
	
		
			

<a class="item" data-title="Advertise Extended Resources for a Node" href="/docs/tasks/administer-cluster/extended-resource-node/"></a>

		
	
		
			

<a class="item" data-title="Autoscale the DNS Service in a Cluster" href="/docs/tasks/administer-cluster/dns-horizontal-autoscaling/"></a>

		
	
		
			

<a class="item" data-title="Change the default StorageClass" href="/docs/tasks/administer-cluster/change-default-storage-class/"></a>

		
	
		
			

<a class="item" data-title="Change the Reclaim Policy of a PersistentVolume" href="/docs/tasks/administer-cluster/change-pv-reclaim-policy/"></a>

		
	
		
			

<a class="item" data-title="Cluster Management" href="/docs/tasks/administer-cluster/cluster-management/"></a>

		
	
		
			

<a class="item" data-title="Configure Multiple Schedulers" href="/docs/tasks/administer-cluster/configure-multiple-schedulers/"></a>

		
	
		
			

<a class="item" data-title="Configure Out of Resource Handling" href="/docs/tasks/administer-cluster/out-of-resource/"></a>

		
	
		
			

<a class="item" data-title="Configure Quotas for API Objects" href="/docs/tasks/administer-cluster/quota-api-object/"></a>

		
	
		
			

<a class="item" data-title="Control CPU Management Policies on the Node" href="/docs/tasks/administer-cluster/cpu-management-policies/"></a>

		
	
		
			

<a class="item" data-title="Control Topology Management Policies on a node" href="/docs/tasks/administer-cluster/topology-manager/"></a>

		
	
		
			

<a class="item" data-title="Customizing DNS Service" href="/docs/tasks/administer-cluster/dns-custom-nameservers/"></a>

		
	
		
			

<a class="item" data-title="Debugging DNS Resolution" href="/docs/tasks/administer-cluster/dns-debugging-resolution/"></a>

		
	
		
			

<a class="item" data-title="Declare Network Policy" href="/docs/tasks/administer-cluster/declare-network-policy/"></a>

		
	
		
			

<a class="item" data-title="Developing Cloud Controller Manager" href="/docs/tasks/administer-cluster/developing-cloud-controller-manager/"></a>

		
	
		
			

<a class="item" data-title="Enabling EndpointSlices" href="/docs/tasks/administer-cluster/enabling-endpointslices/"></a>

		
	
		
			

<a class="item" data-title="Enabling Service Topology" href="/docs/tasks/administer-cluster/enabling-service-topology/"></a>

		
	
		
			

<a class="item" data-title="Encrypting Secret Data at Rest" href="/docs/tasks/administer-cluster/encrypt-data/"></a>

		
	
		
			

<a class="item" data-title="Guaranteed Scheduling For Critical Add-On Pods" href="/docs/tasks/administer-cluster/guaranteed-scheduling-critical-addon-pods/"></a>

		
	
		
			

<a class="item" data-title="IP Masquerade Agent User Guide" href="/docs/tasks/administer-cluster/ip-masq-agent/"></a>

		
	
		
			

<a class="item" data-title="Kubernetes Cloud Controller Manager" href="/docs/tasks/administer-cluster/running-cloud-controller/"></a>

		
	
		
			

<a class="item" data-title="Limit Storage Consumption" href="/docs/tasks/administer-cluster/limit-storage-consumption/"></a>

		
	
		
			

<a class="item" data-title="Namespaces Walkthrough" href="/docs/tasks/administer-cluster/namespaces-walkthrough/"></a>

		
	
		
			

<a class="item" data-title="Operating etcd clusters for Kubernetes" href="/docs/tasks/administer-cluster/configure-upgrade-etcd/"></a>

		
	
		
			

<a class="item" data-title="Reconfigure a Node&#39;s Kubelet in a Live Cluster" href="/docs/tasks/administer-cluster/reconfigure-kubelet/"></a>

		
	
		
			

<a class="item" data-title="Reserve Compute Resources for System Daemons" href="/docs/tasks/administer-cluster/reserve-compute-resources/"></a>

		
	
		
			

<a class="item" data-title="Safely Drain a Node while Respecting the PodDisruptionBudget" href="/docs/tasks/administer-cluster/safely-drain-node/"></a>

		
	
		
			

<a class="item" data-title="Securing a Cluster" href="/docs/tasks/administer-cluster/securing-a-cluster/"></a>

		
	
		
			

<a class="item" data-title="Set Kubelet parameters via a config file" href="/docs/tasks/administer-cluster/kubelet-config-file/"></a>

		
	
		
			

<a class="item" data-title="Set up High-Availability Kubernetes Masters" href="/docs/tasks/administer-cluster/highly-available-master/"></a>

		
	
		
			

<a class="item" data-title="Share a Cluster with Namespaces" href="/docs/tasks/administer-cluster/namespaces/"></a>

		
	
		
			

<a class="item" data-title="Using a KMS provider for data encryption" href="/docs/tasks/administer-cluster/kms-provider/"></a>

		
	
		
			

<a class="item" data-title="Using CoreDNS for Service Discovery" href="/docs/tasks/administer-cluster/coredns/"></a>

		
	
		
			

<a class="item" data-title="Using NodeLocal DNSCache in Kubernetes clusters" href="/docs/tasks/administer-cluster/nodelocaldns/"></a>

		
	
		
			

<a class="item" data-title="Using sysctls in a Kubernetes Cluster" href="/docs/tasks/administer-cluster/sysctl-cluster/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="Configure Pods and Containers">
	<div class="container">
		
		
	
	
	
	
		
			

<a class="item" data-title="Assign Memory Resources to Containers and Pods" href="/docs/tasks/configure-pod-container/assign-memory-resource/"></a>

		
	
		
			

<a class="item" data-title="Assign CPU Resources to Containers and Pods" href="/docs/tasks/configure-pod-container/assign-cpu-resource/"></a>

		
	
		
			

<a class="item" data-title="Configure GMSA for Windows Pods and containers" href="/docs/tasks/configure-pod-container/configure-gmsa/"></a>

		
	
		
			

<a class="item" data-title="Configure RunAsUserName for Windows pods and containers" href="/docs/tasks/configure-pod-container/configure-runasusername/"></a>

		
	
		
			

<a class="item" data-title="Configure Quality of Service for Pods" href="/docs/tasks/configure-pod-container/quality-service-pod/"></a>

		
	
		
			

<a class="item" data-title="Assign Extended Resources to a Container" href="/docs/tasks/configure-pod-container/extended-resource/"></a>

		
	
		
			

<a class="item" data-title="Configure a Pod to Use a Volume for Storage" href="/docs/tasks/configure-pod-container/configure-volume-storage/"></a>

		
	
		
			

<a class="item" data-title="Configure a Pod to Use a PersistentVolume for Storage" href="/docs/tasks/configure-pod-container/configure-persistent-volume-storage/"></a>

		
	
		
			

<a class="item" data-title="Configure a Pod to Use a Projected Volume for Storage" href="/docs/tasks/configure-pod-container/configure-projected-volume-storage/"></a>

		
	
		
			

<a class="item" data-title="Configure a Security Context for a Pod or Container" href="/docs/tasks/configure-pod-container/security-context/"></a>

		
	
		
			

<a class="item" data-title="Configure Service Accounts for Pods" href="/docs/tasks/configure-pod-container/configure-service-account/"></a>

		
	
		
			

<a class="item" data-title="Pull an Image from a Private Registry" href="/docs/tasks/configure-pod-container/pull-image-private-registry/"></a>

		
	
		
			

<a class="item" data-title="Configure Liveness, Readiness and Startup Probes" href="/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/"></a>

		
	
		
			

<a class="item" data-title="Assign Pods to Nodes" href="/docs/tasks/configure-pod-container/assign-pods-nodes/"></a>

		
	
		
			

<a class="item" data-title="Configure Pod Initialization" href="/docs/tasks/configure-pod-container/configure-pod-initialization/"></a>

		
	
		
			

<a class="item" data-title="Attach Handlers to Container Lifecycle Events" href="/docs/tasks/configure-pod-container/attach-handler-lifecycle-event/"></a>

		
	
		
			

<a class="item" data-title="Configure a Pod to Use a ConfigMap" href="/docs/tasks/configure-pod-container/configure-pod-configmap/"></a>

		
	
		
			

<a class="item" data-title="Share Process Namespace between Containers in a Pod" href="/docs/tasks/configure-pod-container/share-process-namespace/"></a>

		
	
		
			

<a class="item" data-title="Create static Pods" href="/docs/tasks/configure-pod-container/static-pod/"></a>

		
	
		
			

<a class="item" data-title="Translate a Docker Compose File to Kubernetes Resources" href="/docs/tasks/configure-pod-container/translate-compose-kubernetes/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="Manage Kubernetes Objects">
	<div class="container">
		
		
	
	
	
	
		
			

<a class="item" data-title="Declarative Management of Kubernetes Objects Using Configuration Files" href="/docs/tasks/manage-kubernetes-objects/declarative-config/"></a>

		
	
		
			

<a class="item" data-title="Declarative Management of Kubernetes Objects Using Kustomize" href="/docs/tasks/manage-kubernetes-objects/kustomization/"></a>

		
	
		
			

<a class="item" data-title="Managing Kubernetes Objects Using Imperative Commands" href="/docs/tasks/manage-kubernetes-objects/imperative-command/"></a>

		
	
		
			

<a class="item" data-title="Imperative Management of Kubernetes Objects Using Configuration Files" href="/docs/tasks/manage-kubernetes-objects/imperative-config/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="Inject Data Into Applications">
	<div class="container">
		
		
	
	
	
	
		
			

<a class="item" data-title="Define a Command and Arguments for a Container" href="/docs/tasks/inject-data-application/define-command-argument-container/"></a>

		
	
		
			

<a class="item" data-title="Define Environment Variables for a Container" href="/docs/tasks/inject-data-application/define-environment-variable-container/"></a>

		
	
		
			

<a class="item" data-title="Expose Pod Information to Containers Through Environment Variables" href="/docs/tasks/inject-data-application/environment-variable-expose-pod-information/"></a>

		
	
		
			

<a class="item" data-title="Expose Pod Information to Containers Through Files" href="/docs/tasks/inject-data-application/downward-api-volume-expose-pod-information/"></a>

		
	
		
			

<a class="item" data-title="Distribute Credentials Securely Using Secrets" href="/docs/tasks/inject-data-application/distribute-credentials-secure/"></a>

		
	
		
			

<a class="item" data-title="Inject Information into Pods Using a PodPreset" href="/docs/tasks/inject-data-application/podpreset/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="Run Applications">
	<div class="container">
		
		
	
	
	
	
		
			

<a class="item" data-title="Run a Stateless Application Using a Deployment" href="/docs/tasks/run-application/run-stateless-application-deployment/"></a>

		
	
		
			

<a class="item" data-title="Run a Single-Instance Stateful Application" href="/docs/tasks/run-application/run-single-instance-stateful-application/"></a>

		
	
		
			

<a class="item" data-title="Run a Replicated Stateful Application" href="/docs/tasks/run-application/run-replicated-stateful-application/"></a>

		
	
		
			

<a class="item" data-title="Update API Objects in Place Using kubectl patch" href="/docs/tasks/run-application/update-api-object-kubectl-patch/"></a>

		
	
		
			

<a class="item" data-title="Scale a StatefulSet" href="/docs/tasks/run-application/scale-stateful-set/"></a>

		
	
		
			

<a class="item" data-title="Delete a StatefulSet" href="/docs/tasks/run-application/delete-stateful-set/"></a>

		
	
		
			

<a class="item" data-title="Force Delete StatefulSet Pods" href="/docs/tasks/run-application/force-delete-stateful-set-pod/"></a>

		
	
		
			

<a class="item" data-title="Perform Rolling Update Using a Replication Controller" href="/docs/tasks/run-application/rolling-update-replication-controller/"></a>

		
	
		
			

<a class="item" data-title="Horizontal Pod Autoscaler" href="/docs/tasks/run-application/horizontal-pod-autoscale/"></a>

		
	
		
			

<a class="item" data-title="Horizontal Pod Autoscaler Walkthrough" href="/docs/tasks/run-application/horizontal-pod-autoscale-walkthrough/"></a>

		
	
		
			

<a class="item" data-title="Specifying a Disruption Budget for your Application" href="/docs/tasks/run-application/configure-pdb/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="Run Jobs">
	<div class="container">
		
		
	
	
	
	
		
			

<a class="item" data-title="Running Automated Tasks with a CronJob" href="/docs/tasks/job/automated-tasks-with-cron-jobs/"></a>

		
	
		
			

<a class="item" data-title="Parallel Processing using Expansions" href="/docs/tasks/job/parallel-processing-expansion/"></a>

		
	
		
			

<a class="item" data-title="Coarse Parallel Processing Using a Work Queue" href="/docs/tasks/job/coarse-parallel-processing-work-queue/"></a>

		
	
		
			

<a class="item" data-title="Fine Parallel Processing Using a Work Queue" href="/docs/tasks/job/fine-parallel-processing-work-queue/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="Access Applications in a Cluster">
	<div class="container">
		
		
	
	
	
	
		
			

<a class="item" data-title="Web UI (Dashboard)" href="/docs/tasks/access-application-cluster/web-ui-dashboard/"></a>

		
	
		
			

<a class="item" data-title="Accessing Clusters" href="/docs/tasks/access-application-cluster/access-cluster/"></a>

		
	
		
			

<a class="item" data-title="Configure Access to Multiple Clusters" href="/docs/tasks/access-application-cluster/configure-access-multiple-clusters/"></a>

		
	
		
			

<a class="item" data-title="Use Port Forwarding to Access Applications in a Cluster" href="/docs/tasks/access-application-cluster/port-forward-access-application-cluster/"></a>

		
	
		
			

<a class="item" data-title="Use a Service to Access an Application in a Cluster" href="/docs/tasks/access-application-cluster/service-access-application-cluster/"></a>

		
	
		
			

<a class="item" data-title="Connect a Front End to a Back End Using a Service" href="/docs/tasks/access-application-cluster/connecting-frontend-backend/"></a>

		
	
		
			

<a class="item" data-title="Create an External Load Balancer" href="/docs/tasks/access-application-cluster/create-external-load-balancer/"></a>

		
	
		
			

<a class="item" data-title="Configure Your Cloud Provider&#39;s Firewalls" href="/docs/tasks/access-application-cluster/configure-cloud-provider-firewall/"></a>

		
	
		
			

<a class="item" data-title="List All Container Images Running in a Cluster" href="/docs/tasks/access-application-cluster/list-all-running-container-images/"></a>

		
	
		
			

<a class="item" data-title="Set up Ingress on Minikube with the NGINX Ingress Controller" href="/docs/tasks/access-application-cluster/ingress-minikube/"></a>

		
	
		
			

<a class="item" data-title="Communicate Between Containers in the Same Pod Using a Shared Volume" href="/docs/tasks/access-application-cluster/communicate-containers-same-pod-shared-volume/"></a>

		
	
		
			

<a class="item" data-title="Configure DNS for a Cluster" href="/docs/tasks/access-application-cluster/configure-dns-cluster/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="Monitoring, Logging, and Debugging">
	<div class="container">
		
		
	
	
	
	
		
			

<a class="item" data-title="Application Introspection and Debugging" href="/docs/tasks/debug-application-cluster/debug-application-introspection/"></a>

		
	
		
			

<a class="item" data-title="Auditing" href="/docs/tasks/debug-application-cluster/audit/"></a>

		
	
		
			

<a class="item" data-title="Auditing with Falco" href="/docs/tasks/debug-application-cluster/falco/"></a>

		
	
		
			

<a class="item" data-title="Debug a StatefulSet" href="/docs/tasks/debug-application-cluster/debug-stateful-set/"></a>

		
	
		
			

<a class="item" data-title="Debug Init Containers" href="/docs/tasks/debug-application-cluster/debug-init-containers/"></a>

		
	
		
			

<a class="item" data-title="Debug Pods and ReplicationControllers" href="/docs/tasks/debug-application-cluster/debug-pod-replication-controller/"></a>

		
	
		
			

<a class="item" data-title="Debug Services" href="/docs/tasks/debug-application-cluster/debug-service/"></a>

		
	
		
			

<a class="item" data-title="Debugging Kubernetes nodes with crictl" href="/docs/tasks/debug-application-cluster/crictl/"></a>

		
	
		
			

<a class="item" data-title="Determine the Reason for Pod Failure" href="/docs/tasks/debug-application-cluster/determine-reason-pod-failure/"></a>

		
	
		
			

<a class="item" data-title="Developing and debugging services locally" href="/docs/tasks/debug-application-cluster/local-debugging/"></a>

		
	
		
			

<a class="item" data-title="Events in Stackdriver" href="/docs/tasks/debug-application-cluster/events-stackdriver/"></a>

		
	
		
			

<a class="item" data-title="Get a Shell to a Running Container" href="/docs/tasks/debug-application-cluster/get-shell-running-container/"></a>

		
	
		
			

<a class="item" data-title="Logging Using Elasticsearch and Kibana" href="/docs/tasks/debug-application-cluster/logging-elasticsearch-kibana/"></a>

		
	
		
			

<a class="item" data-title="Logging Using Stackdriver" href="/docs/tasks/debug-application-cluster/logging-stackdriver/"></a>

		
	
		
			

<a class="item" data-title="Monitor Node Health" href="/docs/tasks/debug-application-cluster/monitor-node-health/"></a>

		
	
		
			

<a class="item" data-title="Resource metrics pipeline" href="/docs/tasks/debug-application-cluster/resource-metrics-pipeline/"></a>

		
	
		
			

<a class="item" data-title="Tools for Monitoring Resources" href="/docs/tasks/debug-application-cluster/resource-usage-monitoring/"></a>

		
	
		
			

<a class="item" data-title="Troubleshoot Applications" href="/docs/tasks/debug-application-cluster/debug-application/"></a>

		
	
		
			

<a class="item" data-title="Troubleshoot Clusters" href="/docs/tasks/debug-application-cluster/debug-cluster/"></a>

		
	
		
			

<a class="item" data-title="Troubleshooting" href="/docs/tasks/debug-application-cluster/troubleshooting/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="Extend Kubernetes">
	<div class="container">
		
		
	
	
	
	
		
			

<a class="item" data-title="Configure the Aggregation Layer" href="/docs/tasks/access-kubernetes-api/configure-aggregation-layer/"></a>

		
	
		
			
<div class="item" data-title="Use Custom Resources">
	<div class="container">
		
		
	
	
	
	
		
			

<a class="item" data-title="Extend the Kubernetes API with CustomResourceDefinitions" href="/docs/tasks/access-kubernetes-api/custom-resources/custom-resource-definitions/"></a>

		
	
		
			

<a class="item" data-title="Versions in CustomResourceDefinitions" href="/docs/tasks/access-kubernetes-api/custom-resources/custom-resource-definition-versioning/"></a>

		
	

	</div>
</div>

		
	
		
			

<a class="item" data-title="Setup an Extension API Server" href="/docs/tasks/access-kubernetes-api/setup-extension-api-server/"></a>

		
	
		
			

<a class="item" data-title="Use an HTTP Proxy to Access the Kubernetes API" href="/docs/tasks/access-kubernetes-api/http-proxy-access-api/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="TLS">
	<div class="container">
		
		
	
	
	
	
		
			

<a class="item" data-title="Certificate Rotation" href="/docs/tasks/tls/certificate-rotation/"></a>

		
	
		
			

<a class="item" data-title="Manage TLS Certificates in a Cluster" href="/docs/tasks/tls/managing-tls-in-a-cluster/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="Manage Cluster Daemons">
	<div class="container">
		
		
	
	
	
	
		
			

<a class="item" data-title="Perform a Rolling Update on a DaemonSet" href="/docs/tasks/manage-daemon/update-daemon-set/"></a>

		
	
		
			

<a class="item" data-title="Perform a Rollback on a DaemonSet" href="/docs/tasks/manage-daemon/rollback-daemon-set/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="Install Service Catalog">
	<div class="container">
		
		
	
	
	
	
		
			

<a class="item" data-title="Install Service Catalog using Helm" href="/docs/tasks/service-catalog/install-service-catalog-using-helm/"></a>

		
	
		
			

<a class="item" data-title="Install Service Catalog using SC" href="/docs/tasks/service-catalog/install-service-catalog-using-sc/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="Network">
	<div class="container">
		
		
	
	
	
	
		
			

<a class="item" data-title="Validate IPv4/IPv6 dual-stack" href="/docs/tasks/network/validate-dual-stack/"></a>

		
	

	</div>
</div>

		
	
		
			

<a class="item" data-title="Extend kubectl with plugins" href="/docs/tasks/extend-kubectl/kubectl-plugins/"></a>

		
	
		
			

<a class="item" data-title="Manage HugePages" href="/docs/tasks/manage-hugepages/scheduling-hugepages/"></a>

		
	
		
			

<a class="item" data-title="Schedule GPUs" href="/docs/tasks/manage-gpus/scheduling-gpus/"></a>

		
	





     </div> 
    <button class="push-menu-close-button" onclick="kub.toggleToc()"></button>
</div> 


          <div id="docsContent">
            

<p>
  <a href="https://github.com/kubernetes/website/edit/master/content/en/docs/tasks/access-kubernetes-api/custom-resources/custom-resource-definition-versioning.md" id="editPageButton" target="_blank">
    Edit This Page
  </a>
</p>

<h1>Versions in CustomResourceDefinitions</h1>




<p>This page explains how to add versioning information to
<a href="/docs/reference/generated/kubernetes-api/v1.17/#customresourcedefinition-v1beta1-apiextensions">CustomResourceDefinitions</a>, to indicate the stability
level of your CustomResourceDefinitions or advance your API to a new version with conversion between API representations. It also describes how to upgrade an object from one version to another.</p>











<ul id="markdown-toc">










<li><a href="#before-you-begin">Before you begin</a></li>












<li><a href="#overview">Overview</a></li>




<li><a href="#specify-multiple-versions">Specify multiple versions</a></li>




<li><a href="#webhook-conversion">Webhook conversion</a></li>




<li><a href="#webhook-request-and-response">Webhook request and response</a></li>




<li><a href="#writing-reading-and-updating-versioned-customresourcedefinition-objects">Writing, reading, and updating versioned CustomResourceDefinition objects</a></li>




<li><a href="#upgrade-existing-objects-to-a-new-stored-version">Upgrade existing objects to a new stored version</a></li>



























</ul>



<h2 id="before-you-begin">Before you begin</h2>
<p>You need to have a Kubernetes cluster, and the kubectl command-line tool must
be configured to communicate with your cluster. If you do not already have a
cluster, you can create one by using
<a href="/docs/setup/learning-environment/minikube/">Minikube</a>,
or you can use one of these Kubernetes playgrounds:</p>

<ul>
<li><a href="https://www.katacoda.com/courses/kubernetes/playground" target="_blank">Katacoda</a></li>
<li><a href="http://labs.play-with-k8s.com/" target="_blank">Play with Kubernetes</a></li>
</ul>

<p>You should have a initial understanding of <a href="/docs/concepts/api-extension/custom-resources/">custom resources</a>.</p>

<p>Your Kubernetes server must be at or later than version v1.16.
 To check the version, enter <code>kubectl version</code>.</p>




<h2 id="overview">Overview</h2>

<p>The CustomResourceDefinition API provides a workflow for introducing and upgrading
to new versions of a CustomResourceDefinition.</p>

<p>When a CustomResourceDefinition is created, the first version is set in the
CustomResourceDefinition <code>spec.versions</code> list to an appropriate stability level
and a version number. For example <code>v1beta1</code> would indicate that the first
version is not yet stable. All custom resource objects will initially be stored
at this version.</p>

<p>Once the CustomResourceDefinition is created, clients may begin using the
<code>v1beta1</code> API.</p>

<p>Later it might be necessary to add new version such as <code>v1</code>.</p>

<p>Adding a new version:</p>

<ol>
<li>Pick a conversion strategy. Since custom resource objects need to be able to
be served at both versions, that means they will sometimes be served at a
different version than their storage version. In order for this to be
possible, the custom resource objects must sometimes be converted between the
version they are stored at and the version they are served at. If the
conversion involves schema changes and requires custom logic, a conversion
webhook should be used. If there are no schema changes, the default <code>None</code>
conversion strategy may be used and only the <code>apiVersion</code> field will be
modified when serving different versions.</li>
<li>If using conversion webhooks, create and deploy the conversion webhook. See
the <a href="#webhook-conversion">Webhook conversion</a> for more details.</li>
<li>Update the CustomResourceDefinition to include the new version in the
<code>spec.versions</code> list with <code>served:true</code>.  Also, set <code>spec.conversion</code> field
to the selected conversion strategy. If using a conversion webhook, configure
<code>spec.conversion.webhookClientConfig</code> field to call the webhook.</li>
</ol>

<p>Once the new version is added, clients may incrementally migrate to the new
version. It is perfectly safe for some clients to use the old version while
others use the new version.</p>

<p>Migrate stored objects to the new version:</p>

<ol>
<li>See the <a href="#upgrade-existing-objects-to-a-new-stored-version">upgrade existing objects to a new stored version</a> section.</li>
</ol>

<p>It is safe for clients to use both the old and new version before, during and
after upgrading the objects to a new stored version.</p>

<p>Removing an old version:</p>

<ol>
<li>Ensure all clients are fully migrated to the new version. The kube-apiserver
logs can reviewed to help identify any clients that are still accessing via
the old version.</li>
<li>Set <code>served</code> to <code>false</code> for the old version in the <code>spec.versions</code> list. If
any clients are still unexpectedly using the old version they may begin reporting
errors attempting to access the custom resource objects at the old version.
If this occurs, switch back to using <code>served:true</code> on the old version, migrate the
remaining clients to the new version and repeat this step.</li>
<li>Ensure the <a href="#upgrade-existing-objects-to-a-new-stored-version">upgrade of existing objects to the new stored version</a> step has been completed.

<ol>
<li>Verify that the <code>stored</code> is set to <code>true</code> for the new version in the <code>spec.versions</code> list in the CustomResourceDefinition.</li>
<li>Verify that the old version is no longer listed in the CustomResourceDefinition <code>status.storedVersions</code>.</li>
</ol></li>
<li>Remove the old version from the CustomResourceDefinition <code>spec.versions</code> list.</li>
<li>Drop conversion support for the old version in conversion webhooks.</li>
</ol>

<h2 id="specify-multiple-versions">Specify multiple versions</h2>

<p>The CustomResourceDefinition API <code>versions</code> field can be used to support multiple versions of custom resources that you
have developed. Versions can have different schemas, and conversion webhooks can convert custom resources between versions.
Webhook conversions should follow the <a href="https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md" target="_blank">Kubernetes API conventions</a> wherever applicable.
Specifically, See the <a href="https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api_changes.md" target="_blank">API change documentation</a> for a set of useful gotchas and suggestions.</p>

<blockquote class="note">
  <div><strong>Note:</strong> In <code>apiextensions.k8s.io/v1beta1</code>, there was a <code>version</code> field instead of <code>versions</code>. The
<code>version</code> field is deprecated and optional, but if it is not empty, it must
match the first item in the <code>versions</code> field.</div>
</blockquote>

<p>This example shows a CustomResourceDefinition with two versions. For the first
example, the assumption is all versions share the same schema with no conversion
between them. The comments in the YAML provide more context.</p>

<div id="customresourcedefinition-versioning-example-1">
<ul>
    
      
  <li><a href="#customresourcedefinition-versioning-example-1-0">apiextensions.k8s.io/v1</a></li>

      
  <li><a href="#customresourcedefinition-versioning-example-1-1">apiextensions.k8s.io/v1beta1</a></li>

</ul>


<div id="customresourcedefinition-versioning-example-1-0">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>apiextensions.k8s.io/v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>CustomResourceDefinition<span style="color:#bbb">
</span><span style="color:#bbb"></span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># name must match the spec fields below, and be in the form: &lt;plural&gt;.&lt;group&gt;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>name:<span style="color:#bbb"> </span>crontabs.example.com<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># group name to use for REST API: /apis/&lt;group&gt;/&lt;version&gt;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>group:<span style="color:#bbb"> </span>example.com<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># list of versions supported by this CustomResourceDefinition</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>versions:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>v1beta1<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># Each version can be enabled/disabled by Served flag.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>served:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># One and only one version must be marked as the storage version.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>storage:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># A schema is required</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>schema:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>openAPIV3Schema:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>type:<span style="color:#bbb"> </span>object<span style="color:#bbb">
</span><span style="color:#bbb">        </span>properties:<span style="color:#bbb">
</span><span style="color:#bbb">          </span>host:<span style="color:#bbb">
</span><span style="color:#bbb">            </span>type:<span style="color:#bbb"> </span>string<span style="color:#bbb">
</span><span style="color:#bbb">          </span>port:<span style="color:#bbb">
</span><span style="color:#bbb">            </span>type:<span style="color:#bbb"> </span>string<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb">    </span>served:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>storage:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">false</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>schema:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>openAPIV3Schema:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>type:<span style="color:#bbb"> </span>object<span style="color:#bbb">
</span><span style="color:#bbb">        </span>properties:<span style="color:#bbb">
</span><span style="color:#bbb">          </span>host:<span style="color:#bbb">
</span><span style="color:#bbb">            </span>type:<span style="color:#bbb"> </span>string<span style="color:#bbb">
</span><span style="color:#bbb">          </span>port:<span style="color:#bbb">
</span><span style="color:#bbb">            </span>type:<span style="color:#bbb"> </span>string<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># The conversion section is introduced in Kubernetes 1.13+ with a default value of</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># None conversion (strategy sub-field set to None).</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>conversion:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># None conversion assumes the same schema for all versions and only sets the apiVersion</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># field of custom resources to the proper value</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>strategy:<span style="color:#bbb"> </span>None<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># either Namespaced or Cluster</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>scope:<span style="color:#bbb"> </span>Namespaced<span style="color:#bbb">
</span><span style="color:#bbb">  </span>names:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># plural name to be used in the URL: /apis/&lt;group&gt;/&lt;version&gt;/&lt;plural&gt;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>plural:<span style="color:#bbb"> </span>crontabs<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># singular name to be used as an alias on the CLI and for display</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>singular:<span style="color:#bbb"> </span>crontab<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># kind is normally the CamelCased singular type. Your resource manifests use this.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>kind:<span style="color:#bbb"> </span>CronTab<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># shortNames allow shorter string to match your resource on the CLI</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>shortNames:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-<span style="color:#bbb"> </span>ct</code></pre></div>
    

<p></div></p>

<div id="customresourcedefinition-versioning-example-1-1">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#080;font-style:italic"># Deprecated in v1.16 in favor of apiextensions.k8s.io/v1</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>apiVersion:<span style="color:#bbb"> </span>apiextensions.k8s.io/v1beta1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>CustomResourceDefinition<span style="color:#bbb">
</span><span style="color:#bbb"></span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># name must match the spec fields below, and be in the form: &lt;plural&gt;.&lt;group&gt;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>name:<span style="color:#bbb"> </span>crontabs.example.com<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># group name to use for REST API: /apis/&lt;group&gt;/&lt;version&gt;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>group:<span style="color:#bbb"> </span>example.com<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># list of versions supported by this CustomResourceDefinition</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>versions:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>v1beta1<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># Each version can be enabled/disabled by Served flag.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>served:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># One and only one version must be marked as the storage version.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>storage:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb">    </span>served:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>storage:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">false</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>validation:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>openAPIV3Schema:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>type:<span style="color:#bbb"> </span>object<span style="color:#bbb">
</span><span style="color:#bbb">      </span>properties:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>host:<span style="color:#bbb">
</span><span style="color:#bbb">          </span>type:<span style="color:#bbb"> </span>string<span style="color:#bbb">
</span><span style="color:#bbb">        </span>port:<span style="color:#bbb">
</span><span style="color:#bbb">          </span>type:<span style="color:#bbb"> </span>string<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># The conversion section is introduced in Kubernetes 1.13+ with a default value of</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># None conversion (strategy sub-field set to None).</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>conversion:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># None conversion assumes the same schema for all versions and only sets the apiVersion</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># field of custom resources to the proper value</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>strategy:<span style="color:#bbb"> </span>None<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># either Namespaced or Cluster</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>scope:<span style="color:#bbb"> </span>Namespaced<span style="color:#bbb">
</span><span style="color:#bbb">  </span>names:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># plural name to be used in the URL: /apis/&lt;group&gt;/&lt;version&gt;/&lt;plural&gt;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>plural:<span style="color:#bbb"> </span>crontabs<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># singular name to be used as an alias on the CLI and for display</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>singular:<span style="color:#bbb"> </span>crontab<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># kind is normally the CamelCased singular type. Your resource manifests use this.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>kind:<span style="color:#bbb"> </span>CronTab<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># shortNames allow shorter string to match your resource on the CLI</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>shortNames:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-<span style="color:#bbb"> </span>ct</code></pre></div>
    

<p></div></p>

<p></div></p>

<script>$(function(){$("#customresourcedefinition-versioning-example-1").tabs();});</script>

<p>You can save the CustomResourceDefinition in a YAML file, then use
<code>kubectl apply</code> to create it.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl apply -f my-versioned-crontab.yaml</code></pre></div>
<p>After creation, the API server starts to serve each enabled version at an HTTP
REST endpoint. In the above example, the API versions are available at
<code>/apis/example.com/v1beta1</code> and <code>/apis/example.com/v1</code>.</p>

<h3 id="version-priority">Version priority</h3>

<p>Regardless of the order in which versions are defined in a
CustomResourceDefinition, the version with the highest priority is used by
kubectl as the default version to access objects. The priority is determined
by parsing the <em>name</em> field to determine the version number, the stability
(GA, Beta, or Alpha), and the sequence within that stability level.</p>

<p>The algorithm used for sorting the versions is designed to sort versions in the
same way that the Kubernetes project sorts Kubernetes versions. Versions start with a
<code>v</code> followed by a number, an optional <code>beta</code> or <code>alpha</code> designation, and
optional additional numeric versioning information. Broadly, a version string might look
like <code>v2</code> or <code>v2beta1</code>. Versions are sorted using the following algorithm:</p>

<ul>
<li>Entries that follow Kubernetes version patterns are sorted before those that
do not.</li>
<li>For entries that follow Kubernetes version patterns, the numeric portions of
the version string is sorted largest to smallest.</li>
<li>If the strings <code>beta</code> or <code>alpha</code> follow the first numeric portion, they sorted
in that order, after the equivalent string without the <code>beta</code> or <code>alpha</code>
suffix (which is presumed to be the GA version).</li>
<li>If another number follows the <code>beta</code>, or <code>alpha</code>, those numbers are also
sorted from largest to smallest.</li>
<li>Strings that don&rsquo;t fit the above format are sorted alphabetically and the
numeric portions are not treated specially. Notice that in the example below,
<code>foo1</code> is sorted above <code>foo10</code>. This is different from the sorting of the
numeric portion of entries that do follow the Kubernetes version patterns.</li>
</ul>

<p>This might make sense if you look at the following sorted version list:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-none" data-lang="none">- v10
- v2
- v1
- v11beta2
- v10beta3
- v3beta1
- v12alpha1
- v11alpha2
- foo1
- foo10</code></pre></div>
<p>For the example in <a href="#specify-multiple-versions">Specify multiple versions</a>, the
version sort order is <code>v1</code>, followed by <code>v1beta1</code>. This causes the kubectl
command to use <code>v1</code> as the default version unless the provided object specifies
the version.</p>

<h2 id="webhook-conversion">Webhook conversion</h2>

<div style="margin-top: 10px; margin-bottom: 10px;">



<b>FEATURE STATE:</b> <code>Kubernetes 1.16</code>




    
    
    
    
    
<a href="#" id="feature-state-dialog-link" class="ui-state-default ui-corner-all"><span class="ui-icon ui-icon-newwin"></span>stable</a>
<div id="feature-state-dialog" class="ui-dialog-content" title="stable">
This feature is <em>stable</em>, meaning:</p>

<ul>
<li>The version name is vX where X is an integer.</li>
<li>Stable versions of features will appear in released software for many subsequent versions.</li>
</ul>
</div>
<script>
$(function(){
    
    $( "#feature-state-dialog" ).dialog({
        autoOpen: false,
        width: "600",
        buttons: [
            {
                text: "Ok",
                click: function() {
                    $( this ).dialog( "close" );
                }
            }
        ]
    });

    
    $( "#feature-state-dialog-link" ).click(function( event ) {
        $( "#feature-state-dialog" ).dialog( "open" );
        event.preventDefault();
    });

});
</script>

    

</div>

<blockquote class="note">
  <div><strong>Note:</strong> Webhook conversion is available as beta since 1.15, and as alpha since Kubernetes 1.13. The
<code>CustomResourceWebhookConversion</code> feature must be enabled, which is the case automatically for many clusters for beta features. Please refer to the <a href="/docs/reference/command-line-tools-reference/feature-gates/">feature gate</a> documentation for more information.</div>
</blockquote>

<p>The above example has a None conversion between versions which only sets the <code>apiVersion</code> field
on conversion and does not change the rest of the object. The API server also supports webhook
conversions that call an external service in case a conversion is required. For example when:</p>

<ul>
<li>custom resource is requested in a different version than stored version.</li>
<li>Watch is created in one version but the changed object is stored in another version.</li>
<li>custom resource PUT request is in a different version than storage version.</li>
</ul>

<p>To cover all of these cases and to optimize conversion by the API server, the conversion requests may contain multiple objects in order to minimize the external calls. The webhook should perform these conversions independently.</p>

<h3 id="write-a-conversion-webhook-server">Write a conversion webhook server</h3>

<p>Please refer to the implementation of the <a href="https://github.com/kubernetes/kubernetes/tree/v1.15.0/test/images/crd-conversion-webhook/main.go" target="_blank">custom resource conversion webhook
server</a>
that is validated in a Kubernetes e2e test. The webhook handles the
<code>ConversionReview</code> requests sent by the API servers, and sends back conversion
results wrapped in <code>ConversionResponse</code>. Note that the request
contains a list of custom resources that need to be converted independently without
changing the order of objects.
The example server is organized in a way to be reused for other conversions. Most of the common code are located in the <a href="https://github.com/kubernetes/kubernetes/tree/v1.15.0/test/images/crd-conversion-webhook/converter/framework.go" target="_blank">framework file</a> that leaves only <a href="https://github.com/kubernetes/kubernetes/blob/v1.15.0/test/images/crd-conversion-webhook/converter/example_converter.go#L29-L80" target="_blank">one function</a> to be implemented for different conversions.</p>

<blockquote class="note">
  <div><strong>Note:</strong> The example conversion webhook server leaves the <code>ClientAuth</code> field
<a href="https://github.com/kubernetes/kubernetes/tree/v1.13.0/test/images/crd-conversion-webhook/config.go#L47-L48" target="_blank">empty</a>,
which defaults to <code>NoClientCert</code>. This means that the webhook server does not
authenticate the identity of the clients, supposedly API servers. If you need
mutual TLS or other ways to authenticate the clients, see
how to <a href="/docs/reference/access-authn-authz/extensible-admission-controllers/#authenticate-apiservers">authenticate API servers</a>.</div>
</blockquote>

<h4 id="permissible-mutations">Permissible mutations</h4>

<p>A conversion webhook must not mutate anything inside of <code>metadata</code> of the converted object other than <code>labels</code> and <code>annotations</code>. Attempted changes to <code>name</code>, <code>UID</code> and <code>namespace</code> are rejected and fail the request which caused the conversion. All other changes are just ignored.</p>

<h3 id="deploy-the-conversion-webhook-service">Deploy the conversion webhook service</h3>

<p>Documentation for deploying the conversion webhook is the same as for the <a href="/docs/reference/access-authn-authz/extensible-admission-controllers/#deploy_the_admission_webhook_service">admission webhook example service</a>.
The assumption for next sections is that the conversion webhook server is deployed to a service named <code>example-conversion-webhook-server</code> in <code>default</code> namespace and serving traffic on path <code>/crdconvert</code>.</p>

<blockquote class="note">
  <div><strong>Note:</strong> When the webhook server is deployed into the Kubernetes cluster as a
service, it has to be exposed via a service on port 443 (The server
itself can have an arbitrary port but the service object should map it to port 443).
The communication between the API server and the webhook service may fail
if a different port is used for the service.</div>
</blockquote>

<h3 id="configure-customresourcedefinition-to-use-conversion-webhooks">Configure CustomResourceDefinition to use conversion webhooks</h3>

<p>The <code>None</code> conversion example can be extended to use the conversion webhook by modifying <code>conversion</code>
section of the <code>spec</code>:</p>

<div id="customresourcedefinition-versioning-example-2">
<ul>
    
      
  <li><a href="#customresourcedefinition-versioning-example-2-0">apiextensions.k8s.io/v1</a></li>

      
  <li><a href="#customresourcedefinition-versioning-example-2-1">apiextensions.k8s.io/v1beta1</a></li>

</ul>


<div id="customresourcedefinition-versioning-example-2-0">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>apiextensions.k8s.io/v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>CustomResourceDefinition<span style="color:#bbb">
</span><span style="color:#bbb"></span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># name must match the spec fields below, and be in the form: &lt;plural&gt;.&lt;group&gt;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>name:<span style="color:#bbb"> </span>crontabs.example.com<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># group name to use for REST API: /apis/&lt;group&gt;/&lt;version&gt;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>group:<span style="color:#bbb"> </span>example.com<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># list of versions supported by this CustomResourceDefinition</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>versions:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>v1beta1<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># Each version can be enabled/disabled by Served flag.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>served:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># One and only one version must be marked as the storage version.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>storage:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># Each version can define it&#39;s own schema when there is no top-level</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># schema is defined.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>schema:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>openAPIV3Schema:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>type:<span style="color:#bbb"> </span>object<span style="color:#bbb">
</span><span style="color:#bbb">        </span>properties:<span style="color:#bbb">
</span><span style="color:#bbb">          </span>hostPort:<span style="color:#bbb">
</span><span style="color:#bbb">            </span>type:<span style="color:#bbb"> </span>string<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb">    </span>served:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>storage:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">false</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>schema:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>openAPIV3Schema:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>type:<span style="color:#bbb"> </span>object<span style="color:#bbb">
</span><span style="color:#bbb">        </span>properties:<span style="color:#bbb">
</span><span style="color:#bbb">          </span>host:<span style="color:#bbb">
</span><span style="color:#bbb">            </span>type:<span style="color:#bbb"> </span>string<span style="color:#bbb">
</span><span style="color:#bbb">          </span>port:<span style="color:#bbb">
</span><span style="color:#bbb">            </span>type:<span style="color:#bbb"> </span>string<span style="color:#bbb">
</span><span style="color:#bbb">  </span>conversion:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># a Webhook strategy instruct API server to call an external webhook for any conversion between custom resources.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>strategy:<span style="color:#bbb"> </span>Webhook<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># webhook is required when strategy is `Webhook` and it configures the webhook endpoint to be called by API server.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>webhook:<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># conversionReviewVersions indicates what ConversionReview versions are understood/preferred by the webhook.</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># The first version in the list understood by the API server is sent to the webhook.</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#080;font-style:italic"># The webhook must respond with a ConversionReview object in the same version it received.</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span>conversionReviewVersions:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;v1&#34;</span>,<span style="color:#b44">&#34;v1beta1&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">      </span>clientConfig:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>service:<span style="color:#bbb">
</span><span style="color:#bbb">          </span>namespace:<span style="color:#bbb"> </span>default<span style="color:#bbb">
</span><span style="color:#bbb">          </span>name:<span style="color:#bbb"> </span>example-conversion-webhook-server<span style="color:#bbb">
</span><span style="color:#bbb">          </span>path:<span style="color:#bbb"> </span>/crdconvert<span style="color:#bbb">
</span><span style="color:#bbb">        </span>caBundle:<span style="color:#bbb"> </span><span style="color:#b44">&#34;Ci0tLS0tQk...&lt;base64-encoded PEM bundle&gt;...tLS0K&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># either Namespaced or Cluster</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>scope:<span style="color:#bbb"> </span>Namespaced<span style="color:#bbb">
</span><span style="color:#bbb">  </span>names:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># plural name to be used in the URL: /apis/&lt;group&gt;/&lt;version&gt;/&lt;plural&gt;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>plural:<span style="color:#bbb"> </span>crontabs<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># singular name to be used as an alias on the CLI and for display</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>singular:<span style="color:#bbb"> </span>crontab<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># kind is normally the CamelCased singular type. Your resource manifests use this.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>kind:<span style="color:#bbb"> </span>CronTab<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># shortNames allow shorter string to match your resource on the CLI</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>shortNames:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-<span style="color:#bbb"> </span>ct</code></pre></div>
    

<p></div></p>

<div id="customresourcedefinition-versioning-example-2-1">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#080;font-style:italic"># Deprecated in v1.16 in favor of apiextensions.k8s.io/v1</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>apiVersion:<span style="color:#bbb"> </span>apiextensions.k8s.io/v1beta1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>CustomResourceDefinition<span style="color:#bbb">
</span><span style="color:#bbb"></span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># name must match the spec fields below, and be in the form: &lt;plural&gt;.&lt;group&gt;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>name:<span style="color:#bbb"> </span>crontabs.example.com<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># group name to use for REST API: /apis/&lt;group&gt;/&lt;version&gt;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>group:<span style="color:#bbb"> </span>example.com<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># prunes object fields that are not specified in OpenAPI schemas below.</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>preserveUnknownFields:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">false</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># list of versions supported by this CustomResourceDefinition</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>versions:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>v1beta1<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># Each version can be enabled/disabled by Served flag.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>served:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># One and only one version must be marked as the storage version.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>storage:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># Each version can define it&#39;s own schema when there is no top-level</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># schema is defined.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>schema:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>openAPIV3Schema:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>type:<span style="color:#bbb"> </span>object<span style="color:#bbb">
</span><span style="color:#bbb">        </span>properties:<span style="color:#bbb">
</span><span style="color:#bbb">          </span>hostPort:<span style="color:#bbb">
</span><span style="color:#bbb">            </span>type:<span style="color:#bbb"> </span>string<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb">    </span>served:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>storage:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">false</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>schema:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>openAPIV3Schema:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>type:<span style="color:#bbb"> </span>object<span style="color:#bbb">
</span><span style="color:#bbb">        </span>properties:<span style="color:#bbb">
</span><span style="color:#bbb">          </span>host:<span style="color:#bbb">
</span><span style="color:#bbb">            </span>type:<span style="color:#bbb"> </span>string<span style="color:#bbb">
</span><span style="color:#bbb">          </span>port:<span style="color:#bbb">
</span><span style="color:#bbb">            </span>type:<span style="color:#bbb"> </span>string<span style="color:#bbb">
</span><span style="color:#bbb">  </span>conversion:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># a Webhook strategy instruct API server to call an external webhook for any conversion between custom resources.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>strategy:<span style="color:#bbb"> </span>Webhook<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># webhookClientConfig is required when strategy is `Webhook` and it configures the webhook endpoint to be called by API server.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>webhookClientConfig:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>service:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>namespace:<span style="color:#bbb"> </span>default<span style="color:#bbb">
</span><span style="color:#bbb">        </span>name:<span style="color:#bbb"> </span>example-conversion-webhook-server<span style="color:#bbb">
</span><span style="color:#bbb">        </span>path:<span style="color:#bbb"> </span>/crdconvert<span style="color:#bbb">
</span><span style="color:#bbb">      </span>caBundle:<span style="color:#bbb"> </span><span style="color:#b44">&#34;Ci0tLS0tQk...&lt;base64-encoded PEM bundle&gt;...tLS0K&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># either Namespaced or Cluster</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>scope:<span style="color:#bbb"> </span>Namespaced<span style="color:#bbb">
</span><span style="color:#bbb">  </span>names:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># plural name to be used in the URL: /apis/&lt;group&gt;/&lt;version&gt;/&lt;plural&gt;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>plural:<span style="color:#bbb"> </span>crontabs<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># singular name to be used as an alias on the CLI and for display</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>singular:<span style="color:#bbb"> </span>crontab<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># kind is normally the CamelCased singular type. Your resource manifests use this.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>kind:<span style="color:#bbb"> </span>CronTab<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># shortNames allow shorter string to match your resource on the CLI</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>shortNames:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-<span style="color:#bbb"> </span>ct</code></pre></div>
    

<p></div></p>

<p></div></p>

<script>$(function(){$("#customresourcedefinition-versioning-example-2").tabs();});</script>

<p>You can save the CustomResourceDefinition in a YAML file, then use
<code>kubectl apply</code> to apply it.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl apply -f my-versioned-crontab-with-conversion.yaml</code></pre></div>
<p>Make sure the conversion service is up and running before applying new changes.</p>

<h3 id="contacting-the-webhook">Contacting the webhook</h3>

<p>Once the API server has determined a request should be sent to a conversion webhook,
it needs to know how to contact the webhook. This is specified in the <code>webhookClientConfig</code>
stanza of the webhook configuration.</p>

<p>Conversion webhooks can either be called via a URL or a service reference,
and can optionally include a custom CA bundle to use to verify the TLS connection.</p>

<h3 id="url">URL</h3>

<p><code>url</code> gives the location of the webhook, in standard URL form
(<code>scheme://host:port/path</code>).</p>

<p>The <code>host</code> should not refer to a service running in the cluster; use
a service reference by specifying the <code>service</code> field instead.
The host might be resolved via external DNS in some apiservers
(i.e., <code>kube-apiserver</code> cannot resolve in-cluster DNS as that would
be a layering violation). <code>host</code> may also be an IP address.</p>

<p>Please note that using <code>localhost</code> or <code>127.0.0.1</code> as a <code>host</code> is
risky unless you take great care to run this webhook on all hosts
which run an apiserver which might need to make calls to this
webhook. Such installs are likely to be non-portable, i.e., not easy
to turn up in a new cluster.</p>

<p>The scheme must be &ldquo;https&rdquo;; the URL must begin with &ldquo;https://&ldquo;.</p>

<p>Attempting to use a user or basic auth (for example &ldquo;user:password@&ldquo;) is not allowed.
Fragments (&ldquo;#&hellip;&rdquo;) and query parameters (&ldquo;?&hellip;&rdquo;) are also not allowed.</p>

<p>Here is an example of a conversion webhook configured to call a URL
(and expects the TLS certificate to be verified using system trust roots, so does not specify a caBundle):</p>

<div id="customresourcedefinition-versioning-example-3">
<ul>
    
      
  <li><a href="#customresourcedefinition-versioning-example-3-0">apiextensions.k8s.io/v1</a></li>

      
  <li><a href="#customresourcedefinition-versioning-example-3-1">apiextensions.k8s.io/v1beta1</a></li>

</ul>


<div id="customresourcedefinition-versioning-example-3-0">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>apiextensions.k8s.io/v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>CustomResourceDefinition<span style="color:#bbb">
</span><span style="color:#bbb"></span>...<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>...<span style="color:#bbb">
</span><span style="color:#bbb">  </span>conversion:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>strategy:<span style="color:#bbb"> </span>Webhook<span style="color:#bbb">
</span><span style="color:#bbb">    </span>webhook:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>clientConfig:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>url:<span style="color:#bbb"> </span><span style="color:#b44">&#34;https://my-webhook.example.com:9443/my-webhook-path&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>...</code></pre></div>
    

<p></div></p>

<div id="customresourcedefinition-versioning-example-3-1">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#080;font-style:italic"># Deprecated in v1.16 in favor of apiextensions.k8s.io/v1</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>apiVersion:<span style="color:#bbb"> </span>apiextensions.k8s.io/v1beta1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>CustomResourceDefinition<span style="color:#bbb">
</span><span style="color:#bbb"></span>...<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>...<span style="color:#bbb">
</span><span style="color:#bbb">  </span>conversion:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>strategy:<span style="color:#bbb"> </span>Webhook<span style="color:#bbb">
</span><span style="color:#bbb">    </span>webhookClientConfig:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>url:<span style="color:#bbb"> </span><span style="color:#b44">&#34;https://my-webhook.example.com:9443/my-webhook-path&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>...</code></pre></div>
    

<p></div></p>

<p></div></p>

<script>$(function(){$("#customresourcedefinition-versioning-example-3").tabs();});</script>

<h3 id="service-reference">Service Reference</h3>

<p>The <code>service</code> stanza inside <code>webhookClientConfig</code> is a reference to the service for a conversion webhook.
If the webhook is running within the cluster, then you should use <code>service</code> instead of <code>url</code>.
The service namespace and name are required. The port is optional and defaults to 443.
The path is optional and defaults to &ldquo;/&rdquo;.</p>

<p>Here is an example of a webhook that is configured to call a service on port &ldquo;1234&rdquo;
at the subpath &ldquo;/my-path&rdquo;, and to verify the TLS connection against the ServerName
<code>my-service-name.my-service-namespace.svc</code> using a custom CA bundle.</p>

<div id="customresourcedefinition-versioning-example-4">
<ul>
    
      
  <li><a href="#customresourcedefinition-versioning-example-4-0">apiextensions.k8s.io/v1</a></li>

      
  <li><a href="#customresourcedefinition-versioning-example-4-1">apiextensions.k8s.io/v1beta1</a></li>

</ul>


<div id="customresourcedefinition-versioning-example-4-0">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>apiextensions.k8s.io/v1b<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>CustomResourceDefinition<span style="color:#bbb">
</span><span style="color:#bbb"></span>...<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>...<span style="color:#bbb">
</span><span style="color:#bbb">  </span>conversion:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>strategy:<span style="color:#bbb"> </span>Webhook<span style="color:#bbb">
</span><span style="color:#bbb">    </span>webhook:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>clientConfig:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>service:<span style="color:#bbb">
</span><span style="color:#bbb">          </span>namespace:<span style="color:#bbb"> </span>my-service-namespace<span style="color:#bbb">
</span><span style="color:#bbb">          </span>name:<span style="color:#bbb"> </span>my-service-name<span style="color:#bbb">
</span><span style="color:#bbb">          </span>path:<span style="color:#bbb"> </span>/my-path<span style="color:#bbb">
</span><span style="color:#bbb">          </span>port:<span style="color:#bbb"> </span><span style="color:#666">1234</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span>caBundle:<span style="color:#bbb"> </span><span style="color:#b44">&#34;Ci0tLS0tQk...&lt;base64-encoded PEM bundle&gt;...tLS0K&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>...</code></pre></div>
    

<p></div></p>

<div id="customresourcedefinition-versioning-example-4-1">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#080;font-style:italic"># Deprecated in v1.16 in favor of apiextensions.k8s.io/v1</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>apiVersion:<span style="color:#bbb"> </span>apiextensions.k8s.io/v1beta1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>CustomResourceDefinition<span style="color:#bbb">
</span><span style="color:#bbb"></span>...<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>...<span style="color:#bbb">
</span><span style="color:#bbb">  </span>conversion:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>strategy:<span style="color:#bbb"> </span>Webhook<span style="color:#bbb">
</span><span style="color:#bbb">    </span>webhookClientConfig:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>service:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>namespace:<span style="color:#bbb"> </span>my-service-namespace<span style="color:#bbb">
</span><span style="color:#bbb">        </span>name:<span style="color:#bbb"> </span>my-service-name<span style="color:#bbb">
</span><span style="color:#bbb">        </span>path:<span style="color:#bbb"> </span>/my-path<span style="color:#bbb">
</span><span style="color:#bbb">        </span>port:<span style="color:#bbb"> </span><span style="color:#666">1234</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span>caBundle:<span style="color:#bbb"> </span><span style="color:#b44">&#34;Ci0tLS0tQk...&lt;base64-encoded PEM bundle&gt;...tLS0K&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>...</code></pre></div>
    

<p></div></p>

<p></div></p>

<script>$(function(){$("#customresourcedefinition-versioning-example-4").tabs();});</script>

<h2 id="webhook-request-and-response">Webhook request and response</h2>

<h3 id="request">Request</h3>

<p>Webhooks are sent a POST request, with <code>Content-Type: application/json</code>,
with a <code>ConversionReview</code> API object in the <code>apiextensions.k8s.io</code> API group
serialized to JSON as the body.</p>

<p>Webhooks can specify what versions of <code>ConversionReview</code> objects they accept
with the <code>conversionReviewVersions</code> field in their CustomResourceDefinition:</p>

<div id="conversionreviewversions">
<ul>
    
      
  <li><a href="#conversionreviewversions-0">apiextensions.k8s.io/v1</a></li>

      
  <li><a href="#conversionreviewversions-1">apiextensions.k8s.io/v1beta1</a></li>

</ul>


<div id="conversionreviewversions-0">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>apiextensions.k8s.io/v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>CustomResourceDefinition<span style="color:#bbb">
</span><span style="color:#bbb"></span>...<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>...<span style="color:#bbb">
</span><span style="color:#bbb">  </span>conversion:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>strategy:<span style="color:#bbb"> </span>Webhook<span style="color:#bbb">
</span><span style="color:#bbb">    </span>webhook:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>conversionReviewVersions:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;v1&#34;</span>,<span style="color:#bbb"> </span><span style="color:#b44">&#34;v1beta1&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">      </span>...</code></pre></div>
<p><code>conversionReviewVersions</code> is a required field when creating
<code>apiextensions.k8s.io/v1</code> custom resource definitions.
Webhooks are required to support at least one <code>ConversionReview</code>
version understood by the current and previous API server.</p>

    
</div>

<div id="conversionreviewversions-1">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#080;font-style:italic"># Deprecated in v1.16 in favor of apiextensions.k8s.io/v1</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>apiVersion:<span style="color:#bbb"> </span>apiextensions.k8s.io/v1beta1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>CustomResourceDefinition<span style="color:#bbb">
</span><span style="color:#bbb"></span>...<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>...<span style="color:#bbb">
</span><span style="color:#bbb">  </span>conversion:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>strategy:<span style="color:#bbb"> </span>Webhook<span style="color:#bbb">
</span><span style="color:#bbb">    </span>conversionReviewVersions:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;v1&#34;</span>,<span style="color:#bbb"> </span><span style="color:#b44">&#34;v1beta1&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span>...</code></pre></div>
<p>If no <code>conversionReviewVersions</code> are specified, the default when creating
<code>apiextensions.k8s.io/v1beta1</code> custom resource definitions is <code>v1beta1</code>.</p>

    
</div>

<p></div></p>

<script>$(function(){$("#conversionreviewversions").tabs();});</script>

<p>API servers send the first <code>ConversionReview</code> version in the <code>conversionReviewVersions</code> list they support.
If none of the versions in the list are supported by the API server, the custom resource definition will not be allowed to be created.
If an API server encounters a conversion webhook configuration that was previously created and does not support any of the <code>ConversionReview</code>
versions the API server knows how to send, attempts to call to the webhook will fail.</p>

<p>This example shows the data contained in an <code>ConversionReview</code> object
for a request to convert <code>CronTab</code> objects to <code>example.com/v1</code>:</p>

<div id="conversionreview-request">
<ul>
    
      
  <li><a href="#conversionreview-request-0">apiextensions.k8s.io/v1</a></li>

      
  <li><a href="#conversionreview-request-1">apiextensions.k8s.io/v1beta1</a></li>

</ul>


<div id="conversionreview-request-0">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">{<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#b44">&#34;apiVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;apiextensions.k8s.io/v1&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#b44">&#34;kind&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;ConversionReview&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#b44">&#34;request&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># Random uid uniquely identifying this conversion call</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;uid&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;705ab4f5-6393-11e8-b7cc-42010a800002&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">    
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># The API group and version the objects should be converted to</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;desiredAPIVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;example.com/v1&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">    
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># The list of objects to convert.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># May contain one or more objects, in one or more versions.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;objects&#34;</span>:<span style="color:#bbb"> </span>[<span style="color:#bbb">
</span><span style="color:#bbb">      </span>{<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;kind&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;CronTab&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;apiVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;example.com/v1beta1&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;metadata&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;creationTimestamp&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;2019-09-04T14:03:02Z&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;name&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;local-crontab&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;namespace&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;default&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;resourceVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;143&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;uid&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;3415a7fc-162b-4300-b5da-fd6083580d66&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span>},<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;hostPort&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;localhost:1234&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span>},<span style="color:#bbb">
</span><span style="color:#bbb">      </span>{<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;kind&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;CronTab&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;apiVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;example.com/v1beta1&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;metadata&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;creationTimestamp&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;2019-09-03T13:02:01Z&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;name&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;remote-crontab&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;resourceVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;12893&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;uid&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;359a83ec-b575-460d-b553-d859cedde8a0&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span>},<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;hostPort&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;example.com:2345&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span>}<span style="color:#bbb">
</span><span style="color:#bbb">    </span>]<span style="color:#bbb">
</span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span><span style="color:#bbb"></span>}</code></pre></div>
    

<p></div></p>

<div id="conversionreview-request-1">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">{<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># Deprecated in v1.16 in favor of apiextensions.k8s.io/v1</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#b44">&#34;apiVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;apiextensions.k8s.io/v1beta1&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#b44">&#34;kind&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;ConversionReview&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#b44">&#34;request&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># Random uid uniquely identifying this conversion call</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;uid&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;705ab4f5-6393-11e8-b7cc-42010a800002&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">    
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># The API group and version the objects should be converted to</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;desiredAPIVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;example.com/v1&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">    
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># The list of objects to convert.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># May contain one or more objects, in one or more versions.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;objects&#34;</span>:<span style="color:#bbb"> </span>[<span style="color:#bbb">
</span><span style="color:#bbb">      </span>{<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;kind&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;CronTab&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;apiVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;example.com/v1beta1&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;metadata&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;creationTimestamp&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;2019-09-04T14:03:02Z&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;name&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;local-crontab&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;namespace&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;default&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;resourceVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;143&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;uid&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;3415a7fc-162b-4300-b5da-fd6083580d66&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span>},<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;hostPort&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;localhost:1234&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span>},<span style="color:#bbb">
</span><span style="color:#bbb">      </span>{<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;kind&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;CronTab&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;apiVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;example.com/v1beta1&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;metadata&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;creationTimestamp&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;2019-09-03T13:02:01Z&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;name&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;remote-crontab&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;resourceVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;12893&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;uid&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;359a83ec-b575-460d-b553-d859cedde8a0&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span>},<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;hostPort&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;example.com:2345&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span>}<span style="color:#bbb">
</span><span style="color:#bbb">    </span>]<span style="color:#bbb">
</span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span><span style="color:#bbb"></span>}</code></pre></div>
    

<p></div></p>

<p></div></p>

<script>$(function(){$("#conversionreview-request").tabs();});</script>

<h3 id="response">Response</h3>

<p>Webhooks respond with a 200 HTTP status code, <code>Content-Type: application/json</code>,
and a body containing a <code>ConversionReview</code> object (in the same version they were sent),
with the <code>response</code> stanza populated, serialized to JSON.</p>

<p>If conversion succeeds, a webhook should return a <code>response</code> stanza containing the following fields:
* <code>uid</code>, copied from the <code>request.uid</code> sent to the webhook
* <code>result</code>, set to <code>{&quot;status&quot;:&quot;Success&quot;}</code>
* <code>convertedObjects</code>, containing all of the objects from <code>request.objects</code>, converted to <code>request.desiredVersion</code></p>

<p>Example of a minimal successful response from a webhook:</p>

<div id="conversionreview-response-success">
<ul>
    
      
  <li><a href="#conversionreview-response-success-0">apiextensions.k8s.io/v1</a></li>

      
  <li><a href="#conversionreview-response-success-1">apiextensions.k8s.io/v1beta1</a></li>

</ul>


<div id="conversionreview-response-success-0">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">{<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#b44">&#34;apiVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;apiextensions.k8s.io/v1&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#b44">&#34;kind&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;ConversionReview&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#b44">&#34;response&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># must match &lt;request.uid&gt;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;uid&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;705ab4f5-6393-11e8-b7cc-42010a800002&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;result&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#b44">&#34;status&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;Success&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>},<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># Objects must match the order of request.objects, and have apiVersion set to &lt;request.desiredAPIVersion&gt;.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># kind, metadata.uid, metadata.name, and metadata.namespace fields must not be changed by the webhook.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># metadata.labels and metadata.annotations fields may be changed by the webhook.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># All other changes to metadata fields by the webhook are ignored.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;convertedObjects&#34;</span>:<span style="color:#bbb"> </span>[<span style="color:#bbb">
</span><span style="color:#bbb">      </span>{<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;kind&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;CronTab&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;apiVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;example.com/v1&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;metadata&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;creationTimestamp&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;2019-09-04T14:03:02Z&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;name&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;local-crontab&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;namespace&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;default&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;resourceVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;143&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;uid&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;3415a7fc-162b-4300-b5da-fd6083580d66&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span>},<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;host&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;localhost&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;port&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;1234&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span>},<span style="color:#bbb">
</span><span style="color:#bbb">      </span>{<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;kind&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;CronTab&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;apiVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;example.com/v1&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;metadata&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;creationTimestamp&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;2019-09-03T13:02:01Z&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;name&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;remote-crontab&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;resourceVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;12893&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;uid&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;359a83ec-b575-460d-b553-d859cedde8a0&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span>},<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;host&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;example.com&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;port&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;2345&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span>}<span style="color:#bbb">
</span><span style="color:#bbb">    </span>]<span style="color:#bbb">
</span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span><span style="color:#bbb"></span>}</code></pre></div>
    

<p></div></p>

<div id="conversionreview-response-success-1">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">{<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># Deprecated in v1.16 in favor of apiextensions.k8s.io/v1</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#b44">&#34;apiVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;apiextensions.k8s.io/v1beta1&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#b44">&#34;kind&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;ConversionReview&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#b44">&#34;response&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># must match &lt;request.uid&gt;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;uid&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;705ab4f5-6393-11e8-b7cc-42010a800002&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;result&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#b44">&#34;status&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;Failed&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>},<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># Objects must match the order of request.objects, and have apiVersion set to &lt;request.desiredAPIVersion&gt;.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># kind, metadata.uid, metadata.name, and metadata.namespace fields must not be changed by the webhook.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># metadata.labels and metadata.annotations fields may be changed by the webhook.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic"># All other changes to metadata fields by the webhook are ignored.</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;convertedObjects&#34;</span>:<span style="color:#bbb"> </span>[<span style="color:#bbb">
</span><span style="color:#bbb">      </span>{<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;kind&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;CronTab&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;apiVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;example.com/v1&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;metadata&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;creationTimestamp&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;2019-09-04T14:03:02Z&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;name&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;local-crontab&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;namespace&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;default&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;resourceVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;143&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;uid&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;3415a7fc-162b-4300-b5da-fd6083580d66&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span>},<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;host&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;localhost&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;port&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;1234&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span>},<span style="color:#bbb">
</span><span style="color:#bbb">      </span>{<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;kind&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;CronTab&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;apiVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;example.com/v1&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;metadata&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;creationTimestamp&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;2019-09-03T13:02:01Z&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;name&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;remote-crontab&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;resourceVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;12893&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#b44">&#34;uid&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;359a83ec-b575-460d-b553-d859cedde8a0&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span>},<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;host&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;example.com&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#b44">&#34;port&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;2345&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span>}<span style="color:#bbb">
</span><span style="color:#bbb">    </span>]<span style="color:#bbb">
</span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span><span style="color:#bbb"></span>}</code></pre></div>
    

<p></div></p>

<p></div></p>

<script>$(function(){$("#conversionreview-response-success").tabs();});</script>

<p>If conversion fails, a webhook should return a <code>response</code> stanza containing the following fields:
* <code>uid</code>, copied from the <code>request.uid</code> sent to the webhook
* <code>result</code>, set to <code>{&quot;status&quot;:&quot;Failed&quot;}</code></p>

<blockquote class="warning">
  <div><strong>Warning:</strong> Failing conversion can disrupt read and write access to the custom resources,
including the ability to update or delete the resources. Conversion failures
should be avoided whenever possible, and should not be used to enforce validation
 constraints (use validation schemas or webhook admission instead).</div>
</blockquote>

<p>Example of a response from a webhook indicating a conversion request failed, with an optional message:</p>

<div id="conversionreview-response-failure">
<ul>
    
      
  <li><a href="#conversionreview-response-failure-0">apiextensions.k8s.io/v1</a></li>

      
  <li><a href="#conversionreview-response-failure-1">apiextensions.k8s.io/v1beta1</a></li>

</ul>


<div id="conversionreview-response-failure-0">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">{<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#b44">&#34;apiVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;apiextensions.k8s.io/v1&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#b44">&#34;kind&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;ConversionReview&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#b44">&#34;response&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;uid&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;&lt;value from request.uid&gt;&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;result&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#b44">&#34;status&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;Failed&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#b44">&#34;message&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;hostPort could not be parsed into a separate host and port&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span><span style="color:#bbb"></span>}</code></pre></div>
    

<p></div></p>

<div id="conversionreview-response-failure-1">
    
        <div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">{<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># Deprecated in v1.16 in favor of apiextensions.k8s.io/v1</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#b44">&#34;apiVersion&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;apiextensions.k8s.io/v1beta1&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#b44">&#34;kind&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;ConversionReview&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#b44">&#34;response&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;uid&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;&lt;value from request.uid&gt;&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;result&#34;</span>:<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#b44">&#34;status&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;Failed&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#b44">&#34;message&#34;</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;hostPort could not be parsed into a separate host and port&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span><span style="color:#bbb"></span>}</code></pre></div>
    

<p></div></p>

<p></div></p>

<script>$(function(){$("#conversionreview-response-failure").tabs();});</script>

<h2 id="writing-reading-and-updating-versioned-customresourcedefinition-objects">Writing, reading, and updating versioned CustomResourceDefinition objects</h2>

<p>When an object is written, it is persisted at the version designated as the
storage version at the time of the write. If the storage version changes,
existing objects are never converted automatically. However, newly-created
or updated objects are written at the new storage version. It is possible for an
object to have been written at a version that is no longer served.</p>

<p>When you read an object, you specify the version as part of the path. If you
specify a version that is different from the object&rsquo;s persisted version,
Kubernetes returns the object to you at the version you requested, but the
persisted object is neither changed on disk, nor converted in any way
(other than changing the <code>apiVersion</code> string) while serving the request.
You can request an object at any version that is currently served.</p>

<p>If you update an existing object, it is rewritten at the version that is
currently the storage version. This is the only way that objects can change from
one version to another.</p>

<p>To illustrate this, consider the following hypothetical series of events:</p>

<ol>
<li>The storage version is <code>v1beta1</code>. You create an object. It is persisted in
storage at version <code>v1beta1</code></li>
<li>You add version <code>v1</code> to your CustomResourceDefinition and designate it as
the storage version.</li>
<li>You read your object at version <code>v1beta1</code>, then you read the object again at
version <code>v1</code>. Both returned objects are identical except for the apiVersion
field.</li>
<li>You create a new object. It is persisted in storage at version <code>v1</code>. You now
have two objects, one of which is at <code>v1beta1</code>, and the other of which is at
<code>v1</code>.</li>
<li>You update the first object. It is now persisted at version <code>v1</code> since that
is the current storage version.</li>
</ol>

<h3 id="previous-storage-versions">Previous storage versions</h3>

<p>The API server records each version which has ever been marked as the storage
version in the status field <code>storedVersions</code>. Objects may have been persisted
at any version that has ever been designated as a storage version. No objects
can exist in storage at a version that has never been a storage version.</p>

<h2 id="upgrade-existing-objects-to-a-new-stored-version">Upgrade existing objects to a new stored version</h2>

<p>When deprecating versions and dropping support, select a storage upgrade
procedure.</p>

<p><em>Option 1:</em> Use the Storage Version Migrator</p>

<ol>
<li>Run the <a href="https://github.com/kubernetes-sigs/kube-storage-version-migrator" target="_blank">storage Version migrator</a></li>
<li>Remove the old version from the CustomResourceDefinition <code>status.storedVersions</code> field.</li>
</ol>

<p><em>Option 2:</em> Manually upgrade the existing objects to a new stored version</p>

<p>The following is an example procedure to upgrade from <code>v1beta1</code> to <code>v1</code>.</p>

<ol>
<li>Set <code>v1</code> as the storage in the CustomResourceDefinition file and apply it
using kubectl. The <code>storedVersions</code> is now <code>v1beta1, v1</code>.</li>
<li>Write an upgrade procedure to list all existing objects and write them with
the same content. This forces the backend to write objects in the current
storage version, which is <code>v1</code>.</li>
<li>Remove <code>v1beta1</code> from the CustomResourceDefinition <code>status.storedVersions</code> field.</li>
</ol>




















    
            
  <h2>Feedback</h2>
  <p class="feedback--prompt">Was this page helpful? </p>
  <button class="button feedback--yes">Yes</button>
  <button class="button feedback--no">No</button>
  <p class="feedback--response feedback--response__hidden">
    Thanks for the feedback. If you have a specific, answerable question about how to use Kubernetes, ask it on
    <a target="_blank" rel="noopener"
      href="https://stackoverflow.com/questions/tagged/kubernetes">
      Stack Overflow</a>.
    Open an issue in the GitHub repo if you want to 
    <a class="feedback--link" target="_blank" rel="noopener"
      href="https://github.com/kubernetes/website/issues/new?title=Issue%20with%20k8s.io">
      report a problem</a>
    or
    <a class="feedback--link" target="_blank" rel="noopener"
      href="https://github.com/kubernetes/website/issues/new?title=Improvement%20for%20k8s.io">
      suggest an improvement</a>.
  </p>
  <script>
    const yes = document.querySelector('.feedback--yes');
    const no = document.querySelector('.feedback--no');
    document.querySelectorAll('.feedback--link').forEach(link => {
      link.href = link.href + window.location.pathname;
    });
    const sendFeedback = (value) => {
      if (!gtag) { console.log('!gtag'); }
      gtag('event', 'click', {
        'event_category': 'Helpful',
        'event_label': window.location.pathname,
        value
      });
    };
    const disableButtons = () => {
      yes.disabled = true;
      yes.classList.add('feedback--button__disabled');
      no.disabled = true;
      no.classList.add('feedback--button__disabled');
    };
    yes.addEventListener('click', () => {
      sendFeedback(1);
      disableButtons();
      document.querySelector('.feedback--response').classList.remove('feedback--response__hidden');
    });
    no.addEventListener('click', () => {
      sendFeedback(0);
      disableButtons();
      document.querySelector('.feedback--response').classList.remove('feedback--response__hidden');
    });
  </script>


    
            <div id="pre-footer"> 
  <hr />

  <div class="issue-button-container">
    <p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs/tasks/access-kubernetes-api/custom-resources/custom-resource-definition-versioning.md?pixel" alt="Analytics" /></a></p>
    
    
    <script type="text/javascript">
    PDRTJS_settings_8345992 = {
    "id" : "8345992",
    "unique_id" : "\/docs\/tasks\/access-kubernetes-api\/custom-resources\/custom-resource-definition-versioning\/",
    "title" : "Versions in CustomResourceDefinitions",
    "permalink" : "https:\/\/kubernetes.io\/docs\/tasks\/access-kubernetes-api\/custom-resources\/custom-resource-definition-versioning\/"
    };
    (function(d,c,j){if(!document.getElementById(j)){var pd=d.createElement(c),s;pd.id=j;pd.src=('https:'==document.location.protocol)?'https://polldaddy.com/js/rating/rating.js':'http://i0.poll.fm/js/rating/rating.js';s=document.getElementsByTagName(c)[0];s.parentNode.insertBefore(pd,s);}}(document,'script','pd-rating-js'));
    </script>
    <a href="" onclick="window.open('https://github.com/kubernetes/website/issues/new?template=bug-report.md&title=Issue%20with%20' +
    'k8s.io'+window.location.pathname)" class="button issue">Create an Issue</a>
    
    
    
    <a href="https://github.com/kubernetes/website/edit/master/content/en/docs/tasks/access-kubernetes-api/custom-resources/custom-resource-definition-versioning.md" class="button issue">Edit This Page</a>
    
  </div>
  

  <div id="lastedit" class="lastedit issue-button-container">
    Page last modified on April 09, 2020 at 1:27 PM PST by
    <a href="https://github.com/kubernetes/website/commit/095c9034ebda40f3a0fd012050c5867ee6514c57/">Fix feature-state typo</a> (<a href="https://github.com/kubernetes/website/commits/master/content/en/docs/tasks/access-kubernetes-api/custom-resources/custom-resource-definition-versioning.md">Page History</a>)
  </div>
  
</div>

          </div>
        </section>
    </main>
		<footer>
    <div class="light-text main-section">
        <nav>
            
            
            
            <a href="/docs/home/">Home</a>
            
            <a href="/blog/">Blog</a>
            
            <a href="/training/">Training</a>
            
            <a href="/partners/">Partners</a>
            
            <a href="/community/">Community</a>
            
            <a href="/case-studies/">Case Studies</a>
            
        </nav>
        <div class="social" role="region" aria-label="Social hyperlinks">
            <div>
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>Twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>GitHub</span></a>
                <a href="https://slack.k8s.io/" class="slack"><span>Slack</span></a>
            </div>
            <div>
                <a href="https://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://www.youtube.com/kubernetescommunity" class="youtube"><span>YouTube</span></a>
                <a href="https://discuss.kubernetes.io" class="mailing-list"><span>Forum</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
            <div>
                
                <a href="https://git.k8s.io/community/contributors/guide" class="button">Contribute</a>
            </div>
        </div>
        <div class="miceType center">
            &copy; 2023 The Kubernetes Authors | Documentation Distributed under <a href="https://git.k8s.io/website/LICENSE" class="light-text">CC BY 4.0</a></a>
        </div>
        <div class="miceType center">
            Copyright &copy; 2023 The Linux Foundation &reg;. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage" class="light-text">Trademark Usage page</a>
        </div>
        <div class="miceType center">
            ICP license: 京ICP备17074266号-3
        </div>
    </div>
</footer>

		<button class="flyout-button" onclick="kub.toggleToc()" aria-label="Toggle table of contents visibility"></button>

<script>

(function () {
    window.addEventListener('DOMContentLoaded', init)

        
        function init() {
            window.removeEventListener('DOMContentLoaded', init)
                hideNav()
        }

    function hideNav(toc){
        if (!toc) toc = document.querySelector('#docsToc')
        if (!toc) return
            var container = toc.querySelector('.container')

                
                if (container) {
                    if (container.childElementCount === 0 || toc.querySelectorAll('a.item').length === 1) {
                        toc.style.display = 'none'
                            document.getElementById('docsContent').style.width = '100%'
                    }
                } else {
                    requestAnimationFrame(function () {
                        hideNav(toc)
                    })
                }
    }
})();
</script>



    <script language="application/javascript">
      
      (function addHeadingLinks(){
        var article = document.getElementById('docsContent');
        var headings = article.querySelectorAll('h1, h2, h3, h4, h5, h6');
        headings.forEach(function(heading){
          if(heading.id){
            var a = document.createElement('a');
            a.innerHTML = heading.innerHTML;
            a.href = '#'+heading.id;
            a.classList.add('inpage_heading');
            heading.innerHTML = '';
            heading.appendChild(a);
          }
        });
      })();
    </script>
	</body>
</html>
